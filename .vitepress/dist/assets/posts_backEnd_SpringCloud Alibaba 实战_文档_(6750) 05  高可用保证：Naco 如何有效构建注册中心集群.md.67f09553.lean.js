import{_ as l,j as e,o as c,g as t,k as p,h as a,s,Q as o}from"./chunks/framework.b3d8e22e.js";const z=JSON.parse('{"title":"如何在生产环境部署 Nacos 集群 ","description":"","frontmatter":{},"headers":[],"relativePath":"posts/backEnd/SpringCloud Alibaba 实战_文档/(6750) 05  高可用保证：Naco 如何有效构建注册中心集群.md","filePath":"posts/backEnd/SpringCloud Alibaba 实战_文档/(6750) 05  高可用保证：Naco 如何有效构建注册中心集群.md","lastUpdated":1696417798000}'),r={name:"posts/backEnd/SpringCloud Alibaba 实战_文档/(6750) 05  高可用保证：Naco 如何有效构建注册中心集群.md"},i=s("p",null,"上一节我们学习了 Nacos 注册中心的作用以及单点运行的方法，但是单点运行是分布式应用的大忌，在分布式架构中，任何单点都可能成为系统的瓶颈，因此在生产环境中 Nacos 都需要通过部署集群来为系统带来高可用性。因此本文围绕 Nacos 集群主要讲解以下三方面内容：",-1),y=s("ul",null,[s("li",null,[s("p",null,"生产环境 Nacos 集群的设计要点；")]),s("li",null,[s("p",null,"Nacos 集群的部署过程；")]),s("li",null,[s("p",null,"介绍 Nacos 集群的工作原理。")])],-1),E=s("h3",{id:"如何在生产环境部署-nacos-集群",tabindex:"-1"},[a("如何在生产环境部署 Nacos 集群 "),s("a",{class:"header-anchor",href:"#如何在生产环境部署-nacos-集群","aria-label":'Permalink to "如何在生产环境部署 Nacos 集群"'},"​")],-1),d=s("p",null,"首先介绍下之前我们在国内某互联网金融机构在项目中落地的 Nacos 集群架构图。",-1),g=o("",6),u=s("p",null,"Nacos 采用 Raft 选举算法构成集群",-1),_=s("p",null,"这里需要准备三台服务器（虚拟机）。",-1),h=s("p",null,"我为此准备了三个 CentOS 7 节点，符合最低运行要求，其 IP 地址分别为：",-1),m=s("ul",null,[s("li",null,[s("p",null,"192.168.163.131")]),s("li",null,[s("p",null,"192.168.163.132")]),s("li",null,[s("p",null,"192.168.163.133")])],-1),A=s("p",null,"在这三个节点上安装好 JDK1.8，并配置 JAVA_HOME 环境变量，这些操作在上一节我们已经讲过，不再赘述。",-1),F=s("p",null,"此外还需要额外部署一台 MySQL 数据库用于保存 Nacos 的配置管理、权限控制信息。这里推荐版本为 MySQL5.7 或者 MySQL 8.0。在我这部署版本为 5.7，IP 地址为：192.168.163.100。",-1),D=s("p",null,"MySQL 5.7",-1),C=s("p",null,"第二步，下载安装 Nacos。",-1),N=s("p",null,[a("访问到 "),s("a",{href:"https://github.com/alibaba/nacos/releases/",target:"_blank",rel:"noreferrer"},"https://github.com/alibaba/nacos/releases/"),a(" 网址下载 Nacos 1.4.0 版本，上传到每一台 CentOS 服务器的 /usr/local 目录下，执行解压缩命令，生成 Nacos 目录")],-1),v=s("p",null,"tar -xvf nacos-server-1.4.0.tar.gz。",-1),f=s("p",null,"第三步，配置数据库。",-1),b=s("p",null,[a("使用任意 MySQL 客户端工具连接到 192.168.163.100 MySQL 数据库服务器，创建名为"),s("strong",null,"nacos_config"),a("的数据库，之后使用 MySQL 客户端执行 /usr/local/nacos/conf/nacos-mysql.sql 文件，完成建表工作。")],-1),B=s("p",null,"nacos_config 数据库初始化脚本",-1),I=o("",10),k=o("",17),T=o("",7),S=o("",13),L=s("p",null,[s("strong",null,"2"),a(". 当第一个节点（192.168.163.131）启动后，节点角色会变为 Candidate（参选者），131 节点在每一个任期开始时便会尝试向其他节点发出投票请求，征求自己能否成为 Leader（领导者）节点。只有算上自己获得超过半数的选票，这个 Candidate 才能转正为 Leader。在当前案例，因为 131 发起选举投票，但 132/133 两个节点不在线，尽管 131 会投自己一票，但在总 3 票中未过半数，因此无法成为 Leader。因为第一次选举没有产生 Leader，过段时间在下一个任期开始时，131 任期自增加 1，同时会再次向其他节点发起投票请求争取其他节点同意，直到同意票过半。")],-1),P=s("p",null,[s("strong",null,"3"),a(". 在 Raft 算法中，成为 Leader 的必要条件是某个 Candidate 获得过半选票，如果 132 节点上线，遇到 131 再次发起投票。132 投票给 131 节点，131 获得两票超过半数就会成为 Leader，132 节点自动成为 Follower（跟随者）。之后 133 节点上线，因为集群中已有 Leader，因此自动成为 Follower。")],-1),M=s("p",null,[s("strong",null,"4"),a(". 当 Leader 节点宕机或停止服务，会在剩余 2 个 Nacos 节点中产生新的 Leader。如下所示133获得两票成为 Leader，132 成为 Follower，131已经下线但角色暂时仍为 Leader。")],-1),O=s("p",null,"之后 131 恢复上线，但此时 Nacos 集群已有 Leader 存在，131 自动变为 Follower，且任期归0。",-1),j=s("p",null,'对于 Nacos 集群来说，只要 UP 状态节点不少于"1+N/2"，集群就能正常运行。但少于"1+N/2"，集群仍然可以提供基本服务，但已无法保证 Nacos 各节点数据一致性。',-1),q=s("p",null,"以上就是 Nacos 基于 Raft 算法的 Leader 选举过程，确定 Leader 是维持 Nacos 集群数据一致的最重要前提，下面咱们来讲解在微服务注册时 Nacos 集群节点信息同步的过程。",-1),V=s("h4",{id:"nacos-节点间的数据同步过程",tabindex:"-1"},[a("Nacos 节点间的数据同步过程 "),s("a",{class:"header-anchor",href:"#nacos-节点间的数据同步过程","aria-label":'Permalink to "Nacos 节点间的数据同步过程"'},"​")],-1),W=o("",13);function R(w,x,U,Q,H,K){const n=e("Image");return c(),t("div",null,[i,y,E,d,p(n,{alt:"图片1.png",src:"https://s0.lgstatic.com/i/image6/M00/17/D5/Cgp9HWBIOSmAEY5YAAFUhNaig_g183.png"}),a(),g,p(n,{alt:"图片2.png",src:"https://s0.lgstatic.com/i/image6/M00/17/D5/Cgp9HWBIOTaACHdNAAB65jPftjw609.png"}),a(),u,_,p(n,{alt:"图片33.png",src:"https://s0.lgstatic.com/i/image6/M00/17/D5/Cgp9HWBIOUeADoKoAACIf4r0los343.png"}),h,m,A,F,p(n,{alt:"图片3.png",src:"https://s0.lgstatic.com/i/image6/M00/17/D2/CioPOWBIOVWAGIT6AACwjSPbAOU621.png"}),a(),D,C,N,v,f,b,p(n,{alt:"图片4.png",src:"https://s0.lgstatic.com/i/image6/M00/17/D5/Cgp9HWBIOWKARz8WAAHyivVDZSc196.png"}),a(),B,p(n,{alt:"图片5.png",src:"https://s0.lgstatic.com/i/image6/M00/17/D5/Cgp9HWBIOWyAd5UDAAQe_yLhXDQ150.png"}),a(),I,p(n,{alt:"图片6.png",src:"https://s0.lgstatic.com/i/image6/M00/17/D2/CioPOWBIOXmATuVRAAI3C58AO6c101.png"}),a(),k,p(n,{alt:"图片7.png",src:"https://s0.lgstatic.com/i/image6/M00/17/D2/CioPOWBIOYeAJqqdAACwUrKESBA196.png"}),a(),T,p(n,{alt:"图片8.png",src:"https://s0.lgstatic.com/i/image6/M00/17/D2/CioPOWBIOdaALpeCAAE1rBNc27E800.png"}),a(),S,p(n,{alt:"图片9.png",src:"https://s0.lgstatic.com/i/image6/M00/17/D2/CioPOWBIOemAcpszAACWRdvNMIo546.png"}),L,p(n,{alt:"图片10.png",src:"https://s0.lgstatic.com/i/image6/M00/17/D5/Cgp9HWBIOfSAASKiAACS-9OmEeE300.png"}),P,p(n,{alt:"图片11.png",src:"https://s0.lgstatic.com/i/image6/M00/17/D2/CioPOWBIOf6AboGSAACKsdc9V-c338.png"}),M,p(n,{alt:"图片12.png",src:"https://s0.lgstatic.com/i/image6/M00/17/D5/Cgp9HWBIOgiAaSQiAAEOTYlnWd4160.png"}),O,p(n,{alt:"图片13.png",src:"https://s0.lgstatic.com/i/image6/M01/17/D5/Cgp9HWBIOhKAQkAnAAEMwMIgMgk554.png"}),j,q,V,p(n,{alt:"图片14.png",src:"https://s0.lgstatic.com/i/image6/M01/17/D5/Cgp9HWBIOi-AfhfTAAHNmiaYSdk747.png"}),a(),W])}const J=l(r,[["render",R]]);export{z as __pageData,J as default};
