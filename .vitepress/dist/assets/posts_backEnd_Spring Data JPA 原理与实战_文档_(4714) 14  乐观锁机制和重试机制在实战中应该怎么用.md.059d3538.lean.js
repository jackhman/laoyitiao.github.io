import{_ as l,j as o,o as e,g as t,k as a,Q as p,s}from"./chunks/framework.e0c66c3f.js";const k=JSON.parse('{"title":"什么是乐观锁？ ","description":"","frontmatter":{},"headers":[],"relativePath":"posts/backEnd/Spring Data JPA 原理与实战_文档/(4714) 14  乐观锁机制和重试机制在实战中应该怎么用.md","filePath":"posts/backEnd/Spring Data JPA 原理与实战_文档/(4714) 14  乐观锁机制和重试机制在实战中应该怎么用.md","lastUpdated":1696338709000}'),c={name:"posts/backEnd/Spring Data JPA 原理与实战_文档/(4714) 14  乐观锁机制和重试机制在实战中应该怎么用.md"},r=p("",26),E=s("p",null,"而当面我们调用 testVersionException() 测试方法的时候，利用多线程模拟两个并发情况，会发现两个线程同时取到了历史数据，并在稍后都对历史数据进行了更新。",-1),y=s("p",null,"由此你会发现，第二次测试的结果是乐观锁异常，更新不成功。请看一下测试的日志。",-1),i=p("",8),F=s("p",null,"然后，我们进入JpaMetamodelEntityInformation.class 的 isNew 方法中，又会看到下图显示的界面：",-1),u=p("",14),d=p("",8),A=s("p",null,"下面对常用的 @Retryable 注解中的参数做一下说明：",-1),g=s("ul",null,[s("li",null,[s("p",null,"maxAttempts：最大重试次数，默认为 3，如果要设置的重试次数为 3，可以不写；")]),s("li",null,[s("p",null,"value：抛出指定异常才会重试；")]),s("li",null,[s("p",null,"include：和 value 一样，默认为空，当 exclude 也为空时，默认异常；")]),s("li",null,[s("p",null,"exclude：指定不处理的异常；")]),s("li",null,[s("p",null,"backoff：重试等待策略，默认使用 @Backoff@Backoff 的 value，默认为 1s，请看下面这个图。")])],-1),C=p("",19),D=s("p",null,"然后再执行上面测试中 testRetryable 的方法，跑完测试用例的结果依然是通过的，我们看下日志。",-1),v=p("",6);function I(h,f,b,B,S,_){const n=o("Image");return e(),t("div",null,[r,a(n,{alt:"Drawing 0.png",src:"https://s0.lgstatic.com/i/image/M00/64/E8/CgqCHl-ZUkCASJB6AAH97IuFt1U060.png"}),E,y,a(n,{alt:"Drawing 1.png",src:"https://s0.lgstatic.com/i/image/M00/64/DC/Ciqc1F-ZUkuAZ6qBAAM4TfMZ9YY533.png"}),i,a(n,{alt:"Drawing 2.png",src:"https://s0.lgstatic.com/i/image/M00/64/DC/Ciqc1F-ZUlKALr4SAAGsINmt1QQ621.png"}),F,a(n,{alt:"Drawing 3.png",src:"https://s0.lgstatic.com/i/image/M00/64/DC/Ciqc1F-ZUlmAKt-nAATVCuJgboE277.png"}),u,a(n,{alt:"Drawing 4.png",src:"https://s0.lgstatic.com/i/image/M00/64/E8/CgqCHl-ZUmOAOdGWAADMjETgqAc000.png"}),d,a(n,{alt:"Drawing 5.png",src:"https://s0.lgstatic.com/i/image/M00/64/E8/CgqCHl-ZUmyASpCIAAAw6lXSyoU826.png"}),A,g,a(n,{alt:"Drawing 6.png",src:"https://s0.lgstatic.com/i/image/M00/64/DC/Ciqc1F-ZUnKAJlLUAAAlCGiHUTA658.png"}),C,a(n,{alt:"Drawing 7.png",src:"https://s0.lgstatic.com/i/image/M00/64/DC/Ciqc1F-ZUoGAJBLoAAERlsfoZ0I396.png"}),D,a(n,{alt:"Drawing 8.png",src:"https://s0.lgstatic.com/i/image/M00/64/DC/Ciqc1F-ZUoeAGW2QAAH9g4lZzE4000.png"}),v])}const T=l(c,[["render",I]]);export{k as __pageData,T as default};
