import{_ as p,j as o,o as e,h as r,k as a,f as n,Q as l,s as c}from"./chunks/framework.d3daa342.js";const A=JSON.parse('{"title":"25经典的N+1SQL问题如何正确解决？（上）","description":"","frontmatter":{},"headers":[],"relativePath":"posts/backEnd/Spring Data JPA 原理与实战_文档/(4725) 25  经典的 N+1 SQL 问题如何正确解决？（上）.md","filePath":"posts/backEnd/Spring Data JPA 原理与实战_文档/(4725) 25  经典的 N+1 SQL 问题如何正确解决？（上）.md","lastUpdated":1696682708000}'),t={name:"posts/backEnd/Spring Data JPA 原理与实战_文档/(4725) 25  经典的 N+1 SQL 问题如何正确解决？（上）.md"},E=l(`<h1 id="_25经典的n-1sql问题如何正确解决-上" tabindex="-1">25经典的N+1SQL问题如何正确解决？（上） <a class="header-anchor" href="#_25经典的n-1sql问题如何正确解决-上" aria-label="Permalink to &quot;25经典的N+1SQL问题如何正确解决？（上）&quot;">​</a></h1><p>在 JPA 的使用过程中，N+1 SQL 是很常见的问题，相信很多程序员都遇到过这一问题，我看见很多同事处理起来束手无策，那么它究竟真的有那么麻烦吗？这一讲我会帮助你梳理思路，看看到底如何解决这个经典问题。</p><p>注：由于内容较多，我将这部分内容拆分成两讲，方便你学习。</p><h3 id="什么是-n-1-sql-问题" tabindex="-1">什么是 N+1 SQL 问题？ <a class="header-anchor" href="#什么是-n-1-sql-问题" aria-label="Permalink to &quot;什么是 N+1 SQL 问题？&quot;">​</a></h3><p>想要解决一个问题，必须要知道它是什么、如何产生的，这样才能有方法、有逻辑地去解决它。下面通过一个例子来看一下什么是 N+1 的 SQL 问题。</p><p>假设一个 UserInfo 实体对象和 Address 是一对多的关系，即一个用户有多个地址，我们首先看一下一般实体里面的关联关系会怎么写。两个实体对象如下述代码所示。</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">//UserInfo实体对象如下：</span></span>
<span class="line"><span style="color:#E1E4E8;">@</span><span style="color:#F97583;">Entity</span></span>
<span class="line"><span style="color:#E1E4E8;">@</span><span style="color:#F97583;">Data</span></span>
<span class="line"><span style="color:#E1E4E8;">@</span><span style="color:#F97583;">SuperBuilder</span></span>
<span class="line"><span style="color:#E1E4E8;">@</span><span style="color:#F97583;">AllArgsConstructor</span></span>
<span class="line"><span style="color:#E1E4E8;">@</span><span style="color:#F97583;">NoArgsConstructor</span></span>
<span class="line"><span style="color:#E1E4E8;">@</span><span style="color:#F97583;">Table</span></span>
<span class="line"><span style="color:#E1E4E8;">@</span><span style="color:#F97583;">ToString</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">exclude</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;addressList&quot;</span><span style="color:#E1E4E8;">)</span><span style="color:#6A737D;">//exclued防止 toString打印日志的时候死循环</span></span>
<span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">UserInfo</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">extends</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">BaseEntity</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">private</span><span style="color:#E1E4E8;"> String name;</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">private</span><span style="color:#E1E4E8;"> String telephone;</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#6A737D;">// UserInfo实体对象的关联关系由Address对象里面的userInfo字段维护，默认是lazy加载模式，为了方便演示fetch取EAGER模式。此处是一对多关联关系</span></span>
<span class="line"><span style="color:#E1E4E8;">   @</span><span style="color:#F97583;">OneToMany</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">mappedBy</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;userInfo&quot;</span><span style="color:#E1E4E8;">,</span><span style="color:#79B8FF;">fetch</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> FetchType.EAGER)</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">private</span><span style="color:#E1E4E8;"> List&lt;</span><span style="color:#F97583;">Address</span><span style="color:#E1E4E8;">&gt; addressList;</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"><span style="color:#6A737D;">//Address对象如下：</span></span>
<span class="line"><span style="color:#E1E4E8;">@</span><span style="color:#F97583;">Entity</span></span>
<span class="line"><span style="color:#E1E4E8;">@</span><span style="color:#F97583;">Table</span></span>
<span class="line"><span style="color:#E1E4E8;">@</span><span style="color:#F97583;">Data</span></span>
<span class="line"><span style="color:#E1E4E8;">@</span><span style="color:#F97583;">SuperBuilder</span></span>
<span class="line"><span style="color:#E1E4E8;">@</span><span style="color:#F97583;">AllArgsConstructor</span></span>
<span class="line"><span style="color:#E1E4E8;">@</span><span style="color:#F97583;">NoArgsConstructor</span></span>
<span class="line"><span style="color:#E1E4E8;">@</span><span style="color:#F97583;">ToString</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">exclude</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;userInfo&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Address</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">extends</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">BaseEntity</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">private</span><span style="color:#E1E4E8;"> String city;</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#6A737D;">//维护UserInfo和Address的外键关系，方便演示也采用EAGER模式；</span></span>
<span class="line"><span style="color:#E1E4E8;">   @</span><span style="color:#F97583;">ManyToOne</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">fetch</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> FetchType.EAGER)</span></span>
<span class="line"><span style="color:#E1E4E8;">   @</span><span style="color:#F97583;">JsonBackReference</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">//此注解防止JSON死循环</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">private</span><span style="color:#E1E4E8;"> UserInfo userInfo;</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">//UserInfo实体对象如下：</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Entity</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Data</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">SuperBuilder</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">AllArgsConstructor</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">NoArgsConstructor</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Table</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">ToString</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">exclude</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;addressList&quot;</span><span style="color:#24292E;">)</span><span style="color:#6A737D;">//exclued防止 toString打印日志的时候死循环</span></span>
<span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">UserInfo</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">extends</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">BaseEntity</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> String name;</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> String telephone;</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6A737D;">// UserInfo实体对象的关联关系由Address对象里面的userInfo字段维护，默认是lazy加载模式，为了方便演示fetch取EAGER模式。此处是一对多关联关系</span></span>
<span class="line"><span style="color:#24292E;">   @</span><span style="color:#D73A49;">OneToMany</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">mappedBy</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;userInfo&quot;</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">fetch</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> FetchType.EAGER)</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> List&lt;</span><span style="color:#D73A49;">Address</span><span style="color:#24292E;">&gt; addressList;</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#6A737D;">//Address对象如下：</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Entity</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Table</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Data</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">SuperBuilder</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">AllArgsConstructor</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">NoArgsConstructor</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">ToString</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">exclude</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;userInfo&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Address</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">extends</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">BaseEntity</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> String city;</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6A737D;">//维护UserInfo和Address的外键关系，方便演示也采用EAGER模式；</span></span>
<span class="line"><span style="color:#24292E;">   @</span><span style="color:#D73A49;">ManyToOne</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">fetch</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> FetchType.EAGER)</span></span>
<span class="line"><span style="color:#24292E;">   @</span><span style="color:#D73A49;">JsonBackReference</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">//此注解防止JSON死循环</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> UserInfo userInfo;</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><p>其次，我们假设数据库里面有三条 UserInfo 的数据，ID 分别为 3、6、9，如下图所示。</p>`,8),y=c("p",null,"其中，每个 UserInfo 分别有两条 Address 数据，也就是一共 6 条 Address 的数据，如下图所示。",-1),_=l(`<p>然后，我们请求通过 UserInfoRepository 查询所有的 UserInfo 信息，方法如下面这行代码所示。</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">userInfoRepository.</span><span style="color:#B392F0;">findAll</span><span style="color:#E1E4E8;">()</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">userInfoRepository.</span><span style="color:#6F42C1;">findAll</span><span style="color:#24292E;">()</span></span></code></pre></div><p>现在，我们的控制台将会得到四个 SQL，如下所示。</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#79B8FF;">org</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">hibernate</span><span style="color:#E1E4E8;">.</span><span style="color:#F97583;">SQL</span><span style="color:#E1E4E8;">                        :</span></span>
<span class="line"><span style="color:#F97583;">select</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">userinfo0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">id</span><span style="color:#E1E4E8;">                    </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> id1_1_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">userinfo0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">create_time</span><span style="color:#E1E4E8;">           </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> create_t2_1_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">userinfo0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">create_user_id</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> create_u3_1_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">userinfo0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">last_modified_time</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> last_mod4_1_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">userinfo0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">last_modified_user_id</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> last_mod5_1_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">userinfo0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">version</span><span style="color:#E1E4E8;">               </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> version6_1_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">userinfo0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">ages</span><span style="color:#E1E4E8;">                  </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> ages7_1_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">userinfo0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">email_address</span><span style="color:#E1E4E8;">         </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> email_ad8_1_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">userinfo0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">last_name</span><span style="color:#E1E4E8;">             </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> last_nam9_1_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">userinfo0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">name</span><span style="color:#E1E4E8;">                  </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> name10_1_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">userinfo0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">telephone</span><span style="color:#E1E4E8;">             </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> telepho11_1_</span></span>
<span class="line"><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> user_info userinfo0_ </span><span style="color:#79B8FF;">org</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">hibernate</span><span style="color:#E1E4E8;">.</span><span style="color:#F97583;">SQL</span><span style="color:#E1E4E8;">                        :</span></span>
<span class="line"><span style="color:#F97583;">select</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">addresslis0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">user_info_id</span><span style="color:#E1E4E8;">          </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> user_inf8_0_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">addresslis0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">id</span><span style="color:#E1E4E8;">                    </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> id1_0_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">addresslis0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">id</span><span style="color:#E1E4E8;">                    </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> id1_0_1_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">addresslis0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">create_time</span><span style="color:#E1E4E8;">           </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> create_t2_0_1_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">addresslis0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">create_user_id</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> create_u3_0_1_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">addresslis0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">last_modified_time</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> last_mod4_0_1_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">addresslis0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">last_modified_user_id</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> last_mod5_0_1_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">addresslis0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">version</span><span style="color:#E1E4E8;">               </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> version6_0_1_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">addresslis0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">city</span><span style="color:#E1E4E8;">                  </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> city7_0_1_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">addresslis0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">user_info_id</span><span style="color:#E1E4E8;">          </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> user_inf8_0_1_</span></span>
<span class="line"><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">address</span><span style="color:#E1E4E8;"> addresslis0_</span></span>
<span class="line"><span style="color:#F97583;">where</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">addresslis0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">user_info_id</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> ? </span><span style="color:#79B8FF;">org</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">hibernate</span><span style="color:#E1E4E8;">.</span><span style="color:#F97583;">SQL</span><span style="color:#E1E4E8;">                        :</span></span>
<span class="line"><span style="color:#F97583;">select</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">addresslis0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">user_info_id</span><span style="color:#E1E4E8;">          </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> user_inf8_0_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">addresslis0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">id</span><span style="color:#E1E4E8;">                    </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> id1_0_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">addresslis0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">id</span><span style="color:#E1E4E8;">                    </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> id1_0_1_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">addresslis0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">create_time</span><span style="color:#E1E4E8;">           </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> create_t2_0_1_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">addresslis0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">create_user_id</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> create_u3_0_1_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">addresslis0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">last_modified_time</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> last_mod4_0_1_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">addresslis0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">last_modified_user_id</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> last_mod5_0_1_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">addresslis0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">version</span><span style="color:#E1E4E8;">               </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> version6_0_1_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">addresslis0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">city</span><span style="color:#E1E4E8;">                  </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> city7_0_1_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">addresslis0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">user_info_id</span><span style="color:#E1E4E8;">          </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> user_inf8_0_1_</span></span>
<span class="line"><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">address</span><span style="color:#E1E4E8;"> addresslis0_</span></span>
<span class="line"><span style="color:#F97583;">where</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">addresslis0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">user_info_id</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> ? </span><span style="color:#79B8FF;">org</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">hibernate</span><span style="color:#E1E4E8;">.</span><span style="color:#F97583;">SQL</span><span style="color:#E1E4E8;">                        :</span></span>
<span class="line"><span style="color:#F97583;">select</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">addresslis0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">user_info_id</span><span style="color:#E1E4E8;">          </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> user_inf8_0_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">addresslis0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">id</span><span style="color:#E1E4E8;">                    </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> id1_0_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">addresslis0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">id</span><span style="color:#E1E4E8;">                    </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> id1_0_1_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">addresslis0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">create_time</span><span style="color:#E1E4E8;">           </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> create_t2_0_1_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">addresslis0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">create_user_id</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> create_u3_0_1_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">addresslis0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">last_modified_time</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> last_mod4_0_1_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">addresslis0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">last_modified_user_id</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> last_mod5_0_1_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">addresslis0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">version</span><span style="color:#E1E4E8;">               </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> version6_0_1_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">addresslis0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">city</span><span style="color:#E1E4E8;">                  </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> city7_0_1_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">addresslis0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">user_info_id</span><span style="color:#E1E4E8;">          </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> user_inf8_0_1_</span></span>
<span class="line"><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">address</span><span style="color:#E1E4E8;"> addresslis0_</span></span>
<span class="line"><span style="color:#F97583;">where</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">addresslis0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">user_info_id</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> ?</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#005CC5;">org</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">hibernate</span><span style="color:#24292E;">.</span><span style="color:#D73A49;">SQL</span><span style="color:#24292E;">                        :</span></span>
<span class="line"><span style="color:#D73A49;">select</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">userinfo0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">id</span><span style="color:#24292E;">                    </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> id1_1_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">userinfo0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">create_time</span><span style="color:#24292E;">           </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> create_t2_1_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">userinfo0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">create_user_id</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> create_u3_1_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">userinfo0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">last_modified_time</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> last_mod4_1_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">userinfo0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">last_modified_user_id</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> last_mod5_1_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">userinfo0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">version</span><span style="color:#24292E;">               </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> version6_1_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">userinfo0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">ages</span><span style="color:#24292E;">                  </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> ages7_1_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">userinfo0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">email_address</span><span style="color:#24292E;">         </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> email_ad8_1_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">userinfo0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">last_name</span><span style="color:#24292E;">             </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> last_nam9_1_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">userinfo0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">name</span><span style="color:#24292E;">                  </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> name10_1_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">userinfo0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">telephone</span><span style="color:#24292E;">             </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> telepho11_1_</span></span>
<span class="line"><span style="color:#D73A49;">from</span><span style="color:#24292E;"> user_info userinfo0_ </span><span style="color:#005CC5;">org</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">hibernate</span><span style="color:#24292E;">.</span><span style="color:#D73A49;">SQL</span><span style="color:#24292E;">                        :</span></span>
<span class="line"><span style="color:#D73A49;">select</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">addresslis0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">user_info_id</span><span style="color:#24292E;">          </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> user_inf8_0_0_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">addresslis0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">id</span><span style="color:#24292E;">                    </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> id1_0_0_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">addresslis0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">id</span><span style="color:#24292E;">                    </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> id1_0_1_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">addresslis0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">create_time</span><span style="color:#24292E;">           </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> create_t2_0_1_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">addresslis0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">create_user_id</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> create_u3_0_1_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">addresslis0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">last_modified_time</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> last_mod4_0_1_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">addresslis0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">last_modified_user_id</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> last_mod5_0_1_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">addresslis0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">version</span><span style="color:#24292E;">               </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> version6_0_1_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">addresslis0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">city</span><span style="color:#24292E;">                  </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> city7_0_1_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">addresslis0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">user_info_id</span><span style="color:#24292E;">          </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> user_inf8_0_1_</span></span>
<span class="line"><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">address</span><span style="color:#24292E;"> addresslis0_</span></span>
<span class="line"><span style="color:#D73A49;">where</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">addresslis0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">user_info_id</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> ? </span><span style="color:#005CC5;">org</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">hibernate</span><span style="color:#24292E;">.</span><span style="color:#D73A49;">SQL</span><span style="color:#24292E;">                        :</span></span>
<span class="line"><span style="color:#D73A49;">select</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">addresslis0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">user_info_id</span><span style="color:#24292E;">          </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> user_inf8_0_0_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">addresslis0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">id</span><span style="color:#24292E;">                    </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> id1_0_0_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">addresslis0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">id</span><span style="color:#24292E;">                    </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> id1_0_1_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">addresslis0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">create_time</span><span style="color:#24292E;">           </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> create_t2_0_1_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">addresslis0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">create_user_id</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> create_u3_0_1_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">addresslis0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">last_modified_time</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> last_mod4_0_1_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">addresslis0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">last_modified_user_id</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> last_mod5_0_1_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">addresslis0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">version</span><span style="color:#24292E;">               </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> version6_0_1_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">addresslis0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">city</span><span style="color:#24292E;">                  </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> city7_0_1_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">addresslis0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">user_info_id</span><span style="color:#24292E;">          </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> user_inf8_0_1_</span></span>
<span class="line"><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">address</span><span style="color:#24292E;"> addresslis0_</span></span>
<span class="line"><span style="color:#D73A49;">where</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">addresslis0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">user_info_id</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> ? </span><span style="color:#005CC5;">org</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">hibernate</span><span style="color:#24292E;">.</span><span style="color:#D73A49;">SQL</span><span style="color:#24292E;">                        :</span></span>
<span class="line"><span style="color:#D73A49;">select</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">addresslis0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">user_info_id</span><span style="color:#24292E;">          </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> user_inf8_0_0_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">addresslis0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">id</span><span style="color:#24292E;">                    </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> id1_0_0_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">addresslis0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">id</span><span style="color:#24292E;">                    </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> id1_0_1_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">addresslis0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">create_time</span><span style="color:#24292E;">           </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> create_t2_0_1_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">addresslis0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">create_user_id</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> create_u3_0_1_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">addresslis0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">last_modified_time</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> last_mod4_0_1_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">addresslis0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">last_modified_user_id</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> last_mod5_0_1_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">addresslis0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">version</span><span style="color:#24292E;">               </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> version6_0_1_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">addresslis0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">city</span><span style="color:#24292E;">                  </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> city7_0_1_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">addresslis0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">user_info_id</span><span style="color:#24292E;">          </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> user_inf8_0_1_</span></span>
<span class="line"><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">address</span><span style="color:#24292E;"> addresslis0_</span></span>
<span class="line"><span style="color:#D73A49;">where</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">addresslis0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">user_info_id</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> ?</span></span></code></pre></div><p>通过 SQL 我们可以看得出来，当取 UserInfo 的时候，有多少条 UserInfo 数据就会触发多少条查询 Address 的 SQL。</p><p>那么所谓的 N+1 的 SQL，此时 1 代表的是一条 SQL 查询 UserInfo 信息；N 条 SQL 查询 Address 的信息。你可以想象一下，如果有 100 条 UserInfo 信息，可能会触发 100 条查询 Address 的 SQL，性能多差呀。</p><p>很简单，这就是我们常说的 N+1 SQL 问题。我们这里使用的是 EAGER 模式，当使用 LAZY 的时候也是一样的道理，只是生成 N 条 SQL 的时机是不一样的。</p><p>上面我演示了 @OneToMany 的情况，那么我们再看一下 @ManyToOne 的情况。利用 AddressRepository 查询所有的 Address 信息，方法如下面这行代码所示。</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">addressRepository.</span><span style="color:#B392F0;">findAll</span><span style="color:#E1E4E8;">();</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">addressRepository.</span><span style="color:#6F42C1;">findAll</span><span style="color:#24292E;">();</span></span></code></pre></div><p>这个时候我们再看一下控制台，会产生如下 SQL。</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">org.hibernate.SQL                        </span><span style="color:#F97583;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">select address0_.id                    as id1_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       address0_.create_time           as create_t2_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       address0_.create_user_id        as create_u3_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       address0_.last_modified_time    as last_mod4_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       address0_.last_modified_user_id as last_mod5_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       address0_.version               as version6_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       address0_.city                  as city7_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       address0_.user_info_id          as user_inf8_0_</span></span>
<span class="line"><span style="color:#E1E4E8;">from address address0_ </span></span>
<span class="line"><span style="color:#E1E4E8;">org.hibernate.SQL                        </span><span style="color:#F97583;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">select userinfo0_.id                      as id1_1_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       userinfo0_.create_time             as create_t2_1_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       userinfo0_.create_user_id          as create_u3_1_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       userinfo0_.last_modified_time      as last_mod4_1_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       userinfo0_.last_modified_user_id   as last_mod5_1_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       userinfo0_.version                 as version6_1_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       userinfo0_.ages                    as ages7_1_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       userinfo0_.email_address           as email_ad8_1_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       userinfo0_.last_name               as last_nam9_1_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       userinfo0_.name                    as name10_1_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       userinfo0_.telephone               as telepho11_1_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       addresslis1_.user_info_id          as user_inf8_0_1_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       addresslis1_.id                    as id1_0_1_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       addresslis1_.id                    as id1_0_2_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       addresslis1_.create_time           as create_t2_0_2_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       addresslis1_.create_user_id        as create_u3_0_2_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       addresslis1_.last_modified_time    as last_mod4_0_2_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       addresslis1_.last_modified_user_id as last_mod5_0_2_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       addresslis1_.version               as version6_0_2_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       addresslis1_.city                  as city7_0_2_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       addresslis1_.user_info_id          as user_inf8_0_2_</span></span>
<span class="line"><span style="color:#E1E4E8;">from user_info userinfo0_</span></span>
<span class="line"><span style="color:#E1E4E8;">         left outer join address addresslis1_ on userinfo0_.id </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> addresslis1_.user_info_id</span></span>
<span class="line"><span style="color:#E1E4E8;">where userinfo0_.id </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">?</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#E1E4E8;">org.hibernate.SQL                        </span><span style="color:#F97583;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">select userinfo0_.id                      as id1_1_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       userinfo0_.create_time             as create_t2_1_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       userinfo0_.create_user_id          as create_u3_1_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       userinfo0_.last_modified_time      as last_mod4_1_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       userinfo0_.last_modified_user_id   as last_mod5_1_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       userinfo0_.version                 as version6_1_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       userinfo0_.ages                    as ages7_1_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       userinfo0_.email_address           as email_ad8_1_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       userinfo0_.last_name               as last_nam9_1_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       userinfo0_.name                    as name10_1_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       userinfo0_.telephone               as telepho11_1_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       addresslis1_.user_info_id          as user_inf8_0_1_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       addresslis1_.id                    as id1_0_1_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       addresslis1_.id                    as id1_0_2_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       addresslis1_.create_time           as create_t2_0_2_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       addresslis1_.create_user_id        as create_u3_0_2_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       addresslis1_.last_modified_time    as last_mod4_0_2_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       addresslis1_.last_modified_user_id as last_mod5_0_2_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       addresslis1_.version               as version6_0_2_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       addresslis1_.city                  as city7_0_2_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       addresslis1_.user_info_id          as user_inf8_0_2_</span></span>
<span class="line"><span style="color:#E1E4E8;">from user_info userinfo0_</span></span>
<span class="line"><span style="color:#E1E4E8;">         left outer join address addresslis1_ on userinfo0_.id </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> addresslis1_.user_info_id</span></span>
<span class="line"><span style="color:#E1E4E8;">where userinfo0_.id </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">?</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#E1E4E8;">org.hibernate.SQL                        </span><span style="color:#F97583;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">select userinfo0_.id                      as id1_1_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       userinfo0_.create_time             as create_t2_1_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       userinfo0_.create_user_id          as create_u3_1_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       userinfo0_.last_modified_time      as last_mod4_1_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       userinfo0_.last_modified_user_id   as last_mod5_1_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       userinfo0_.version                 as version6_1_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       userinfo0_.ages                    as ages7_1_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       userinfo0_.email_address           as email_ad8_1_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       userinfo0_.last_name               as last_nam9_1_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       userinfo0_.name                    as name10_1_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       userinfo0_.telephone               as telepho11_1_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       addresslis1_.user_info_id          as user_inf8_0_1_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       addresslis1_.id                    as id1_0_1_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       addresslis1_.id                    as id1_0_2_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       addresslis1_.create_time           as create_t2_0_2_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       addresslis1_.create_user_id        as create_u3_0_2_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       addresslis1_.last_modified_time    as last_mod4_0_2_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       addresslis1_.last_modified_user_id as last_mod5_0_2_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       addresslis1_.version               as version6_0_2_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       addresslis1_.city                  as city7_0_2_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       addresslis1_.user_info_id          as user_inf8_0_2_</span></span>
<span class="line"><span style="color:#E1E4E8;">from user_info userinfo0_</span></span>
<span class="line"><span style="color:#E1E4E8;">         left outer join address addresslis1_ on userinfo0_.id </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> addresslis1_.user_info_id</span></span>
<span class="line"><span style="color:#E1E4E8;">where userinfo0_.id </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">?</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">org.hibernate.SQL                        </span><span style="color:#D73A49;">:</span></span>
<span class="line"><span style="color:#24292E;">select address0_.id                    as id1_0_,</span></span>
<span class="line"><span style="color:#24292E;">       address0_.create_time           as create_t2_0_,</span></span>
<span class="line"><span style="color:#24292E;">       address0_.create_user_id        as create_u3_0_,</span></span>
<span class="line"><span style="color:#24292E;">       address0_.last_modified_time    as last_mod4_0_,</span></span>
<span class="line"><span style="color:#24292E;">       address0_.last_modified_user_id as last_mod5_0_,</span></span>
<span class="line"><span style="color:#24292E;">       address0_.version               as version6_0_,</span></span>
<span class="line"><span style="color:#24292E;">       address0_.city                  as city7_0_,</span></span>
<span class="line"><span style="color:#24292E;">       address0_.user_info_id          as user_inf8_0_</span></span>
<span class="line"><span style="color:#24292E;">from address address0_ </span></span>
<span class="line"><span style="color:#24292E;">org.hibernate.SQL                        </span><span style="color:#D73A49;">:</span></span>
<span class="line"><span style="color:#24292E;">select userinfo0_.id                      as id1_1_0_,</span></span>
<span class="line"><span style="color:#24292E;">       userinfo0_.create_time             as create_t2_1_0_,</span></span>
<span class="line"><span style="color:#24292E;">       userinfo0_.create_user_id          as create_u3_1_0_,</span></span>
<span class="line"><span style="color:#24292E;">       userinfo0_.last_modified_time      as last_mod4_1_0_,</span></span>
<span class="line"><span style="color:#24292E;">       userinfo0_.last_modified_user_id   as last_mod5_1_0_,</span></span>
<span class="line"><span style="color:#24292E;">       userinfo0_.version                 as version6_1_0_,</span></span>
<span class="line"><span style="color:#24292E;">       userinfo0_.ages                    as ages7_1_0_,</span></span>
<span class="line"><span style="color:#24292E;">       userinfo0_.email_address           as email_ad8_1_0_,</span></span>
<span class="line"><span style="color:#24292E;">       userinfo0_.last_name               as last_nam9_1_0_,</span></span>
<span class="line"><span style="color:#24292E;">       userinfo0_.name                    as name10_1_0_,</span></span>
<span class="line"><span style="color:#24292E;">       userinfo0_.telephone               as telepho11_1_0_,</span></span>
<span class="line"><span style="color:#24292E;">       addresslis1_.user_info_id          as user_inf8_0_1_,</span></span>
<span class="line"><span style="color:#24292E;">       addresslis1_.id                    as id1_0_1_,</span></span>
<span class="line"><span style="color:#24292E;">       addresslis1_.id                    as id1_0_2_,</span></span>
<span class="line"><span style="color:#24292E;">       addresslis1_.create_time           as create_t2_0_2_,</span></span>
<span class="line"><span style="color:#24292E;">       addresslis1_.create_user_id        as create_u3_0_2_,</span></span>
<span class="line"><span style="color:#24292E;">       addresslis1_.last_modified_time    as last_mod4_0_2_,</span></span>
<span class="line"><span style="color:#24292E;">       addresslis1_.last_modified_user_id as last_mod5_0_2_,</span></span>
<span class="line"><span style="color:#24292E;">       addresslis1_.version               as version6_0_2_,</span></span>
<span class="line"><span style="color:#24292E;">       addresslis1_.city                  as city7_0_2_,</span></span>
<span class="line"><span style="color:#24292E;">       addresslis1_.user_info_id          as user_inf8_0_2_</span></span>
<span class="line"><span style="color:#24292E;">from user_info userinfo0_</span></span>
<span class="line"><span style="color:#24292E;">         left outer join address addresslis1_ on userinfo0_.id </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> addresslis1_.user_info_id</span></span>
<span class="line"><span style="color:#24292E;">where userinfo0_.id </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">?</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#24292E;">org.hibernate.SQL                        </span><span style="color:#D73A49;">:</span></span>
<span class="line"><span style="color:#24292E;">select userinfo0_.id                      as id1_1_0_,</span></span>
<span class="line"><span style="color:#24292E;">       userinfo0_.create_time             as create_t2_1_0_,</span></span>
<span class="line"><span style="color:#24292E;">       userinfo0_.create_user_id          as create_u3_1_0_,</span></span>
<span class="line"><span style="color:#24292E;">       userinfo0_.last_modified_time      as last_mod4_1_0_,</span></span>
<span class="line"><span style="color:#24292E;">       userinfo0_.last_modified_user_id   as last_mod5_1_0_,</span></span>
<span class="line"><span style="color:#24292E;">       userinfo0_.version                 as version6_1_0_,</span></span>
<span class="line"><span style="color:#24292E;">       userinfo0_.ages                    as ages7_1_0_,</span></span>
<span class="line"><span style="color:#24292E;">       userinfo0_.email_address           as email_ad8_1_0_,</span></span>
<span class="line"><span style="color:#24292E;">       userinfo0_.last_name               as last_nam9_1_0_,</span></span>
<span class="line"><span style="color:#24292E;">       userinfo0_.name                    as name10_1_0_,</span></span>
<span class="line"><span style="color:#24292E;">       userinfo0_.telephone               as telepho11_1_0_,</span></span>
<span class="line"><span style="color:#24292E;">       addresslis1_.user_info_id          as user_inf8_0_1_,</span></span>
<span class="line"><span style="color:#24292E;">       addresslis1_.id                    as id1_0_1_,</span></span>
<span class="line"><span style="color:#24292E;">       addresslis1_.id                    as id1_0_2_,</span></span>
<span class="line"><span style="color:#24292E;">       addresslis1_.create_time           as create_t2_0_2_,</span></span>
<span class="line"><span style="color:#24292E;">       addresslis1_.create_user_id        as create_u3_0_2_,</span></span>
<span class="line"><span style="color:#24292E;">       addresslis1_.last_modified_time    as last_mod4_0_2_,</span></span>
<span class="line"><span style="color:#24292E;">       addresslis1_.last_modified_user_id as last_mod5_0_2_,</span></span>
<span class="line"><span style="color:#24292E;">       addresslis1_.version               as version6_0_2_,</span></span>
<span class="line"><span style="color:#24292E;">       addresslis1_.city                  as city7_0_2_,</span></span>
<span class="line"><span style="color:#24292E;">       addresslis1_.user_info_id          as user_inf8_0_2_</span></span>
<span class="line"><span style="color:#24292E;">from user_info userinfo0_</span></span>
<span class="line"><span style="color:#24292E;">         left outer join address addresslis1_ on userinfo0_.id </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> addresslis1_.user_info_id</span></span>
<span class="line"><span style="color:#24292E;">where userinfo0_.id </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">?</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#24292E;">org.hibernate.SQL                        </span><span style="color:#D73A49;">:</span></span>
<span class="line"><span style="color:#24292E;">select userinfo0_.id                      as id1_1_0_,</span></span>
<span class="line"><span style="color:#24292E;">       userinfo0_.create_time             as create_t2_1_0_,</span></span>
<span class="line"><span style="color:#24292E;">       userinfo0_.create_user_id          as create_u3_1_0_,</span></span>
<span class="line"><span style="color:#24292E;">       userinfo0_.last_modified_time      as last_mod4_1_0_,</span></span>
<span class="line"><span style="color:#24292E;">       userinfo0_.last_modified_user_id   as last_mod5_1_0_,</span></span>
<span class="line"><span style="color:#24292E;">       userinfo0_.version                 as version6_1_0_,</span></span>
<span class="line"><span style="color:#24292E;">       userinfo0_.ages                    as ages7_1_0_,</span></span>
<span class="line"><span style="color:#24292E;">       userinfo0_.email_address           as email_ad8_1_0_,</span></span>
<span class="line"><span style="color:#24292E;">       userinfo0_.last_name               as last_nam9_1_0_,</span></span>
<span class="line"><span style="color:#24292E;">       userinfo0_.name                    as name10_1_0_,</span></span>
<span class="line"><span style="color:#24292E;">       userinfo0_.telephone               as telepho11_1_0_,</span></span>
<span class="line"><span style="color:#24292E;">       addresslis1_.user_info_id          as user_inf8_0_1_,</span></span>
<span class="line"><span style="color:#24292E;">       addresslis1_.id                    as id1_0_1_,</span></span>
<span class="line"><span style="color:#24292E;">       addresslis1_.id                    as id1_0_2_,</span></span>
<span class="line"><span style="color:#24292E;">       addresslis1_.create_time           as create_t2_0_2_,</span></span>
<span class="line"><span style="color:#24292E;">       addresslis1_.create_user_id        as create_u3_0_2_,</span></span>
<span class="line"><span style="color:#24292E;">       addresslis1_.last_modified_time    as last_mod4_0_2_,</span></span>
<span class="line"><span style="color:#24292E;">       addresslis1_.last_modified_user_id as last_mod5_0_2_,</span></span>
<span class="line"><span style="color:#24292E;">       addresslis1_.version               as version6_0_2_,</span></span>
<span class="line"><span style="color:#24292E;">       addresslis1_.city                  as city7_0_2_,</span></span>
<span class="line"><span style="color:#24292E;">       addresslis1_.user_info_id          as user_inf8_0_2_</span></span>
<span class="line"><span style="color:#24292E;">from user_info userinfo0_</span></span>
<span class="line"><span style="color:#24292E;">         left outer join address addresslis1_ on userinfo0_.id </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> addresslis1_.user_info_id</span></span>
<span class="line"><span style="color:#24292E;">where userinfo0_.id </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">?</span></span></code></pre></div><p>这里通过 SQL 我们可以看得出来，当取 Address 的时候，Address 里面有多少个 user_info_id，就会触发多少条查询 UserInfo 的 SQL。</p><p>那么所谓的 N+1 的 SQL，此时 1 就代表一条 SQL 查询 Address 信息；N 条 SQL 查询 UserInfo 的信息。同样，你可以想象一下，如果我们有 100 条 Address 信息，分别有不同的 user_info_id 可能会触发 100 条查询 UserInfo 的 SQL，性能依然很差。</p><p>这也是我们常说的 N+1 SQL 问题，我只是给你演示了 @OneToMany 和 @ManyToOne 的情况，@ManyToMany 和 @OneToOne 也是一样的道理，都是当我们查询主体信息时候，1 条 SQL 会衍生出来关联关系的 N 条 SQL。</p><p>现在你认识了这个问题，下一步该思考，怎么解决才更合理呢？有没有什么办法可以减少 SQL 条数呢？</p><h3 id="减少-n-1-sql-的条数" tabindex="-1">减少 N+1 SQL 的条数 <a class="header-anchor" href="#减少-n-1-sql-的条数" aria-label="Permalink to &quot;减少 N+1 SQL 的条数&quot;">​</a></h3><p>最容易想到，就是有没有什么机制可以减少 N 对应的 SQL 条数呢？从原理分析会知道，不管是 LAZY 还是 EAGER 都是没有用的，因为这两个只是决定了 N 条 SQL 的触发时机，而不能减少 SQL 的条数。</p><p>不知道你是否还记得在<a href="https://kaiwu.lagou.com/course/courseInfo.htm?courseId=490#/detail/pc?id=4720" target="_blank" rel="noreferrer">第 20 讲（Spring JPA 中的 Hibernate 加载过程与配置项是怎么回事）</a>中，我们介绍过的 Hibernate 的配置项有哪些，如果你回过头去看，会发现有个配置可以改变每次批量取数据的大小。</p><h4 id="hibernate-default-batch-fetch-size-配置" tabindex="-1">hibernate.default_batch_fetch_size 配置 <a class="header-anchor" href="#hibernate-default-batch-fetch-size-配置" aria-label="Permalink to &quot;hibernate.default_batch_fetch_size 配置&quot;">​</a></h4><p>hibernate.default_batch_fetch_size 配置在 AvailableSettings.class 里面，指的是批量获取数据的大小，默认是 -1，表示默认没有匹配取数据。那么我们把这个值改成 20 看一下效果，只需要在 application.properties 里面增加如下配置即可。</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;"># 更改批量取数据的大小为20</span></span>
<span class="line"><span style="color:#E1E4E8;">spring.jpa.properties.hibernate.default_batch_fetch_size</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">20</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;"># 更改批量取数据的大小为20</span></span>
<span class="line"><span style="color:#24292E;">spring.jpa.properties.hibernate.default_batch_fetch_size</span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">20</span></span></code></pre></div><p>在实体类不发生任何改变的前提下，我们再执行如下两个方法，分别看一下 SQL 的生成情况。</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">userInfoRepository.</span><span style="color:#B392F0;">findAll</span><span style="color:#E1E4E8;">();</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">userInfoRepository.</span><span style="color:#6F42C1;">findAll</span><span style="color:#24292E;">();</span></span></code></pre></div><p>还是先查询所有的 UserInfo 信息，看一下 SQL 的执行情况，代码如下所示。</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#79B8FF;">org</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">hibernate</span><span style="color:#E1E4E8;">.</span><span style="color:#F97583;">SQL</span><span style="color:#E1E4E8;">                        :</span></span>
<span class="line"><span style="color:#F97583;">select</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">userinfo0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">id</span><span style="color:#E1E4E8;">                    </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> id1_1_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">userinfo0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">create_time</span><span style="color:#E1E4E8;">           </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> create_t2_1_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">userinfo0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">create_user_id</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> create_u3_1_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">userinfo0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">last_modified_time</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> last_mod4_1_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">userinfo0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">last_modified_user_id</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> last_mod5_1_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">userinfo0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">version</span><span style="color:#E1E4E8;">               </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> version6_1_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">userinfo0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">ages</span><span style="color:#E1E4E8;">                  </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> ages7_1_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">userinfo0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">email_address</span><span style="color:#E1E4E8;">         </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> email_ad8_1_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">userinfo0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">last_name</span><span style="color:#E1E4E8;">             </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> last_nam9_1_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">userinfo0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">name</span><span style="color:#E1E4E8;">                  </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> name10_1_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">userinfo0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">telephone</span><span style="color:#E1E4E8;">             </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> telepho11_1_</span></span>
<span class="line"><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> user_info userinfo0_ </span><span style="color:#79B8FF;">org</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">hibernate</span><span style="color:#E1E4E8;">.</span><span style="color:#F97583;">SQL</span><span style="color:#E1E4E8;">                        :</span></span>
<span class="line"><span style="color:#F97583;">select</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">addresslis0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">user_info_id</span><span style="color:#E1E4E8;">          </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> user_inf8_0_1_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">addresslis0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">id</span><span style="color:#E1E4E8;">                    </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> id1_0_1_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">addresslis0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">id</span><span style="color:#E1E4E8;">                    </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> id1_0_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">addresslis0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">create_time</span><span style="color:#E1E4E8;">           </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> create_t2_0_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">addresslis0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">create_user_id</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> create_u3_0_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">addresslis0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">last_modified_time</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> last_mod4_0_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">addresslis0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">last_modified_user_id</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> last_mod5_0_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">addresslis0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">version</span><span style="color:#E1E4E8;">               </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> version6_0_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">addresslis0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">city</span><span style="color:#E1E4E8;">                  </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> city7_0_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">addresslis0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">user_info_id</span><span style="color:#E1E4E8;">          </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> user_inf8_0_0_</span></span>
<span class="line"><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">address</span><span style="color:#E1E4E8;"> addresslis0_</span></span>
<span class="line"><span style="color:#F97583;">where</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">addresslis0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">user_info_id</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> (?, ?, ?)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#005CC5;">org</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">hibernate</span><span style="color:#24292E;">.</span><span style="color:#D73A49;">SQL</span><span style="color:#24292E;">                        :</span></span>
<span class="line"><span style="color:#D73A49;">select</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">userinfo0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">id</span><span style="color:#24292E;">                    </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> id1_1_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">userinfo0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">create_time</span><span style="color:#24292E;">           </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> create_t2_1_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">userinfo0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">create_user_id</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> create_u3_1_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">userinfo0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">last_modified_time</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> last_mod4_1_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">userinfo0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">last_modified_user_id</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> last_mod5_1_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">userinfo0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">version</span><span style="color:#24292E;">               </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> version6_1_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">userinfo0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">ages</span><span style="color:#24292E;">                  </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> ages7_1_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">userinfo0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">email_address</span><span style="color:#24292E;">         </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> email_ad8_1_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">userinfo0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">last_name</span><span style="color:#24292E;">             </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> last_nam9_1_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">userinfo0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">name</span><span style="color:#24292E;">                  </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> name10_1_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">userinfo0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">telephone</span><span style="color:#24292E;">             </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> telepho11_1_</span></span>
<span class="line"><span style="color:#D73A49;">from</span><span style="color:#24292E;"> user_info userinfo0_ </span><span style="color:#005CC5;">org</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">hibernate</span><span style="color:#24292E;">.</span><span style="color:#D73A49;">SQL</span><span style="color:#24292E;">                        :</span></span>
<span class="line"><span style="color:#D73A49;">select</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">addresslis0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">user_info_id</span><span style="color:#24292E;">          </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> user_inf8_0_1_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">addresslis0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">id</span><span style="color:#24292E;">                    </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> id1_0_1_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">addresslis0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">id</span><span style="color:#24292E;">                    </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> id1_0_0_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">addresslis0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">create_time</span><span style="color:#24292E;">           </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> create_t2_0_0_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">addresslis0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">create_user_id</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> create_u3_0_0_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">addresslis0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">last_modified_time</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> last_mod4_0_0_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">addresslis0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">last_modified_user_id</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> last_mod5_0_0_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">addresslis0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">version</span><span style="color:#24292E;">               </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> version6_0_0_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">addresslis0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">city</span><span style="color:#24292E;">                  </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> city7_0_0_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">addresslis0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">user_info_id</span><span style="color:#24292E;">          </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> user_inf8_0_0_</span></span>
<span class="line"><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">address</span><span style="color:#24292E;"> addresslis0_</span></span>
<span class="line"><span style="color:#D73A49;">where</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">addresslis0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">user_info_id</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> (?, ?, ?)</span></span></code></pre></div><p>我们可以看到 SQL 直接减少到两条了，其中查询 Address 的地方查询条件变成了 in(?,?,?)。</p><p>想象一下，如果我们有 20 条 UserInfo 信息，那么产生的 SQL 也是两条，此时要比 20+1 条 SQL 性能高太多了。</p><p>接着我们再执行另一个方法，看一下 @ManyToOne 的情况，代码如下所示。</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">addressRepository.</span><span style="color:#B392F0;">findAll</span><span style="color:#E1E4E8;">()</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">addressRepository.</span><span style="color:#6F42C1;">findAll</span><span style="color:#24292E;">()</span></span></code></pre></div><p>关于执行的 SQL 情况如下所示。</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#79B8FF;">2020</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">11</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">29</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;">:</span><span style="color:#79B8FF;">11</span><span style="color:#E1E4E8;">:</span><span style="color:#79B8FF;">27</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">381</span><span style="color:#E1E4E8;"> DEBUG </span><span style="color:#79B8FF;">30870</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">--- [nio-8087-exec-5] org.hibernate.SQL                        : </span></span>
<span class="line"><span style="color:#F97583;">select</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">address0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">id</span><span style="color:#E1E4E8;">                    </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> id1_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">address0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">create_time</span><span style="color:#E1E4E8;">           </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> create_t2_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">address0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">create_user_id</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> create_u3_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">address0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">last_modified_time</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> last_mod4_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">address0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">last_modified_user_id</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> last_mod5_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">address0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">version</span><span style="color:#E1E4E8;">               </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> version6_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">address0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">city</span><span style="color:#E1E4E8;">                  </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> city7_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">address0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">user_info_id</span><span style="color:#E1E4E8;">          </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> user_inf8_0_</span></span>
<span class="line"><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">address</span><span style="color:#E1E4E8;"> address0_</span></span>
<span class="line"><span style="color:#79B8FF;">2020</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">11</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">29</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;">:</span><span style="color:#79B8FF;">11</span><span style="color:#E1E4E8;">:</span><span style="color:#79B8FF;">27</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">383</span><span style="color:#E1E4E8;"> DEBUG </span><span style="color:#79B8FF;">30870</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">--- [nio-8087-exec-5] org.hibernate.SQL                        : </span></span>
<span class="line"><span style="color:#F97583;">select</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">userinfo0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">id</span><span style="color:#E1E4E8;">                      </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> id1_1_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">userinfo0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">create_time</span><span style="color:#E1E4E8;">             </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> create_t2_1_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">userinfo0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">create_user_id</span><span style="color:#E1E4E8;">          </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> create_u3_1_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">userinfo0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">last_modified_time</span><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> last_mod4_1_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">userinfo0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">last_modified_user_id</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> last_mod5_1_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">userinfo0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">version</span><span style="color:#E1E4E8;">                 </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> version6_1_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">userinfo0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">ages</span><span style="color:#E1E4E8;">                    </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> ages7_1_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">userinfo0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">email_address</span><span style="color:#E1E4E8;">           </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> email_ad8_1_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">userinfo0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">last_name</span><span style="color:#E1E4E8;">               </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> last_nam9_1_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">userinfo0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">name</span><span style="color:#E1E4E8;">                    </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> name10_1_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">userinfo0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">telephone</span><span style="color:#E1E4E8;">               </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> telepho11_1_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">addresslis1_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">user_info_id</span><span style="color:#E1E4E8;">          </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> user_inf8_0_1_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">addresslis1_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">id</span><span style="color:#E1E4E8;">                    </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> id1_0_1_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">addresslis1_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">id</span><span style="color:#E1E4E8;">                    </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> id1_0_2_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">addresslis1_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">create_time</span><span style="color:#E1E4E8;">           </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> create_t2_0_2_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">addresslis1_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">create_user_id</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> create_u3_0_2_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">addresslis1_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">last_modified_time</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> last_mod4_0_2_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">addresslis1_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">last_modified_user_id</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> last_mod5_0_2_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">addresslis1_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">version</span><span style="color:#E1E4E8;">               </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> version6_0_2_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">addresslis1_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">city</span><span style="color:#E1E4E8;">                  </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> city7_0_2_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">addresslis1_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">user_info_id</span><span style="color:#E1E4E8;">          </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> user_inf8_0_2_</span></span>
<span class="line"><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> user_info userinfo0_</span></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#F97583;">left outer join</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">address</span><span style="color:#E1E4E8;"> addresslis1_ </span><span style="color:#F97583;">on</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">userinfo0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">id</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">addresslis1_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">user_info_id</span></span>
<span class="line"><span style="color:#F97583;">where</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">userinfo0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">id</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> (?, ?, ?)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#005CC5;">2020</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">11</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">29</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;">:</span><span style="color:#005CC5;">11</span><span style="color:#24292E;">:</span><span style="color:#005CC5;">27</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">381</span><span style="color:#24292E;"> DEBUG </span><span style="color:#005CC5;">30870</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">--- [nio-8087-exec-5] org.hibernate.SQL                        : </span></span>
<span class="line"><span style="color:#D73A49;">select</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">address0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">id</span><span style="color:#24292E;">                    </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> id1_0_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">address0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">create_time</span><span style="color:#24292E;">           </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> create_t2_0_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">address0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">create_user_id</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> create_u3_0_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">address0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">last_modified_time</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> last_mod4_0_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">address0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">last_modified_user_id</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> last_mod5_0_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">address0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">version</span><span style="color:#24292E;">               </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> version6_0_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">address0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">city</span><span style="color:#24292E;">                  </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> city7_0_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">address0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">user_info_id</span><span style="color:#24292E;">          </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> user_inf8_0_</span></span>
<span class="line"><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">address</span><span style="color:#24292E;"> address0_</span></span>
<span class="line"><span style="color:#005CC5;">2020</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">11</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">29</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;">:</span><span style="color:#005CC5;">11</span><span style="color:#24292E;">:</span><span style="color:#005CC5;">27</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">383</span><span style="color:#24292E;"> DEBUG </span><span style="color:#005CC5;">30870</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">--- [nio-8087-exec-5] org.hibernate.SQL                        : </span></span>
<span class="line"><span style="color:#D73A49;">select</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">userinfo0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">id</span><span style="color:#24292E;">                      </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> id1_1_0_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">userinfo0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">create_time</span><span style="color:#24292E;">             </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> create_t2_1_0_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">userinfo0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">create_user_id</span><span style="color:#24292E;">          </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> create_u3_1_0_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">userinfo0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">last_modified_time</span><span style="color:#24292E;">      </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> last_mod4_1_0_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">userinfo0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">last_modified_user_id</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> last_mod5_1_0_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">userinfo0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">version</span><span style="color:#24292E;">                 </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> version6_1_0_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">userinfo0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">ages</span><span style="color:#24292E;">                    </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> ages7_1_0_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">userinfo0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">email_address</span><span style="color:#24292E;">           </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> email_ad8_1_0_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">userinfo0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">last_name</span><span style="color:#24292E;">               </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> last_nam9_1_0_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">userinfo0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">name</span><span style="color:#24292E;">                    </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> name10_1_0_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">userinfo0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">telephone</span><span style="color:#24292E;">               </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> telepho11_1_0_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">addresslis1_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">user_info_id</span><span style="color:#24292E;">          </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> user_inf8_0_1_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">addresslis1_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">id</span><span style="color:#24292E;">                    </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> id1_0_1_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">addresslis1_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">id</span><span style="color:#24292E;">                    </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> id1_0_2_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">addresslis1_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">create_time</span><span style="color:#24292E;">           </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> create_t2_0_2_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">addresslis1_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">create_user_id</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> create_u3_0_2_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">addresslis1_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">last_modified_time</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> last_mod4_0_2_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">addresslis1_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">last_modified_user_id</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> last_mod5_0_2_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">addresslis1_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">version</span><span style="color:#24292E;">               </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> version6_0_2_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">addresslis1_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">city</span><span style="color:#24292E;">                  </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> city7_0_2_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">addresslis1_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">user_info_id</span><span style="color:#24292E;">          </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> user_inf8_0_2_</span></span>
<span class="line"><span style="color:#D73A49;">from</span><span style="color:#24292E;"> user_info userinfo0_</span></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#D73A49;">left outer join</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">address</span><span style="color:#24292E;"> addresslis1_ </span><span style="color:#D73A49;">on</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">userinfo0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">id</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">addresslis1_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">user_info_id</span></span>
<span class="line"><span style="color:#D73A49;">where</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">userinfo0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">id</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> (?, ?, ?)</span></span></code></pre></div><p>从代码中可以看到，我们查询所有的 Address 信息也只产生了 2 条 SQL；而当我们查询 UserInfo 的时候，SQL 最后的查询条件也变成了 in (？，？，？)，同样的道理这样也会提升不少性能。</p><p>而 hibernate.default_batch_fetch_size 的经验参考值，可以设置成 20、30、50、100 等，太高了也没有意义。一个请求执行一次，产生的 SQL 数量为 3-5 条基本上都算合理情况，这样通过设置 default_batch_fetch_size 就可以很好地避免大部分业务场景下的 N+1 条 SQL 的性能问题了。</p><p>此时你还需要注意一点就是，在实际工作中，一定要知道我们一次操作会产生多少 SQL，有没有预期之外的 SQL 参数，这是需要关注的重点，这种情况可以利用我们之前说过的如下配置来开启打印 SQL，请看代码。</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">## 显示sql的执行日志，如果开了这个,show_sql就可以不用了，show_sql没有上下文，多线程情况下，分不清楚是谁打印的，所有我推荐如下配置项：</span></span>
<span class="line"><span style="color:#E1E4E8;">logging.level.org.hibernate.SQL</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">debug</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">## 显示sql的执行日志，如果开了这个,show_sql就可以不用了，show_sql没有上下文，多线程情况下，分不清楚是谁打印的，所有我推荐如下配置项：</span></span>
<span class="line"><span style="color:#24292E;">logging.level.org.hibernate.SQL</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">debug</span></span></code></pre></div><p>但是这种配置也有个缺陷，就是只能全局配置，没办法针对不通过的实体管理关系配置不同的 Fetch Size 的值。</p><p>而与之类似的 Hibernate 里面也提供了一个注解 @BatchSize 可以解决此问题。</p><h4 id="batchsize-注解" tabindex="-1">@BatchSize 注解 <a class="header-anchor" href="#batchsize-注解" aria-label="Permalink to &quot;@BatchSize 注解&quot;">​</a></h4><p>@BatchSize 注解是 Hibernate 提供的用来解决查询关联关系的批量处理大小，默认无，可以配置在实体上，也可以配置在关联关系上面。此注解里面只有一个属性 size，用来指定关联关系 LAZY 或者是 EAGER 一次性取数据的大小。</p><p>我们还是将上面的例子中的 UserInfo 实体做一下改造，在里面增加两次 @BatchSize 注解，代码如下所示。</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">@</span><span style="color:#F97583;">Entity</span></span>
<span class="line"><span style="color:#E1E4E8;">@</span><span style="color:#F97583;">Data</span></span>
<span class="line"><span style="color:#E1E4E8;">@</span><span style="color:#F97583;">SuperBuilder</span></span>
<span class="line"><span style="color:#E1E4E8;">@</span><span style="color:#F97583;">AllArgsConstructor</span></span>
<span class="line"><span style="color:#E1E4E8;">@</span><span style="color:#F97583;">NoArgsConstructor</span></span>
<span class="line"><span style="color:#E1E4E8;">@</span><span style="color:#F97583;">Table</span></span>
<span class="line"><span style="color:#E1E4E8;">@</span><span style="color:#F97583;">ToString</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">exclude</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;addressList&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">@</span><span style="color:#F97583;">BatchSize</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">size</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">)</span><span style="color:#6A737D;">//实体类上加@BatchSize注解，用来设置当被关联关系的时候一次查询的大小，我们设置成2，方便演示Address关联UserInfo的时候的效果</span></span>
<span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">UserInfo</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">extends</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">BaseEntity</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">private</span><span style="color:#E1E4E8;"> String name;</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">private</span><span style="color:#E1E4E8;"> String telephone;</span></span>
<span class="line"><span style="color:#E1E4E8;">   @</span><span style="color:#F97583;">OneToMany</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">mappedBy</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;userInfo&quot;</span><span style="color:#E1E4E8;">,</span><span style="color:#79B8FF;">cascade</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> CascadeType.PERSIST,</span><span style="color:#79B8FF;">fetch</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> FetchType.EAGER)</span></span>
<span class="line"><span style="color:#E1E4E8;">   @</span><span style="color:#F97583;">BatchSize</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">size</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">20</span><span style="color:#E1E4E8;">)</span><span style="color:#6A737D;">//关联关系的属性上加@BatchSize注解，用来设置当通过UserInfo加载Address的时候一次取数据的大小</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">private</span><span style="color:#E1E4E8;"> List&lt;</span><span style="color:#F97583;">Address</span><span style="color:#E1E4E8;">&gt; addressList;</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Entity</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Data</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">SuperBuilder</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">AllArgsConstructor</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">NoArgsConstructor</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Table</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">ToString</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">exclude</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;addressList&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">BatchSize</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">size</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2</span><span style="color:#24292E;">)</span><span style="color:#6A737D;">//实体类上加@BatchSize注解，用来设置当被关联关系的时候一次查询的大小，我们设置成2，方便演示Address关联UserInfo的时候的效果</span></span>
<span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">UserInfo</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">extends</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">BaseEntity</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> String name;</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> String telephone;</span></span>
<span class="line"><span style="color:#24292E;">   @</span><span style="color:#D73A49;">OneToMany</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">mappedBy</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;userInfo&quot;</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">cascade</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> CascadeType.PERSIST,</span><span style="color:#005CC5;">fetch</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> FetchType.EAGER)</span></span>
<span class="line"><span style="color:#24292E;">   @</span><span style="color:#D73A49;">BatchSize</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">size</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">20</span><span style="color:#24292E;">)</span><span style="color:#6A737D;">//关联关系的属性上加@BatchSize注解，用来设置当通过UserInfo加载Address的时候一次取数据的大小</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> List&lt;</span><span style="color:#D73A49;">Address</span><span style="color:#24292E;">&gt; addressList;</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><p>我们通过改造 UserInfo 实体，可以直接演示 @BatchSize 应用在实体类和属性字段上的效果，所以 Address 实体可以不做任何改变，hibernate.default_batch_fetch_size 还改成默认值 -1，我们再分别执行一下两个 findAll 方法，看一下效果。</p><p>第一种：查询所有 UserInfo，代码如下面这行所示。</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">userInfoRepository.</span><span style="color:#B392F0;">findAll</span><span style="color:#E1E4E8;">()</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">userInfoRepository.</span><span style="color:#6F42C1;">findAll</span><span style="color:#24292E;">()</span></span></code></pre></div><p>我们看一下 SQL 控制台。</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;"> org.hibernate.SQL                        </span><span style="color:#F97583;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">select userinfo0_.id                    as id1_1_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       userinfo0_.create_time           as create_t2_1_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       userinfo0_.create_user_id        as create_u3_1_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       userinfo0_.last_modified_time    as last_mod4_1_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       userinfo0_.last_modified_user_id as last_mod5_1_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       userinfo0_.version               as version6_1_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       userinfo0_.ages                  as ages7_1_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       userinfo0_.email_address         as email_ad8_1_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       userinfo0_.last_name             as last_nam9_1_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       userinfo0_.name                  as name10_1_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       userinfo0_.telephone             as telepho11_1_</span></span>
<span class="line"><span style="color:#E1E4E8;">from user_info userinfo0_ org.hibernate.SQL                        </span><span style="color:#F97583;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">select addresslis0_.user_info_id          as user_inf8_0_1_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       addresslis0_.id                    as id1_0_1_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       addresslis0_.id                    as id1_0_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       addresslis0_.create_time           as create_t2_0_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       addresslis0_.create_user_id        as create_u3_0_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       addresslis0_.last_modified_time    as last_mod4_0_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       addresslis0_.last_modified_user_id as last_mod5_0_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       addresslis0_.version               as version6_0_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       addresslis0_.city                  as city7_0_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       addresslis0_.user_info_id          as user_inf8_0_0_</span></span>
<span class="line"><span style="color:#E1E4E8;">from address addresslis0_</span></span>
<span class="line"><span style="color:#E1E4E8;">where addresslis0_.user_info_id </span><span style="color:#B392F0;">in</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">?</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">?</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">?</span><span style="color:#E1E4E8;">)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;"> org.hibernate.SQL                        </span><span style="color:#D73A49;">:</span></span>
<span class="line"><span style="color:#24292E;">select userinfo0_.id                    as id1_1_,</span></span>
<span class="line"><span style="color:#24292E;">       userinfo0_.create_time           as create_t2_1_,</span></span>
<span class="line"><span style="color:#24292E;">       userinfo0_.create_user_id        as create_u3_1_,</span></span>
<span class="line"><span style="color:#24292E;">       userinfo0_.last_modified_time    as last_mod4_1_,</span></span>
<span class="line"><span style="color:#24292E;">       userinfo0_.last_modified_user_id as last_mod5_1_,</span></span>
<span class="line"><span style="color:#24292E;">       userinfo0_.version               as version6_1_,</span></span>
<span class="line"><span style="color:#24292E;">       userinfo0_.ages                  as ages7_1_,</span></span>
<span class="line"><span style="color:#24292E;">       userinfo0_.email_address         as email_ad8_1_,</span></span>
<span class="line"><span style="color:#24292E;">       userinfo0_.last_name             as last_nam9_1_,</span></span>
<span class="line"><span style="color:#24292E;">       userinfo0_.name                  as name10_1_,</span></span>
<span class="line"><span style="color:#24292E;">       userinfo0_.telephone             as telepho11_1_</span></span>
<span class="line"><span style="color:#24292E;">from user_info userinfo0_ org.hibernate.SQL                        </span><span style="color:#D73A49;">:</span></span>
<span class="line"><span style="color:#24292E;">select addresslis0_.user_info_id          as user_inf8_0_1_,</span></span>
<span class="line"><span style="color:#24292E;">       addresslis0_.id                    as id1_0_1_,</span></span>
<span class="line"><span style="color:#24292E;">       addresslis0_.id                    as id1_0_0_,</span></span>
<span class="line"><span style="color:#24292E;">       addresslis0_.create_time           as create_t2_0_0_,</span></span>
<span class="line"><span style="color:#24292E;">       addresslis0_.create_user_id        as create_u3_0_0_,</span></span>
<span class="line"><span style="color:#24292E;">       addresslis0_.last_modified_time    as last_mod4_0_0_,</span></span>
<span class="line"><span style="color:#24292E;">       addresslis0_.last_modified_user_id as last_mod5_0_0_,</span></span>
<span class="line"><span style="color:#24292E;">       addresslis0_.version               as version6_0_0_,</span></span>
<span class="line"><span style="color:#24292E;">       addresslis0_.city                  as city7_0_0_,</span></span>
<span class="line"><span style="color:#24292E;">       addresslis0_.user_info_id          as user_inf8_0_0_</span></span>
<span class="line"><span style="color:#24292E;">from address addresslis0_</span></span>
<span class="line"><span style="color:#24292E;">where addresslis0_.user_info_id </span><span style="color:#6F42C1;">in</span><span style="color:#24292E;"> (</span><span style="color:#D73A49;">?</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">?</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">?</span><span style="color:#24292E;">)</span></span></code></pre></div><p>和刚才设置 hibernate.default_batch_fetch_size=20 的效果一模一样，所以我们可以利用 @BatchSize 这个注解针对不同的关联关系，配置不同的大小，从而提升 N+1 SQL 的性能。</p><p>第二种：查询一下所有 Address，如下面这行代码所示。</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">addressRepository.</span><span style="color:#B392F0;">findAll</span><span style="color:#E1E4E8;">();</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">addressRepository.</span><span style="color:#6F42C1;">findAll</span><span style="color:#24292E;">();</span></span></code></pre></div><p>我们看一下控制台的 SQL 情况，如下所示。</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#79B8FF;">org</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">hibernate</span><span style="color:#E1E4E8;">.</span><span style="color:#F97583;">SQL</span><span style="color:#E1E4E8;">                        :</span></span>
<span class="line"><span style="color:#F97583;">select</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">address0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">id</span><span style="color:#E1E4E8;">                    </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> id1_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">address0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">create_time</span><span style="color:#E1E4E8;">           </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> create_t2_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">address0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">create_user_id</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> create_u3_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">address0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">last_modified_time</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> last_mod4_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">address0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">last_modified_user_id</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> last_mod5_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">address0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">version</span><span style="color:#E1E4E8;">               </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> version6_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">address0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">city</span><span style="color:#E1E4E8;">                  </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> city7_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">address0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">user_info_id</span><span style="color:#E1E4E8;">          </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> user_inf8_0_</span></span>
<span class="line"><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">address</span><span style="color:#E1E4E8;"> address0_ </span></span>
<span class="line"><span style="color:#79B8FF;">org</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">hibernate</span><span style="color:#E1E4E8;">.</span><span style="color:#F97583;">SQL</span><span style="color:#E1E4E8;">                        :</span></span>
<span class="line"><span style="color:#F97583;">select</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">userinfo0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">id</span><span style="color:#E1E4E8;">                      </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> id1_1_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">userinfo0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">create_time</span><span style="color:#E1E4E8;">             </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> create_t2_1_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">userinfo0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">create_user_id</span><span style="color:#E1E4E8;">          </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> create_u3_1_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">userinfo0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">last_modified_time</span><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> last_mod4_1_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">userinfo0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">last_modified_user_id</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> last_mod5_1_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">userinfo0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">version</span><span style="color:#E1E4E8;">                 </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> version6_1_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">userinfo0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">ages</span><span style="color:#E1E4E8;">                    </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> ages7_1_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">userinfo0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">email_address</span><span style="color:#E1E4E8;">           </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> email_ad8_1_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">userinfo0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">last_name</span><span style="color:#E1E4E8;">               </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> last_nam9_1_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">userinfo0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">name</span><span style="color:#E1E4E8;">                    </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> name10_1_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">userinfo0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">telephone</span><span style="color:#E1E4E8;">               </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> telepho11_1_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">addresslis1_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">user_info_id</span><span style="color:#E1E4E8;">          </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> user_inf8_0_1_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">addresslis1_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">id</span><span style="color:#E1E4E8;">                    </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> id1_0_1_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">addresslis1_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">id</span><span style="color:#E1E4E8;">                    </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> id1_0_2_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">addresslis1_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">create_time</span><span style="color:#E1E4E8;">           </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> create_t2_0_2_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">addresslis1_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">create_user_id</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> create_u3_0_2_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">addresslis1_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">last_modified_time</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> last_mod4_0_2_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">addresslis1_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">last_modified_user_id</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> last_mod5_0_2_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">addresslis1_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">version</span><span style="color:#E1E4E8;">               </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> version6_0_2_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">addresslis1_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">city</span><span style="color:#E1E4E8;">                  </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> city7_0_2_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">addresslis1_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">user_info_id</span><span style="color:#E1E4E8;">          </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> user_inf8_0_2_</span></span>
<span class="line"><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> user_info userinfo0_</span></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#F97583;">left outer join</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">address</span><span style="color:#E1E4E8;"> addresslis1_ </span><span style="color:#F97583;">on</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">userinfo0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">id</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">addresslis1_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">user_info_id</span></span>
<span class="line"><span style="color:#F97583;">where</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">userinfo0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">id</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> (?, ?) </span></span>
<span class="line"><span style="color:#79B8FF;">org</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">hibernate</span><span style="color:#E1E4E8;">.</span><span style="color:#F97583;">SQL</span><span style="color:#E1E4E8;">                        :</span></span>
<span class="line"><span style="color:#F97583;">select</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">userinfo0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">id</span><span style="color:#E1E4E8;">                      </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> id1_1_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">userinfo0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">create_time</span><span style="color:#E1E4E8;">             </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> create_t2_1_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">userinfo0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">create_user_id</span><span style="color:#E1E4E8;">          </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> create_u3_1_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">userinfo0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">last_modified_time</span><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> last_mod4_1_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">userinfo0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">last_modified_user_id</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> last_mod5_1_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">userinfo0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">version</span><span style="color:#E1E4E8;">                 </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> version6_1_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">userinfo0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">ages</span><span style="color:#E1E4E8;">                    </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> ages7_1_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">userinfo0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">email_address</span><span style="color:#E1E4E8;">           </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> email_ad8_1_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">userinfo0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">last_name</span><span style="color:#E1E4E8;">               </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> last_nam9_1_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">userinfo0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">name</span><span style="color:#E1E4E8;">                    </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> name10_1_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">userinfo0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">telephone</span><span style="color:#E1E4E8;">               </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> telepho11_1_0_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">addresslis1_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">user_info_id</span><span style="color:#E1E4E8;">          </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> user_inf8_0_1_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">addresslis1_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">id</span><span style="color:#E1E4E8;">                    </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> id1_0_1_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">addresslis1_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">id</span><span style="color:#E1E4E8;">                    </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> id1_0_2_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">addresslis1_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">create_time</span><span style="color:#E1E4E8;">           </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> create_t2_0_2_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">addresslis1_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">create_user_id</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> create_u3_0_2_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">addresslis1_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">last_modified_time</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> last_mod4_0_2_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">addresslis1_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">last_modified_user_id</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> last_mod5_0_2_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">addresslis1_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">version</span><span style="color:#E1E4E8;">               </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> version6_0_2_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">addresslis1_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">city</span><span style="color:#E1E4E8;">                  </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> city7_0_2_,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">addresslis1_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">user_info_id</span><span style="color:#E1E4E8;">          </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> user_inf8_0_2_</span></span>
<span class="line"><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> user_info userinfo0_</span></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#F97583;">left outer join</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">address</span><span style="color:#E1E4E8;"> addresslis1_ </span><span style="color:#F97583;">on</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">userinfo0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">id</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">addresslis1_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">user_info_id</span></span>
<span class="line"><span style="color:#F97583;">where</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">userinfo0_</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">id</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> ?</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#005CC5;">org</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">hibernate</span><span style="color:#24292E;">.</span><span style="color:#D73A49;">SQL</span><span style="color:#24292E;">                        :</span></span>
<span class="line"><span style="color:#D73A49;">select</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">address0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">id</span><span style="color:#24292E;">                    </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> id1_0_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">address0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">create_time</span><span style="color:#24292E;">           </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> create_t2_0_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">address0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">create_user_id</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> create_u3_0_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">address0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">last_modified_time</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> last_mod4_0_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">address0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">last_modified_user_id</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> last_mod5_0_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">address0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">version</span><span style="color:#24292E;">               </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> version6_0_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">address0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">city</span><span style="color:#24292E;">                  </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> city7_0_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">address0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">user_info_id</span><span style="color:#24292E;">          </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> user_inf8_0_</span></span>
<span class="line"><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">address</span><span style="color:#24292E;"> address0_ </span></span>
<span class="line"><span style="color:#005CC5;">org</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">hibernate</span><span style="color:#24292E;">.</span><span style="color:#D73A49;">SQL</span><span style="color:#24292E;">                        :</span></span>
<span class="line"><span style="color:#D73A49;">select</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">userinfo0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">id</span><span style="color:#24292E;">                      </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> id1_1_0_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">userinfo0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">create_time</span><span style="color:#24292E;">             </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> create_t2_1_0_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">userinfo0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">create_user_id</span><span style="color:#24292E;">          </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> create_u3_1_0_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">userinfo0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">last_modified_time</span><span style="color:#24292E;">      </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> last_mod4_1_0_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">userinfo0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">last_modified_user_id</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> last_mod5_1_0_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">userinfo0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">version</span><span style="color:#24292E;">                 </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> version6_1_0_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">userinfo0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">ages</span><span style="color:#24292E;">                    </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> ages7_1_0_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">userinfo0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">email_address</span><span style="color:#24292E;">           </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> email_ad8_1_0_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">userinfo0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">last_name</span><span style="color:#24292E;">               </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> last_nam9_1_0_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">userinfo0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">name</span><span style="color:#24292E;">                    </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> name10_1_0_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">userinfo0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">telephone</span><span style="color:#24292E;">               </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> telepho11_1_0_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">addresslis1_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">user_info_id</span><span style="color:#24292E;">          </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> user_inf8_0_1_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">addresslis1_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">id</span><span style="color:#24292E;">                    </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> id1_0_1_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">addresslis1_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">id</span><span style="color:#24292E;">                    </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> id1_0_2_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">addresslis1_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">create_time</span><span style="color:#24292E;">           </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> create_t2_0_2_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">addresslis1_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">create_user_id</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> create_u3_0_2_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">addresslis1_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">last_modified_time</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> last_mod4_0_2_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">addresslis1_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">last_modified_user_id</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> last_mod5_0_2_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">addresslis1_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">version</span><span style="color:#24292E;">               </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> version6_0_2_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">addresslis1_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">city</span><span style="color:#24292E;">                  </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> city7_0_2_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">addresslis1_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">user_info_id</span><span style="color:#24292E;">          </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> user_inf8_0_2_</span></span>
<span class="line"><span style="color:#D73A49;">from</span><span style="color:#24292E;"> user_info userinfo0_</span></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#D73A49;">left outer join</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">address</span><span style="color:#24292E;"> addresslis1_ </span><span style="color:#D73A49;">on</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">userinfo0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">id</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">addresslis1_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">user_info_id</span></span>
<span class="line"><span style="color:#D73A49;">where</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">userinfo0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">id</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> (?, ?) </span></span>
<span class="line"><span style="color:#005CC5;">org</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">hibernate</span><span style="color:#24292E;">.</span><span style="color:#D73A49;">SQL</span><span style="color:#24292E;">                        :</span></span>
<span class="line"><span style="color:#D73A49;">select</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">userinfo0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">id</span><span style="color:#24292E;">                      </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> id1_1_0_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">userinfo0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">create_time</span><span style="color:#24292E;">             </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> create_t2_1_0_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">userinfo0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">create_user_id</span><span style="color:#24292E;">          </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> create_u3_1_0_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">userinfo0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">last_modified_time</span><span style="color:#24292E;">      </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> last_mod4_1_0_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">userinfo0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">last_modified_user_id</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> last_mod5_1_0_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">userinfo0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">version</span><span style="color:#24292E;">                 </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> version6_1_0_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">userinfo0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">ages</span><span style="color:#24292E;">                    </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> ages7_1_0_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">userinfo0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">email_address</span><span style="color:#24292E;">           </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> email_ad8_1_0_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">userinfo0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">last_name</span><span style="color:#24292E;">               </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> last_nam9_1_0_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">userinfo0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">name</span><span style="color:#24292E;">                    </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> name10_1_0_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">userinfo0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">telephone</span><span style="color:#24292E;">               </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> telepho11_1_0_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">addresslis1_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">user_info_id</span><span style="color:#24292E;">          </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> user_inf8_0_1_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">addresslis1_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">id</span><span style="color:#24292E;">                    </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> id1_0_1_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">addresslis1_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">id</span><span style="color:#24292E;">                    </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> id1_0_2_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">addresslis1_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">create_time</span><span style="color:#24292E;">           </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> create_t2_0_2_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">addresslis1_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">create_user_id</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> create_u3_0_2_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">addresslis1_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">last_modified_time</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> last_mod4_0_2_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">addresslis1_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">last_modified_user_id</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> last_mod5_0_2_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">addresslis1_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">version</span><span style="color:#24292E;">               </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> version6_0_2_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">addresslis1_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">city</span><span style="color:#24292E;">                  </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> city7_0_2_,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">addresslis1_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">user_info_id</span><span style="color:#24292E;">          </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> user_inf8_0_2_</span></span>
<span class="line"><span style="color:#D73A49;">from</span><span style="color:#24292E;"> user_info userinfo0_</span></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#D73A49;">left outer join</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">address</span><span style="color:#24292E;"> addresslis1_ </span><span style="color:#D73A49;">on</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">userinfo0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">id</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">addresslis1_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">user_info_id</span></span>
<span class="line"><span style="color:#D73A49;">where</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">userinfo0_</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">id</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> ?</span></span></code></pre></div><p>这里可以看到，由于我们在 UserInfo 的实体上设置了 @BatchSize(size = 2)，表示所有关联关系到 UserInfo 的时候一次取两条数据，所以就会发现这次我查询 Address 加载 UserInfo 的时候，产生了 3 条 SQL。</p><p>其中通过关联关系查询 UserInfo 产生了 2 条 SQL，由于我们 UserInfo 在数据库里面有三条数据，所以第一条 UserInfo 的 SQL 受 @BatchSize(size = 2) 控制，从而 in (?,?) 只支持了两个参数，同时也产生了第二条查 UserInfo 的 SQL。</p><p>从上面的例子中我们可以看到 @BatchSize 和 hibernate.default_batch_fetch_size 的效果是一样的，只不过一个是全局配置、一个是局部设置，这是可以减少 N+1 SQL 最直接、最方便的两种方式。</p><p><strong>注意事项：</strong></p><p>@BatchSize 的使用具有局限性，不能作用于 @ManyToOne 和 @OneToOne 的关联关系上，那样代码是不起作用的，如下所示。</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Address</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">extends</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">BaseEntity</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">private</span><span style="color:#E1E4E8;"> String city;</span></span>
<span class="line"><span style="color:#E1E4E8;">   @</span><span style="color:#F97583;">ManyToOne</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">cascade</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> CascadeType.PERSIST,</span><span style="color:#79B8FF;">fetch</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> FetchType.EAGER)</span></span>
<span class="line"><span style="color:#E1E4E8;">   @</span><span style="color:#F97583;">BatchSize</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">size</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">30</span><span style="color:#E1E4E8;">) </span><span style="color:#6A737D;">//由于是@ManyToOne的关联关系所有没有作用</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">private</span><span style="color:#E1E4E8;"> UserInfo userInfo;</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Address</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">extends</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">BaseEntity</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> String city;</span></span>
<span class="line"><span style="color:#24292E;">   @</span><span style="color:#D73A49;">ManyToOne</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">cascade</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> CascadeType.PERSIST,</span><span style="color:#005CC5;">fetch</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> FetchType.EAGER)</span></span>
<span class="line"><span style="color:#24292E;">   @</span><span style="color:#D73A49;">BatchSize</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">size</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">30</span><span style="color:#24292E;">) </span><span style="color:#6A737D;">//由于是@ManyToOne的关联关系所有没有作用</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> UserInfo userInfo;</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><p>因此，你要注意 @BatchSize 只能作用在 @ManyToMany、@OneToMany、实体类这三个地方。</p><p>此外，Hibernate 中还提供了一种 FetchMode 的策略，包含三种模式，分别为 FetchMode.SELECT、FetchMode.JOIN，以及 FetchMode.Subselect。由于内容较多，我怕你一次性不好消化，所以会在下一讲继续为你介绍。到时见。</p><blockquote><p>点击下方链接查看源码（不定时更新）<br><a href="https://github.com/zhangzhenhuajack/spring-boot-guide/tree/master/spring-data/spring-data-jpa" target="_blank" rel="noreferrer">https://github.com/zhangzhenhuajack/spring-boot-guide/tree/master/spring-data/spring-data-jpa</a></p></blockquote>`,60);function i(d,F,C,u,f,m){const s=o("Image");return e(),r("div",null,[E,a(s,{alt:"Drawing 0.png",src:"https://s0.lgstatic.com/i/image/M00/78/8C/CgqCHl_KD8SABiKCAACKI1OHeQg789.png"}),n(),y,a(s,{alt:"Drawing 1.png",src:"https://s0.lgstatic.com/i/image/M00/78/8C/CgqCHl_KD8mAe5A7AAErBNjfxAg931.png"}),n(),_])}const h=p(t,[["render",i]]);export{A as __pageData,h as default};
