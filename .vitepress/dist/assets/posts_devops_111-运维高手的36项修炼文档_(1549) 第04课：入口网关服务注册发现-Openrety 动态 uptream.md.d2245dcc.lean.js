import{_ as a,D as n,o as l,g as o,J as s,h as r,Q as t,m as e}from"./chunks/framework.f67d7268.js";const J=JSON.parse('{"title":"第04课：入口网关服务注册发现-Openrety动态uptream","description":"","frontmatter":{},"headers":[],"relativePath":"posts/devops/111-运维高手的36项修炼文档/(1549) 第04课：入口网关服务注册发现-Openrety 动态 uptream.md","filePath":"posts/devops/111-运维高手的36项修炼文档/(1549) 第04课：入口网关服务注册发现-Openrety 动态 uptream.md","lastUpdated":1696682708000}'),_={name:"posts/devops/111-运维高手的36项修炼文档/(1549) 第04课：入口网关服务注册发现-Openrety 动态 uptream.md"},i=t("",11),u=t("",17),c=e("br",null,null,-1),m=e("p",null,"我们再看一个常见的 K8s 的入口网关架构，这里就使用了动态 Upstream。我们知道 K8s + Docker 的服务部署模式下，ETCD 作为服务注册发现中的KV存储数据库，存取着后台节点服务的注册信息，包含服务名称、连接方式等。所以，在图中会把所有后台的 服务节点(App1-App4) 的信息注册到 ETCD 的数据库中存储。然后 入口网关(如：Nginx) 通过查看etcd中数据并根据变化情况动态地调整 Upstream 配置，这个就是在K8S中动态入口网关理论原理。",-1),d=e("br",null,null,-1),h=e("p",null,"图中上面的箭头表示一个服务的注册和动态的 Upstream 更新配置文件。下面的箭头表示动态的实现负载均衡策略流量转发，这个就是在 K8s 和 Docker 的部署场景中入口网关的实现原理。",-1),b=e("h2",{id:"动态-upsteam-实现方式",tabindex:"-1"},[r("动态 Upsteam 实现方式 "),e("a",{class:"header-anchor",href:"#动态-upsteam-实现方式","aria-label":'Permalink to "动态 Upsteam 实现方式"'},"​")],-1),g=e("p",null,"那么，动态 Upstream 的实现方式都有哪些呢？下面我给你具体讲解一下。",-1),x=e("br",null,null,-1),y=e("p",null,"我们知道Nginx 本身诞生的比 K8s 和 Docker 更早，Nginx 默认的配置模块是有来实现动态Upstream 是有局限的，这也是上一讲中我所认为Nginx存在缺陷，所以我们想要实现，通常有这么几种方式：",-1),N=e("br",null,null,-1),A=e("br",null,null,-1),U=e("p",null,"第一种方式是通过 Nginx+Lua，使用 Lua 语言开发接口，做到动态调用，也就是基于 Openresty 动态实现 Upstream，因为我们知道 Openresty 服务本身就是基于 Nginx 和 Lua 的一个结合体。",-1),v=e("br",null,null,-1),O=e("p",null,"第二种方式是通过已经开源并成熟的组件，如 confd 工具或 国内某大公司开源的 nginx-upsync-module 的模块来实现动态 Upstream。",-1),T=e("br",null,null,-1),f=e("p",null,"第三种方式是通过一个独立的入口网关把 Nginx 完全替换掉，比如我们现在了解的 Kong 网关还有 Traefik，都是在 K8s 中支持云原生的非常好的网关服务。",-1),P=e("br",null,null,-1),C=e("p",null,"那我总结的实现方式有以上三种，接下来本课时我们来演示 Openresty 动态 Upstream 方案，使用 Lua 语言开发一套动态的接口，我们可以动态地调用接口实现一个动态的分流。",-1),E=e("br",null,null,-1),k=e("p",null,"这个方案中实现了3个接口，让 Openresty 支持添加、删除、监控 Upstream 后台节点的功能（如图接口1-接口3）。",-1),S=e("br",null,null,-1),B=e("p",null,"我们看下如图描述的内容：",-1),q=e("br",null,null,-1),w=t("",48);function D(I,L,V,F,K,R){const p=n("Image");return l(),o("div",null,[i,s(p,{alt:"",src:"https://s0.lgstatic.com/i/image3/M01/6B/69/CgpOIF5XlqGAJ1iwAAE2ca-U8Go037.png"}),r(),u,s(p,{alt:"",src:"https://s0.lgstatic.com/i/image3/M01/6B/69/Cgq2xl5XlrOAW-n0AAFbOCQssio629.png"}),r(),c,m,d,h,b,g,x,y,N,s(p,{alt:"",src:"https://s0.lgstatic.com/i/image3/M01/6B/69/CgpOIF5XlsKAFA4dAACi4m6_YDE387.png"}),r(),A,U,v,O,T,f,P,C,E,k,S,B,q,s(p,{alt:"",src:"https://s0.lgstatic.com/i/image3/M01/6B/69/Cgq2xl5Xls6AJ57nAAEo03hFxpQ626.png"}),r(),w])}const M=a(_,[["render",D]]);export{J as __pageData,M as default};
