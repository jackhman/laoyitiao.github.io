import{_ as i,j as l,o,g as _,k as e,s as p,h as s,Q as a}from"./chunks/framework.b3d8e22e.js";const F=JSON.parse('{"title":"生产&消费者 ","description":"","frontmatter":{},"headers":[],"relativePath":"posts/frontEnd/103-云原生微信小程序开发实战文档/(5111) 18  持续在线：如何借助云应用持续运行队列消费者？.md","filePath":"posts/frontEnd/103-云原生微信小程序开发实战文档/(5111) 18  持续在线：如何借助云应用持续运行队列消费者？.md","lastUpdated":1696417798000}'),n={name:"posts/frontEnd/103-云原生微信小程序开发实战文档/(5111) 18  持续在线：如何借助云应用持续运行队列消费者？.md"},r=p("p",null,"既然云开发是后端服务，那么不可或缺的一定是计算能力，因为计算能力是后端服务的核心。而云函数作为函数形态的容器计算服务，在云开发后端生态中发挥着不可代替的作用。",-1),c=p("p",null,"不过，当应用功能越来越强大，模块分层日渐明显时，云函数不持久服务的特性也越发明显，这一特性会限制应用的发展。而我们需要做出相应的改变，这里就要提云开发的另一个计算能力------云应用（现称云托管）。",-1),d=p("p",null,"云托管支持任意语言和框架编写的容器化应用。说白了就是把整装的后端服务打包，放置在云托管中运行，提供服务。",-1),h=p("p",null,"为了让你更好地领悟和使用云托管进行应用开发，这一讲我会通过引入生产者&消费者模型，来讲解云托管在其中发挥的作用 。",-1),g=p("h3",{id:"生产-消费者",tabindex:"-1"},[s("生产&消费者 "),p("a",{class:"header-anchor",href:"#生产-消费者","aria-label":'Permalink to "生产\\&消费者"'},"​")],-1),m=p("p",null,"目前大部分的应用开发（包括 WEB 应用）用的都是前后端分离的架构体系，也就是客户端与服务端分离，二者通过网络请求进行交互。好处是：客户端能作为一个整体，独立运行在用户的计算环境中，与用户打交道，专注于交互体验而服务端没有了构造交互页面的琐事，专心处理服务数据，更加高效。",-1),u=a("",14),A=p("p",null,"这种情况就类似于前面的外卖餐厅，云托管的服务就是厨师角色，实例就是厨师的人数。如果此时你有新的业务变更升级，服务处理时流程也随之发生了变化，那你需要再次重复以上步骤，在统一服务下创建新的版本，此时的情况如下：",-1),C=p("p",null,"云托管对于同一服务的不同版本有一个流量分配控制，开发者可以通过变更流量分配情况，来改变版本后实例的增减。如果你需要灰度上线更新，可以设置一部分流量到版本 2 服务中，情况也随之发生变化：",-1),f=p("p",null,"此时，流量的一部分被版本 2 下面的实例消费了（上图所示为40%）。假设一个实例可以同时处理 10 个请求。那么有100个请求过来时，按照流量分配，版本 2 下应该有4个实例，版本 1 下应该有6个实例。如果用户访问增长，流量增大，那么两个版本会根据各自消费的需要，扩充相应的实例出来。",-1),T=p("p",null,"作为使用者，实例的自动扩缩全部由云托管控制，我们只需要分配流量就可以。很多情况下服务的请求是突然增长的，短时间可能来不及扩展并投入实例，那么你可以预先设置一个比例，告诉云托管，当一个实例资源占用到一定比例时，就开始扩容；如果资源使用小于这个比例，就自动缩容。如此一来，就做到了未雨绸缪，先行扩容保稳定。",-1),k=a("",17);function q(B,S,b,D,E,P){const t=l("Image");return o(),_("div",null,[r,c,d,h,g,m,e(t,{alt:"Drawing 0.png",src:"https://s0.lgstatic.com/i/image/M00/8C/59/Ciqc1F_r5yyAXiedAACHvxQjuCU834.png"}),u,e(t,{alt:"Drawing 2.png",src:"https://s0.lgstatic.com/i/image/M00/8C/65/CgqCHl_r50uAF8sBAABFb3yeqUo665.png"}),A,e(t,{alt:"Drawing 4.png",src:"https://s0.lgstatic.com/i/image/M00/8C/59/Ciqc1F_r50uAHNZaAABN2b1L-MY564.png"}),C,e(t,{alt:"Drawing 6.png",src:"https://s0.lgstatic.com/i/image/M00/8C/65/CgqCHl_r51iAL8J7AABV-j_S8Xo934.png"}),f,T,e(t,{alt:"Drawing 4.png",src:"https://s0.lgstatic.com/i/image2/M01/03/FB/Cip5yF_lt6-ACTFiAABTEH3zpks779.png"}),k])}const N=i(n,[["render",q]]);export{F as __pageData,N as default};
