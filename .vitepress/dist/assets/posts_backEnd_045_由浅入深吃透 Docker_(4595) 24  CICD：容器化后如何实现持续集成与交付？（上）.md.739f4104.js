import{_ as p,D as e,o as t,g as c,J as l,h as n,Q as o,m as s}from"./chunks/framework.f67d7268.js";const T=JSON.parse('{"title":"24CICD：容器化后如何实现持续集成与交付？（上）","description":"","frontmatter":{},"headers":[],"relativePath":"posts/backEnd/045_由浅入深吃透 Docker/(4595) 24  CICD：容器化后如何实现持续集成与交付？（上）.md","filePath":"posts/backEnd/045_由浅入深吃透 Docker/(4595) 24  CICD：容器化后如何实现持续集成与交付？（上）.md","lastUpdated":1696682708000}'),r={name:"posts/backEnd/045_由浅入深吃透 Docker/(4595) 24  CICD：容器化后如何实现持续集成与交付？（上）.md"},y=o(`<h1 id="_24cicd-容器化后如何实现持续集成与交付-上" tabindex="-1">24CICD：容器化后如何实现持续集成与交付？（上） <a class="header-anchor" href="#_24cicd-容器化后如何实现持续集成与交付-上" aria-label="Permalink to &quot;24CICD：容器化后如何实现持续集成与交付？（上）&quot;">​</a></h1><p>上一讲，我介绍了 DevOps 的概念与 DevOps 的一些思想。DevOps 的思想可以帮助我们缩短上线周期并且提高软件迭代速度，而 CI/CD 则是 DevOps 思想中最重要的部分。</p><p>具体来说，CI/CD 是一种通过在应用开发阶段，引入自动化的手段来频繁地构建应用，并且向客户交付应用的方法。它的核心理念是持续开发、持续部署以及持续交付，它还可以让自动化持续交付贯穿于整个应用生命周期，使得开发和运维统一参与协同支持。</p><p>下面我们来详细了解下 CI/CD 。</p><h3 id="什么是-ci-cd" tabindex="-1">什么是 CI/CD <a class="header-anchor" href="#什么是-ci-cd" aria-label="Permalink to &quot;什么是 CI/CD&quot;">​</a></h3><h4 id="ci-持续集成-continuous-integration" tabindex="-1">CI 持续集成（Continuous Integration） <a class="header-anchor" href="#ci-持续集成-continuous-integration" aria-label="Permalink to &quot;CI 持续集成（Continuous Integration）&quot;">​</a></h4><p>随着软件功能越来越复杂，一个大型项目要想在规定时间内顺利完成，就需要多位开发人员协同开发。但是，如果我们每个人都负责开发自己的代码，然后集中在某一天将代码合并在一起（称为&quot;合并日&quot;）。你会发现，代码可能会有很多冲突和编译问题，而这个处理过程十分烦琐、耗时，并且需要每一位工程师确认代码是否被覆盖，代码是否完整。这种情况显然不是我们想要看到的，这时持续集成（CI）就可以很好地帮助我们解决这个问题。</p><p>CI 持续集成要求开发人员频繁地（甚至是每天）将代码提交到共享分支中。一旦开发人员的代码被合并，将会自动触发构建流程来构建应用，并通过触发自动化测试（单元测试或者集成测试）来验证这些代码的提交，确保这些更改没有对应用造成影响。如果发现提交的代码在测试过程中或者构建过程中有问题，则会马上通知研发人员确认，修改代码并重新提交。通过将以往的定期合并代码的方式，改变为频繁提交代码并且自动构建和测试的方式，可以帮助我们<strong>及早地发现问题和解决冲突，减少代码出错。</strong></p><p>传统 CI 流程的实现十分复杂，无法做到标准化交付，而当我们的应用容器化后，应用构建的结果就是 Docker 镜像。代码检查完毕没有缺陷后合并入主分支。此时启动构建流程，构建系统会自动将我们的应用打包成 Docker 镜像，并且推送到镜像仓库。</p><h4 id="cd-持续交付-continuous-delivery" tabindex="-1">CD 持续交付（Continuous Delivery） <a class="header-anchor" href="#cd-持续交付-continuous-delivery" aria-label="Permalink to &quot;CD 持续交付（Continuous Delivery）&quot;">​</a></h4><p>当我们每次完成代码的测试和构建后，我们需要将编译后的镜像快速发布到测试环境，这时我们的持续交付就登场了。持续交付要求我们实现自动化准备测试环境、自动化测试应用、自动化监控代码质量，并且自动化交付生产环境镜像。</p><p>在以前，测试环境的构建是非常耗时的，并且很难保证测试环境和研发环境的一致性。但现在，借助于容器技术，我们可以很方便地构建出一个测试环境，并且可以保证开发和测试环境的一致性，这样不仅可以提高测试效率，还可以提高敏捷性。</p><p>容器化后的应用交付过程是这样的，我们将测试的环境交由 QA 来维护，当我们确定好本次上线要发布的功能列表时，我们将不同开发人员开发的 feature 分支的代码合并到 release 分支。然后由 QA 来将构建镜像部署到测试环境，结合自动测试和人工测试、自动检测和人工记录，形成完整的测试报告，并且把测试过程中遇到的问题交由开发人员修改，开发修改无误后再次构建测试环境进行测试。测试没有问题后，自动交付生产环境的镜像到镜像仓库。</p><h4 id="cd-持续部署-continuous-deployment" tabindex="-1">CD 持续部署（Continuous Deployment） <a class="header-anchor" href="#cd-持续部署-continuous-deployment" aria-label="Permalink to &quot;CD 持续部署（Continuous Deployment）&quot;">​</a></h4><p>CD 不仅有持续交付的含义，还代表持续部署。经测试无误打包完生产环境的镜像后，我们需要把镜像部署到生产环境，持续部署是最后阶段，它作为持续交付的延伸，可以自动将生产环境的镜像发布到生产环境中。</p><p>部署业务首先需要我们有一个资源池，实现资源自动化供给，而且有的应用还希望有自动伸缩的能力，根据外部流量自动调整容器的副本数，而这一切在容器云中都将变得十分简单。</p><p>我们可以想象，如果有客户提出了反馈，我们通过持续部署在几分钟内，就能在更改完代码的情况下，将新的应用版本发布到生产环境中（假设通过了自动化测试），这时我们就可以实现快速迭代，持续接收和整合用户的反馈，将用户体验做到极致。</p><p>讲了这么多概念，也许你会感觉比较枯燥乏味。下面我们就动动手，利用一些工具搭建一个 DevOps 环境。</p><p>搭建 DevOps 环境的工具非常多，这里我选择的工具为 Jenkins、Docker 和 GitLab。Jenkins 和 Docker 都已经介绍过了，这里我再介绍一下 Gitlab。</p><p>Gitlab 是由 Gitlab Inc. 开发的一款基于 Git 的代码托管平台，它的功能和 GitHub 类似，可以帮助我们存储代码。除此之外，GitLab 还具有在线编辑 wiki、issue 跟踪等功能，另外最新版本的 GitLab 还集成了 CI/CD 功能，不过这里我们仅仅使用 GitLab 的代码存储功能， CI/CD 还是交给我们的老牌持续集成工具 Jenkins 来做。</p><h3 id="docker-jenkins-gitlab-搭建-ci-cd-系统" tabindex="-1">Docker+Jenkins+GitLab 搭建 CI/CD 系统 <a class="header-anchor" href="#docker-jenkins-gitlab-搭建-ci-cd-系统" aria-label="Permalink to &quot;Docker+Jenkins+GitLab 搭建 CI/CD 系统&quot;">​</a></h3><p>软件安装环境如下。</p><ul><li><p>操作系统：CentOS 7</p></li><li><p>Jenkins：tls 长期维护版</p></li><li><p>Docker：18.06</p></li><li><p>GitLab：13.3.8-ce.0</p></li></ul><h4 id="第一步-安装-docker" tabindex="-1">第一步：安装 Docker <a class="header-anchor" href="#第一步-安装-docker" aria-label="Permalink to &quot;第一步：安装 Docker&quot;">​</a></h4><p>安装 Docker 的步骤可以在<a href="https://kaiwu.lagou.com/course/courseInfo.htm?courseId=455#/detail/pc?id=4572" target="_blank" rel="noreferrer">第一讲</a>的内容中找到，这里就不再赘述。Docker 环境准备好后，我们就可以利用 Docker 来部署 GitLab 和 Jenkins 了。</p><h4 id="第二步-安装-gitlab" tabindex="-1">第二步：安装 GitLab <a class="header-anchor" href="#第二步-安装-gitlab" aria-label="Permalink to &quot;第二步：安装 GitLab&quot;">​</a></h4><p>GitLab 官方提供了 GitLab 的 Docker 镜像，因此我们只需要执行以下命令就可以快速启动一个 GitLab 服务了。</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">$ docker run </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">d \\</span></span>
<span class="line"><span style="color:#F97583;">--</span><span style="color:#E1E4E8;">hostname localhost \\</span></span>
<span class="line"><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">p </span><span style="color:#79B8FF;">8080</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">80</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">p </span><span style="color:#79B8FF;">2222</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">22</span><span style="color:#E1E4E8;"> \\</span></span>
<span class="line"><span style="color:#F97583;">--</span><span style="color:#E1E4E8;">name gitlab \\</span></span>
<span class="line"><span style="color:#F97583;">--</span><span style="color:#E1E4E8;">restart always \\</span></span>
<span class="line"><span style="color:#F97583;">--</span><span style="color:#E1E4E8;">volume </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">tmp</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">gitlab</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">config</span><span style="color:#F97583;">:/</span><span style="color:#E1E4E8;">etc</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">gitlab \\</span></span>
<span class="line"><span style="color:#F97583;">--</span><span style="color:#E1E4E8;">volume </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">tmp</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">gitlab</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">logs</span><span style="color:#F97583;">:/</span><span style="color:#E1E4E8;">var</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">log</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">gitlab \\</span></span>
<span class="line"><span style="color:#F97583;">--</span><span style="color:#E1E4E8;">volume </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">tmp</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">gitlab</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">data</span><span style="color:#F97583;">:/</span><span style="color:#E1E4E8;">var</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">opt</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">gitlab \\</span></span>
<span class="line"><span style="color:#E1E4E8;">gitlab</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">gitlab</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">ce</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">13.3</span><span style="color:#E1E4E8;">.</span><span style="color:#FDAEB7;font-style:italic;">8</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">ce.</span><span style="color:#FDAEB7;font-style:italic;">0</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">$ docker run </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">d \\</span></span>
<span class="line"><span style="color:#D73A49;">--</span><span style="color:#24292E;">hostname localhost \\</span></span>
<span class="line"><span style="color:#D73A49;">-</span><span style="color:#24292E;">p </span><span style="color:#005CC5;">8080</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">80</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">p </span><span style="color:#005CC5;">2222</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">22</span><span style="color:#24292E;"> \\</span></span>
<span class="line"><span style="color:#D73A49;">--</span><span style="color:#24292E;">name gitlab \\</span></span>
<span class="line"><span style="color:#D73A49;">--</span><span style="color:#24292E;">restart always \\</span></span>
<span class="line"><span style="color:#D73A49;">--</span><span style="color:#24292E;">volume </span><span style="color:#D73A49;">/</span><span style="color:#24292E;">tmp</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">gitlab</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">config</span><span style="color:#D73A49;">:/</span><span style="color:#24292E;">etc</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">gitlab \\</span></span>
<span class="line"><span style="color:#D73A49;">--</span><span style="color:#24292E;">volume </span><span style="color:#D73A49;">/</span><span style="color:#24292E;">tmp</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">gitlab</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">logs</span><span style="color:#D73A49;">:/</span><span style="color:#24292E;">var</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">log</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">gitlab \\</span></span>
<span class="line"><span style="color:#D73A49;">--</span><span style="color:#24292E;">volume </span><span style="color:#D73A49;">/</span><span style="color:#24292E;">tmp</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">gitlab</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">data</span><span style="color:#D73A49;">:/</span><span style="color:#24292E;">var</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">opt</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">gitlab \\</span></span>
<span class="line"><span style="color:#24292E;">gitlab</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">gitlab</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">ce</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">13.3</span><span style="color:#24292E;">.</span><span style="color:#B31D28;font-style:italic;">8</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">ce.</span><span style="color:#B31D28;font-style:italic;">0</span></span></code></pre></div><p>这个启动过程可能需要几分钟的时间。当服务启动后我们就可以通过 <a href="http://localhost:8080" target="_blank" rel="noreferrer">http://localhost:8080</a> 访问到我们的 GitLab 服务了。</p>`,29),E=s("p",null,"图1 GitLab 设置密码界面",-1),i=s("p",null,"第一次登陆，GitLab 会要求我们设置管理员密码，我们输入管理员密码后点击确认即可，之后 GitLab 会自动跳转到登录页面。",-1),F=o(`<p>图2 GitLab 登录界面</p><p>然后输入默认管理员用户名：admin@example.com，密码为我们上一步设置的密码。点击登录即可登录到系统中，至此，GitLab 已经安装成功。</p><h4 id="第三步-安装-jenkins" tabindex="-1">第三步：安装 Jenkins <a class="header-anchor" href="#第三步-安装-jenkins" aria-label="Permalink to &quot;第三步：安装 Jenkins&quot;">​</a></h4><p>Jenkins 官方提供了 Jenkins 的 Docker 镜像，我们使用 Jenkins 镜像就可以一键启动一个 Jenkins 服务。命令如下：</p><div class="language-dart vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">dart</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;"># docker run </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">d </span><span style="color:#F97583;">--</span><span style="color:#E1E4E8;">name</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">jenkins \\</span></span>
<span class="line"><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">p </span><span style="color:#79B8FF;">8888</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">8080</span><span style="color:#E1E4E8;"> \\</span></span>
<span class="line"><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">u root \\</span></span>
<span class="line"><span style="color:#F97583;">--</span><span style="color:#E1E4E8;">restart always \\</span></span>
<span class="line"><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">v </span><span style="color:#F97583;">/var/</span><span style="color:#E1E4E8;">run</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">docker.sock</span><span style="color:#F97583;">:/var/</span><span style="color:#E1E4E8;">run</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">docker.sock \\</span></span>
<span class="line"><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">v </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">usr</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">bin</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">docker</span><span style="color:#F97583;">:/</span><span style="color:#E1E4E8;">usr</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">bin</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">docker \\</span></span>
<span class="line"><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">v </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">tmp</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">jenkins_home</span><span style="color:#F97583;">:/var/</span><span style="color:#E1E4E8;">jenkins_home \\</span></span>
<span class="line"><span style="color:#E1E4E8;">jenkins</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">jenkins</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;">lts</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;"># docker run </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">d </span><span style="color:#D73A49;">--</span><span style="color:#24292E;">name</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">jenkins \\</span></span>
<span class="line"><span style="color:#D73A49;">-</span><span style="color:#24292E;">p </span><span style="color:#005CC5;">8888</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">8080</span><span style="color:#24292E;"> \\</span></span>
<span class="line"><span style="color:#D73A49;">-</span><span style="color:#24292E;">u root \\</span></span>
<span class="line"><span style="color:#D73A49;">--</span><span style="color:#24292E;">restart always \\</span></span>
<span class="line"><span style="color:#D73A49;">-</span><span style="color:#24292E;">v </span><span style="color:#D73A49;">/var/</span><span style="color:#24292E;">run</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">docker.sock</span><span style="color:#D73A49;">:/var/</span><span style="color:#24292E;">run</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">docker.sock \\</span></span>
<span class="line"><span style="color:#D73A49;">-</span><span style="color:#24292E;">v </span><span style="color:#D73A49;">/</span><span style="color:#24292E;">usr</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">bin</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">docker</span><span style="color:#D73A49;">:/</span><span style="color:#24292E;">usr</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">bin</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">docker \\</span></span>
<span class="line"><span style="color:#D73A49;">-</span><span style="color:#24292E;">v </span><span style="color:#D73A49;">/</span><span style="color:#24292E;">tmp</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">jenkins_home</span><span style="color:#D73A49;">:/var/</span><span style="color:#24292E;">jenkins_home \\</span></span>
<span class="line"><span style="color:#24292E;">jenkins</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">jenkins</span><span style="color:#D73A49;">:</span><span style="color:#24292E;">lts</span></span></code></pre></div><blockquote><p>这里，我将 docker.sock 和 docker 二进制挂载到了 Jenkins 容器中，是为了让 Jenkins 可以直接调用 docker 命令来构建应用镜像。</p></blockquote><p>Jenkins 的默认密码会在容器启动后打印在容器的日志中，我们可以通过以下命令找到 Jenkins 的默认密码，星号之间的类似于一串 UUID 的随机串就是我们的密码。</p><div class="language-dart vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">dart</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">$ docker logs </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">f jenkins</span></span>
<span class="line"><span style="color:#E1E4E8;">unning from</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">usr</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">share</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">jenkins</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">jenkins.war</span></span>
<span class="line"><span style="color:#E1E4E8;">webroot</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">EnvVars</span><span style="color:#E1E4E8;">.masterEnvVars.</span><span style="color:#B392F0;">get</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;JENKINS_HOME&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#79B8FF;">2020</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">10</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">31</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">16</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">13</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">06.472</span><span style="color:#F97583;">+</span><span style="color:#79B8FF;">0000</span><span style="color:#E1E4E8;"> [id</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">]	</span><span style="color:#79B8FF;">INFO</span><span style="color:#E1E4E8;">	org.eclipse.jetty.util.log.</span><span style="color:#79B8FF;">Log</span><span style="color:#E1E4E8;">#initialized</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Logging</span><span style="color:#E1E4E8;"> initialized @292ms to org.eclipse.jetty.util.log.</span><span style="color:#79B8FF;">JavaUtilLog</span></span>
<span class="line"><span style="color:#79B8FF;">2020</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">10</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">31</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">16</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">13</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">06.581</span><span style="color:#F97583;">+</span><span style="color:#79B8FF;">0000</span><span style="color:#E1E4E8;"> [id</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">]	</span><span style="color:#79B8FF;">INFO</span><span style="color:#E1E4E8;">	winstone.</span><span style="color:#79B8FF;">Logger</span><span style="color:#E1E4E8;">#logInternal</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Beginning</span><span style="color:#E1E4E8;"> extraction from war file</span></span>
<span class="line"><span style="color:#79B8FF;">2020</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">10</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">31</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">16</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">13</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">08.369</span><span style="color:#F97583;">+</span><span style="color:#79B8FF;">0000</span><span style="color:#E1E4E8;"> [id</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">]	</span><span style="color:#79B8FF;">WARNING</span><span style="color:#E1E4E8;">	o.e.j.s.handler.</span><span style="color:#79B8FF;">ContextHandler</span><span style="color:#E1E4E8;">#setContextPath</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Empty</span><span style="color:#E1E4E8;"> contextPath</span></span>
<span class="line"><span style="color:#E1E4E8;">... 省略部分启动日志</span></span>
<span class="line"><span style="color:#79B8FF;">Jenkins</span><span style="color:#E1E4E8;"> initial setup </span><span style="color:#F97583;">is</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">required</span><span style="color:#E1E4E8;">. </span><span style="color:#79B8FF;">An</span><span style="color:#E1E4E8;"> admin user has been created and a password generated.</span></span>
<span class="line"><span style="color:#79B8FF;">Please</span><span style="color:#E1E4E8;"> use the following password to proceed to installation</span><span style="color:#F97583;">:</span></span>
<span class="line"><span style="color:#F97583;">*************************************************************</span></span>
<span class="line"><span style="color:#F97583;">*************************************************************</span></span>
<span class="line"><span style="color:#F97583;">*************************************************************</span></span>
<span class="line"></span>
<span class="line"><span style="color:#79B8FF;">Jenkins</span><span style="color:#E1E4E8;"> initial setup </span><span style="color:#F97583;">is</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">required</span><span style="color:#E1E4E8;">. </span><span style="color:#79B8FF;">An</span><span style="color:#E1E4E8;"> admin user has been created and a password generated.</span></span>
<span class="line"><span style="color:#79B8FF;">Please</span><span style="color:#E1E4E8;"> use the following password to proceed to installation</span><span style="color:#F97583;">:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">fb3499944e4845bba9d4b7d9eb4e3932</span></span>
<span class="line"></span>
<span class="line"><span style="color:#79B8FF;">This</span><span style="color:#E1E4E8;"> may also be found at</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">/var/</span><span style="color:#E1E4E8;">jenkins_home</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">secrets</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">initialAdminPassword</span></span>
<span class="line"><span style="color:#F97583;">*************************************************************</span></span>
<span class="line"><span style="color:#F97583;">*************************************************************</span></span>
<span class="line"><span style="color:#F97583;">*************************************************************</span></span>
<span class="line"><span style="color:#79B8FF;">This</span><span style="color:#E1E4E8;"> may also be found at</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">/var/</span><span style="color:#E1E4E8;">jenkins_home</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">secrets</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">initialAdminPassword</span></span>
<span class="line"><span style="color:#79B8FF;">2020</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">10</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">31</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">16</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">17</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">07.577</span><span style="color:#F97583;">+</span><span style="color:#79B8FF;">0000</span><span style="color:#E1E4E8;"> [id</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">28</span><span style="color:#E1E4E8;">]	</span><span style="color:#79B8FF;">INFO</span><span style="color:#E1E4E8;">	jenkins.</span><span style="color:#79B8FF;">InitReactorRunner$1</span><span style="color:#E1E4E8;">#onAttained</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Completed</span><span style="color:#E1E4E8;"> initialization</span></span>
<span class="line"><span style="color:#79B8FF;">2020</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">10</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">31</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">16</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">17</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">07.589</span><span style="color:#F97583;">+</span><span style="color:#79B8FF;">0000</span><span style="color:#E1E4E8;"> [id</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">21</span><span style="color:#E1E4E8;">]	</span><span style="color:#79B8FF;">INFO</span><span style="color:#E1E4E8;">	hudson.</span><span style="color:#79B8FF;">WebAppMain$3</span><span style="color:#E1E4E8;">#run</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Jenkins</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">is</span><span style="color:#E1E4E8;"> fully up and running</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">$ docker logs </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">f jenkins</span></span>
<span class="line"><span style="color:#24292E;">unning from</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">/</span><span style="color:#24292E;">usr</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">share</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">jenkins</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">jenkins.war</span></span>
<span class="line"><span style="color:#24292E;">webroot</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">EnvVars</span><span style="color:#24292E;">.masterEnvVars.</span><span style="color:#6F42C1;">get</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;JENKINS_HOME&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#005CC5;">2020</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">10</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">31</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">16</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">13</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">06.472</span><span style="color:#D73A49;">+</span><span style="color:#005CC5;">0000</span><span style="color:#24292E;"> [id</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">]	</span><span style="color:#005CC5;">INFO</span><span style="color:#24292E;">	org.eclipse.jetty.util.log.</span><span style="color:#005CC5;">Log</span><span style="color:#24292E;">#initialized</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Logging</span><span style="color:#24292E;"> initialized @292ms to org.eclipse.jetty.util.log.</span><span style="color:#005CC5;">JavaUtilLog</span></span>
<span class="line"><span style="color:#005CC5;">2020</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">10</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">31</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">16</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">13</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">06.581</span><span style="color:#D73A49;">+</span><span style="color:#005CC5;">0000</span><span style="color:#24292E;"> [id</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">]	</span><span style="color:#005CC5;">INFO</span><span style="color:#24292E;">	winstone.</span><span style="color:#005CC5;">Logger</span><span style="color:#24292E;">#logInternal</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Beginning</span><span style="color:#24292E;"> extraction from war file</span></span>
<span class="line"><span style="color:#005CC5;">2020</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">10</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">31</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">16</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">13</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">08.369</span><span style="color:#D73A49;">+</span><span style="color:#005CC5;">0000</span><span style="color:#24292E;"> [id</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">]	</span><span style="color:#005CC5;">WARNING</span><span style="color:#24292E;">	o.e.j.s.handler.</span><span style="color:#005CC5;">ContextHandler</span><span style="color:#24292E;">#setContextPath</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Empty</span><span style="color:#24292E;"> contextPath</span></span>
<span class="line"><span style="color:#24292E;">... 省略部分启动日志</span></span>
<span class="line"><span style="color:#005CC5;">Jenkins</span><span style="color:#24292E;"> initial setup </span><span style="color:#D73A49;">is</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">required</span><span style="color:#24292E;">. </span><span style="color:#005CC5;">An</span><span style="color:#24292E;"> admin user has been created and a password generated.</span></span>
<span class="line"><span style="color:#005CC5;">Please</span><span style="color:#24292E;"> use the following password to proceed to installation</span><span style="color:#D73A49;">:</span></span>
<span class="line"><span style="color:#D73A49;">*************************************************************</span></span>
<span class="line"><span style="color:#D73A49;">*************************************************************</span></span>
<span class="line"><span style="color:#D73A49;">*************************************************************</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;">Jenkins</span><span style="color:#24292E;"> initial setup </span><span style="color:#D73A49;">is</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">required</span><span style="color:#24292E;">. </span><span style="color:#005CC5;">An</span><span style="color:#24292E;"> admin user has been created and a password generated.</span></span>
<span class="line"><span style="color:#005CC5;">Please</span><span style="color:#24292E;"> use the following password to proceed to installation</span><span style="color:#D73A49;">:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">fb3499944e4845bba9d4b7d9eb4e3932</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;">This</span><span style="color:#24292E;"> may also be found at</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">/var/</span><span style="color:#24292E;">jenkins_home</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">secrets</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">initialAdminPassword</span></span>
<span class="line"><span style="color:#D73A49;">*************************************************************</span></span>
<span class="line"><span style="color:#D73A49;">*************************************************************</span></span>
<span class="line"><span style="color:#D73A49;">*************************************************************</span></span>
<span class="line"><span style="color:#005CC5;">This</span><span style="color:#24292E;"> may also be found at</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">/var/</span><span style="color:#24292E;">jenkins_home</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">secrets</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">initialAdminPassword</span></span>
<span class="line"><span style="color:#005CC5;">2020</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">10</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">31</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">16</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">17</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">07.577</span><span style="color:#D73A49;">+</span><span style="color:#005CC5;">0000</span><span style="color:#24292E;"> [id</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">28</span><span style="color:#24292E;">]	</span><span style="color:#005CC5;">INFO</span><span style="color:#24292E;">	jenkins.</span><span style="color:#005CC5;">InitReactorRunner$1</span><span style="color:#24292E;">#onAttained</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Completed</span><span style="color:#24292E;"> initialization</span></span>
<span class="line"><span style="color:#005CC5;">2020</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">10</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">31</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">16</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">17</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">07.589</span><span style="color:#D73A49;">+</span><span style="color:#005CC5;">0000</span><span style="color:#24292E;"> [id</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">21</span><span style="color:#24292E;">]	</span><span style="color:#005CC5;">INFO</span><span style="color:#24292E;">	hudson.</span><span style="color:#005CC5;">WebAppMain$3</span><span style="color:#24292E;">#run</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Jenkins</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">is</span><span style="color:#24292E;"> fully up and running</span></span></code></pre></div><p>之后，我们通过访问 <a href="http://localhost:8888" target="_blank" rel="noreferrer">http://localhost:8888</a> 就可以访问到 Jenkins 服务了。</p>`,9),C=s("p",null,"图3 Jenkins 登录界面",-1),d=s("p",null,"然后将日志中的密码粘贴到密码框即可，之后 Jenkins 会自动初始化，我们根据引导，安装推荐的插件即可。",-1),D=s("p",null,"图4 Jenkins 引导页面",-1),A=s("p",null,"选择好安装推荐的插件后，Jenkins 会自动开始初始化一些常用插件。界面如下：",-1),u=s("p",null,"图5 Jenkins 插件初始化",-1),g=s("p",null,"插件初始化完后，创建管理员账户和密码，输入用户名、密码和邮箱等信息，然后点击保存并完成即可。",-1),h=s("p",null,"图6 Jenkins 创建管理员",-1),k=s("p",null,"这里，确认 Jenkins 地址，我们就可以进入到 Jenkins 主页了。",-1),_=s("p",null,"图7 Jenkins 主页",-1),b=s("p",null,"然后在系统管理 -> 插件管理 -> 可选插件处，搜索 GitLab 和 Docker ，分别安装相关插件即可，以便我们的 Jenkins 服务和 GitLab 以及 Docker 可以更好地交互。",-1),m=s("p",null,"图8 Jenkins 插件安装",-1),B=s("p",null,"等待插件安装完成， 重启 Jenkins ，我们的 Jenkins 环境就准备完成了。",-1),v=s("p",null,"现在，我们的 Docker+Jenkins+GitLab 环境已经准备完成，后面只需要把我们的代码推送到 GitLab 中，并做相关的配置即可实现推送代码自动构建镜像和发布。",-1),f=s("h3",{id:"结语",tabindex:"-1"},[n("结语 "),s("a",{class:"header-anchor",href:"#结语","aria-label":'Permalink to "结语"'},"​")],-1),I=s("p",null,"Docker 的出现解决了 CI/CD 流程中的各种问题，Docker 交付的镜像不仅包含应用程序，也包含了应用程序的运行环境，这很好地解决了开发和线上环境不一致问题。同时 Docker 的出现也极大地提升了 CI/CD 的构建效率，我们仅仅需要编写一个 Dockerfile 并将 Dockerfile 提交到我们的代码仓库即可快速构建出我们的应用，最后，当我们构建好 Docker 镜像后 Docker 可以帮助我们快速发布及更新应用。",-1),J=s("p",null,"那么，你知道 Docker 还可以帮助我们解决 CI/CD 流程中的哪些问题吗？",-1),q=s("p",null,"下一讲，我将为你讲解 CI/CD 实战，利用我们准备好的环境自动构建和发布应用。",-1);function w(j,G,L,P,N,x){const a=e("Image");return t(),c("div",null,[y,l(a,{alt:"Drawing 0.png",src:"https://s0.lgstatic.com/i/image/M00/6F/40/CgqCHl-05ceAOEtOAAC7xTjpRgo536.png"}),n(),E,i,l(a,{alt:"Drawing 1.png",src:"https://s0.lgstatic.com/i/image/M00/6F/40/CgqCHl-05eKAftEiAACO_hts6R8497.png"}),n(),F,l(a,{alt:"Drawing 2.png",src:"https://s0.lgstatic.com/i/image/M00/6F/35/Ciqc1F-05giAJYDhAADCpDZzl2M065.png"}),n(),C,d,l(a,{alt:"Drawing 3.png",src:"https://s0.lgstatic.com/i/image/M00/6F/35/Ciqc1F-05hSAHd7VAAEpFeu4qfY218.png"}),n(),D,A,l(a,{alt:"Drawing 4.png",src:"https://s0.lgstatic.com/i/image/M00/6F/35/Ciqc1F-05h-AUSiFAAEAxHFCt30058.png"}),n(),u,g,l(a,{alt:"Drawing 5.png",src:"https://s0.lgstatic.com/i/image/M00/6F/35/Ciqc1F-05iaANJXNAABXftlfsvQ115.png"}),n(),h,k,l(a,{alt:"Drawing 6.png",src:"https://s0.lgstatic.com/i/image/M00/6F/35/Ciqc1F-05i2AR2lRAADHULl7Ysk145.png"}),n(),_,b,l(a,{alt:"Drawing 7.png",src:"https://s0.lgstatic.com/i/image/M00/6F/35/Ciqc1F-05j2AfmTUAAGVJGSmG1g804.png"}),n(),l(a,{alt:"Drawing 8.png",src:"https://s0.lgstatic.com/i/image/M00/6F/35/Ciqc1F-05kKAMr27AAGh4SQTNsU299.png"}),n(),m,B,v,f,I,J,q])}const M=p(r,[["render",w]]);export{T as __pageData,M as default};
