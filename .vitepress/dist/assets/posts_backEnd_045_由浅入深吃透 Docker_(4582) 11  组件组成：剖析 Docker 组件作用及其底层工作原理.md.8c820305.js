import{_ as o,j as l,o as t,g as e,k as p,h as n,s,Q as c}from"./chunks/framework.e0c66c3f.js";const b=JSON.parse('{"title":"Docker 的组件构成 ","description":"","frontmatter":{},"headers":[],"relativePath":"posts/backEnd/045_由浅入深吃透 Docker/(4582) 11  组件组成：剖析 Docker 组件作用及其底层工作原理.md","filePath":"posts/backEnd/045_由浅入深吃透 Docker/(4582) 11  组件组成：剖析 Docker 组件作用及其底层工作原理.md","lastUpdated":1696338709000}'),r={name:"posts/backEnd/045_由浅入深吃透 Docker/(4582) 11  组件组成：剖析 Docker 组件作用及其底层工作原理.md"},y=s("p",null,[n("在"),s("a",{href:"https://kaiwu.lagou.com/course/courseInfo.htm?courseId=455#/detail/pc?id=4573",target:"_blank",rel:"noreferrer"},'第 02 课时" 核心概念：镜像、容器、仓库，彻底掌握 Docker 架构核心设计理念"'),n("里。我简单介绍了 Docker 架构的形成，相信你已经对 Docker 的架构有了一个整体的认知。这一讲我将带你深入剖析 Docker 的各个组件的作用及其底层的实现原理。")],-1),E=s("p",null,"首先我们来回顾一下 Docker 的组件构成。",-1),F=s("h3",{id:"docker-的组件构成",tabindex:"-1"},[n("Docker 的组件构成 "),s("a",{class:"header-anchor",href:"#docker-的组件构成","aria-label":'Permalink to "Docker 的组件构成"'},"​")],-1),i=s("p",null,[n("Docker 整体架构采用 C/S（客户端 / 服务器）模式，主要由客户端和服务端两大部分组成。客户端负责发送操作指令，服务端负责接收和处理指令。客户端和服务端通信有多种方式，即可以在同一台机器上通过"),s("code",null,"UNIX"),n("套接字通信，也可以通过网络连接远程通信。")],-1),C=c(`<p>图1 Docker 整体架构图</p><p>从整体架构可知，Docker 组件大体分为 Docker 相关组件，containerd 相关组件和容器运行时相关组件。下面我们深入剖析下各个组件。</p><h3 id="docker-组件剖析" tabindex="-1">Docker 组件剖析 <a class="header-anchor" href="#docker-组件剖析" aria-label="Permalink to &quot;Docker 组件剖析&quot;">​</a></h3><p>Docker 到底有哪些组件呢？我们可以在 Docker 安装路径下执行 ls 命令，这样可以看到以下与 Docker 有关的组件。</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">rwxr</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">xr</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">x </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> root root </span><span style="color:#79B8FF;">27941976</span><span style="color:#E1E4E8;"> Dec </span><span style="color:#79B8FF;">12</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">2019</span><span style="color:#E1E4E8;"> containerd</span></span>
<span class="line"><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">rwxr</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">xr</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">x </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> root root  </span><span style="color:#79B8FF;">4964704</span><span style="color:#E1E4E8;"> Dec </span><span style="color:#79B8FF;">12</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">2019</span><span style="color:#E1E4E8;"> containerd</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">shim</span></span>
<span class="line"><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">rwxr</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">xr</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">x </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> root root </span><span style="color:#79B8FF;">15678392</span><span style="color:#E1E4E8;"> Dec </span><span style="color:#79B8FF;">12</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">2019</span><span style="color:#E1E4E8;"> ctr</span></span>
<span class="line"><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">rwxr</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">xr</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">x </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> root root </span><span style="color:#79B8FF;">50683148</span><span style="color:#E1E4E8;"> Dec </span><span style="color:#79B8FF;">12</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">2019</span><span style="color:#E1E4E8;"> docker</span></span>
<span class="line"><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">rwxr</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">xr</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">x </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> root root   </span><span style="color:#79B8FF;">764144</span><span style="color:#E1E4E8;"> Dec </span><span style="color:#79B8FF;">12</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">2019</span><span style="color:#E1E4E8;"> docker</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">init</span></span>
<span class="line"><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">rwxr</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">xr</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">x </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> root root  </span><span style="color:#79B8FF;">2837280</span><span style="color:#E1E4E8;"> Dec </span><span style="color:#79B8FF;">12</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">2019</span><span style="color:#E1E4E8;"> docker</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">proxy</span></span>
<span class="line"><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">rwxr</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">xr</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">x </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> root root </span><span style="color:#79B8FF;">54320560</span><span style="color:#E1E4E8;"> Dec </span><span style="color:#79B8FF;">12</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">2019</span><span style="color:#E1E4E8;"> dockerd</span></span>
<span class="line"><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">rwxr</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">xr</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">x </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> root root  </span><span style="color:#79B8FF;">7522464</span><span style="color:#E1E4E8;"> Dec </span><span style="color:#79B8FF;">12</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">2019</span><span style="color:#E1E4E8;"> runc</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">-</span><span style="color:#24292E;">rwxr</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">xr</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">x </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> root root </span><span style="color:#005CC5;">27941976</span><span style="color:#24292E;"> Dec </span><span style="color:#005CC5;">12</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">2019</span><span style="color:#24292E;"> containerd</span></span>
<span class="line"><span style="color:#D73A49;">-</span><span style="color:#24292E;">rwxr</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">xr</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">x </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> root root  </span><span style="color:#005CC5;">4964704</span><span style="color:#24292E;"> Dec </span><span style="color:#005CC5;">12</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">2019</span><span style="color:#24292E;"> containerd</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">shim</span></span>
<span class="line"><span style="color:#D73A49;">-</span><span style="color:#24292E;">rwxr</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">xr</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">x </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> root root </span><span style="color:#005CC5;">15678392</span><span style="color:#24292E;"> Dec </span><span style="color:#005CC5;">12</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">2019</span><span style="color:#24292E;"> ctr</span></span>
<span class="line"><span style="color:#D73A49;">-</span><span style="color:#24292E;">rwxr</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">xr</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">x </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> root root </span><span style="color:#005CC5;">50683148</span><span style="color:#24292E;"> Dec </span><span style="color:#005CC5;">12</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">2019</span><span style="color:#24292E;"> docker</span></span>
<span class="line"><span style="color:#D73A49;">-</span><span style="color:#24292E;">rwxr</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">xr</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">x </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> root root   </span><span style="color:#005CC5;">764144</span><span style="color:#24292E;"> Dec </span><span style="color:#005CC5;">12</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">2019</span><span style="color:#24292E;"> docker</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">init</span></span>
<span class="line"><span style="color:#D73A49;">-</span><span style="color:#24292E;">rwxr</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">xr</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">x </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> root root  </span><span style="color:#005CC5;">2837280</span><span style="color:#24292E;"> Dec </span><span style="color:#005CC5;">12</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">2019</span><span style="color:#24292E;"> docker</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">proxy</span></span>
<span class="line"><span style="color:#D73A49;">-</span><span style="color:#24292E;">rwxr</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">xr</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">x </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> root root </span><span style="color:#005CC5;">54320560</span><span style="color:#24292E;"> Dec </span><span style="color:#005CC5;">12</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">2019</span><span style="color:#24292E;"> dockerd</span></span>
<span class="line"><span style="color:#D73A49;">-</span><span style="color:#24292E;">rwxr</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">xr</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">x </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> root root  </span><span style="color:#005CC5;">7522464</span><span style="color:#24292E;"> Dec </span><span style="color:#005CC5;">12</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">2019</span><span style="color:#24292E;"> runc</span></span></code></pre></div><p>这些组件根据工作职责可以分为以下三大类。</p><ol><li><p>Docker 相关的组件：docker、dockerd、docker-init 和 docker-proxy</p></li><li><p>containerd 相关的组件：containerd、containerd-shim 和 ctr</p></li><li><p>容器运行时相关的组件：runc</p></li></ol><p>下面我们就逐一了解。</p><h4 id="docker-相关的组件" tabindex="-1">Docker 相关的组件 <a class="header-anchor" href="#docker-相关的组件" aria-label="Permalink to &quot;Docker 相关的组件&quot;">​</a></h4><p><strong>（1）docker</strong></p><p>docker 是 Docker 客户端的一个完整实现，它是一个二进制文件，对用户可见的操作形式为 docker 命令，通过 docker 命令可以完成所有的 Docker 客户端与服务端的通信（还可以通过 REST API、SDK 等多种形式与 Docker 服务端通信）。</p><p>Docker 客户端与服务端的交互过程是：docker 组件向服务端发送请求后，服务端根据请求执行具体的动作并将结果返回给 docker，docker 解析服务端的返回结果，并将结果通过命令行标准输出展示给用户。这样一次完整的客户端服务端请求就完成了。</p><p><strong>（2）dockerd</strong></p><p>dockerd 是 Docker 服务端的后台常驻进程，用来接收客户端发送的请求，执行具体的处理任务，处理完成后将结果返回给客户端。</p><p>Docker 客户端可以通过多种方式向 dockerd 发送请求，我们常用的 Docker 客户端与 dockerd 的交互方式有三种。</p><ul><li><p>通过 UNIX 套接字与服务端通信：配置格式为unix://socket_path，默认 dockerd 生成的 socket 文件路径为 /var/run/docker.sock，该文件只有 root 用户或者 docker 用户组的用户才可以访问，这就是为什么 Docker 刚安装完成后只有 root 用户才能使用 docker 命令的原因。</p></li><li><p>通过 TCP 与服务端通信：配置格式为tcp://host:port，通过这种方式可以实现客户端远程连接服务端，但是在方便的同时也带有安全隐患，因此在生产环境中如果你要使用 TCP 的方式与 Docker 服务端通信，推荐使用 TLS 认证，可以通过设置 Docker 的 TLS 相关参数，来保证数据传输的安全。</p></li><li><p>通过文件描述符的方式与服务端通信：配置格式为：fd://这种格式一般用于 systemd 管理的系统中。</p></li></ul><p>Docker 客户端和服务端的通信形式必须保持一致，否则将无法通信，只有当 dockerd 监听了 UNIX 套接字客户端才可以使用 UNIX 套接字的方式与服务端通信，UNIX 套接字也是 Docker 默认的通信方式，如果你想要通过远程的方式访问 dockerd，可以在 dockerd 启动的时候添加 -H 参数指定监听的 HOST 和 PORT。</p><p><strong>（3）docker-init</strong></p><p>如果你熟悉 Linux 系统，你应该知道在 Linux 系统中，1 号进程是 init 进程，是所有进程的父进程。主机上的进程出现问题时，init 进程可以帮我们回收这些问题进程。同样的，在容器内部，当我们自己的业务进程没有回收子进程的能力时，在执行 docker run 启动容器时可以添加 --init 参数，此时 Docker 会使用 docker-init 作为1号进程，帮你管理容器内子进程，例如回收僵尸进程等。</p><p>下面我们通过启动一个 busybox 容器来演示下：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">docker</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">run</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-it</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">busybox</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">sh</span></span>
<span class="line"><span style="color:#B392F0;">/</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># ps aux</span></span>
<span class="line"><span style="color:#B392F0;">PID</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">USER</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">TIME</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">COMMAND</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">root</span><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">0</span><span style="color:#9ECBFF;">:00</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">sh</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">6</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">root</span><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">0</span><span style="color:#9ECBFF;">:00</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ps</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">aux</span></span>
<span class="line"><span style="color:#B392F0;">/</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">#</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">docker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">run</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-it</span><span style="color:#24292E;"> </span><span style="color:#032F62;">busybox</span><span style="color:#24292E;"> </span><span style="color:#032F62;">sh</span></span>
<span class="line"><span style="color:#6F42C1;">/</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># ps aux</span></span>
<span class="line"><span style="color:#6F42C1;">PID</span><span style="color:#24292E;">   </span><span style="color:#032F62;">USER</span><span style="color:#24292E;">     </span><span style="color:#032F62;">TIME</span><span style="color:#24292E;">  </span><span style="color:#032F62;">COMMAND</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">root</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">0</span><span style="color:#032F62;">:00</span><span style="color:#24292E;"> </span><span style="color:#032F62;">sh</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">6</span><span style="color:#24292E;"> </span><span style="color:#032F62;">root</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">0</span><span style="color:#032F62;">:00</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ps</span><span style="color:#24292E;"> </span><span style="color:#032F62;">aux</span></span>
<span class="line"><span style="color:#6F42C1;">/</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#</span></span></code></pre></div><p>可以看到容器启动时如果没有添加 --init 参数，1 号进程就是 sh 进程。</p><p>我们使用 Crtl + D 退出当前容器，重新启动一个新的容器并添加 --init 参数，然后看下进程：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">docker</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">run</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-it</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--init</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">busybox</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">sh</span></span>
<span class="line"><span style="color:#B392F0;">/</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># ps aux</span></span>
<span class="line"><span style="color:#B392F0;">PID</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">USER</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">TIME</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">COMMAND</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">root</span><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">0</span><span style="color:#9ECBFF;">:00</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/sbin/docker-init</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">sh</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">6</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">root</span><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">0</span><span style="color:#9ECBFF;">:00</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">sh</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">7</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">root</span><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">0</span><span style="color:#9ECBFF;">:00</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ps</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">aux</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">docker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">run</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-it</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--init</span><span style="color:#24292E;"> </span><span style="color:#032F62;">busybox</span><span style="color:#24292E;"> </span><span style="color:#032F62;">sh</span></span>
<span class="line"><span style="color:#6F42C1;">/</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># ps aux</span></span>
<span class="line"><span style="color:#6F42C1;">PID</span><span style="color:#24292E;">   </span><span style="color:#032F62;">USER</span><span style="color:#24292E;">     </span><span style="color:#032F62;">TIME</span><span style="color:#24292E;">  </span><span style="color:#032F62;">COMMAND</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">root</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">0</span><span style="color:#032F62;">:00</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/sbin/docker-init</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--</span><span style="color:#24292E;"> </span><span style="color:#032F62;">sh</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">6</span><span style="color:#24292E;"> </span><span style="color:#032F62;">root</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">0</span><span style="color:#032F62;">:00</span><span style="color:#24292E;"> </span><span style="color:#032F62;">sh</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">7</span><span style="color:#24292E;"> </span><span style="color:#032F62;">root</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">0</span><span style="color:#032F62;">:00</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ps</span><span style="color:#24292E;"> </span><span style="color:#032F62;">aux</span></span></code></pre></div><p>可以看到此时容器内的 1 号进程已经变为 /sbin/docker-init，而不再是 sh 了。</p><p><strong>（4）docker-proxy</strong></p><p>docker-proxy 主要是用来做端口映射的。当我们使用 docker run 命令启动容器时，如果使用了 -p 参数，docker-proxy 组件就会把容器内相应的端口映射到主机上来，底层是依赖于 iptables 实现的。</p><p>下面我们通过一个实例演示下。</p><p>使用以下命令启动一个 nginx 容器并把容器的 80 端口映射到主机的 8080 端口。</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">docker</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">run</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--name=nginx</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-d</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-p</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">8080</span><span style="color:#9ECBFF;">:80</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nginx</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">docker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">run</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--name=nginx</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-d</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-p</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">8080</span><span style="color:#032F62;">:80</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nginx</span></span></code></pre></div><p>然后通过以下命令查看一下启动的容器 IP：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">docker</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">inspect</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--format</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;{ { .NetworkSettings.IPAddress }}&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nginx</span></span>
<span class="line"><span style="color:#B392F0;">172.17.0.2</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">docker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">inspect</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--format</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;{ { .NetworkSettings.IPAddress }}&#39;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nginx</span></span>
<span class="line"><span style="color:#6F42C1;">172.17.0.2</span></span></code></pre></div><p>可以看到，我们启动的 nginx 容器 IP 为 172.17.0.2。</p><p>此时，我们使用 ps 命令查看一下主机上是否有 docker-proxy 进程：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ps</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">aux</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#B392F0;">grep</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">docker-proxy</span></span>
<span class="line"><span style="color:#B392F0;">root</span><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">9100</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">0.0</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">0.0</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">290772</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">9160</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">?</span><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">Sl</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">07</span><span style="color:#9ECBFF;">:48</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#9ECBFF;">:00</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/usr/bin/docker-proxy</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-proto</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">tcp</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-host-ip</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0.0</span><span style="color:#9ECBFF;">.0.0</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-host-port</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">8080</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-container-ip</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">172.17</span><span style="color:#9ECBFF;">.0.2</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-container-port</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">80</span></span>
<span class="line"><span style="color:#B392F0;">root</span><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">9192</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">0.0</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">0.0</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">112784</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">992</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pts/0</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">S+</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">07</span><span style="color:#9ECBFF;">:51</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#9ECBFF;">:00</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">grep</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--color=auto</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">docker-proxy</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ps</span><span style="color:#24292E;"> </span><span style="color:#032F62;">aux</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">grep</span><span style="color:#24292E;"> </span><span style="color:#032F62;">docker-proxy</span></span>
<span class="line"><span style="color:#6F42C1;">root</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">9100</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">0.0</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">0.0</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">290772</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">9160</span><span style="color:#24292E;"> </span><span style="color:#032F62;">?</span><span style="color:#24292E;">        </span><span style="color:#032F62;">Sl</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">07</span><span style="color:#032F62;">:48</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#032F62;">:00</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/usr/bin/docker-proxy</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-proto</span><span style="color:#24292E;"> </span><span style="color:#032F62;">tcp</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-host-ip</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0.0</span><span style="color:#032F62;">.0.0</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-host-port</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">8080</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-container-ip</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">172.17</span><span style="color:#032F62;">.0.2</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-container-port</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">80</span></span>
<span class="line"><span style="color:#6F42C1;">root</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">9192</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">0.0</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">0.0</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">112784</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">992</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pts/0</span><span style="color:#24292E;">    </span><span style="color:#032F62;">S+</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">07</span><span style="color:#032F62;">:51</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#032F62;">:00</span><span style="color:#24292E;"> </span><span style="color:#032F62;">grep</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--color=auto</span><span style="color:#24292E;"> </span><span style="color:#032F62;">docker-proxy</span></span></code></pre></div><p>可以看到当我们启动一个容器时需要端口映射时， Docker 为我们创建了一个 docker-proxy 进程，并且通过参数把我们的容器 IP 和端口传递给 docker-proxy 进程，然后 docker-proxy 通过 iptables 实现了 nat 转发。</p><p>我们通过以下命令查看一下主机上 iptables nat 表的规则：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">iptables</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-L</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-nv</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-t</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nat</span></span>
<span class="line"><span style="color:#B392F0;">Chain</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">PREROUTING</span><span style="color:#E1E4E8;"> (policy </span><span style="color:#9ECBFF;">ACCEPT</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">35</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">packets,</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2214</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">bytes</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pkts</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">bytes</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">target</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">prot</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">opt</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">in</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">out</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">source</span><span style="color:#E1E4E8;">               </span><span style="color:#9ECBFF;">destination</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">398</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">21882</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">DOCKER</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">all</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">--</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">*</span><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">*</span><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">0.0</span><span style="color:#9ECBFF;">.0.0/0</span><span style="color:#E1E4E8;">            </span><span style="color:#79B8FF;">0.0</span><span style="color:#9ECBFF;">.0.0/0</span><span style="color:#E1E4E8;">            </span><span style="color:#9ECBFF;">ADDRTYPE</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">match</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">dst-type</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">LOCAL</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">Chain</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INPUT</span><span style="color:#E1E4E8;"> (policy </span><span style="color:#9ECBFF;">ACCEPT</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">35</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">packets,</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2214</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">bytes</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pkts</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">bytes</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">target</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">prot</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">opt</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">in</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">out</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">source</span><span style="color:#E1E4E8;">               </span><span style="color:#9ECBFF;">destination</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">Chain</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">OUTPUT</span><span style="color:#E1E4E8;"> (policy </span><span style="color:#9ECBFF;">ACCEPT</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">packets,</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">76</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">bytes</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pkts</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">bytes</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">target</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">prot</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">opt</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">in</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">out</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">source</span><span style="color:#E1E4E8;">               </span><span style="color:#9ECBFF;">destination</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">0</span><span style="color:#E1E4E8;">     </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">DOCKER</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">all</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">--</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">*</span><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">*</span><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">0.0</span><span style="color:#9ECBFF;">.0.0/0</span><span style="color:#E1E4E8;">           </span><span style="color:#9ECBFF;">!127.0.0.0/8</span><span style="color:#E1E4E8;">          </span><span style="color:#9ECBFF;">ADDRTYPE</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">match</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">dst-type</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">LOCAL</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">Chain</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">POSTROUTING</span><span style="color:#E1E4E8;"> (policy </span><span style="color:#9ECBFF;">ACCEPT</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">packets,</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">76</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">bytes</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pkts</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">bytes</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">target</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">prot</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">opt</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">in</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">out</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">source</span><span style="color:#E1E4E8;">               </span><span style="color:#9ECBFF;">destination</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">0</span><span style="color:#E1E4E8;">     </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">MASQUERADE</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">all</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">--</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">*</span><span style="color:#E1E4E8;">      </span><span style="color:#9ECBFF;">!docker0</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">172.17</span><span style="color:#9ECBFF;">.0.0/16</span><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">0.0</span><span style="color:#9ECBFF;">.0.0/0</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">0</span><span style="color:#E1E4E8;">     </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">MASQUERADE</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">tcp</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">--</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">*</span><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">*</span><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">172.17</span><span style="color:#9ECBFF;">.0.2</span><span style="color:#E1E4E8;">           </span><span style="color:#79B8FF;">172.17</span><span style="color:#9ECBFF;">.0.2</span><span style="color:#E1E4E8;">           </span><span style="color:#9ECBFF;">tcp</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">dpt:80</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">Chain</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">DOCKER</span><span style="color:#E1E4E8;"> (2 </span><span style="color:#9ECBFF;">references</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pkts</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">bytes</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">target</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">prot</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">opt</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">in</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">out</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">source</span><span style="color:#E1E4E8;">               </span><span style="color:#9ECBFF;">destination</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">0</span><span style="color:#E1E4E8;">     </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">RETURN</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">all</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">--</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">docker0</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">*</span><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">0.0</span><span style="color:#9ECBFF;">.0.0/0</span><span style="color:#E1E4E8;">            </span><span style="color:#79B8FF;">0.0</span><span style="color:#9ECBFF;">.0.0/0</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">0</span><span style="color:#E1E4E8;">     </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">DNAT</span><span style="color:#E1E4E8;">       </span><span style="color:#9ECBFF;">tcp</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">--</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">!docker0</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">*</span><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">0.0</span><span style="color:#9ECBFF;">.0.0/0</span><span style="color:#E1E4E8;">            </span><span style="color:#79B8FF;">0.0</span><span style="color:#9ECBFF;">.0.0/0</span><span style="color:#E1E4E8;">            </span><span style="color:#9ECBFF;">tcp</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">dpt:8080</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">to:172.17.0.2:80</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;">  </span><span style="color:#032F62;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">iptables</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-L</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-nv</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-t</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nat</span></span>
<span class="line"><span style="color:#6F42C1;">Chain</span><span style="color:#24292E;"> </span><span style="color:#032F62;">PREROUTING</span><span style="color:#24292E;"> (policy </span><span style="color:#032F62;">ACCEPT</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">35</span><span style="color:#24292E;"> </span><span style="color:#032F62;">packets,</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2214</span><span style="color:#24292E;"> </span><span style="color:#032F62;">bytes</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pkts</span><span style="color:#24292E;"> </span><span style="color:#032F62;">bytes</span><span style="color:#24292E;"> </span><span style="color:#032F62;">target</span><span style="color:#24292E;">     </span><span style="color:#032F62;">prot</span><span style="color:#24292E;"> </span><span style="color:#032F62;">opt</span><span style="color:#24292E;"> </span><span style="color:#032F62;">in</span><span style="color:#24292E;">     </span><span style="color:#032F62;">out</span><span style="color:#24292E;">     </span><span style="color:#032F62;">source</span><span style="color:#24292E;">               </span><span style="color:#032F62;">destination</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">398</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">21882</span><span style="color:#24292E;"> </span><span style="color:#032F62;">DOCKER</span><span style="color:#24292E;">     </span><span style="color:#032F62;">all</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">--</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">*</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">*</span><span style="color:#24292E;">       </span><span style="color:#005CC5;">0.0</span><span style="color:#032F62;">.0.0/0</span><span style="color:#24292E;">            </span><span style="color:#005CC5;">0.0</span><span style="color:#032F62;">.0.0/0</span><span style="color:#24292E;">            </span><span style="color:#032F62;">ADDRTYPE</span><span style="color:#24292E;"> </span><span style="color:#032F62;">match</span><span style="color:#24292E;"> </span><span style="color:#032F62;">dst-type</span><span style="color:#24292E;"> </span><span style="color:#032F62;">LOCAL</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">Chain</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INPUT</span><span style="color:#24292E;"> (policy </span><span style="color:#032F62;">ACCEPT</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">35</span><span style="color:#24292E;"> </span><span style="color:#032F62;">packets,</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2214</span><span style="color:#24292E;"> </span><span style="color:#032F62;">bytes</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pkts</span><span style="color:#24292E;"> </span><span style="color:#032F62;">bytes</span><span style="color:#24292E;"> </span><span style="color:#032F62;">target</span><span style="color:#24292E;">     </span><span style="color:#032F62;">prot</span><span style="color:#24292E;"> </span><span style="color:#032F62;">opt</span><span style="color:#24292E;"> </span><span style="color:#032F62;">in</span><span style="color:#24292E;">     </span><span style="color:#032F62;">out</span><span style="color:#24292E;">     </span><span style="color:#032F62;">source</span><span style="color:#24292E;">               </span><span style="color:#032F62;">destination</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">Chain</span><span style="color:#24292E;"> </span><span style="color:#032F62;">OUTPUT</span><span style="color:#24292E;"> (policy </span><span style="color:#032F62;">ACCEPT</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">packets,</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">76</span><span style="color:#24292E;"> </span><span style="color:#032F62;">bytes</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pkts</span><span style="color:#24292E;"> </span><span style="color:#032F62;">bytes</span><span style="color:#24292E;"> </span><span style="color:#032F62;">target</span><span style="color:#24292E;">     </span><span style="color:#032F62;">prot</span><span style="color:#24292E;"> </span><span style="color:#032F62;">opt</span><span style="color:#24292E;"> </span><span style="color:#032F62;">in</span><span style="color:#24292E;">     </span><span style="color:#032F62;">out</span><span style="color:#24292E;">     </span><span style="color:#032F62;">source</span><span style="color:#24292E;">               </span><span style="color:#032F62;">destination</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">0</span><span style="color:#24292E;">     </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#032F62;">DOCKER</span><span style="color:#24292E;">     </span><span style="color:#032F62;">all</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">--</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">*</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">*</span><span style="color:#24292E;">       </span><span style="color:#005CC5;">0.0</span><span style="color:#032F62;">.0.0/0</span><span style="color:#24292E;">           </span><span style="color:#032F62;">!127.0.0.0/8</span><span style="color:#24292E;">          </span><span style="color:#032F62;">ADDRTYPE</span><span style="color:#24292E;"> </span><span style="color:#032F62;">match</span><span style="color:#24292E;"> </span><span style="color:#032F62;">dst-type</span><span style="color:#24292E;"> </span><span style="color:#032F62;">LOCAL</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">Chain</span><span style="color:#24292E;"> </span><span style="color:#032F62;">POSTROUTING</span><span style="color:#24292E;"> (policy </span><span style="color:#032F62;">ACCEPT</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">packets,</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">76</span><span style="color:#24292E;"> </span><span style="color:#032F62;">bytes</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pkts</span><span style="color:#24292E;"> </span><span style="color:#032F62;">bytes</span><span style="color:#24292E;"> </span><span style="color:#032F62;">target</span><span style="color:#24292E;">     </span><span style="color:#032F62;">prot</span><span style="color:#24292E;"> </span><span style="color:#032F62;">opt</span><span style="color:#24292E;"> </span><span style="color:#032F62;">in</span><span style="color:#24292E;">     </span><span style="color:#032F62;">out</span><span style="color:#24292E;">     </span><span style="color:#032F62;">source</span><span style="color:#24292E;">               </span><span style="color:#032F62;">destination</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">0</span><span style="color:#24292E;">     </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#032F62;">MASQUERADE</span><span style="color:#24292E;">  </span><span style="color:#032F62;">all</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">--</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">*</span><span style="color:#24292E;">      </span><span style="color:#032F62;">!docker0</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">172.17</span><span style="color:#032F62;">.0.0/16</span><span style="color:#24292E;">        </span><span style="color:#005CC5;">0.0</span><span style="color:#032F62;">.0.0/0</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">0</span><span style="color:#24292E;">     </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#032F62;">MASQUERADE</span><span style="color:#24292E;">  </span><span style="color:#032F62;">tcp</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">--</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">*</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">*</span><span style="color:#24292E;">       </span><span style="color:#005CC5;">172.17</span><span style="color:#032F62;">.0.2</span><span style="color:#24292E;">           </span><span style="color:#005CC5;">172.17</span><span style="color:#032F62;">.0.2</span><span style="color:#24292E;">           </span><span style="color:#032F62;">tcp</span><span style="color:#24292E;"> </span><span style="color:#032F62;">dpt:80</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">Chain</span><span style="color:#24292E;"> </span><span style="color:#032F62;">DOCKER</span><span style="color:#24292E;"> (2 </span><span style="color:#032F62;">references</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pkts</span><span style="color:#24292E;"> </span><span style="color:#032F62;">bytes</span><span style="color:#24292E;"> </span><span style="color:#032F62;">target</span><span style="color:#24292E;">     </span><span style="color:#032F62;">prot</span><span style="color:#24292E;"> </span><span style="color:#032F62;">opt</span><span style="color:#24292E;"> </span><span style="color:#032F62;">in</span><span style="color:#24292E;">     </span><span style="color:#032F62;">out</span><span style="color:#24292E;">     </span><span style="color:#032F62;">source</span><span style="color:#24292E;">               </span><span style="color:#032F62;">destination</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">0</span><span style="color:#24292E;">     </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#032F62;">RETURN</span><span style="color:#24292E;">     </span><span style="color:#032F62;">all</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">--</span><span style="color:#24292E;">  </span><span style="color:#032F62;">docker0</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">*</span><span style="color:#24292E;">       </span><span style="color:#005CC5;">0.0</span><span style="color:#032F62;">.0.0/0</span><span style="color:#24292E;">            </span><span style="color:#005CC5;">0.0</span><span style="color:#032F62;">.0.0/0</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">0</span><span style="color:#24292E;">     </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#032F62;">DNAT</span><span style="color:#24292E;">       </span><span style="color:#032F62;">tcp</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">--</span><span style="color:#24292E;">  </span><span style="color:#032F62;">!docker0</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">*</span><span style="color:#24292E;">       </span><span style="color:#005CC5;">0.0</span><span style="color:#032F62;">.0.0/0</span><span style="color:#24292E;">            </span><span style="color:#005CC5;">0.0</span><span style="color:#032F62;">.0.0/0</span><span style="color:#24292E;">            </span><span style="color:#032F62;">tcp</span><span style="color:#24292E;"> </span><span style="color:#032F62;">dpt:8080</span><span style="color:#24292E;"> </span><span style="color:#032F62;">to:172.17.0.2:80</span></span></code></pre></div><p>通过最后一行规则我们可以得知，当我们访问主机的 8080 端口时，iptables 会把流量转发到 172.17.0.2 的 80 端口，从而实现了我们从主机上可以直接访问到容器内的业务。</p><p>我们通过 curl 命令访问一下 nginx 容器：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">curl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">http://localhost:8080</span></span>
<span class="line"><span style="color:#F97583;">&lt;!</span><span style="color:#B392F0;">DOCTYPE</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">htm</span><span style="color:#E1E4E8;">l</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">html</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">head</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">title</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">Welcome to nginx</span><span style="color:#F97583;">!&lt;</span><span style="color:#E1E4E8;">/title</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">style</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">body</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">width:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">35</span><span style="color:#9ECBFF;">em</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">margin:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">auto</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">font-family:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Tahoma,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Verdana,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Arial,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">sans-serif</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">/style</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">/head</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">body</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">h</span><span style="color:#F97583;">1&gt;</span><span style="color:#E1E4E8;">Welcome to nginx</span><span style="color:#F97583;">!&lt;</span><span style="color:#E1E4E8;">/h</span><span style="color:#F97583;">1&gt;</span></span>
<span class="line"><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">p</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">If you see this page, the nginx web server is successfully installed and</span></span>
<span class="line"><span style="color:#B392F0;">working.</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Further</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">configuration</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">is</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">required.</span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">/</span><span style="color:#E1E4E8;">p</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">p</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">For online documentation and support please refer to</span></span>
<span class="line"><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">a href=</span><span style="color:#9ECBFF;">&quot;http://nginx.org/&quot;</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">nginx.org</span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">/a</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">.</span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">br/</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#B392F0;">Commercial</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">support</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">is</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">available</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">at</span></span>
<span class="line"><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">a href=</span><span style="color:#9ECBFF;">&quot;http://nginx.com/&quot;</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">nginx.com</span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">/a</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">.</span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">/p</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">p&gt;&lt;em</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">Thank you </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> using nginx.</span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">/em&gt;&lt;/p</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">/body</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">/html</span><span style="color:#F97583;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">curl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">http://localhost:8080</span></span>
<span class="line"><span style="color:#D73A49;">&lt;!</span><span style="color:#6F42C1;">DOCTYPE</span><span style="color:#24292E;"> </span><span style="color:#032F62;">htm</span><span style="color:#24292E;">l</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">html</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">head</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">title</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">Welcome to nginx</span><span style="color:#D73A49;">!&lt;</span><span style="color:#24292E;">/title</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">style</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">body</span><span style="color:#24292E;"> </span><span style="color:#032F62;">{</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">width:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">35</span><span style="color:#032F62;">em</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">margin:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#032F62;">auto</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">font-family:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Tahoma,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Verdana,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Arial,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">sans-serif</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">/style</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">/head</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">body</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">h</span><span style="color:#D73A49;">1&gt;</span><span style="color:#24292E;">Welcome to nginx</span><span style="color:#D73A49;">!&lt;</span><span style="color:#24292E;">/h</span><span style="color:#D73A49;">1&gt;</span></span>
<span class="line"><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">p</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">If you see this page, the nginx web server is successfully installed and</span></span>
<span class="line"><span style="color:#6F42C1;">working.</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Further</span><span style="color:#24292E;"> </span><span style="color:#032F62;">configuration</span><span style="color:#24292E;"> </span><span style="color:#032F62;">is</span><span style="color:#24292E;"> </span><span style="color:#032F62;">required.</span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">/</span><span style="color:#24292E;">p</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">p</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">For online documentation and support please refer to</span></span>
<span class="line"><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">a href=</span><span style="color:#032F62;">&quot;http://nginx.org/&quot;</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">nginx.org</span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">/a</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">.</span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">br/</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#6F42C1;">Commercial</span><span style="color:#24292E;"> </span><span style="color:#032F62;">support</span><span style="color:#24292E;"> </span><span style="color:#032F62;">is</span><span style="color:#24292E;"> </span><span style="color:#032F62;">available</span><span style="color:#24292E;"> </span><span style="color:#032F62;">at</span></span>
<span class="line"><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">a href=</span><span style="color:#032F62;">&quot;http://nginx.com/&quot;</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">nginx.com</span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">/a</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">.</span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">/p</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">p&gt;&lt;em</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">Thank you </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> using nginx.</span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">/em&gt;&lt;/p</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">/body</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">/html</span><span style="color:#D73A49;">&gt;</span></span></code></pre></div><p>通过上面的输出可以得知我们已经成功访问到了 nginx 容器。</p><p>总体来说，docker 是官方实现的标准客户端，dockerd 是 Docker 服务端的入口，负责接收客户端发送的指令并返回相应结果，而 docker-init 在业务主进程没有进程回收功能时则十分有用，docker-proxy 组件则是实现 Docker 网络访问的重要组件。</p><p>了解完 docker 相关的组件，下面我来介绍下 containerd 相关的组件。</p><h4 id="containerd-相关的组件" tabindex="-1">containerd 相关的组件 <a class="header-anchor" href="#containerd-相关的组件" aria-label="Permalink to &quot;containerd 相关的组件&quot;">​</a></h4><p><strong>（1）containerd</strong></p><p><a href="https://github.com/containerd/containerd" target="_blank" rel="noreferrer">containerd</a> 组件是从 Docker 1.11 版本正式从 dockerd 中剥离出来的，它的诞生完全遵循 OCI 标准，是容器标准化后的产物。containerd 完全遵循了 OCI 标准，并且是完全社区化运营的，因此被容器界广泛采用。</p><p>containerd 不仅负责容器生命周期的管理，同时还负责一些其他的功能：</p><ul><li><p>镜像的管理，例如容器运行前从镜像仓库拉取镜像到本地；</p></li><li><p>接收 dockerd 的请求，通过适当的参数调用 runc 启动容器；</p></li><li><p>管理存储相关资源；</p></li><li><p>管理网络相关资源。</p></li></ul><p>containerd 包含一个后台常驻进程，默认的 socket 路径为 /run/containerd/containerd.sock，dockerd 通过 UNIX 套接字向 containerd 发送请求，containerd 接收到请求后负责执行相关的动作并把执行结果返回给 dockerd。</p><p>如果你不想使用 dockerd，也可以直接使用 containerd 来管理容器，由于 containerd 更加简单和轻量，生产环境中越来越多的人开始直接使用 containerd 来管理容器。</p><p><strong>（2）containerd-shim</strong></p><p>containerd-shim 的意思是垫片，类似于拧螺丝时夹在螺丝和螺母之间的垫片。containerd-shim 的主要作用是将 containerd 和真正的容器进程解耦，使用 containerd-shim 作为容器进程的父进程，从而实现重启 containerd 不影响已经启动的容器进程。</p><p><strong>（3）ctr</strong></p><p>ctr 实际上是 containerd-ctr，它是 containerd 的客户端，主要用来开发和调试，在没有 dockerd 的环境中，ctr 可以充当 docker 客户端的部分角色，直接向 containerd 守护进程发送操作容器的请求。</p><p>了解完 containerd 相关的组件，我们来了解一下容器的真正运行时 runc。</p><h4 id="容器运行时组件runc" tabindex="-1">容器运行时组件runc <a class="header-anchor" href="#容器运行时组件runc" aria-label="Permalink to &quot;容器运行时组件runc&quot;">​</a></h4><p>runc 是一个标准的 OCI 容器运行时的实现，它是一个命令行工具，可以直接用来创建和运行容器。</p><p>下面我们通过一个实例来演示一下 runc 的神奇之处。</p><p>第一步，准备容器运行时文件：进入 /home/centos 目录下，创建 runc 文件夹，并导入 busybox 镜像文件。</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">cd</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/home/centos</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">## 创建 runc 运行根目录</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">mkdir</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">runc</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">## 导入 rootfs 镜像文件</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">mkdir</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">rootfs</span><span style="color:#E1E4E8;"> &amp;&amp; </span><span style="color:#B392F0;">docker</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">export</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">$(</span><span style="color:#B392F0;">docker</span><span style="color:#9ECBFF;"> create busybox)</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">tar</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-C</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">rootfs</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-xvf</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">-</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;"> </span><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">cd</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/home/centos</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6A737D;">## 创建 runc 运行根目录</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">mkdir</span><span style="color:#24292E;"> </span><span style="color:#032F62;">runc</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6A737D;">## 导入 rootfs 镜像文件</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">mkdir</span><span style="color:#24292E;"> </span><span style="color:#032F62;">rootfs</span><span style="color:#24292E;"> &amp;&amp; </span><span style="color:#6F42C1;">docker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">export</span><span style="color:#24292E;"> </span><span style="color:#032F62;">$(</span><span style="color:#6F42C1;">docker</span><span style="color:#032F62;"> create busybox)</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">tar</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-C</span><span style="color:#24292E;"> </span><span style="color:#032F62;">rootfs</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-xvf</span><span style="color:#24292E;"> </span><span style="color:#032F62;">-</span></span></code></pre></div><p>第二步，生成 runc config 文件。我们可以使用 runc spec 命令根据文件系统生成对应的 config.json 文件。命令如下：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">runc</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">spec</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">runc</span><span style="color:#24292E;"> </span><span style="color:#032F62;">spec</span></span></code></pre></div><p>此时会在当前目录下生成 config.json 文件，我们可以使用 cat 命令查看一下 config.json 的内容：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">cat</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">config.json</span></span>
<span class="line"><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#B392F0;">&quot;ociVersion&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;1.0.1-dev&quot;,</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#B392F0;">&quot;process&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">		</span><span style="color:#B392F0;">&quot;terminal&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">true</span><span style="color:#9ECBFF;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">		</span><span style="color:#B392F0;">&quot;user&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">			</span><span style="color:#B392F0;">&quot;uid&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#9ECBFF;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">			</span><span style="color:#B392F0;">&quot;gid&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#E1E4E8;">		},</span></span>
<span class="line"><span style="color:#E1E4E8;">		</span><span style="color:#B392F0;">&quot;args&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> [</span></span>
<span class="line"><span style="color:#E1E4E8;">			</span><span style="color:#B392F0;">&quot;sh&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">		],</span></span>
<span class="line"><span style="color:#E1E4E8;">		</span><span style="color:#B392F0;">&quot;env&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> [</span></span>
<span class="line"><span style="color:#E1E4E8;">			</span><span style="color:#B392F0;">&quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;</span><span style="color:#B392F0;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">			</span><span style="color:#B392F0;">&quot;TERM=xterm&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">		],</span></span>
<span class="line"><span style="color:#E1E4E8;">		</span><span style="color:#B392F0;">&quot;cwd&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;/&quot;,</span></span>
<span class="line"><span style="color:#E1E4E8;">		</span><span style="color:#B392F0;">&quot;capabilities&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">			</span><span style="color:#B392F0;">&quot;bounding&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> [</span></span>
<span class="line"><span style="color:#E1E4E8;">				</span><span style="color:#B392F0;">&quot;CAP_AUDIT_WRITE&quot;</span><span style="color:#B392F0;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">				</span><span style="color:#B392F0;">&quot;CAP_KILL&quot;</span><span style="color:#B392F0;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">				</span><span style="color:#B392F0;">&quot;CAP_NET_BIND_SERVICE&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">			],</span></span>
<span class="line"><span style="color:#E1E4E8;">			</span><span style="color:#B392F0;">&quot;effective&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> [</span></span>
<span class="line"><span style="color:#E1E4E8;">				</span><span style="color:#B392F0;">&quot;CAP_AUDIT_WRITE&quot;</span><span style="color:#B392F0;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">				</span><span style="color:#B392F0;">&quot;CAP_KILL&quot;</span><span style="color:#B392F0;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">				</span><span style="color:#B392F0;">&quot;CAP_NET_BIND_SERVICE&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">			],</span></span>
<span class="line"><span style="color:#E1E4E8;">			</span><span style="color:#B392F0;">&quot;inheritable&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> [</span></span>
<span class="line"><span style="color:#E1E4E8;">				</span><span style="color:#B392F0;">&quot;CAP_AUDIT_WRITE&quot;</span><span style="color:#B392F0;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">				</span><span style="color:#B392F0;">&quot;CAP_KILL&quot;</span><span style="color:#B392F0;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">				</span><span style="color:#B392F0;">&quot;CAP_NET_BIND_SERVICE&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">			],</span></span>
<span class="line"><span style="color:#E1E4E8;">			</span><span style="color:#B392F0;">&quot;permitted&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> [</span></span>
<span class="line"><span style="color:#E1E4E8;">				</span><span style="color:#B392F0;">&quot;CAP_AUDIT_WRITE&quot;</span><span style="color:#B392F0;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">				</span><span style="color:#B392F0;">&quot;CAP_KILL&quot;</span><span style="color:#B392F0;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">				</span><span style="color:#B392F0;">&quot;CAP_NET_BIND_SERVICE&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">			],</span></span>
<span class="line"><span style="color:#E1E4E8;">			</span><span style="color:#B392F0;">&quot;ambient&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> [</span></span>
<span class="line"><span style="color:#E1E4E8;">				</span><span style="color:#B392F0;">&quot;CAP_AUDIT_WRITE&quot;</span><span style="color:#B392F0;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">				</span><span style="color:#B392F0;">&quot;CAP_KILL&quot;</span><span style="color:#B392F0;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">				</span><span style="color:#B392F0;">&quot;CAP_NET_BIND_SERVICE&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">			]</span></span>
<span class="line"><span style="color:#E1E4E8;">		},</span></span>
<span class="line"><span style="color:#E1E4E8;">		</span><span style="color:#B392F0;">&quot;rlimits&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> [</span></span>
<span class="line"><span style="color:#E1E4E8;">			{</span></span>
<span class="line"><span style="color:#E1E4E8;">				</span><span style="color:#B392F0;">&quot;type&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;RLIMIT_NOFILE&quot;,</span></span>
<span class="line"><span style="color:#E1E4E8;">				</span><span style="color:#B392F0;">&quot;hard&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1024</span><span style="color:#9ECBFF;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">				</span><span style="color:#B392F0;">&quot;soft&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1024</span></span>
<span class="line"><span style="color:#E1E4E8;">			}</span></span>
<span class="line"><span style="color:#E1E4E8;">		],</span></span>
<span class="line"><span style="color:#E1E4E8;">		</span><span style="color:#B392F0;">&quot;noNewPrivileges&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">true</span></span>
<span class="line"><span style="color:#E1E4E8;">	},</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#B392F0;">&quot;root&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">		</span><span style="color:#B392F0;">&quot;path&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;rootfs&quot;,</span></span>
<span class="line"><span style="color:#E1E4E8;">		</span><span style="color:#B392F0;">&quot;readonly&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">true</span></span>
<span class="line"><span style="color:#E1E4E8;">	},</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#B392F0;">&quot;hostname&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;runc&quot;,</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#B392F0;">&quot;mounts&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> [</span></span>
<span class="line"><span style="color:#E1E4E8;">		{</span></span>
<span class="line"><span style="color:#E1E4E8;">			</span><span style="color:#B392F0;">&quot;destination&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;/proc&quot;,</span></span>
<span class="line"><span style="color:#E1E4E8;">			</span><span style="color:#B392F0;">&quot;type&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;proc&quot;,</span></span>
<span class="line"><span style="color:#E1E4E8;">			</span><span style="color:#B392F0;">&quot;source&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;proc&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">		},</span></span>
<span class="line"><span style="color:#E1E4E8;">		{</span></span>
<span class="line"><span style="color:#E1E4E8;">			</span><span style="color:#B392F0;">&quot;destination&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;/dev&quot;,</span></span>
<span class="line"><span style="color:#E1E4E8;">			</span><span style="color:#B392F0;">&quot;type&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;tmpfs&quot;,</span></span>
<span class="line"><span style="color:#E1E4E8;">			</span><span style="color:#B392F0;">&quot;source&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;tmpfs&quot;,</span></span>
<span class="line"><span style="color:#E1E4E8;">			</span><span style="color:#B392F0;">&quot;options&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> [</span></span>
<span class="line"><span style="color:#E1E4E8;">				</span><span style="color:#B392F0;">&quot;nosuid&quot;</span><span style="color:#B392F0;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">				</span><span style="color:#B392F0;">&quot;strictatime&quot;</span><span style="color:#B392F0;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">				</span><span style="color:#B392F0;">&quot;mode=755&quot;</span><span style="color:#B392F0;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">				</span><span style="color:#B392F0;">&quot;size=65536k&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">			]</span></span>
<span class="line"><span style="color:#E1E4E8;">		},</span></span>
<span class="line"><span style="color:#E1E4E8;">		{</span></span>
<span class="line"><span style="color:#E1E4E8;">			</span><span style="color:#B392F0;">&quot;destination&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;/dev/pts&quot;,</span></span>
<span class="line"><span style="color:#E1E4E8;">			</span><span style="color:#B392F0;">&quot;type&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;devpts&quot;,</span></span>
<span class="line"><span style="color:#E1E4E8;">			</span><span style="color:#B392F0;">&quot;source&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;devpts&quot;,</span></span>
<span class="line"><span style="color:#E1E4E8;">			</span><span style="color:#B392F0;">&quot;options&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> [</span></span>
<span class="line"><span style="color:#E1E4E8;">				</span><span style="color:#B392F0;">&quot;nosuid&quot;</span><span style="color:#B392F0;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">				</span><span style="color:#B392F0;">&quot;noexec&quot;</span><span style="color:#B392F0;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">				</span><span style="color:#B392F0;">&quot;newinstance&quot;</span><span style="color:#B392F0;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">				</span><span style="color:#B392F0;">&quot;ptmxmode=0666&quot;</span><span style="color:#B392F0;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">				</span><span style="color:#B392F0;">&quot;mode=0620&quot;</span><span style="color:#B392F0;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">				</span><span style="color:#B392F0;">&quot;gid=5&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">			]</span></span>
<span class="line"><span style="color:#E1E4E8;">		},</span></span>
<span class="line"><span style="color:#E1E4E8;">		{</span></span>
<span class="line"><span style="color:#E1E4E8;">			</span><span style="color:#B392F0;">&quot;destination&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;/dev/shm&quot;,</span></span>
<span class="line"><span style="color:#E1E4E8;">			</span><span style="color:#B392F0;">&quot;type&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;tmpfs&quot;,</span></span>
<span class="line"><span style="color:#E1E4E8;">			</span><span style="color:#B392F0;">&quot;source&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;shm&quot;,</span></span>
<span class="line"><span style="color:#E1E4E8;">			</span><span style="color:#B392F0;">&quot;options&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> [</span></span>
<span class="line"><span style="color:#E1E4E8;">				</span><span style="color:#B392F0;">&quot;nosuid&quot;</span><span style="color:#B392F0;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">				</span><span style="color:#B392F0;">&quot;noexec&quot;</span><span style="color:#B392F0;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">				</span><span style="color:#B392F0;">&quot;nodev&quot;</span><span style="color:#B392F0;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">				</span><span style="color:#B392F0;">&quot;mode=1777&quot;</span><span style="color:#B392F0;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">				</span><span style="color:#B392F0;">&quot;size=65536k&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">			]</span></span>
<span class="line"><span style="color:#E1E4E8;">		},</span></span>
<span class="line"><span style="color:#E1E4E8;">		{</span></span>
<span class="line"><span style="color:#E1E4E8;">			</span><span style="color:#B392F0;">&quot;destination&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;/dev/mqueue&quot;,</span></span>
<span class="line"><span style="color:#E1E4E8;">			</span><span style="color:#B392F0;">&quot;type&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;mqueue&quot;,</span></span>
<span class="line"><span style="color:#E1E4E8;">			</span><span style="color:#B392F0;">&quot;source&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;mqueue&quot;,</span></span>
<span class="line"><span style="color:#E1E4E8;">			</span><span style="color:#B392F0;">&quot;options&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> [</span></span>
<span class="line"><span style="color:#E1E4E8;">				</span><span style="color:#B392F0;">&quot;nosuid&quot;</span><span style="color:#B392F0;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">				</span><span style="color:#B392F0;">&quot;noexec&quot;</span><span style="color:#B392F0;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">				</span><span style="color:#B392F0;">&quot;nodev&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">			]</span></span>
<span class="line"><span style="color:#E1E4E8;">		},</span></span>
<span class="line"><span style="color:#E1E4E8;">		{</span></span>
<span class="line"><span style="color:#E1E4E8;">			</span><span style="color:#B392F0;">&quot;destination&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;/sys&quot;,</span></span>
<span class="line"><span style="color:#E1E4E8;">			</span><span style="color:#B392F0;">&quot;type&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;sysfs&quot;,</span></span>
<span class="line"><span style="color:#E1E4E8;">			</span><span style="color:#B392F0;">&quot;source&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;sysfs&quot;,</span></span>
<span class="line"><span style="color:#E1E4E8;">			</span><span style="color:#B392F0;">&quot;options&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> [</span></span>
<span class="line"><span style="color:#E1E4E8;">				</span><span style="color:#B392F0;">&quot;nosuid&quot;</span><span style="color:#B392F0;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">				</span><span style="color:#B392F0;">&quot;noexec&quot;</span><span style="color:#B392F0;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">				</span><span style="color:#B392F0;">&quot;nodev&quot;</span><span style="color:#B392F0;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">				</span><span style="color:#B392F0;">&quot;ro&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">			]</span></span>
<span class="line"><span style="color:#E1E4E8;">		},</span></span>
<span class="line"><span style="color:#E1E4E8;">		{</span></span>
<span class="line"><span style="color:#E1E4E8;">			</span><span style="color:#B392F0;">&quot;destination&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;/sys/fs/cgroup&quot;,</span></span>
<span class="line"><span style="color:#E1E4E8;">			</span><span style="color:#B392F0;">&quot;type&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;cgroup&quot;,</span></span>
<span class="line"><span style="color:#E1E4E8;">			</span><span style="color:#B392F0;">&quot;source&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;cgroup&quot;,</span></span>
<span class="line"><span style="color:#E1E4E8;">			</span><span style="color:#B392F0;">&quot;options&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> [</span></span>
<span class="line"><span style="color:#E1E4E8;">				</span><span style="color:#B392F0;">&quot;nosuid&quot;</span><span style="color:#B392F0;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">				</span><span style="color:#B392F0;">&quot;noexec&quot;</span><span style="color:#B392F0;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">				</span><span style="color:#B392F0;">&quot;nodev&quot;</span><span style="color:#B392F0;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">				</span><span style="color:#B392F0;">&quot;relatime&quot;</span><span style="color:#B392F0;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">				</span><span style="color:#B392F0;">&quot;ro&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">			]</span></span>
<span class="line"><span style="color:#E1E4E8;">		}</span></span>
<span class="line"><span style="color:#E1E4E8;">	],</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#B392F0;">&quot;linux&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">		</span><span style="color:#B392F0;">&quot;resources&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">			</span><span style="color:#B392F0;">&quot;devices&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> [</span></span>
<span class="line"><span style="color:#E1E4E8;">				{</span></span>
<span class="line"><span style="color:#E1E4E8;">					</span><span style="color:#B392F0;">&quot;allow&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">false</span><span style="color:#9ECBFF;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">					</span><span style="color:#B392F0;">&quot;access&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;rwm&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">				}</span></span>
<span class="line"><span style="color:#E1E4E8;">			]</span></span>
<span class="line"><span style="color:#E1E4E8;">		},</span></span>
<span class="line"><span style="color:#E1E4E8;">		</span><span style="color:#B392F0;">&quot;namespaces&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> [</span></span>
<span class="line"><span style="color:#E1E4E8;">			{</span></span>
<span class="line"><span style="color:#E1E4E8;">				</span><span style="color:#B392F0;">&quot;type&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;pid&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">			},</span></span>
<span class="line"><span style="color:#E1E4E8;">			{</span></span>
<span class="line"><span style="color:#E1E4E8;">				</span><span style="color:#B392F0;">&quot;type&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;network&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">			},</span></span>
<span class="line"><span style="color:#E1E4E8;">			{</span></span>
<span class="line"><span style="color:#E1E4E8;">				</span><span style="color:#B392F0;">&quot;type&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;ipc&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">			},</span></span>
<span class="line"><span style="color:#E1E4E8;">			{</span></span>
<span class="line"><span style="color:#E1E4E8;">				</span><span style="color:#B392F0;">&quot;type&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;uts&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">			},</span></span>
<span class="line"><span style="color:#E1E4E8;">			{</span></span>
<span class="line"><span style="color:#E1E4E8;">				</span><span style="color:#B392F0;">&quot;type&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;mount&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">			}</span></span>
<span class="line"><span style="color:#E1E4E8;">		],</span></span>
<span class="line"><span style="color:#E1E4E8;">		</span><span style="color:#B392F0;">&quot;maskedPaths&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> [</span></span>
<span class="line"><span style="color:#E1E4E8;">			</span><span style="color:#B392F0;">&quot;/proc/acpi&quot;</span><span style="color:#B392F0;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">			</span><span style="color:#B392F0;">&quot;/proc/asound&quot;</span><span style="color:#B392F0;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">			</span><span style="color:#B392F0;">&quot;/proc/kcore&quot;</span><span style="color:#B392F0;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">			</span><span style="color:#B392F0;">&quot;/proc/keys&quot;</span><span style="color:#B392F0;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">			</span><span style="color:#B392F0;">&quot;/proc/latency_stats&quot;</span><span style="color:#B392F0;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">			</span><span style="color:#B392F0;">&quot;/proc/timer_list&quot;</span><span style="color:#B392F0;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">			</span><span style="color:#B392F0;">&quot;/proc/timer_stats&quot;</span><span style="color:#B392F0;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">			</span><span style="color:#B392F0;">&quot;/proc/sched_debug&quot;</span><span style="color:#B392F0;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">			</span><span style="color:#B392F0;">&quot;/sys/firmware&quot;</span><span style="color:#B392F0;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">			</span><span style="color:#B392F0;">&quot;/proc/scsi&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">		],</span></span>
<span class="line"><span style="color:#E1E4E8;">		</span><span style="color:#B392F0;">&quot;readonlyPaths&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> [</span></span>
<span class="line"><span style="color:#E1E4E8;">			</span><span style="color:#B392F0;">&quot;/proc/bus&quot;</span><span style="color:#B392F0;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">			</span><span style="color:#B392F0;">&quot;/proc/fs&quot;</span><span style="color:#B392F0;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">			</span><span style="color:#B392F0;">&quot;/proc/irq&quot;</span><span style="color:#B392F0;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">			</span><span style="color:#B392F0;">&quot;/proc/sys&quot;</span><span style="color:#B392F0;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">			</span><span style="color:#B392F0;">&quot;/proc/sysrq-trigger&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">		]</span></span>
<span class="line"><span style="color:#E1E4E8;">	}</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">cat</span><span style="color:#24292E;"> </span><span style="color:#032F62;">config.json</span></span>
<span class="line"><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#6F42C1;">&quot;ociVersion&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;1.0.1-dev&quot;,</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#6F42C1;">&quot;process&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">{</span></span>
<span class="line"><span style="color:#24292E;">		</span><span style="color:#6F42C1;">&quot;terminal&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">true</span><span style="color:#032F62;">,</span></span>
<span class="line"><span style="color:#24292E;">		</span><span style="color:#6F42C1;">&quot;user&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">{</span></span>
<span class="line"><span style="color:#24292E;">			</span><span style="color:#6F42C1;">&quot;uid&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#032F62;">,</span></span>
<span class="line"><span style="color:#24292E;">			</span><span style="color:#6F42C1;">&quot;gid&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#24292E;">		},</span></span>
<span class="line"><span style="color:#24292E;">		</span><span style="color:#6F42C1;">&quot;args&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> [</span></span>
<span class="line"><span style="color:#24292E;">			</span><span style="color:#6F42C1;">&quot;sh&quot;</span></span>
<span class="line"><span style="color:#24292E;">		],</span></span>
<span class="line"><span style="color:#24292E;">		</span><span style="color:#6F42C1;">&quot;env&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> [</span></span>
<span class="line"><span style="color:#24292E;">			</span><span style="color:#6F42C1;">&quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;</span><span style="color:#6F42C1;">,</span></span>
<span class="line"><span style="color:#24292E;">			</span><span style="color:#6F42C1;">&quot;TERM=xterm&quot;</span></span>
<span class="line"><span style="color:#24292E;">		],</span></span>
<span class="line"><span style="color:#24292E;">		</span><span style="color:#6F42C1;">&quot;cwd&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;/&quot;,</span></span>
<span class="line"><span style="color:#24292E;">		</span><span style="color:#6F42C1;">&quot;capabilities&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">{</span></span>
<span class="line"><span style="color:#24292E;">			</span><span style="color:#6F42C1;">&quot;bounding&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> [</span></span>
<span class="line"><span style="color:#24292E;">				</span><span style="color:#6F42C1;">&quot;CAP_AUDIT_WRITE&quot;</span><span style="color:#6F42C1;">,</span></span>
<span class="line"><span style="color:#24292E;">				</span><span style="color:#6F42C1;">&quot;CAP_KILL&quot;</span><span style="color:#6F42C1;">,</span></span>
<span class="line"><span style="color:#24292E;">				</span><span style="color:#6F42C1;">&quot;CAP_NET_BIND_SERVICE&quot;</span></span>
<span class="line"><span style="color:#24292E;">			],</span></span>
<span class="line"><span style="color:#24292E;">			</span><span style="color:#6F42C1;">&quot;effective&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> [</span></span>
<span class="line"><span style="color:#24292E;">				</span><span style="color:#6F42C1;">&quot;CAP_AUDIT_WRITE&quot;</span><span style="color:#6F42C1;">,</span></span>
<span class="line"><span style="color:#24292E;">				</span><span style="color:#6F42C1;">&quot;CAP_KILL&quot;</span><span style="color:#6F42C1;">,</span></span>
<span class="line"><span style="color:#24292E;">				</span><span style="color:#6F42C1;">&quot;CAP_NET_BIND_SERVICE&quot;</span></span>
<span class="line"><span style="color:#24292E;">			],</span></span>
<span class="line"><span style="color:#24292E;">			</span><span style="color:#6F42C1;">&quot;inheritable&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> [</span></span>
<span class="line"><span style="color:#24292E;">				</span><span style="color:#6F42C1;">&quot;CAP_AUDIT_WRITE&quot;</span><span style="color:#6F42C1;">,</span></span>
<span class="line"><span style="color:#24292E;">				</span><span style="color:#6F42C1;">&quot;CAP_KILL&quot;</span><span style="color:#6F42C1;">,</span></span>
<span class="line"><span style="color:#24292E;">				</span><span style="color:#6F42C1;">&quot;CAP_NET_BIND_SERVICE&quot;</span></span>
<span class="line"><span style="color:#24292E;">			],</span></span>
<span class="line"><span style="color:#24292E;">			</span><span style="color:#6F42C1;">&quot;permitted&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> [</span></span>
<span class="line"><span style="color:#24292E;">				</span><span style="color:#6F42C1;">&quot;CAP_AUDIT_WRITE&quot;</span><span style="color:#6F42C1;">,</span></span>
<span class="line"><span style="color:#24292E;">				</span><span style="color:#6F42C1;">&quot;CAP_KILL&quot;</span><span style="color:#6F42C1;">,</span></span>
<span class="line"><span style="color:#24292E;">				</span><span style="color:#6F42C1;">&quot;CAP_NET_BIND_SERVICE&quot;</span></span>
<span class="line"><span style="color:#24292E;">			],</span></span>
<span class="line"><span style="color:#24292E;">			</span><span style="color:#6F42C1;">&quot;ambient&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> [</span></span>
<span class="line"><span style="color:#24292E;">				</span><span style="color:#6F42C1;">&quot;CAP_AUDIT_WRITE&quot;</span><span style="color:#6F42C1;">,</span></span>
<span class="line"><span style="color:#24292E;">				</span><span style="color:#6F42C1;">&quot;CAP_KILL&quot;</span><span style="color:#6F42C1;">,</span></span>
<span class="line"><span style="color:#24292E;">				</span><span style="color:#6F42C1;">&quot;CAP_NET_BIND_SERVICE&quot;</span></span>
<span class="line"><span style="color:#24292E;">			]</span></span>
<span class="line"><span style="color:#24292E;">		},</span></span>
<span class="line"><span style="color:#24292E;">		</span><span style="color:#6F42C1;">&quot;rlimits&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> [</span></span>
<span class="line"><span style="color:#24292E;">			{</span></span>
<span class="line"><span style="color:#24292E;">				</span><span style="color:#6F42C1;">&quot;type&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;RLIMIT_NOFILE&quot;,</span></span>
<span class="line"><span style="color:#24292E;">				</span><span style="color:#6F42C1;">&quot;hard&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1024</span><span style="color:#032F62;">,</span></span>
<span class="line"><span style="color:#24292E;">				</span><span style="color:#6F42C1;">&quot;soft&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1024</span></span>
<span class="line"><span style="color:#24292E;">			}</span></span>
<span class="line"><span style="color:#24292E;">		],</span></span>
<span class="line"><span style="color:#24292E;">		</span><span style="color:#6F42C1;">&quot;noNewPrivileges&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">true</span></span>
<span class="line"><span style="color:#24292E;">	},</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#6F42C1;">&quot;root&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">{</span></span>
<span class="line"><span style="color:#24292E;">		</span><span style="color:#6F42C1;">&quot;path&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;rootfs&quot;,</span></span>
<span class="line"><span style="color:#24292E;">		</span><span style="color:#6F42C1;">&quot;readonly&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">true</span></span>
<span class="line"><span style="color:#24292E;">	},</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#6F42C1;">&quot;hostname&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;runc&quot;,</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#6F42C1;">&quot;mounts&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> [</span></span>
<span class="line"><span style="color:#24292E;">		{</span></span>
<span class="line"><span style="color:#24292E;">			</span><span style="color:#6F42C1;">&quot;destination&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;/proc&quot;,</span></span>
<span class="line"><span style="color:#24292E;">			</span><span style="color:#6F42C1;">&quot;type&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;proc&quot;,</span></span>
<span class="line"><span style="color:#24292E;">			</span><span style="color:#6F42C1;">&quot;source&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;proc&quot;</span></span>
<span class="line"><span style="color:#24292E;">		},</span></span>
<span class="line"><span style="color:#24292E;">		{</span></span>
<span class="line"><span style="color:#24292E;">			</span><span style="color:#6F42C1;">&quot;destination&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;/dev&quot;,</span></span>
<span class="line"><span style="color:#24292E;">			</span><span style="color:#6F42C1;">&quot;type&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;tmpfs&quot;,</span></span>
<span class="line"><span style="color:#24292E;">			</span><span style="color:#6F42C1;">&quot;source&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;tmpfs&quot;,</span></span>
<span class="line"><span style="color:#24292E;">			</span><span style="color:#6F42C1;">&quot;options&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> [</span></span>
<span class="line"><span style="color:#24292E;">				</span><span style="color:#6F42C1;">&quot;nosuid&quot;</span><span style="color:#6F42C1;">,</span></span>
<span class="line"><span style="color:#24292E;">				</span><span style="color:#6F42C1;">&quot;strictatime&quot;</span><span style="color:#6F42C1;">,</span></span>
<span class="line"><span style="color:#24292E;">				</span><span style="color:#6F42C1;">&quot;mode=755&quot;</span><span style="color:#6F42C1;">,</span></span>
<span class="line"><span style="color:#24292E;">				</span><span style="color:#6F42C1;">&quot;size=65536k&quot;</span></span>
<span class="line"><span style="color:#24292E;">			]</span></span>
<span class="line"><span style="color:#24292E;">		},</span></span>
<span class="line"><span style="color:#24292E;">		{</span></span>
<span class="line"><span style="color:#24292E;">			</span><span style="color:#6F42C1;">&quot;destination&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;/dev/pts&quot;,</span></span>
<span class="line"><span style="color:#24292E;">			</span><span style="color:#6F42C1;">&quot;type&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;devpts&quot;,</span></span>
<span class="line"><span style="color:#24292E;">			</span><span style="color:#6F42C1;">&quot;source&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;devpts&quot;,</span></span>
<span class="line"><span style="color:#24292E;">			</span><span style="color:#6F42C1;">&quot;options&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> [</span></span>
<span class="line"><span style="color:#24292E;">				</span><span style="color:#6F42C1;">&quot;nosuid&quot;</span><span style="color:#6F42C1;">,</span></span>
<span class="line"><span style="color:#24292E;">				</span><span style="color:#6F42C1;">&quot;noexec&quot;</span><span style="color:#6F42C1;">,</span></span>
<span class="line"><span style="color:#24292E;">				</span><span style="color:#6F42C1;">&quot;newinstance&quot;</span><span style="color:#6F42C1;">,</span></span>
<span class="line"><span style="color:#24292E;">				</span><span style="color:#6F42C1;">&quot;ptmxmode=0666&quot;</span><span style="color:#6F42C1;">,</span></span>
<span class="line"><span style="color:#24292E;">				</span><span style="color:#6F42C1;">&quot;mode=0620&quot;</span><span style="color:#6F42C1;">,</span></span>
<span class="line"><span style="color:#24292E;">				</span><span style="color:#6F42C1;">&quot;gid=5&quot;</span></span>
<span class="line"><span style="color:#24292E;">			]</span></span>
<span class="line"><span style="color:#24292E;">		},</span></span>
<span class="line"><span style="color:#24292E;">		{</span></span>
<span class="line"><span style="color:#24292E;">			</span><span style="color:#6F42C1;">&quot;destination&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;/dev/shm&quot;,</span></span>
<span class="line"><span style="color:#24292E;">			</span><span style="color:#6F42C1;">&quot;type&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;tmpfs&quot;,</span></span>
<span class="line"><span style="color:#24292E;">			</span><span style="color:#6F42C1;">&quot;source&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;shm&quot;,</span></span>
<span class="line"><span style="color:#24292E;">			</span><span style="color:#6F42C1;">&quot;options&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> [</span></span>
<span class="line"><span style="color:#24292E;">				</span><span style="color:#6F42C1;">&quot;nosuid&quot;</span><span style="color:#6F42C1;">,</span></span>
<span class="line"><span style="color:#24292E;">				</span><span style="color:#6F42C1;">&quot;noexec&quot;</span><span style="color:#6F42C1;">,</span></span>
<span class="line"><span style="color:#24292E;">				</span><span style="color:#6F42C1;">&quot;nodev&quot;</span><span style="color:#6F42C1;">,</span></span>
<span class="line"><span style="color:#24292E;">				</span><span style="color:#6F42C1;">&quot;mode=1777&quot;</span><span style="color:#6F42C1;">,</span></span>
<span class="line"><span style="color:#24292E;">				</span><span style="color:#6F42C1;">&quot;size=65536k&quot;</span></span>
<span class="line"><span style="color:#24292E;">			]</span></span>
<span class="line"><span style="color:#24292E;">		},</span></span>
<span class="line"><span style="color:#24292E;">		{</span></span>
<span class="line"><span style="color:#24292E;">			</span><span style="color:#6F42C1;">&quot;destination&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;/dev/mqueue&quot;,</span></span>
<span class="line"><span style="color:#24292E;">			</span><span style="color:#6F42C1;">&quot;type&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;mqueue&quot;,</span></span>
<span class="line"><span style="color:#24292E;">			</span><span style="color:#6F42C1;">&quot;source&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;mqueue&quot;,</span></span>
<span class="line"><span style="color:#24292E;">			</span><span style="color:#6F42C1;">&quot;options&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> [</span></span>
<span class="line"><span style="color:#24292E;">				</span><span style="color:#6F42C1;">&quot;nosuid&quot;</span><span style="color:#6F42C1;">,</span></span>
<span class="line"><span style="color:#24292E;">				</span><span style="color:#6F42C1;">&quot;noexec&quot;</span><span style="color:#6F42C1;">,</span></span>
<span class="line"><span style="color:#24292E;">				</span><span style="color:#6F42C1;">&quot;nodev&quot;</span></span>
<span class="line"><span style="color:#24292E;">			]</span></span>
<span class="line"><span style="color:#24292E;">		},</span></span>
<span class="line"><span style="color:#24292E;">		{</span></span>
<span class="line"><span style="color:#24292E;">			</span><span style="color:#6F42C1;">&quot;destination&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;/sys&quot;,</span></span>
<span class="line"><span style="color:#24292E;">			</span><span style="color:#6F42C1;">&quot;type&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;sysfs&quot;,</span></span>
<span class="line"><span style="color:#24292E;">			</span><span style="color:#6F42C1;">&quot;source&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;sysfs&quot;,</span></span>
<span class="line"><span style="color:#24292E;">			</span><span style="color:#6F42C1;">&quot;options&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> [</span></span>
<span class="line"><span style="color:#24292E;">				</span><span style="color:#6F42C1;">&quot;nosuid&quot;</span><span style="color:#6F42C1;">,</span></span>
<span class="line"><span style="color:#24292E;">				</span><span style="color:#6F42C1;">&quot;noexec&quot;</span><span style="color:#6F42C1;">,</span></span>
<span class="line"><span style="color:#24292E;">				</span><span style="color:#6F42C1;">&quot;nodev&quot;</span><span style="color:#6F42C1;">,</span></span>
<span class="line"><span style="color:#24292E;">				</span><span style="color:#6F42C1;">&quot;ro&quot;</span></span>
<span class="line"><span style="color:#24292E;">			]</span></span>
<span class="line"><span style="color:#24292E;">		},</span></span>
<span class="line"><span style="color:#24292E;">		{</span></span>
<span class="line"><span style="color:#24292E;">			</span><span style="color:#6F42C1;">&quot;destination&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;/sys/fs/cgroup&quot;,</span></span>
<span class="line"><span style="color:#24292E;">			</span><span style="color:#6F42C1;">&quot;type&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;cgroup&quot;,</span></span>
<span class="line"><span style="color:#24292E;">			</span><span style="color:#6F42C1;">&quot;source&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;cgroup&quot;,</span></span>
<span class="line"><span style="color:#24292E;">			</span><span style="color:#6F42C1;">&quot;options&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> [</span></span>
<span class="line"><span style="color:#24292E;">				</span><span style="color:#6F42C1;">&quot;nosuid&quot;</span><span style="color:#6F42C1;">,</span></span>
<span class="line"><span style="color:#24292E;">				</span><span style="color:#6F42C1;">&quot;noexec&quot;</span><span style="color:#6F42C1;">,</span></span>
<span class="line"><span style="color:#24292E;">				</span><span style="color:#6F42C1;">&quot;nodev&quot;</span><span style="color:#6F42C1;">,</span></span>
<span class="line"><span style="color:#24292E;">				</span><span style="color:#6F42C1;">&quot;relatime&quot;</span><span style="color:#6F42C1;">,</span></span>
<span class="line"><span style="color:#24292E;">				</span><span style="color:#6F42C1;">&quot;ro&quot;</span></span>
<span class="line"><span style="color:#24292E;">			]</span></span>
<span class="line"><span style="color:#24292E;">		}</span></span>
<span class="line"><span style="color:#24292E;">	],</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#6F42C1;">&quot;linux&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">{</span></span>
<span class="line"><span style="color:#24292E;">		</span><span style="color:#6F42C1;">&quot;resources&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">{</span></span>
<span class="line"><span style="color:#24292E;">			</span><span style="color:#6F42C1;">&quot;devices&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> [</span></span>
<span class="line"><span style="color:#24292E;">				{</span></span>
<span class="line"><span style="color:#24292E;">					</span><span style="color:#6F42C1;">&quot;allow&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">false</span><span style="color:#032F62;">,</span></span>
<span class="line"><span style="color:#24292E;">					</span><span style="color:#6F42C1;">&quot;access&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;rwm&quot;</span></span>
<span class="line"><span style="color:#24292E;">				}</span></span>
<span class="line"><span style="color:#24292E;">			]</span></span>
<span class="line"><span style="color:#24292E;">		},</span></span>
<span class="line"><span style="color:#24292E;">		</span><span style="color:#6F42C1;">&quot;namespaces&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> [</span></span>
<span class="line"><span style="color:#24292E;">			{</span></span>
<span class="line"><span style="color:#24292E;">				</span><span style="color:#6F42C1;">&quot;type&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;pid&quot;</span></span>
<span class="line"><span style="color:#24292E;">			},</span></span>
<span class="line"><span style="color:#24292E;">			{</span></span>
<span class="line"><span style="color:#24292E;">				</span><span style="color:#6F42C1;">&quot;type&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;network&quot;</span></span>
<span class="line"><span style="color:#24292E;">			},</span></span>
<span class="line"><span style="color:#24292E;">			{</span></span>
<span class="line"><span style="color:#24292E;">				</span><span style="color:#6F42C1;">&quot;type&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;ipc&quot;</span></span>
<span class="line"><span style="color:#24292E;">			},</span></span>
<span class="line"><span style="color:#24292E;">			{</span></span>
<span class="line"><span style="color:#24292E;">				</span><span style="color:#6F42C1;">&quot;type&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;uts&quot;</span></span>
<span class="line"><span style="color:#24292E;">			},</span></span>
<span class="line"><span style="color:#24292E;">			{</span></span>
<span class="line"><span style="color:#24292E;">				</span><span style="color:#6F42C1;">&quot;type&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;mount&quot;</span></span>
<span class="line"><span style="color:#24292E;">			}</span></span>
<span class="line"><span style="color:#24292E;">		],</span></span>
<span class="line"><span style="color:#24292E;">		</span><span style="color:#6F42C1;">&quot;maskedPaths&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> [</span></span>
<span class="line"><span style="color:#24292E;">			</span><span style="color:#6F42C1;">&quot;/proc/acpi&quot;</span><span style="color:#6F42C1;">,</span></span>
<span class="line"><span style="color:#24292E;">			</span><span style="color:#6F42C1;">&quot;/proc/asound&quot;</span><span style="color:#6F42C1;">,</span></span>
<span class="line"><span style="color:#24292E;">			</span><span style="color:#6F42C1;">&quot;/proc/kcore&quot;</span><span style="color:#6F42C1;">,</span></span>
<span class="line"><span style="color:#24292E;">			</span><span style="color:#6F42C1;">&quot;/proc/keys&quot;</span><span style="color:#6F42C1;">,</span></span>
<span class="line"><span style="color:#24292E;">			</span><span style="color:#6F42C1;">&quot;/proc/latency_stats&quot;</span><span style="color:#6F42C1;">,</span></span>
<span class="line"><span style="color:#24292E;">			</span><span style="color:#6F42C1;">&quot;/proc/timer_list&quot;</span><span style="color:#6F42C1;">,</span></span>
<span class="line"><span style="color:#24292E;">			</span><span style="color:#6F42C1;">&quot;/proc/timer_stats&quot;</span><span style="color:#6F42C1;">,</span></span>
<span class="line"><span style="color:#24292E;">			</span><span style="color:#6F42C1;">&quot;/proc/sched_debug&quot;</span><span style="color:#6F42C1;">,</span></span>
<span class="line"><span style="color:#24292E;">			</span><span style="color:#6F42C1;">&quot;/sys/firmware&quot;</span><span style="color:#6F42C1;">,</span></span>
<span class="line"><span style="color:#24292E;">			</span><span style="color:#6F42C1;">&quot;/proc/scsi&quot;</span></span>
<span class="line"><span style="color:#24292E;">		],</span></span>
<span class="line"><span style="color:#24292E;">		</span><span style="color:#6F42C1;">&quot;readonlyPaths&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> [</span></span>
<span class="line"><span style="color:#24292E;">			</span><span style="color:#6F42C1;">&quot;/proc/bus&quot;</span><span style="color:#6F42C1;">,</span></span>
<span class="line"><span style="color:#24292E;">			</span><span style="color:#6F42C1;">&quot;/proc/fs&quot;</span><span style="color:#6F42C1;">,</span></span>
<span class="line"><span style="color:#24292E;">			</span><span style="color:#6F42C1;">&quot;/proc/irq&quot;</span><span style="color:#6F42C1;">,</span></span>
<span class="line"><span style="color:#24292E;">			</span><span style="color:#6F42C1;">&quot;/proc/sys&quot;</span><span style="color:#6F42C1;">,</span></span>
<span class="line"><span style="color:#24292E;">			</span><span style="color:#6F42C1;">&quot;/proc/sysrq-trigger&quot;</span></span>
<span class="line"><span style="color:#24292E;">		]</span></span>
<span class="line"><span style="color:#24292E;">	}</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><p>config.json 文件定义了 runc 启动容器时的一些配置，如根目录的路径，文件挂载路径等配置。</p><p>第三步，使用 runc 启动容器。我们可以使用 runc run 命令直接启动 busybox 容器。</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">runc</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">run</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">busybox</span></span>
<span class="line"><span style="color:#B392F0;">/</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">#</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">runc</span><span style="color:#24292E;"> </span><span style="color:#032F62;">run</span><span style="color:#24292E;"> </span><span style="color:#032F62;">busybox</span></span>
<span class="line"><span style="color:#6F42C1;">/</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#</span></span></code></pre></div><p>此时，我们已经创建并启动了一个 busybox 容器。</p><p>我们新打开一个命令行窗口，可以使用 run list 命令看到刚才启动的容器。</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">cd</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/home/centos/runc/</span></span>
<span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">runc</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">list</span></span>
<span class="line"><span style="color:#B392F0;">D</span><span style="color:#E1E4E8;">          </span><span style="color:#9ECBFF;">PID</span><span style="color:#E1E4E8;">         </span><span style="color:#9ECBFF;">STATUS</span><span style="color:#E1E4E8;">      </span><span style="color:#9ECBFF;">BUNDLE</span><span style="color:#E1E4E8;">              </span><span style="color:#9ECBFF;">CREATED</span><span style="color:#E1E4E8;">                          </span><span style="color:#9ECBFF;">OWNER</span></span>
<span class="line"><span style="color:#B392F0;">busybox</span><span style="color:#E1E4E8;">     </span><span style="color:#79B8FF;">9778</span><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">running</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">/home/centos/runc</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">2020</span><span style="color:#9ECBFF;">-09-06T09:25:32.441957273Z</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">root</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">cd</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/home/centos/runc/</span></span>
<span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">runc</span><span style="color:#24292E;"> </span><span style="color:#032F62;">list</span></span>
<span class="line"><span style="color:#6F42C1;">D</span><span style="color:#24292E;">          </span><span style="color:#032F62;">PID</span><span style="color:#24292E;">         </span><span style="color:#032F62;">STATUS</span><span style="color:#24292E;">      </span><span style="color:#032F62;">BUNDLE</span><span style="color:#24292E;">              </span><span style="color:#032F62;">CREATED</span><span style="color:#24292E;">                          </span><span style="color:#032F62;">OWNER</span></span>
<span class="line"><span style="color:#6F42C1;">busybox</span><span style="color:#24292E;">     </span><span style="color:#005CC5;">9778</span><span style="color:#24292E;">        </span><span style="color:#032F62;">running</span><span style="color:#24292E;">     </span><span style="color:#032F62;">/home/centos/runc</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">2020</span><span style="color:#032F62;">-09-06T09:25:32.441957273Z</span><span style="color:#24292E;">   </span><span style="color:#032F62;">root</span></span></code></pre></div><p>通过上面的输出，我们可以看到，当前已经有一个 busybox 容器处于运行状态。</p><p>总体来说，Docker 的组件虽然很多，但每个组件都有自己清晰的工作职责，Docker 相关的组件负责发送和接受 Docker 请求，contianerd 相关的组件负责管理容器的生命周期，而 runc 负责真正意义上创建和启动容器。这些组件相互配合，才使得 Docker 顺利完成了容器的管理工作。</p><h3 id="总结" tabindex="-1">总结 <a class="header-anchor" href="#总结" aria-label="Permalink to &quot;总结&quot;">​</a></h3><p>到此，相信你已经完全掌握了 Docker 的组件构成，各个组件的作用和工作原理。本节课时的重点我帮你总结如下。</p>`,75),u=s("p",null,"那么，你知道 Docker 当前的架构有什么弊端吗？思考后，把你的想法写在留言区。",-1);function B(q,d,h,g,k,D){const a=l("Image");return t(),e("div",null,[y,E,F,i,p(a,{alt:"image.png",src:"https://s0.lgstatic.com/i/image/M00/56/40/CgqCHl9rFtSAPGOeAADIK4E6wrc522.png"}),n(),C,p(a,{alt:"7.png",src:"https://s0.lgstatic.com/i/image/M00/59/E6/Ciqc1F9y4vGAVzmAAADk1nlHpUA424.png"}),u])}const m=o(r,[["render",B]]);export{b as __pageData,m as default};
