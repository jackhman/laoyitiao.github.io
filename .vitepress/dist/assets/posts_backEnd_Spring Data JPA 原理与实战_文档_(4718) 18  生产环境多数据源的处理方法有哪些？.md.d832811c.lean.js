import{_ as o,j as e,o as t,g as r,k as n,h as l,s,Q as p}from"./chunks/framework.b3d8e22e.js";const j=JSON.parse('{"title":"第一种方式：多个数据源的 @Configuration 的配置方法 ","description":"","frontmatter":{},"headers":[],"relativePath":"posts/backEnd/Spring Data JPA 原理与实战_文档/(4718) 18  生产环境多数据源的处理方法有哪些？.md","filePath":"posts/backEnd/Spring Data JPA 原理与实战_文档/(4718) 18  生产环境多数据源的处理方法有哪些？.md","lastUpdated":1696417798000}'),c={name:"posts/backEnd/Spring Data JPA 原理与实战_文档/(4718) 18  生产环境多数据源的处理方法有哪些？.md"},y=s("p",null,"上一讲我们介绍了 DataSource 的相关内容，今天我们来介绍一下多数据源的处理方法有哪些。",-1),E=s("p",null,"工作中我们时常会遇到跨数据库操作的情况，这时候就需要配置多数据源，那么如何配置呢？常用的方式及其背后的原理支撑是什么呢？我们下面来了解一下。",-1),i=s("p",null,"首先看看两种常见的配置方式，分别为通过多个 @Configuration 文件、利用 AbstractRoutingDataSource 配置多数据源。",-1),u=s("h3",{id:"第一种方式-多个数据源的-configuration-的配置方法",tabindex:"-1"},[l("第一种方式：多个数据源的 @Configuration 的配置方法 "),s("a",{class:"header-anchor",href:"#第一种方式-多个数据源的-configuration-的配置方法","aria-label":'Permalink to "第一种方式：多个数据源的 @Configuration 的配置方法"'},"​")],-1),F=s("p",null,"这种方式的主要思路是，不同 Package 下面的实体和 Repository 采用不同的 Datasource。所以我们改造一下我们的 example 目录结构，来看看不同 Repositories 的数据源是怎么处理的。",-1),D=s("p",null,[s("strong",null,"第一步：规划 Entity 和 Repository 的目录结构，为了方便配置多数据源。")],-1),d=s("p",null,"将 User 和 UserAddress、UserRepository 和 UserAddressRepository 移动到 db1 里面；将 UserInfo 和 UserInfoRepository 移动到 db2 里面。如下图所示：",-1),g=p("",14),A=s("p",null,"可以看到启动的是两个数据源，其对应的连接池的监控也是不一样的：数据源 1 有 8 个，数据源 2 有 6 个。",-1),b=s("p",null,"如果我们分别请求 Controller 写的两个方法的时候，也会分别插入到不同的数据源里面去。",-1),C=s("p",null,"通过上面的六个步骤你应该知道了如何配置多数据源，那么它的原理基础是什么呢？我们看一下",-1),S=s("p",null,"Datasource 与 TransactionManager、EntityManagerFactory 的关系和职责分别是怎么样的。",-1),B=s("h4",{id:"datasource-与-transactionmanager、entitymanagerfactory-的关系分析",tabindex:"-1"},[l("Datasource 与 TransactionManager、EntityManagerFactory 的关系分析 "),s("a",{class:"header-anchor",href:"#datasource-与-transactionmanager、entitymanagerfactory-的关系分析","aria-label":'Permalink to "Datasource 与 TransactionManager、EntityManagerFactory 的关系分析"'},"​")],-1),m=s("p",null,"我们通过一个类的关系图来分析一下：",-1),M=p("",5),q=s("p",null,"接着打开 JpaBaseConfiguration 就可以看到多数据源的参考原型，如下图所示：",-1),h=p("",26),f=p("",9);function v(k,P,R,_,T,x){const a=e("Image");return t(),r("div",null,[y,E,i,u,F,D,d,n(a,{alt:"Drawing 0.png",src:"https://s0.lgstatic.com/i/image/M00/6C/C0/Ciqc1F-rk6mAO4voAAEl2cIHNqg269.png"}),g,n(a,{alt:"Drawing 1.png",src:"https://s0.lgstatic.com/i/image/M00/6C/CC/CgqCHl-rk8WAV0LYAAIUPl37DVs337.png"}),l(),n(a,{alt:"Drawing 2.png",src:"https://s0.lgstatic.com/i/image/M00/6C/CC/CgqCHl-rk8qAZkCgAAHBFDKIWG0269.png"}),A,n(a,{alt:"Drawing 3.png",src:"https://s0.lgstatic.com/i/image/M00/6C/CC/CgqCHl-rk8-AK9nMAABPduIgKR4098.png"}),b,C,S,B,m,n(a,{alt:"Drawing 4.png",src:"https://s0.lgstatic.com/i/image/M00/6C/CC/CgqCHl-rk9aAfRipAAB6oNvBMnM239.png"}),M,n(a,{alt:"Drawing 5.png",src:"https://s0.lgstatic.com/i/image/M00/6C/C1/Ciqc1F-rk-GAXBLMAABJWH1P9Qs574.png"}),q,n(a,{alt:"Drawing 6.png",src:"https://s0.lgstatic.com/i/image/M00/6C/C1/Ciqc1F-rk-iAMO5TAAIqJTa-4bI250.png"}),h,n(a,{alt:"Drawing 7.png",src:"https://s0.lgstatic.com/i/image/M00/6C/CC/CgqCHl-rlAGARlxqAAVdbojSwxw751.png"}),f])}const H=o(c,[["render",v]]);export{j as __pageData,H as default};
