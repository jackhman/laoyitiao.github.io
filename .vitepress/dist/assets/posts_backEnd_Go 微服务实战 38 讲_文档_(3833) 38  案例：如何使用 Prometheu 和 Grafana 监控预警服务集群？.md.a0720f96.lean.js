import{_ as l,j as e,o as t,g as r,k as o,h as a,Q as p,s}from"./chunks/framework.4e7d56ce.js";const W=JSON.parse('{"title":"部署和配置 Prometheus ","description":"","frontmatter":{},"headers":[],"relativePath":"posts/backEnd/Go 微服务实战 38 讲_文档/(3833) 38  案例：如何使用 Prometheu 和 Grafana 监控预警服务集群？.md","filePath":"posts/backEnd/Go 微服务实战 38 讲_文档/(3833) 38  案例：如何使用 Prometheu 和 Grafana 监控预警服务集群？.md","lastUpdated":1696417798000}'),c={name:"posts/backEnd/Go 微服务实战 38 讲_文档/(3833) 38  案例：如何使用 Prometheu 和 Grafana 监控预警服务集群？.md"},E=p("",6),i=p("",13),y=p("",6),h=p("",10),_=s("p",null,"Grafana 数据源配置页面",-1),g=s("p",null,"最后，我们来建立 Go 程序数据的可视化看板，从界面左侧的加号点击，可以从 0 开始新建可视化看板，也可以导入其他人开源的可视化看板。",-1),u=s("p",null,'新建看板时，只要在 Metrics 中输入自己想要监控的数据名称即可，比如我们想要监控 Go 程序中协程的数量，则输入 go_goroutines，然后上方图标就会显示出对应的数据，一个是 Prometheus 平台自身的协程数据，另外一个则是 Go 程序的协程数据。如果只想看 Go 程序的，则可以输入 go_goroutines{job="go"}，即可限定只显示 Go 程序的数据。',-1),m=s("p",null,"Grafana 看板配置页面",-1),d=s("p",null,"新建看板虽然入门简单，但是想要建立起完备真实可用的看板也是要花费一定时间的，所以我们往往都是直接导入其他人开源的看板配置。那怎么导入呢？",-1),A=s("p",null,[a("首先，我们在"),s("a",{href:"https://grafana.com/grafana/dashboards",target:"_blank",rel:"noreferrer"},"https://grafana.com/grafana/dashboards"),a("上搜索 Go 相关的看板配置，然后检查这个看板配置是否和我们所收集数据的 Exporter 相互吻合，确定之后，复制该看板详情页面的网络 URL。")],-1),D=s("p",null,"Grafana 网站页面",-1),f=s("p",null,"将 URL 贴到 Grafana 的导入页面上，点击加载，就会加入一些看板名称、数据来源等配置，点击保存，我们就直接获得了 Go 程序的监控数据可视化看板界面。",-1),F=s("p",null,"Grafana 看板导入界面",-1),G=s("p",null,"从可视化看板中，我们可以清晰地看到 Go 程序相关的性能指标曲线图，比如 process memory、 go memstats、Goroutines 和 GC duration 等。",-1),P=s("p",null,"Grafana 看板详情界面",-1),b=s("p",null,"基于这些性能指标曲线图，我们就可以清楚地了解 Go 程序在过去的某一时刻某些指标是否异常，从而给线上 Go 程序异常分析工作提供巨大的帮助。",-1),C=s("p",null,"除了协助异常诊断，Grafana 还可以根据性能指标进行报警，比如当 process memory 超过一定数值时，通过钉钉或者邮件向开发者发出报警信息，有助于开发者提前感知线上程序的异常状态，从而尽快处理，以减少线上程序异常情况发生的频率。",-1),v=s("h4",{id:"配置报警规则和通道",tabindex:"-1"},[a("配置报警规则和通道 "),s("a",{class:"header-anchor",href:"#配置报警规则和通道","aria-label":'Permalink to "配置报警规则和通道"'},"​")],-1),k=s("p",null,"接下来，我们就来基于 Grafana 配置对于 Go 程序的性能数据异常的报警渠道。",-1),T=s("p",null,"首先，我们编辑想要报警指标的看板，切换到 Alert 一栏，在 Conditions 下面我们可以进行均值相关的配置，如下图所示，我们就做了这样的配置：如果 Go 程序线程数量在一分钟内的均值超过 8 则报警，对应的上方图标就有一条红线，表示警戒线。",-1),q=s("p",null,"Grafana 报警规则配置界面",-1),S=s("p",null,'接着，我们需要配置报警渠道，可以选择钉钉或者邮件渠道。我们在需要发送报警消息的群中首先添加一个自定义机器人，安全设置就勾选"自定义关键词"选项，关键词就选择"报警"二字。',-1),B=s("p",null,"钉钉机器人配置界面",-1),x=s("p",null,"添加后，我们可以获得该机器人的 Webhook 地址，然后进入 Grafana 的报警渠道配置页面：新建 DingDing 类型的报警渠道，将 Webhook 地址填入 Url 一栏，点击 Test 没问题后再点击 Save 进行保存。",-1),M=s("p",null,"Grafana 报警通道配置界面",-1),I=s("p",null,'然后在配置报警规则时，报警渠道选择"钉钉报警渠道"，文本消息中必须包含"报警"二字，否则不能通过钉钉机器人的安全配置校验，从而导致无法发送报警信息，具体配置如下图所示：',-1),w=s("p",null,"Grafana 报警规则配置页面",-1),R=s("p",null,"综上，Grafana 每隔 1 分钟对 Go 服务的协程数量进行判断，如果其数值持续超过 8 到达 5 分钟，则通过钉钉发送报警消息。",-1),j=s("h4",{id:"小结",tabindex:"-1"},[a("小结 "),s("a",{class:"header-anchor",href:"#小结","aria-label":'Permalink to "小结"'},"​")],-1),V=s("p",null,"本课时主要讲解了如何使用 Prometheus 和 Grafana 建立 Go 程序性能数据监控和报警平台。根据系统的需要，对业务服务、中间件或者数据库的数据基表进行收集和展示，方便开发人员查看和了解整体系统的动态和数据指标，协助排查线上异常问题和提前发现异常状态。",-1),H=s("p",null,"除了 Prometheus 和 Grafana，你还对什么其他的监控平台有所了解？欢你迎积极在下方留言，我们一起交流。",-1);function L(N,U,K,Y,X,Q){const n=e("Image");return t(),r("div",null,[E,o(n,{alt:"Drawing 1.png",src:"https://s0.lgstatic.com/i/image/M00/68/E8/CgqCHl-lBcSAT3LdAAMKsps4g0A385.png"}),a(),i,o(n,{alt:"Drawing 3.png",src:"https://s0.lgstatic.com/i/image/M00/68/DC/Ciqc1F-lBdOAGf0fAAO2GhMXnPI434.png"}),a(),y,o(n,{alt:"Drawing 5.png",src:"https://s0.lgstatic.com/i/image/M00/68/DC/Ciqc1F-lBemAV7huAASa6GYhyx8056.png"}),a(),h,o(n,{alt:"Drawing 7.png",src:"https://s0.lgstatic.com/i/image/M00/68/E8/CgqCHl-lBfuAV4UxAAJAa595YgI567.png"}),a(),_,g,u,o(n,{alt:"Drawing 9.png",src:"https://s0.lgstatic.com/i/image/M00/68/DD/Ciqc1F-lBgyAPP-DAAMkHLk4ibY306.png"}),a(),m,d,A,o(n,{alt:"Drawing 5.png",src:"https://s0.lgstatic.com/i/image/M00/67/D6/CgqCHl-iWsCADYe0AAz3hA18tsc589.png"}),a(),D,f,o(n,{alt:"Drawing 12.png",src:"https://s0.lgstatic.com/i/image/M00/68/E8/CgqCHl-lBjGAScg7AANRWsSQuNI689.png"}),a(),F,G,o(n,{alt:"Drawing 14.png",src:"https://s0.lgstatic.com/i/image/M00/68/DD/Ciqc1F-lBjyAY-kcAARXdD9UNp0756.png"}),a(),P,b,C,v,k,T,o(n,{alt:"Drawing 16.png",src:"https://s0.lgstatic.com/i/image/M00/68/DD/Ciqc1F-lBkuAMUKgAAKPmQSuBFc967.png"}),a(),q,S,o(n,{alt:"Drawing 18.png",src:"https://s0.lgstatic.com/i/image/M00/68/E8/CgqCHl-lBliAe0zFAAFUeXbC5RE342.png"}),a(),B,x,o(n,{alt:"Drawing 20.png",src:"https://s0.lgstatic.com/i/image/M00/68/E8/CgqCHl-lBmmAK15XAAKG9lUP1nY683.png"}),a(),M,I,o(n,{alt:"Drawing 22.png",src:"https://s0.lgstatic.com/i/image/M00/68/DD/Ciqc1F-lBnKAXfRbAAI4pLYImMY057.png"}),a(),w,R,j,V,H])}const $=l(c,[["render",L]]);export{W as __pageData,$ as default};
