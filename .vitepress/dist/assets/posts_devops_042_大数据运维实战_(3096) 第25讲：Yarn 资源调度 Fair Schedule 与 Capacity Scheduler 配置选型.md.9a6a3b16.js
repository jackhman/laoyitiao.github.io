import{_ as s,o as a,g as n,Q as l}from"./chunks/framework.f949202b.js";const g=JSON.parse('{"title":"Yarn 多用户资源管理策略 ","description":"","frontmatter":{},"headers":[],"relativePath":"posts/devops/042_大数据运维实战/(3096) 第25讲：Yarn 资源调度 Fair Schedule 与 Capacity Scheduler 配置选型.md","filePath":"posts/devops/042_大数据运维实战/(3096) 第25讲：Yarn 资源调度 Fair Schedule 与 Capacity Scheduler 配置选型.md","lastUpdated":null}'),p={name:"posts/devops/042_大数据运维实战/(3096) 第25讲：Yarn 资源调度 Fair Schedule 与 Capacity Scheduler 配置选型.md"},e=l(`<p>在大数据平台运维中，会经常遇到<strong>集群资源争抢的问题</strong>。因为在公司内部，Hadoop Yarn 集群一般会被多个业务、多个用户同时使用，共享 Yarn 资源。此时，如果不对集群资源做规划和管理的话，那么就会出现 Yarn 的资源被某一个用户提交的 Application（App）占满，而其他用户只能等待；或者也可能会出现集群还有很多剩余资源，但 App 就是无法使用的情况。</p><p>如何解决这个问题呢？此时就需要用到 Hadoop 中提供的<strong>资源调度器。</strong></p><h3 id="yarn-多用户资源管理策略" tabindex="-1">Yarn 多用户资源管理策略 <a class="header-anchor" href="#yarn-多用户资源管理策略" aria-label="Permalink to &quot;Yarn 多用户资源管理策略&quot;">​</a></h3><p>Yarn 提供了可插拔的资源调度算法，用于解决 App 之间资源竞争的问题。在 Yarn 中有三种资源调度器可供选择，即 FIFO Scheduler、Capacity Scheduler、Fair Scheduler，目前使用比较多的是 Fair Scheduler 和 Capacity Scheduler。下面对这三种资源调度器分别进行介绍。</p><h4 id="_1-fifo-scheduler" tabindex="-1">1. FIFO Scheduler <a class="header-anchor" href="#_1-fifo-scheduler" aria-label="Permalink to &quot;1. FIFO Scheduler&quot;">​</a></h4><p>在 Hadoop 1.x 系列版本中，默认使用的调度器是 FIFO，它采用队列方式将每个任务按照时间先后顺序进行服务。比如排在最前面的任务需要若干 Map Task 和 Reduce Task，当发现有空闲的服务器节点时就分配给这个任务，直到任务执行完毕。</p><h4 id="_2-capacity-scheduler" tabindex="-1">2. Capacity Scheduler <a class="header-anchor" href="#_2-capacity-scheduler" aria-label="Permalink to &quot;2. Capacity Scheduler&quot;">​</a></h4><p>在 Hadoop 2.x/3.x 系列版本中，默认使用的调度器是 Capacity Scheduler（容量调度器），这是一种<strong>多用户、多队列</strong> 的资源调度器。<strong>每个队列</strong>可以配置资源量，可限制每个用户、每个队列的并发运行作业量，也可限制每个作业使用的内存量；每个用户的作业有优先级，在单个队列中，作业按照先来先服务（实际上是先按照优先级，优先级相同的再按照作业提交时间）的原则进行调度。</p><p>容量资源调度器，支持多队列，<strong>但默认情况下只有 root.default 这一个队列</strong>。</p><p>当不同用户提交任务时，任务都会在这个队列里按照<strong>先进先出</strong>策略执行调度，很明显，单个队列会大大降低多用户的资源使用率。</p><p>因此，要使用容量资源调度，一定要配置多个队列，每个队列可配置一定比率的资源量（CPU、内存）；同时为了防止同一个用户的任务独占队列的所有资源，调度器会对同一个用户提交的任务所占资源量进行限定。</p><p>举个简单的例子，下图是容量调度器中配置好的一个队列树：</p><p><img src="https://s0.lgstatic.com/i/image/M00/35/54/Ciqc1F8VSH2APIBaAAAlubO9K7M490.png" alt="Drawing 0.png"></p><p>上图通过队列树方式对 Yarn 集群资源做了一个划分，可以看到，在 root 队列下面定义了两个子队列 dev 和 test，分别占 30% 和 70% 的 Yarn 集群资源；而 dev 队列又被分成了 dev1 和 dev2 两个子队列，分别占用 dev 队列 30% 中的 40% 和 60% 的 Yarn 集群资源。</p><p>容量调度除了可以配置队列及其容量外，还可以配置一个用户或任务可以分配的最大资源数量、同时可以配置运行应用的数量、队列的 ACL 认证等。</p><p><strong>如何让任务运行在指定的队列呢？</strong> 有两种方式，一种是直接指定队列名，另一种是通过用户名、用户组和队列名进行对应。注意：对于容量调度器，我们的队列名必须是队列树中的最后一部分，如果使用队列树则不会被识别。例如，在上面配置中，可直接使用 dev1 和 dev2 作为队列名，但如果用 root.dev.dev1 或者 dev.dev2 则都是无效的。</p><h4 id="_3-fair-scheduler" tabindex="-1">3. Fair Scheduler <a class="header-anchor" href="#_3-fair-scheduler" aria-label="Permalink to &quot;3. Fair Scheduler&quot;">​</a></h4><p>Fair Scheduler（公平调度器）支持<strong>多用户、多分组</strong>管理，每个分组可以配置资源量，也可限制每个用户和每个分组中并发运行的作业数量；每个用户的作业有优先级，优先级越高分配的资源就越多。公平调度器的主要目标是实现 Yarn 上运行的任务能公平的分配到资源。</p><p>Fair Scheduler 将整个 Yarn 的可用资源划分成多个队列资源池，每个队列中可以配置最小和最大的可用资源（内存和 CPU）、最大可同时运行 Application 数量、权重，以及可以提交和管理 Application 的用户等。</p><p>资源池以及用户的对应关系如下图所示：</p><p><img src="https://s0.lgstatic.com/i/image/M00/35/5F/CgqCHl8VSJmAU1DfAADOTE-gHkM880.png" alt="1.png"></p><p>在上图中，假设整个 Yarn 集群可用的 CPU 资源为 100vCPU，可用的内存资源为 100GB。现在为三个业务线各自划分一个队列，分别是 Queue1、Queue2 和 Queue3，每个队列可用的资源均为 20vCPU 和 20GB 内存，最后还规划了一个 default 队列，用于运行其他用户和业务提交的任务。可用资源为 40vCPU 和 40GB 内存，这样，四个队列将整个 Yarn 集群资源刚好分配完毕。</p><p>在执行任务的时候，可以显性地指定任务运行的队列，但更多情况下不指定队列，而是通过用户名作为队列名称来提交任务，即用户 user1 提交的任务被分配到队列 Queue1 中，用户 user2 提交的任务被分配到资源池 Queue2 中。注意，这里的 user1 和 user2 是配置的固定用户，除了这些用户外，其他未指定的用户提交的任务将会被分配到 default 队列中。这里的用户名，就是提交 App 所使用的 Linux/Unix 的系统用户名。</p><p>除了可以通过用户名作为队列名，在用户比较多的时候，还可以使用用户组，将同一类用户放到一个用户组下，然后将这个用户组配置到资源调度策略中。</p><p>接下来，向你介绍 Fair Scheduler 调度的配置。</p><h3 id="fair-scheduler-调度的配置" tabindex="-1">Fair Scheduler 调度的配置 <a class="header-anchor" href="#fair-scheduler-调度的配置" aria-label="Permalink to &quot;Fair Scheduler 调度的配置&quot;">​</a></h3><p>要启用公平调度器，首先需要配置 yarn-site.xml 文件，添加如下设置：</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">&lt;</span><span style="color:#85E89D;">property</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">  &lt;</span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">&gt;yarn.resourcemanager.scheduler.class&lt;/</span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">  &lt;</span><span style="color:#85E89D;">value</span><span style="color:#E1E4E8;">&gt;org.apache.hadoop.yarn.server.resourcemanager.scheduler.fair.FairScheduler&lt;/</span><span style="color:#85E89D;">value</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;/</span><span style="color:#85E89D;">property</span><span style="color:#E1E4E8;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">&lt;</span><span style="color:#22863A;">property</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">  &lt;</span><span style="color:#22863A;">name</span><span style="color:#24292E;">&gt;yarn.resourcemanager.scheduler.class&lt;/</span><span style="color:#22863A;">name</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">  &lt;</span><span style="color:#22863A;">value</span><span style="color:#24292E;">&gt;org.apache.hadoop.yarn.server.resourcemanager.scheduler.fair.FairScheduler&lt;/</span><span style="color:#22863A;">value</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">&lt;/</span><span style="color:#22863A;">property</span><span style="color:#24292E;">&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>公平调度器的配置文件路径位于 HADOOP_CONF_DIR下 的 fair-scheduler.xml 文件中，这个路径可以通过配置 yarn-site.xml 文件，添加如下内容来实现：</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">    &lt;</span><span style="color:#85E89D;">property</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">      &lt;</span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">&gt;yarn.scheduler.fair.allocation.file&lt;/</span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">      &lt;</span><span style="color:#85E89D;">value</span><span style="color:#E1E4E8;">&gt;/etc/hadoop/conf/fair-scheduler.xml&lt;/</span><span style="color:#85E89D;">value</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;/</span><span style="color:#85E89D;">property</span><span style="color:#E1E4E8;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">    &lt;</span><span style="color:#22863A;">property</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">      &lt;</span><span style="color:#22863A;">name</span><span style="color:#24292E;">&gt;yarn.scheduler.fair.allocation.file&lt;/</span><span style="color:#22863A;">name</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">      &lt;</span><span style="color:#22863A;">value</span><span style="color:#24292E;">&gt;/etc/hadoop/conf/fair-scheduler.xml&lt;/</span><span style="color:#22863A;">value</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    &lt;/</span><span style="color:#22863A;">property</span><span style="color:#24292E;">&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>若没有这个配置文件，调度器会在用户提交第一个应用时为其自动创建一个队列，队列的名字就是用户名，所有的任务都会被分配到 default 队列中。</p><p>接下来重点看看 fair-scheduler.xml 文件如何编写，此文件中定义队列的层次是通过嵌套元素实现的。所有的队列都是 root 队列的孩子，下面是一个定义好的公平调度策略：</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">&lt;?</span><span style="color:#E1E4E8;">xml version</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;1.0&quot;</span><span style="color:#F97583;">?&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;</span><span style="color:#85E89D;">allocations</span><span style="color:#E1E4E8;">&gt;  </span></span>
<span class="line"><span style="color:#E1E4E8;">        &lt;!-- users max running apps --&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">        &lt;</span><span style="color:#79B8FF;">userMaxAppsDefault</span><span style="color:#E1E4E8;">&gt;10&lt;/</span><span style="color:#79B8FF;">userMaxAppsDefault</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;</span><span style="color:#85E89D;">queue</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">name</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;root&quot;</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">        &lt;</span><span style="color:#79B8FF;">aclSubmitApps</span><span style="color:#E1E4E8;">&gt; &lt;/</span><span style="color:#79B8FF;">aclSubmitApps</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">        &lt;</span><span style="color:#79B8FF;">aclAdministerApps</span><span style="color:#E1E4E8;">&gt; &lt;/</span><span style="color:#79B8FF;">aclAdministerApps</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">        &lt;</span><span style="color:#85E89D;">queue</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">name</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;default&quot;</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">                &lt;</span><span style="color:#79B8FF;">minResources</span><span style="color:#E1E4E8;">&gt;12000mb,5vcores&lt;/</span><span style="color:#79B8FF;">minResources</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">                &lt;</span><span style="color:#79B8FF;">maxResources</span><span style="color:#E1E4E8;">&gt;100000mb,50vcores&lt;/</span><span style="color:#79B8FF;">maxResources</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">                &lt;</span><span style="color:#79B8FF;">maxRunningApps</span><span style="color:#E1E4E8;">&gt;22&lt;/</span><span style="color:#79B8FF;">maxRunningApps</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">                &lt;</span><span style="color:#79B8FF;">schedulingMode</span><span style="color:#E1E4E8;">&gt;fair&lt;/</span><span style="color:#79B8FF;">schedulingMode</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">                &lt;</span><span style="color:#85E89D;">weight</span><span style="color:#E1E4E8;">&gt;1&lt;/</span><span style="color:#85E89D;">weight</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">                &lt;</span><span style="color:#79B8FF;">aclSubmitApps</span><span style="color:#E1E4E8;">&gt;*&lt;/</span><span style="color:#79B8FF;">aclSubmitApps</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">        &lt;/</span><span style="color:#85E89D;">queue</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span></span>
<span class="line"><span style="color:#E1E4E8;">        &lt;</span><span style="color:#85E89D;">queue</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">name</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;dev_group&quot;</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">                &lt;</span><span style="color:#79B8FF;">minResources</span><span style="color:#E1E4E8;">&gt;115000mb,50vcores&lt;/</span><span style="color:#79B8FF;">minResources</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">                &lt;</span><span style="color:#79B8FF;">maxResources</span><span style="color:#E1E4E8;">&gt;500000mb,150vcores&lt;/</span><span style="color:#79B8FF;">maxResources</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">                &lt;</span><span style="color:#79B8FF;">maxRunningApps</span><span style="color:#E1E4E8;">&gt;181&lt;/</span><span style="color:#79B8FF;">maxRunningApps</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">                &lt;</span><span style="color:#79B8FF;">schedulingMode</span><span style="color:#E1E4E8;">&gt;fair&lt;/</span><span style="color:#79B8FF;">schedulingMode</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">                &lt;</span><span style="color:#85E89D;">weight</span><span style="color:#E1E4E8;">&gt;5&lt;/</span><span style="color:#85E89D;">weight</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">                &lt;</span><span style="color:#79B8FF;">aclSubmitApps</span><span style="color:#E1E4E8;">&gt; dev_group&lt;/</span><span style="color:#79B8FF;">aclSubmitApps</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">                &lt;</span><span style="color:#79B8FF;">aclAdministerApps</span><span style="color:#E1E4E8;">&gt;hadoop dev_group&lt;/</span><span style="color:#79B8FF;">aclAdministerApps</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">        &lt;/</span><span style="color:#85E89D;">queue</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">                                                                                                         </span></span>
<span class="line"><span style="color:#E1E4E8;">                                          </span></span>
<span class="line"><span style="color:#E1E4E8;">        &lt;</span><span style="color:#85E89D;">queue</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">name</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;test_group&quot;</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">                &lt;</span><span style="color:#79B8FF;">minResources</span><span style="color:#E1E4E8;">&gt;23000mb,10vcores&lt;/</span><span style="color:#79B8FF;">minResources</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">                &lt;</span><span style="color:#79B8FF;">maxResources</span><span style="color:#E1E4E8;">&gt;300000mb,100vcores&lt;/</span><span style="color:#79B8FF;">maxResources</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">                &lt;</span><span style="color:#79B8FF;">maxRunningApps</span><span style="color:#E1E4E8;">&gt;22&lt;/</span><span style="color:#79B8FF;">maxRunningApps</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">                &lt;</span><span style="color:#79B8FF;">schedulingMode</span><span style="color:#E1E4E8;">&gt;fair&lt;/</span><span style="color:#79B8FF;">schedulingMode</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">                &lt;</span><span style="color:#85E89D;">weight</span><span style="color:#E1E4E8;">&gt;4&lt;/</span><span style="color:#85E89D;">weight</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">                &lt;</span><span style="color:#79B8FF;">aclSubmitApps</span><span style="color:#E1E4E8;">&gt; test_group&lt;/</span><span style="color:#79B8FF;">aclSubmitApps</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">                &lt;</span><span style="color:#79B8FF;">aclAdministerApps</span><span style="color:#E1E4E8;">&gt;hadoop test_group&lt;/</span><span style="color:#79B8FF;">aclAdministerApps</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">        &lt;/</span><span style="color:#85E89D;">queue</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">                                                      </span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;/</span><span style="color:#85E89D;">queue</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">  &lt;</span><span style="color:#79B8FF;">queuePlacementPolicy</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">  &lt;</span><span style="color:#85E89D;">rule</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">name</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;user&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">create</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;false&quot;</span><span style="color:#E1E4E8;"> /&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">  &lt;</span><span style="color:#85E89D;">rule</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">name</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;primaryGroup&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">create</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;false&quot;</span><span style="color:#E1E4E8;"> /&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;</span><span style="color:#85E89D;">rule</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">name</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;secondaryGroupExistingQueue&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">create</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;false&quot;</span><span style="color:#E1E4E8;"> /&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">  &lt;</span><span style="color:#85E89D;">rule</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">name</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;default&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">queue</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;default&quot;</span><span style="color:#E1E4E8;"> /&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">  &lt;/</span><span style="color:#79B8FF;">queuePlacementPolicy</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;/</span><span style="color:#85E89D;">allocations</span><span style="color:#E1E4E8;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">&lt;?</span><span style="color:#24292E;">xml version</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;1.0&quot;</span><span style="color:#D73A49;">?&gt;</span></span>
<span class="line"><span style="color:#24292E;">&lt;</span><span style="color:#22863A;">allocations</span><span style="color:#24292E;">&gt;  </span></span>
<span class="line"><span style="color:#24292E;">        &lt;!-- users max running apps --&gt;</span></span>
<span class="line"><span style="color:#24292E;">        &lt;</span><span style="color:#005CC5;">userMaxAppsDefault</span><span style="color:#24292E;">&gt;10&lt;/</span><span style="color:#005CC5;">userMaxAppsDefault</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">&lt;</span><span style="color:#22863A;">queue</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">name</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;root&quot;</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">        &lt;</span><span style="color:#005CC5;">aclSubmitApps</span><span style="color:#24292E;">&gt; &lt;/</span><span style="color:#005CC5;">aclSubmitApps</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">        &lt;</span><span style="color:#005CC5;">aclAdministerApps</span><span style="color:#24292E;">&gt; &lt;/</span><span style="color:#005CC5;">aclAdministerApps</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">        &lt;</span><span style="color:#22863A;">queue</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">name</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;default&quot;</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">                &lt;</span><span style="color:#005CC5;">minResources</span><span style="color:#24292E;">&gt;12000mb,5vcores&lt;/</span><span style="color:#005CC5;">minResources</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">                &lt;</span><span style="color:#005CC5;">maxResources</span><span style="color:#24292E;">&gt;100000mb,50vcores&lt;/</span><span style="color:#005CC5;">maxResources</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">                &lt;</span><span style="color:#005CC5;">maxRunningApps</span><span style="color:#24292E;">&gt;22&lt;/</span><span style="color:#005CC5;">maxRunningApps</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">                &lt;</span><span style="color:#005CC5;">schedulingMode</span><span style="color:#24292E;">&gt;fair&lt;/</span><span style="color:#005CC5;">schedulingMode</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">                &lt;</span><span style="color:#22863A;">weight</span><span style="color:#24292E;">&gt;1&lt;/</span><span style="color:#22863A;">weight</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">                &lt;</span><span style="color:#005CC5;">aclSubmitApps</span><span style="color:#24292E;">&gt;*&lt;/</span><span style="color:#005CC5;">aclSubmitApps</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">        &lt;/</span><span style="color:#22863A;">queue</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">       </span></span>
<span class="line"><span style="color:#24292E;">        &lt;</span><span style="color:#22863A;">queue</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">name</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;dev_group&quot;</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">                &lt;</span><span style="color:#005CC5;">minResources</span><span style="color:#24292E;">&gt;115000mb,50vcores&lt;/</span><span style="color:#005CC5;">minResources</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">                &lt;</span><span style="color:#005CC5;">maxResources</span><span style="color:#24292E;">&gt;500000mb,150vcores&lt;/</span><span style="color:#005CC5;">maxResources</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">                &lt;</span><span style="color:#005CC5;">maxRunningApps</span><span style="color:#24292E;">&gt;181&lt;/</span><span style="color:#005CC5;">maxRunningApps</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">                &lt;</span><span style="color:#005CC5;">schedulingMode</span><span style="color:#24292E;">&gt;fair&lt;/</span><span style="color:#005CC5;">schedulingMode</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">                &lt;</span><span style="color:#22863A;">weight</span><span style="color:#24292E;">&gt;5&lt;/</span><span style="color:#22863A;">weight</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">                &lt;</span><span style="color:#005CC5;">aclSubmitApps</span><span style="color:#24292E;">&gt; dev_group&lt;/</span><span style="color:#005CC5;">aclSubmitApps</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">                &lt;</span><span style="color:#005CC5;">aclAdministerApps</span><span style="color:#24292E;">&gt;hadoop dev_group&lt;/</span><span style="color:#005CC5;">aclAdministerApps</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">        &lt;/</span><span style="color:#22863A;">queue</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">                                                                                                         </span></span>
<span class="line"><span style="color:#24292E;">                                          </span></span>
<span class="line"><span style="color:#24292E;">        &lt;</span><span style="color:#22863A;">queue</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">name</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;test_group&quot;</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">                &lt;</span><span style="color:#005CC5;">minResources</span><span style="color:#24292E;">&gt;23000mb,10vcores&lt;/</span><span style="color:#005CC5;">minResources</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">                &lt;</span><span style="color:#005CC5;">maxResources</span><span style="color:#24292E;">&gt;300000mb,100vcores&lt;/</span><span style="color:#005CC5;">maxResources</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">                &lt;</span><span style="color:#005CC5;">maxRunningApps</span><span style="color:#24292E;">&gt;22&lt;/</span><span style="color:#005CC5;">maxRunningApps</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">                &lt;</span><span style="color:#005CC5;">schedulingMode</span><span style="color:#24292E;">&gt;fair&lt;/</span><span style="color:#005CC5;">schedulingMode</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">                &lt;</span><span style="color:#22863A;">weight</span><span style="color:#24292E;">&gt;4&lt;/</span><span style="color:#22863A;">weight</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">                &lt;</span><span style="color:#005CC5;">aclSubmitApps</span><span style="color:#24292E;">&gt; test_group&lt;/</span><span style="color:#005CC5;">aclSubmitApps</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">                &lt;</span><span style="color:#005CC5;">aclAdministerApps</span><span style="color:#24292E;">&gt;hadoop test_group&lt;/</span><span style="color:#005CC5;">aclAdministerApps</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">        &lt;/</span><span style="color:#22863A;">queue</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">                                                      </span></span>
<span class="line"><span style="color:#24292E;">&lt;/</span><span style="color:#22863A;">queue</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">  &lt;</span><span style="color:#005CC5;">queuePlacementPolicy</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">  &lt;</span><span style="color:#22863A;">rule</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">name</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;user&quot;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">create</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;false&quot;</span><span style="color:#24292E;"> /&gt;</span></span>
<span class="line"><span style="color:#24292E;">  &lt;</span><span style="color:#22863A;">rule</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">name</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;primaryGroup&quot;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">create</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;false&quot;</span><span style="color:#24292E;"> /&gt;</span></span>
<span class="line"><span style="color:#24292E;">&lt;</span><span style="color:#22863A;">rule</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">name</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;secondaryGroupExistingQueue&quot;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">create</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;false&quot;</span><span style="color:#24292E;"> /&gt;</span></span>
<span class="line"><span style="color:#24292E;">  &lt;</span><span style="color:#22863A;">rule</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">name</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;default&quot;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">queue</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;default&quot;</span><span style="color:#24292E;"> /&gt;</span></span>
<span class="line"><span style="color:#24292E;">  &lt;/</span><span style="color:#005CC5;">queuePlacementPolicy</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">&lt;/</span><span style="color:#22863A;">allocations</span><span style="color:#24292E;">&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div><p>下面介绍这个配置中的几个配置项的含义：</p><table><thead><tr><th><strong>配置项</strong></th><th><strong>含义</strong></th></tr></thead><tbody><tr><td>userMaxAppsDefault</td><td>默认的用户最多可同时运行多少个应用程序</td></tr><tr><td>minResources</td><td>设置最少资源保证量，设置格式为&quot;X mb, Y vcores&quot;，当一个队列的最少资源保证量未满足时，它将优先于其他同级队列获得资源</td></tr><tr><td>maxResources</td><td>设置最多可以使用的资源量，fair scheduler 会保证每个队列使用的资源量不会超过该队列的最多可使用资源量</td></tr><tr><td>maxRunningApps</td><td>设置最多同时运行的应用程序数</td></tr><tr><td>schedulingMode</td><td>设置队列采用的调度模式，可以是 fifo、fair 或者 drf</td></tr><tr><td>weight</td><td>设置队列的权重，权重越高，可获取的资源就越多</td></tr><tr><td>aclSubmitApps</td><td>表示可向队列中提交应用程序的用户和组列表，默认情况下为&quot;*&quot;，表示任何用户和组均可以向该队列提交应用程序</td></tr></tbody></table><p>再来看一下队列执行规则列表（Queue Placement Policy），Fair 调度器采用了一套基于规则的配置来确定应用应该放到哪个队列中。在上面的例子中，我定义了一个规则列表，总共有四个规则，其中的每个规则会被逐个尝试，直到匹配成功。</p><p>例如，第一个规则是 user，表示将提交任务的用户名作为队列名，然后将任务放到这个队列中执行；第二个规则 primaryGroup，表示将提交任务的用户所属的主组作为队列名；第三个规则 secondaryGroupExistingQueue 表示将提交任务的用户所属的附属组作为队列名；最后一个规则 default，表示当前面所有规则都不满足时，用户提交的任务会放到 default 队列中。</p><p>除了上面的规则之外，还可以在 yarn-site.xml 文件添加如下配置：</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">&lt;</span><span style="color:#85E89D;">property</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;</span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">&gt;yarn.scheduler.fair.user-as-default-queue&lt;/</span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;</span><span style="color:#85E89D;">value</span><span style="color:#E1E4E8;">&gt;true&lt;/</span><span style="color:#85E89D;">value</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;</span><span style="color:#85E89D;">description</span><span style="color:#E1E4E8;">&gt;default is True&lt;/</span><span style="color:#85E89D;">description</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;/</span><span style="color:#85E89D;">property</span><span style="color:#E1E4E8;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">&lt;</span><span style="color:#22863A;">property</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">&lt;</span><span style="color:#22863A;">name</span><span style="color:#24292E;">&gt;yarn.scheduler.fair.user-as-default-queue&lt;/</span><span style="color:#22863A;">name</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">&lt;</span><span style="color:#22863A;">value</span><span style="color:#24292E;">&gt;true&lt;/</span><span style="color:#22863A;">value</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">&lt;</span><span style="color:#22863A;">description</span><span style="color:#24292E;">&gt;default is True&lt;/</span><span style="color:#22863A;">description</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">&lt;/</span><span style="color:#22863A;">property</span><span style="color:#24292E;">&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>此配置值默认为 true，表示当任务中未指定队列名时，将以用户名作为队列名，这个配置就实现了根据用户名自动分配队列；如果设置为 false，那么所有任务会被放入 default 队列，而不是放到基于用户名的队列中。</p><p>另外，我们还可以在 yarn-site.xml 文件添加如下配置：</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">&lt;</span><span style="color:#85E89D;">property</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;</span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">&gt;yarn.scheduler.fair.allow-undeclared-pools&lt;/</span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;</span><span style="color:#85E89D;">value</span><span style="color:#E1E4E8;">&gt;false&lt;/</span><span style="color:#85E89D;">value</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;</span><span style="color:#85E89D;">description</span><span style="color:#E1E4E8;">&gt;default is True&lt;/</span><span style="color:#85E89D;">description</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;/</span><span style="color:#85E89D;">property</span><span style="color:#E1E4E8;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">&lt;</span><span style="color:#22863A;">property</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">&lt;</span><span style="color:#22863A;">name</span><span style="color:#24292E;">&gt;yarn.scheduler.fair.allow-undeclared-pools&lt;/</span><span style="color:#22863A;">name</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">&lt;</span><span style="color:#22863A;">value</span><span style="color:#24292E;">&gt;false&lt;/</span><span style="color:#22863A;">value</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">&lt;</span><span style="color:#22863A;">description</span><span style="color:#24292E;">&gt;default is True&lt;/</span><span style="color:#22863A;">description</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">&lt;/</span><span style="color:#22863A;">property</span><span style="color:#24292E;">&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>此配置表示是否允许创建未定义的队列，默认值为 true，表示 Yarn 将会自动创建任务中指定的未定义过的队列名。设置成 false 后，用户就无法创建队列了，该任务会被分配到 default 队列中。</p><p>最后，再来说下<strong>资源抢占</strong>，当一个任务提交到一个繁忙集群中的空队列时，任务并不会马上执行，而是暂时阻塞，直到正在运行的任务释放系统资源，才开始执行。为了使提交的任务执行时间更具预测性（可以设置等待的超时时间），Fair 调度器支持抢占。</p><p>抢占就是允许调度器杀掉占用超过其应占资源份额队列的 containers，这些 containers 资源释放后可，被分配到应该享有这些份额资源的队列中。需要注意，抢占会降低集群的执行效率，因为被终止的 containers 需要被重新执行。</p><p>要启用抢占模式，可以在 yarn-site.xml 文件中添加如下配置：</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">    &lt;</span><span style="color:#85E89D;">property</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">      &lt;</span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">&gt;yarn.scheduler.fair.preemption&lt;/</span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">      &lt;</span><span style="color:#85E89D;">value</span><span style="color:#E1E4E8;">&gt;true&lt;/</span><span style="color:#85E89D;">value</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;/</span><span style="color:#85E89D;">property</span><span style="color:#E1E4E8;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">    &lt;</span><span style="color:#22863A;">property</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">      &lt;</span><span style="color:#22863A;">name</span><span style="color:#24292E;">&gt;yarn.scheduler.fair.preemption&lt;/</span><span style="color:#22863A;">name</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">      &lt;</span><span style="color:#22863A;">value</span><span style="color:#24292E;">&gt;true&lt;/</span><span style="color:#22863A;">value</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    &lt;/</span><span style="color:#22863A;">property</span><span style="color:#24292E;">&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>可以设置此参数为 true 来启用抢占功能。此外，还需要在 fair-scheduler.xml 文件中添加一个参数用来控制抢占的过期时间，参数设置如下：</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">&lt;</span><span style="color:#79B8FF;">fairSharePreemptionTimeout</span><span style="color:#E1E4E8;">&gt;60&lt;/</span><span style="color:#79B8FF;">fairSharePreemptionTimeout</span><span style="color:#E1E4E8;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">&lt;</span><span style="color:#005CC5;">fairSharePreemptionTimeout</span><span style="color:#24292E;">&gt;60&lt;/</span><span style="color:#005CC5;">fairSharePreemptionTimeout</span><span style="color:#24292E;">&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>此参数用来设置某个队列的超时时间，如果队列在指定的时间内未获得最小的资源保障，调度器就会抢占 container。</p><p>还可以在 fair-scheduler.xml 文件中添加全局配置参数，内容如下：</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">&lt;</span><span style="color:#79B8FF;">defaultFairSharePreemptionTimeout</span><span style="color:#E1E4E8;">&gt;60&lt;/</span><span style="color:#79B8FF;">defaultFairSharePreemptionTimeout</span><span style="color:#E1E4E8;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">&lt;</span><span style="color:#005CC5;">defaultFairSharePreemptionTimeout</span><span style="color:#24292E;">&gt;60&lt;/</span><span style="color:#005CC5;">defaultFairSharePreemptionTimeout</span><span style="color:#24292E;">&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>此参数用来配置所有队列的超时时间。</p><p>这里需要注意，在 fair-scheduler.xml 配置中，添加了用户和用户组，这里的用户和用户组的对应关系，需要维护在 ResourceManager 上，ResourceManager 在分配资源池时候，是从 ResourceManager 所在的操作系统上读取用户和用户组的对应关系的，否则就会被分配到default 队列中。而客户端机器上的用户对应的用户组无关紧要。</p><p>在 fair-scheduler.xml 第一次添加、配置完成后，需要重启 Yarn 集群才能生效，而后面再对 fair-scheduler.xml 进行修改用户或者调整资源池配额后，无须重启 yarn 集群，只需执行下面的命令刷新即可生效：</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[hadoop@yarnserver </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]$ yarn rmadmin </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">refreshQueues</span></span>
<span class="line"><span style="color:#E1E4E8;">[hadoop@yarnserver </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]$ yarn rmadmin </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">refreshUserToGroupsMappings</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[hadoop@yarnserver </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]$ yarn rmadmin </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">refreshQueues</span></span>
<span class="line"><span style="color:#24292E;">[hadoop@yarnserver </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]$ yarn rmadmin </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">refreshUserToGroupsMappings</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>动态更新只支持修改资源池配额，如果是新增或减少资源池，则还需要重启 Yarn 集群。</p><h3 id="容量调度与公平调度对比与选型" tabindex="-1">容量调度与公平调度对比与选型 <a class="header-anchor" href="#容量调度与公平调度对比与选型" aria-label="Permalink to &quot;容量调度与公平调度对比与选型&quot;">​</a></h3><h4 id="_1-相同" tabindex="-1">1. 相同 <a class="header-anchor" href="#_1-相同" aria-label="Permalink to &quot;1. 相同&quot;">​</a></h4><p>容量调度和公平调度实现的功能基本一致，例如，它们都支持多用户、多队列，即都适用于多用户共享集群的应用环境。同时，单个队列均支持优先级和 FIFO 调度方式，还支持资源共享，即某个队列中的资源有剩余时，可共享给其他缺资源的队列。</p><h4 id="_2-不同" tabindex="-1">2. 不同 <a class="header-anchor" href="#_2-不同" aria-label="Permalink to &quot;2. 不同&quot;">​</a></h4><ul><li><strong>核心调度策略不同</strong></li></ul><p>容量调度器的调度策略是，先选择资源利用率低的队列，然后在队列中同时考虑 FIFO 和内存因素；而公平调度器仅考虑公平，而公平是通过任务缺额体现的，调度器每次选择缺额最大的任务（队列的资源量，任务的优先级等仅用于计算任务缺额）。</p><ul><li><strong>对特殊任务的处理不同</strong></li></ul><p>容量调度器调度任务时会考虑作业的内存限制，为了满足某些特殊任务的特殊内存需求，可能会为该任务分配多个 slot；而公平调度器对这种特殊的任务无能为力，只能杀掉这种任务。</p><p>因此，具体选用哪种调度算法，可根据实际应用需求而定。<strong>一个基本的经验是，小型 Yarn 集群（100 个节点以内），可考虑使用公平调度器，而大型 Yarn 集群（超过 100 个节点）可采用容量调度器效果会更好。</strong></p><h3 id="小结" tabindex="-1">小结 <a class="header-anchor" href="#小结" aria-label="Permalink to &quot;小结&quot;">​</a></h3><p>本课时主要介绍了 Yarn 集群中常用的两个资源调度器：<strong>容量调度和公平调度</strong>。通过该课时的学习，我们了解到，在多个用户同时使用 Yarn 集群的时候，合理地设置调度器可以有效利用集群资源，并减少资源争抢，使集群资源利用率达到最大化。</p>`,68),o=[e];function t(r,c,E,y,i,u){return a(),n("div",null,o)}const m=s(p,[["render",t]]);export{g as __pageData,m as default};
