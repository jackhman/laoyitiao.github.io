import{_ as r,j as s,o as n,g as p,k as o,Q as l,s as e,h as t}from"./chunks/framework.e0c66c3f.js";const V=JSON.parse('{"title":"什么是分布式锁 ","description":"","frontmatter":{},"headers":[],"relativePath":"posts/backEnd/ZooKeeper源码分析与实战_文档/(3151) 第21讲：ZooKeeper 分布式锁：实现和原理解析.md","filePath":"posts/backEnd/ZooKeeper源码分析与实战_文档/(3151) 第21讲：ZooKeeper 分布式锁：实现和原理解析.md","lastUpdated":1696338709000}'),c={name:"posts/backEnd/ZooKeeper源码分析与实战_文档/(3151) 第21讲：ZooKeeper 分布式锁：实现和原理解析.md"},i=l("",20),h=e("h4",{id:"获取锁",tabindex:"-1"},[t("获取锁 "),e("a",{class:"header-anchor",href:"#获取锁","aria-label":'Permalink to "获取锁"'},"​")],-1),_=e("p",null,"当某一个事务在访问共享数据时，首先需要获取锁。ZooKeeper 中的所有客户端会在 Locks_shared 节点下创建一个临时顺序节点。根据对数据对象的操作类型创建不同的数据节点，如果是读操作，就创建名称中带有 R 标志的顺序节点，如果是写入操作就创建带有 W 标志的顺序节点。",-1),d=e("h4",{id:"释放锁",tabindex:"-1"},[t("释放锁 "),e("a",{class:"header-anchor",href:"#释放锁","aria-label":'Permalink to "释放锁"'},"​")],-1),g=e("p",null,"事务逻辑执行完毕后，需要对事物线程占有的共享锁进行释放。我们可以利用 ZooKeeper 中数据节点的性质来实现主动释放锁和被动释放锁两种方式。",-1),m=e("p",null,"主动释放锁是当客户端的逻辑执行完毕，主动调用 delete 函数删除ZooKeeper 服务上的数据节点。而被动释放锁则利用临时节点的性质，在客户端因异常而退出时，ZooKeeper 服务端会直接删除该临时节点，即释放该共享锁。",-1),u=e("p",null,"这种实现方式正好和上面介绍的死锁的两种处理方式相对应。到目前为止，我们就利用 ZooKeeper 实现了一个比较完整的共享锁。如下图所示，在这个实现逻辑中，首先通过创建数据临时数据节点的方式实现获取锁的操作。创建数据节点分为两种，分别是读操作的数据节点和写操作的数据节点。当锁节点删除时，注册了该 Watch 监控的其他客户端也会收到通知，重新发起创建临时节点尝试获取锁。当事务逻辑执行完成，客户端会主动删除该临时节点释放锁。",-1),Z=e("h3",{id:"总结",tabindex:"-1"},[t("总结 "),e("a",{class:"header-anchor",href:"#总结","aria-label":'Permalink to "总结"'},"​")],-1),b=e("p",null,"通过本课时的学习，我们掌握了什么是分布式锁，以及分布式锁在实际生产环境中面临的问题和挑战。无论是单机上的加锁还是分布式环境下的分布式锁，都会出现死锁问题。面对死锁问题，如果我们不能很好地处理，会严重影响系统的运行。在本课时中，我为你讲解了两种处理死锁问题的方法，分别是超时设置和死锁监控。然后重点介绍了利用 ZooKeeper 实现一个共享锁。",-1),K=e("p",null,"在具体实现的过程中，我们利用 ZooKeeper 数据模型的临时顺序节点和 Watch 监控机制，在客户端通过创建数据节点的方式来获取锁，通过删除数据节点来释放锁。",-1),f=e("p",null,"这里我给你留一个问题，作为我们课后的作业：在分布式共享锁的实现中，获得锁的线程执行完释放锁后，其他等待资源的线程客户端收到 Watch 通知机制，会尝试获取锁。但是如果等待线程过多，那么频繁的 Watch 通知也会占用系统的网络资源和内存，有没有什么好的办法可以优化呢？在保证共享锁的实现下，减少 Watch 通知次数，这里留给你在本地进行优化。",-1);function k(q,A,P,x,W,C){const a=s("Image");return n(),p("div",null,[i,o(a,{alt:"image (1).png",src:"https://s0.lgstatic.com/i/image/M00/32/74/CgqCHl8Oc56AEMuZAAAsuQwHWCY999.png"}),h,_,o(a,{alt:"image (2).png",src:"https://s0.lgstatic.com/i/image/M00/32/69/Ciqc1F8Oc6aAH44DAAA1aVd9UXo732.png"}),d,g,m,u,o(a,{alt:"X.png",src:"https://s0.lgstatic.com/i/image/M00/32/EB/CgqCHl8O5rOADPbBAACVhsBN-NU550.png"}),Z,b,K,f])}const E=r(c,[["render",k]]);export{V as __pageData,E as default};
