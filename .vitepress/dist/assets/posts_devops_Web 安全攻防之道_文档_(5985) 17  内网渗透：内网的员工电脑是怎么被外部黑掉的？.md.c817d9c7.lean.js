import{_ as o,D as e,o as t,g as c,J as l,h as a,Q as p,m as s}from"./chunks/framework.f67d7268.js";const ms=JSON.parse('{"title":"17内网渗透：内网的员工电脑是怎么被外部黑掉的？","description":"","frontmatter":{},"headers":[],"relativePath":"posts/devops/Web 安全攻防之道_文档/(5985) 17  内网渗透：内网的员工电脑是怎么被外部黑掉的？.md","filePath":"posts/devops/Web 安全攻防之道_文档/(5985) 17  内网渗透：内网的员工电脑是怎么被外部黑掉的？.md","lastUpdated":1696682708000}'),r={name:"posts/devops/Web 安全攻防之道_文档/(5985) 17  内网渗透：内网的员工电脑是怎么被外部黑掉的？.md"},i=p("",8),E=s("p",null,"图 1 靶场的内网拓扑结构图",-1),y=s("p",null,"这 3 台虚拟机分别如下。",-1),d=s("p",null,"VM1：Windows 7 x64，开放 Web 服务的服务器",-1),h=s("p",null,"VM2：Win2K3 Metasploitable，内网机器",-1),g=s("p",null,"VM3：Windows Server 2008 R2 x64，内网机器，域控服务器（关于域控的介绍见下文）",-1),u=p("",9),_=p("",4),m=p("",3),A=p("",3),F=p("",3),C=p("",6),v=p("",4),D=p("",3),b=p("",5),k=s("p",null,"图 11 查询 DNS 服务器",-1),P=s("ul",null,[s("li",null,[a("扫描内网主机，寻找对应机器名的 IP，比如用"),s("a",{href:"https://github.com/lifenjoiner/nbtscan/releases/download/nbtscan-v1.5.2-2394b4/nbtscan-v1.5.2-2394b4-win32.7z",target:"_blank",rel:"noreferrer"},"nbtscan 工具"),a("，它就是利用 NetBIOS 协议去进行机器名查询解析应答的过程以探测内网主机。")])],-1),w=s("p",null,"图 12 利用 nbtscan 扫描内网主机",-1),T=s("p",null,"基于上述方法的输出结果，我们可以知道域控制器 IP 为 192.168.52.138。",-1),S=s("h4",{id:"_3-域关系",tabindex:"-1"},[a("3.域关系 "),s("a",{class:"header-anchor",href:"#_3-域关系","aria-label":'Permalink to "3.域关系"'},"​")],-1),f=s("p",null,"一台台计算机组成一个域，称为单域。",-1),B=s("p",null,"出于管理或其他需求，可能将一个域分成多个域来管理，就像公司分成几个部分一样，那么公司层面的域称为父域，部门层面的域称为子域。",-1),x=s("p",null,"父子域与域名中的一级域名、二级域名的概念类似，比如 test.baidu.com 是 baidu.com 的二级域，父域是 baidu.com，子域是 test.baidu.com。",-1),I=s("p",null,"这些父子域称成了域树，一个个域树建立起来的组合称为域森林，简单域林。",-1),q=p("",11),M=s("p",null,"图 14 Bloodhound",-1),W=s("p",null,"该工具最有用也是最常用的一个功能就是提供攻击域控的最短路径，可以帮助我们更快地攻下域控服务器。",-1),j=p("",43),V=s("p",null,"图 16 利用 local_exploit_suggester 获取未修复且可利用的漏洞",-1),O=s("p",null,"根据上述信息可以知道，系统上还是不少漏洞可直接利用的，你可以挑选内核漏洞去利用。",-1),N=s("p",null,"不过这里还有个更简单的方法，就是利用 getsystem 命令去获取 SYSTEM 权限，如下图所示。",-1),R=s("p",null,"图 17 利用 getsystem 提权",-1),H=s("h4",{id:"_2-绕过-uac",tabindex:"-1"},[a("2.绕过 UAC "),s("a",{class:"header-anchor",href:"#_2-绕过-uac","aria-label":'Permalink to "2.绕过 UAC"'},"​")],-1),L=s("p",null,"即使是 Administrator 权限，有时在执行程序时会失败，相信你对下图的弹框不会陌生。这就是 UAC（用户账户控制），其原理是通知用户是否对应用程序使用硬盘驱动器和系统文件授权，以达到帮助阻止恶意程序损坏系统的效果。",-1),z=p("",7),U=p("",7),Y=p("",3),Q=s("p",null,"图 21 获取系统的账号与密码",-1),G=s("p",null,"除了 Mimikatz 外，还可以利用 hashdump 可导出当前机器的密码 Hash：",-1),K=s("p",null,"图 22 利用 hashdump 可导出当前机器的密码 Hash",-1),J=s("p",null,"利用 smart_hashdump 还可以获取域内用户的密码 Hash，但需要 system 权限：",-1),X=s("p",null,"图 23 利用 smart_hashdump 导出域内用户的密码 Hash",-1),$=s("p",null,"如果只有 hash，那就需要结合 hashcat 来破解出明文密码，有时也可采用哈希传递攻击的方式去利用，即利用域内一些账号密码相同的情况，直接将密码哈希传递给其他计算机去尝试登录的攻击方式，可以不必花时间破解密码明文，Mimikatz 就支持哈希传递攻击。",-1),Z=s("p",null,"前面我们已经知道这里 Administrator 是域管理员，并且刚刚已经获取到密码是 hongrisec@2019，那么接下来我们就可以尝试拿下更多的内网机器，进一步横向移动渗透。",-1),ss=s("h4",{id:"_2-账号密码连接",tabindex:"-1"},[a("2.账号密码连接 "),s("a",{class:"header-anchor",href:"#_2-账号密码连接","aria-label":'Permalink to "2.账号密码连接"'},"​")],-1),as=s("p",null,"前面已经拿到域管理员的账号、密码，就可以尝试去登录下域内的其他主机，下面我们尝试去登录下域控主机 192.168.69.138。登录方式有很多，常用的是下面几种：",-1),ns=s("ul",null,[s("li",null,[s("strong",null,"3389 登录")])],-1),ls=s("p",null,"先扫描端口，看目标是否打开 3389，然后用远程桌面连接工具 mstsc.exe 去登录，下图是域控主机的端口扫描结果，发现没有开 3389，就先放弃。",-1),ps=s("p",null,"图 24 扫描端口",-1),os=p("",5),es=p("",5),ts=p("",4),cs=p("",21),rs=p("",18);function is(Es,ys,ds,hs,gs,us){const n=e("Image");return t(),c("div",null,[i,l(n,{alt:"Drawing 0.png",src:"https://s0.lgstatic.com/i/image6/M00/02/D0/CioPOWAeEO6AG9AkAAEj8_JosNU947.png"}),a(),E,y,d,h,g,l(n,{alt:"图片2.png",src:"https://s0.lgstatic.com/i/image6/M00/03/97/Cgp9HWAfY0eAfE1WAAMYLHntmgU570.png"}),a(),u,l(n,{alt:"Drawing 2.png",src:"https://s0.lgstatic.com/i/image6/M00/02/D2/Cgp9HWAeEQaAVj9BAAAXrb5SArk412.png"}),a(),_,l(n,{alt:"Drawing 3.png",src:"https://s0.lgstatic.com/i/image6/M00/02/D2/Cgp9HWAeEQ2AJhh5AAAikI0lX0Y455.png"}),a(),m,l(n,{alt:"Drawing 4.png",src:"https://s0.lgstatic.com/i/image6/M00/02/D2/Cgp9HWAeERWADJYhAAAnZIqI-D8292.png"}),a(),A,l(n,{alt:"Drawing 5.png",src:"https://s0.lgstatic.com/i/image6/M00/02/D0/CioPOWAeERyAT5rjAAAS8yoAmXw757.png"}),a(),F,l(n,{alt:"Drawing 6.png",src:"https://s0.lgstatic.com/i/image6/M00/02/D0/CioPOWAeESSAH-ZkAAAaJdSwOEE769.png"}),a(),C,l(n,{alt:"Drawing 7.png",src:"https://s0.lgstatic.com/i/image6/M00/02/D2/Cgp9HWAeES2AAURlAAAYxuOOMQQ920.png"}),a(),v,l(n,{alt:"Drawing 8.png",src:"https://s0.lgstatic.com/i/image6/M00/02/D2/Cgp9HWAeETaANehWAAAUW2JBZak736.png"}),a(),D,l(n,{alt:"Drawing 9.png",src:"https://s0.lgstatic.com/i/image6/M00/02/D0/CioPOWAeET2AQFjTAAATkdoqwP4465.png"}),a(),b,l(n,{alt:"Drawing 10.png",src:"https://s0.lgstatic.com/i/image6/M00/02/D2/Cgp9HWAeEUWAIGZWAAAQDfvLnvs583.png"}),a(),k,P,l(n,{alt:"图片12.png",src:"https://s0.lgstatic.com/i/image6/M00/03/95/CioPOWAfY12AHyFVAADWvNQT2YE315.png"}),a(),w,T,S,f,B,x,I,l(n,{alt:"Drawing 12.png",src:"https://s0.lgstatic.com/i/image6/M00/02/D0/CioPOWAeEViAKOJIAAEtcglxU5U255.png"}),a(),q,l(n,{alt:"图片14.png",src:"https://s0.lgstatic.com/i/image6/M00/03/97/Cgp9HWAfY2yAAEGRAABdkWCTiXQ008.png"}),a(),M,W,l(n,{alt:"Drawing 14.png",src:"https://s0.lgstatic.com/i/image6/M00/02/D2/Cgp9HWAeEXSANSPOAAEqJIowHsQ844.png"}),a(),j,l(n,{alt:"图片16.png",src:"https://s0.lgstatic.com/i/image6/M00/03/97/Cgp9HWAfY4GAQcMKAAL5SxNj3Q4699.png"}),a(),V,O,N,l(n,{alt:"Drawing 16.png",src:"https://s0.lgstatic.com/i/image6/M00/02/D2/Cgp9HWAeEaWAPN3CAABEa5FU48c948.png"}),a(),R,H,L,l(n,{alt:"Drawing 17.png",src:"https://s0.lgstatic.com/i/image6/M00/02/D2/Cgp9HWAeEayAQhAQAACp3hxvVs4058.png"}),a(),z,l(n,{alt:"Drawing 18.png",src:"https://s0.lgstatic.com/i/image6/M00/02/D0/CioPOWAeEbWAfYtIAADYedlIyJY442.png"}),a(),U,l(n,{alt:"Drawing 19.png",src:"https://s0.lgstatic.com/i/image6/M00/02/D2/Cgp9HWAeEcKAPB1IAAF7z9fhxL0342.png"}),a(),Y,l(n,{alt:"Drawing 20.png",src:"https://s0.lgstatic.com/i/image6/M00/02/D0/CioPOWAeEcmAdN4ZAABC3Bc6dFs102.png"}),a(),Q,G,l(n,{alt:"Drawing 21.png",src:"https://s0.lgstatic.com/i/image6/M00/02/D0/CioPOWAeEdGAWOPMAAFVZckrEAI446.png"}),a(),K,J,l(n,{alt:"图片23.png",src:"https://s0.lgstatic.com/i/image6/M00/03/97/Cgp9HWAfY5WAYTl7AALWnzNVoVk263.png"}),a(),X,$,Z,ss,as,ns,ls,l(n,{alt:"Drawing 23.png",src:"https://s0.lgstatic.com/i/image6/M00/02/D2/Cgp9HWAeEfKAWSFSAAFcqQVWYB8312.png"}),a(),ps,l(n,{alt:"Drawing 24.png",src:"https://s0.lgstatic.com/i/image6/M00/02/D2/Cgp9HWAeEfqALvbvAAB93cLa61g706.png"}),a(),os,l(n,{alt:"Drawing 25.png",src:"https://s0.lgstatic.com/i/image6/M00/02/D0/CioPOWAeEgyAH8HSAABNZ8-054c288.png"}),a(),es,l(n,{alt:"Drawing 26.png",src:"https://s0.lgstatic.com/i/image6/M00/02/D0/CioPOWAeEiCAFXs4AAJqKBM7rnw147.png"}),a(),ts,l(n,{alt:"Drawing 27.png",src:"https://s0.lgstatic.com/i/image6/M00/02/D0/CioPOWAeEimAG3tlAAAfUzrGXD0403.png"}),a(),cs,l(n,{alt:"Drawing 28.png",src:"https://s0.lgstatic.com/i/image6/M00/02/D2/Cgp9HWAeEjSAG5D7AAB7pk5Jmlc919.png"}),a(),rs])}const As=o(r,[["render",is]]);export{ms as __pageData,As as default};
