import{_ as p,j as o,o as e,g as t,k as n,s,h as c,Q as l}from"./chunks/framework.e0c66c3f.js";const _=JSON.parse('{"title":"典型回答 ","description":"","frontmatter":{},"headers":[],"relativePath":"posts/backEnd/Java 源码剖析 34 讲_文档/(1786) 第26讲：生产环境如何排除和优化 JVM？.md","filePath":"posts/backEnd/Java 源码剖析 34 讲_文档/(1786) 第26讲：生产环境如何排除和优化 JVM？.md","lastUpdated":1696338709000}'),r={name:"posts/backEnd/Java 源码剖析 34 讲_文档/(1786) 第26讲：生产环境如何排除和优化 JVM？.md"},y=s("p",null,"通过前面几个课时的学习，相信你对 JVM 的理论及实践等相关知识有了一个大体的印象。而本课时将重点讲解 JVM 的排查与优化，这样就会对 JVM 的知识点有一个完整的认识，从而可以更好地应用于实际工作或者面试了。",-1),E=s("p",null,"我们本课时的面试题是，生产环境如何排查问题？",-1),i=s("h3",{id:"典型回答",tabindex:"-1"},[c("典型回答 "),s("a",{class:"header-anchor",href:"#典型回答","aria-label":'Permalink to "典型回答"'},"​")],-1),F=s("p",null,"如果是在生产环境中直接排查 JVM 的话，最简单的做法就是使用 JDK 自带的 6 个非常实用的命令行工具来排查。它们分别是：jps、jstat、jinfo、jmap、jhat 和 jstack，它们都位于 JDK 的 bin 目录下，可以使用命令行工具直接运行，其目录如下图所示：",-1),d=l(`<p>接下来我们来看看这些工具的具体使用。</p><h4 id="_1-jps-虚拟机进程状况工具" tabindex="-1">1. jps（虚拟机进程状况工具） <a class="header-anchor" href="#_1-jps-虚拟机进程状况工具" aria-label="Permalink to &quot;1. jps（虚拟机进程状况工具）&quot;">​</a></h4><p>jps（JVM Process Status tool，虚拟机进程状况工具）它的功能和 Linux 中的 ps 命令比较类似，用于列出正在运行的 JVM 的 LVMID（Local Virtual Machine IDentifier，本地虚拟机唯一 ID），以及 JVM 的执行主类、JVM 启动参数等信息。语法如下：</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">jps [options] [hostid]</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">jps [options] [hostid]</span></span></code></pre></div><p>常用的 options 选项：</p><ul><li><p>-l：用于输出运行主类的全名，如果是 jar 包，则输出 jar 包的路径；</p></li><li><p>-q：用于输出 LVMID（Local Virtual Machine Identifier，虚拟机唯一 ID）；</p></li><li><p>-m：用于输出虚拟机启动时传递给主类 main() 方法的参数；</p></li><li><p>-v：用于输出启动时的 JVM 参数。</p></li></ul><p>使用实例：</p><div class="language-powershell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">➜  jps </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">l</span></span>
<span class="line"><span style="color:#79B8FF;">68848</span></span>
<span class="line"><span style="color:#79B8FF;">40085</span><span style="color:#E1E4E8;"> org.jetbrains.jps.cmdline.Launcher</span></span>
<span class="line"><span style="color:#79B8FF;">40086</span><span style="color:#E1E4E8;"> com.example.optimize.NativeOptimize</span></span>
<span class="line"><span style="color:#79B8FF;">40109</span><span style="color:#E1E4E8;"> jdk.jcmd</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">sun.tools.jps.Jps</span></span>
<span class="line"><span style="color:#79B8FF;">68879</span><span style="color:#E1E4E8;"> org.jetbrains.idea.maven.server.RemoteMavenServer36</span></span>
<span class="line"><span style="color:#E1E4E8;">➜  jps </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">q</span></span>
<span class="line"><span style="color:#79B8FF;">40368</span></span>
<span class="line"><span style="color:#79B8FF;">68848</span></span>
<span class="line"><span style="color:#79B8FF;">40085</span></span>
<span class="line"><span style="color:#79B8FF;">40086</span></span>
<span class="line"><span style="color:#79B8FF;">68879</span></span>
<span class="line"><span style="color:#E1E4E8;">➜  jps </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">m</span></span>
<span class="line"><span style="color:#79B8FF;">40400</span><span style="color:#E1E4E8;"> Jps </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">m</span></span>
<span class="line"><span style="color:#79B8FF;">68848</span></span>
<span class="line"><span style="color:#79B8FF;">40085</span><span style="color:#E1E4E8;"> Launcher </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Applications</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">IntelliJ IDEA2.app</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Contents</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">lib</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">idea_rt.jar:</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Applications</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">IntelliJ IDEA2.app</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Contents</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">lib</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">oro</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">2.0</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">8.</span><span style="color:#E1E4E8;">jar:</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Applications</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">IntelliJ IDEA2.app</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Contents</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">lib</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">resources_en.jar:</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Applications</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">IntelliJ IDEA2.app</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Contents</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">lib</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">maven</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">model</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">3.6</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">1.</span><span style="color:#E1E4E8;">jar:</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Applications</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">IntelliJ IDEA2.app</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Contents</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">lib</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">qdox</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">2.0</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">M10.jar:</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Applications</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">IntelliJ IDEA2.app</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Contents</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">lib</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">plexus</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">component</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">annotations</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">1.7</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">1.</span><span style="color:#E1E4E8;">jar:</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Applications</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">IntelliJ IDEA2.app</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Contents</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">lib</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">httpcore</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">4.4</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">13.</span><span style="color:#E1E4E8;">jar:</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Applications</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">IntelliJ IDEA2.app</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Contents</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">lib</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">maven</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">resolver</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">api</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">1.3</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">3.</span><span style="color:#E1E4E8;">jar:</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Applications</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">IntelliJ IDEA2.app</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Contents</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">lib</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">netty</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">common</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">4.1</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">47.</span><span style="color:#E1E4E8;">Final.jar:</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Applications</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">IntelliJ IDEA2.app</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Contents</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">plugins</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">java</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">lib</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">maven</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">resolver</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">connector</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">basic</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">1.3</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">3.</span><span style="color:#E1E4E8;">jar:</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Applications</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">IntelliJ IDEA2.app</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Contents</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">lib</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">maven</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">artifact</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">3.6</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">1.</span><span style="color:#E1E4E8;">jar:</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Applications</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">IntelliJ IDEA2.app</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Contents</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">lib</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">plexus</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">utils</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">3.2</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">0.</span><span style="color:#E1E4E8;">jar:</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Applications</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">IntelliJ IDEA2.app</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Contents</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">lib</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">netty</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">resolver</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">4.1</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">47.</span><span style="color:#E1E4E8;">Final.jar:</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Applications</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">IntelliJ IDEA2.app</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Contents</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">lib</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">guava</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">28.2</span><span style="color:#F97583;">-</span></span>
<span class="line"><span style="color:#79B8FF;">40086</span><span style="color:#E1E4E8;"> NativeOptimize</span></span>
<span class="line"><span style="color:#79B8FF;">68879</span><span style="color:#E1E4E8;"> RemoteMavenServer36</span></span>
<span class="line"><span style="color:#E1E4E8;">➜  jps </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">v</span></span>
<span class="line"><span style="color:#79B8FF;">68848</span><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">Xms128m </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">Xmx2048m </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">XX:ReservedCodeCacheSize</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">240m</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">XX:</span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;">UseCompressedOops </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">Dfile.encoding</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">UTF</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">8</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">XX:</span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;">UseConcMarkSweepGC </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">XX:SoftRefLRUPolicyMSPerMB</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">50</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">ea </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">XX:CICompilerCount</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">Dsun.io.useCanonPrefixCache</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">false </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">Djava.net.preferIPv4Stack</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">true </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">Djdk.http.auth.tunneling.disabledSchemes</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">XX:</span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;">HeapDumpOnOutOfMemoryError </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">XX:</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">OmitStackTraceInFastThrow </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">Djdk.attach.allowAttachSelf </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">Dkotlinx.coroutines.debug</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">off </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">Djdk.module.illegalAccess.silent</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">true </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">Xverify:none </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">XX:ErrorFile</span><span style="color:#F97583;">=/</span><span style="color:#E1E4E8;">Users</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">admin</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">java_error_in_idea_</span><span style="color:#F97583;">%</span><span style="color:#E1E4E8;">p.log </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">XX:HeapDumpPath</span><span style="color:#F97583;">=/</span><span style="color:#E1E4E8;">Users</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">admin</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">java_error_in_idea.hprof </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">javaagent:</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Users</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">admin</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">.jetbrains</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">jetbrains</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">agent</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">v3.</span><span style="color:#79B8FF;">2.0</span><span style="color:#E1E4E8;">.de72.</span><span style="color:#79B8FF;">619</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">Djb.vmOptionsFile</span><span style="color:#F97583;">=/</span><span style="color:#E1E4E8;">Users</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">admin</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Library</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Application Support</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">JetBrains</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">IntelliJIdea2020.</span><span style="color:#79B8FF;">1</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">idea.vmoptions </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">Didea.paths.selector</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">IntelliJIdea2020.</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">Didea.executable</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">idea </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">Didea.home.path</span><span style="color:#F97583;">=/</span><span style="color:#E1E4E8;">Applications</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">IntelliJ IDEA2.app</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Contents </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">Didea.vendor.name</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">JetBrains</span></span>
<span class="line"><span style="color:#79B8FF;">40085</span><span style="color:#E1E4E8;"> Launcher </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">Xmx700m </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">Djava.awt.headless</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">true </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">Djava.endorsed.dirs</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">Djdt.compiler.useSingleThread</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">true </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">Dpreload.project.path</span><span style="color:#F97583;">=/</span><span style="color:#E1E4E8;">Users</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">admin</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">github</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">blog</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">example</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">blog</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">example </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">Dpreload.config.path</span><span style="color:#F97583;">=/</span><span style="color:#E1E4E8;">Users</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">admin</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Library</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Application Support</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">JetBrains</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">IntelliJIdea2020.</span><span style="color:#79B8FF;">1</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">options </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">Dcompile.parallel</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">false </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">Drebuild.on.dependency.change</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">true </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">Djava.net.preferIPv4Stack</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">true </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">Dio.netty.initialSeedUniquifier</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">1366842080359982660</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">Dfile.encoding</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">UTF</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">8</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">Duser.language</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">zh </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">Duser.country</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">CN </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">Didea.paths.selector</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">IntelliJIdea2020.</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">Didea.home.path</span><span style="color:#F97583;">=/</span><span style="color:#E1E4E8;">Applications</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">IntelliJ IDEA2.app</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Contents </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">Didea.config.path</span><span style="color:#F97583;">=/</span><span style="color:#E1E4E8;">Users</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">admin</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Library</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Application Support</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">JetBrains</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">IntelliJIdea2020.</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">Didea.plugins.path</span><span style="color:#F97583;">=/</span><span style="color:#E1E4E8;">Users</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">admin</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Library</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Application Support</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">JetBrains</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">IntelliJIdea2020.</span><span style="color:#79B8FF;">1</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">plugins </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">Djps.log.dir</span><span style="color:#F97583;">=/</span><span style="color:#E1E4E8;">Users</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">admin</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Library</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Logs</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">JetBrains</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">IntelliJIdea2020.</span><span style="color:#79B8FF;">1</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">build-log</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">Djps.fallback.jdk.home</span><span style="color:#F97583;">=/</span><span style="color:#E1E4E8;">Applications</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">IntelliJ IDEA2.app</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Contents</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">jbr</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Contents</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Home </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">Djps.fallback.jdk.version</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">11.0</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">6</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">Dio.netty.noUnsafe</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">true </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">Djava.io.tmpdir</span><span style="color:#F97583;">=/</span><span style="color:#E1E4E8;">Users</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">admin</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Library</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Caches</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Je</span></span>
<span class="line"><span style="color:#79B8FF;">40086</span><span style="color:#E1E4E8;"> NativeOptimize </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">Dfile.encoding</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">UTF</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">8</span></span>
<span class="line"><span style="color:#79B8FF;">40425</span><span style="color:#E1E4E8;"> Jps </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">Dapplication.home</span><span style="color:#F97583;">=/</span><span style="color:#E1E4E8;">Users</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">admin</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Library</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Java</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">JavaVirtualMachines</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">openjdk</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">14</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Contents</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Home </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">Xms8m </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">Djdk.module.main</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">jdk.jcmd</span></span>
<span class="line"><span style="color:#79B8FF;">68879</span><span style="color:#E1E4E8;"> RemoteMavenServer36 </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">Djava.awt.headless</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">true </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">Dmaven.defaultProjectBuilder.disableGlobalModelCache</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">true </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">Xmx768m </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">Didea.maven.embedder.version</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">3.6</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">Dmaven.ext.class.path</span><span style="color:#F97583;">=/</span><span style="color:#E1E4E8;">Applications</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">IntelliJ IDEA2.app</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Contents</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">plugins</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">maven</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">lib</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">maven</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">event</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">listener.jar </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">Dfile.encoding</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">UTF</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">8</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">➜  jps </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">l</span></span>
<span class="line"><span style="color:#005CC5;">68848</span></span>
<span class="line"><span style="color:#005CC5;">40085</span><span style="color:#24292E;"> org.jetbrains.jps.cmdline.Launcher</span></span>
<span class="line"><span style="color:#005CC5;">40086</span><span style="color:#24292E;"> com.example.optimize.NativeOptimize</span></span>
<span class="line"><span style="color:#005CC5;">40109</span><span style="color:#24292E;"> jdk.jcmd</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">sun.tools.jps.Jps</span></span>
<span class="line"><span style="color:#005CC5;">68879</span><span style="color:#24292E;"> org.jetbrains.idea.maven.server.RemoteMavenServer36</span></span>
<span class="line"><span style="color:#24292E;">➜  jps </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">q</span></span>
<span class="line"><span style="color:#005CC5;">40368</span></span>
<span class="line"><span style="color:#005CC5;">68848</span></span>
<span class="line"><span style="color:#005CC5;">40085</span></span>
<span class="line"><span style="color:#005CC5;">40086</span></span>
<span class="line"><span style="color:#005CC5;">68879</span></span>
<span class="line"><span style="color:#24292E;">➜  jps </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">m</span></span>
<span class="line"><span style="color:#005CC5;">40400</span><span style="color:#24292E;"> Jps </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">m</span></span>
<span class="line"><span style="color:#005CC5;">68848</span></span>
<span class="line"><span style="color:#005CC5;">40085</span><span style="color:#24292E;"> Launcher </span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Applications</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">IntelliJ IDEA2.app</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Contents</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">lib</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">idea_rt.jar:</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Applications</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">IntelliJ IDEA2.app</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Contents</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">lib</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">oro</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">2.0</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">8.</span><span style="color:#24292E;">jar:</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Applications</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">IntelliJ IDEA2.app</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Contents</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">lib</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">resources_en.jar:</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Applications</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">IntelliJ IDEA2.app</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Contents</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">lib</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">maven</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">model</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">3.6</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">1.</span><span style="color:#24292E;">jar:</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Applications</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">IntelliJ IDEA2.app</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Contents</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">lib</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">qdox</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">2.0</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">M10.jar:</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Applications</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">IntelliJ IDEA2.app</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Contents</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">lib</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">plexus</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">component</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">annotations</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">1.7</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">1.</span><span style="color:#24292E;">jar:</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Applications</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">IntelliJ IDEA2.app</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Contents</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">lib</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">httpcore</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">4.4</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">13.</span><span style="color:#24292E;">jar:</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Applications</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">IntelliJ IDEA2.app</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Contents</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">lib</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">maven</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">resolver</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">api</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">1.3</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">3.</span><span style="color:#24292E;">jar:</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Applications</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">IntelliJ IDEA2.app</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Contents</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">lib</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">netty</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">common</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">4.1</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">47.</span><span style="color:#24292E;">Final.jar:</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Applications</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">IntelliJ IDEA2.app</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Contents</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">plugins</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">java</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">lib</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">maven</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">resolver</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">connector</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">basic</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">1.3</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">3.</span><span style="color:#24292E;">jar:</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Applications</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">IntelliJ IDEA2.app</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Contents</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">lib</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">maven</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">artifact</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">3.6</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">1.</span><span style="color:#24292E;">jar:</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Applications</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">IntelliJ IDEA2.app</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Contents</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">lib</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">plexus</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">utils</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">3.2</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">0.</span><span style="color:#24292E;">jar:</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Applications</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">IntelliJ IDEA2.app</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Contents</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">lib</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">netty</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">resolver</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">4.1</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">47.</span><span style="color:#24292E;">Final.jar:</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Applications</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">IntelliJ IDEA2.app</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Contents</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">lib</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">guava</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">28.2</span><span style="color:#D73A49;">-</span></span>
<span class="line"><span style="color:#005CC5;">40086</span><span style="color:#24292E;"> NativeOptimize</span></span>
<span class="line"><span style="color:#005CC5;">68879</span><span style="color:#24292E;"> RemoteMavenServer36</span></span>
<span class="line"><span style="color:#24292E;">➜  jps </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">v</span></span>
<span class="line"><span style="color:#005CC5;">68848</span><span style="color:#24292E;">  </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">Xms128m </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">Xmx2048m </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">XX:ReservedCodeCacheSize</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">240m</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">XX:</span><span style="color:#D73A49;">+</span><span style="color:#24292E;">UseCompressedOops </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">Dfile.encoding</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">UTF</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">8</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">XX:</span><span style="color:#D73A49;">+</span><span style="color:#24292E;">UseConcMarkSweepGC </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">XX:SoftRefLRUPolicyMSPerMB</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">50</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">ea </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">XX:CICompilerCount</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">2</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">Dsun.io.useCanonPrefixCache</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">false </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">Djava.net.preferIPv4Stack</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">true </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">Djdk.http.auth.tunneling.disabledSchemes</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">XX:</span><span style="color:#D73A49;">+</span><span style="color:#24292E;">HeapDumpOnOutOfMemoryError </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">XX:</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">OmitStackTraceInFastThrow </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">Djdk.attach.allowAttachSelf </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">Dkotlinx.coroutines.debug</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">off </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">Djdk.module.illegalAccess.silent</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">true </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">Xverify:none </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">XX:ErrorFile</span><span style="color:#D73A49;">=/</span><span style="color:#24292E;">Users</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">admin</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">java_error_in_idea_</span><span style="color:#D73A49;">%</span><span style="color:#24292E;">p.log </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">XX:HeapDumpPath</span><span style="color:#D73A49;">=/</span><span style="color:#24292E;">Users</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">admin</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">java_error_in_idea.hprof </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">javaagent:</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Users</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">admin</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">.jetbrains</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">jetbrains</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">agent</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">v3.</span><span style="color:#005CC5;">2.0</span><span style="color:#24292E;">.de72.</span><span style="color:#005CC5;">619</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">Djb.vmOptionsFile</span><span style="color:#D73A49;">=/</span><span style="color:#24292E;">Users</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">admin</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Library</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Application Support</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">JetBrains</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">IntelliJIdea2020.</span><span style="color:#005CC5;">1</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">idea.vmoptions </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">Didea.paths.selector</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">IntelliJIdea2020.</span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">Didea.executable</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">idea </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">Didea.home.path</span><span style="color:#D73A49;">=/</span><span style="color:#24292E;">Applications</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">IntelliJ IDEA2.app</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Contents </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">Didea.vendor.name</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">JetBrains</span></span>
<span class="line"><span style="color:#005CC5;">40085</span><span style="color:#24292E;"> Launcher </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">Xmx700m </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">Djava.awt.headless</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">true </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">Djava.endorsed.dirs</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">Djdt.compiler.useSingleThread</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">true </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">Dpreload.project.path</span><span style="color:#D73A49;">=/</span><span style="color:#24292E;">Users</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">admin</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">github</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">blog</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">example</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">blog</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">example </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">Dpreload.config.path</span><span style="color:#D73A49;">=/</span><span style="color:#24292E;">Users</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">admin</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Library</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Application Support</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">JetBrains</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">IntelliJIdea2020.</span><span style="color:#005CC5;">1</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">options </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">Dcompile.parallel</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">false </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">Drebuild.on.dependency.change</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">true </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">Djava.net.preferIPv4Stack</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">true </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">Dio.netty.initialSeedUniquifier</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">1366842080359982660</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">Dfile.encoding</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">UTF</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">8</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">Duser.language</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">zh </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">Duser.country</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">CN </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">Didea.paths.selector</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">IntelliJIdea2020.</span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">Didea.home.path</span><span style="color:#D73A49;">=/</span><span style="color:#24292E;">Applications</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">IntelliJ IDEA2.app</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Contents </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">Didea.config.path</span><span style="color:#D73A49;">=/</span><span style="color:#24292E;">Users</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">admin</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Library</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Application Support</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">JetBrains</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">IntelliJIdea2020.</span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">Didea.plugins.path</span><span style="color:#D73A49;">=/</span><span style="color:#24292E;">Users</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">admin</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Library</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Application Support</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">JetBrains</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">IntelliJIdea2020.</span><span style="color:#005CC5;">1</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">plugins </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">Djps.log.dir</span><span style="color:#D73A49;">=/</span><span style="color:#24292E;">Users</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">admin</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Library</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Logs</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">JetBrains</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">IntelliJIdea2020.</span><span style="color:#005CC5;">1</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">build-log</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">Djps.fallback.jdk.home</span><span style="color:#D73A49;">=/</span><span style="color:#24292E;">Applications</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">IntelliJ IDEA2.app</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Contents</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">jbr</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Contents</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Home </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">Djps.fallback.jdk.version</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">11.0</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">6</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">Dio.netty.noUnsafe</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">true </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">Djava.io.tmpdir</span><span style="color:#D73A49;">=/</span><span style="color:#24292E;">Users</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">admin</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Library</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Caches</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Je</span></span>
<span class="line"><span style="color:#005CC5;">40086</span><span style="color:#24292E;"> NativeOptimize </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">Dfile.encoding</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">UTF</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">8</span></span>
<span class="line"><span style="color:#005CC5;">40425</span><span style="color:#24292E;"> Jps </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">Dapplication.home</span><span style="color:#D73A49;">=/</span><span style="color:#24292E;">Users</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">admin</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Library</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Java</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">JavaVirtualMachines</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">openjdk</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">14</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Contents</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Home </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">Xms8m </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">Djdk.module.main</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">jdk.jcmd</span></span>
<span class="line"><span style="color:#005CC5;">68879</span><span style="color:#24292E;"> RemoteMavenServer36 </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">Djava.awt.headless</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">true </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">Dmaven.defaultProjectBuilder.disableGlobalModelCache</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">true </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">Xmx768m </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">Didea.maven.embedder.version</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">3.6</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">Dmaven.ext.class.path</span><span style="color:#D73A49;">=/</span><span style="color:#24292E;">Applications</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">IntelliJ IDEA2.app</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Contents</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">plugins</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">maven</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">lib</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">maven</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">event</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">listener.jar </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">Dfile.encoding</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">UTF</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">8</span></span></code></pre></div><h4 id="_2-jstat-虚拟机统计信息监视工具" tabindex="-1">2. jstat（虚拟机统计信息监视工具） <a class="header-anchor" href="#_2-jstat-虚拟机统计信息监视工具" aria-label="Permalink to &quot;2. jstat（虚拟机统计信息监视工具）&quot;">​</a></h4><p>jstat（JVM Statistics Monitoring Tool，虚拟机统计信息监视工具）用于监控虚拟机的运行状态信息。</p><p>例如，我们用它来查询某个 Java 进程的垃圾收集情况，示例如下：</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">➜  jstat </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">gc </span><span style="color:#79B8FF;">43704</span></span>
<span class="line"><span style="color:#E1E4E8;"> S0C    S1C    S0U    S1U      EC       EU        OC         OU       MC     MU    CCSC   CCSU   YGC     YGCT    FGC    FGCT    CGC    CGCT     GCT</span></span>
<span class="line"><span style="color:#79B8FF;">10752.0</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">10752.0</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">0.0</span><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">0.0</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">65536.0</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">5243.4</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">175104.0</span><span style="color:#E1E4E8;">     </span><span style="color:#79B8FF;">0.0</span><span style="color:#E1E4E8;">     </span><span style="color:#79B8FF;">4480.0</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">774.0</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">384.0</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">75.8</span><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">0.000</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">0.000</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">          </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">0.000</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">➜  jstat </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">gc </span><span style="color:#005CC5;">43704</span></span>
<span class="line"><span style="color:#24292E;"> S0C    S1C    S0U    S1U      EC       EU        OC         OU       MC     MU    CCSC   CCSU   YGC     YGCT    FGC    FGCT    CGC    CGCT     GCT</span></span>
<span class="line"><span style="color:#005CC5;">10752.0</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">10752.0</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">0.0</span><span style="color:#24292E;">    </span><span style="color:#005CC5;">0.0</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">65536.0</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">5243.4</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">175104.0</span><span style="color:#24292E;">     </span><span style="color:#005CC5;">0.0</span><span style="color:#24292E;">     </span><span style="color:#005CC5;">4480.0</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">774.0</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">384.0</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">75.8</span><span style="color:#24292E;">       </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">    </span><span style="color:#005CC5;">0.000</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">0.000</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">          </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">    </span><span style="color:#005CC5;">0.000</span></span></code></pre></div><p>参数说明如下表所示：</p><table><thead><tr><th style="text-align:center;"><strong>参数</strong></th><th style="text-align:center;"><strong>说明</strong></th></tr></thead><tbody><tr><td style="text-align:center;">S0C</td><td style="text-align:center;">年轻代中第一个存活区的大小</td></tr><tr><td style="text-align:center;">S1C</td><td style="text-align:center;">年轻代中第二个存活区的大小</td></tr><tr><td style="text-align:center;">S0U</td><td style="text-align:center;">年轻代中第一个存活区已使用的空间（字节）</td></tr><tr><td style="text-align:center;">S1U</td><td style="text-align:center;">年轻代中第二个存活区已使用的空间（字节）</td></tr><tr><td style="text-align:center;">EC</td><td style="text-align:center;">Eden 区大小</td></tr><tr><td style="text-align:center;">EU</td><td style="text-align:center;">年轻代中 Eden 区已使用的空间（字节）</td></tr><tr><td style="text-align:center;">OC</td><td style="text-align:center;">老年代大小</td></tr><tr><td style="text-align:center;">OU</td><td style="text-align:center;">老年代已使用的空间（字节）</td></tr><tr><td style="text-align:center;">YGC</td><td style="text-align:center;">从应用程序启动到采样时 young gc 的次数</td></tr><tr><td style="text-align:center;">YGCT</td><td style="text-align:center;">从应用程序启动到采样时 young gc 的所用的时间（s）</td></tr><tr><td style="text-align:center;">FGC</td><td style="text-align:center;">从应用程序启动到采样时 full gc 的次数</td></tr><tr><td style="text-align:center;">FGCT</td><td style="text-align:center;">从应用程序启动到采样时 full gc 的所用的时间</td></tr><tr><td style="text-align:center;">GCT</td><td style="text-align:center;">从应用程序启动到采样时整个 gc 所用的时间</td></tr></tbody></table><blockquote><p>注意：年轻代的 Eden 区满了会触发 young gc，老年代满了会触发 old gc。full gc 指的是清除整个堆，包括 young 区 和 old 区。</p></blockquote><p>jstat 常用的查询参数有：</p><ul><li><p>-class，查询类加载器信息；</p></li><li><p>-compiler，JIT 相关信息；</p></li><li><p>-gc，GC 堆状态；</p></li><li><p>-gcnew，新生代统计信息；</p></li><li><p>-gcutil，GC 堆统计汇总信息。</p></li></ul><h4 id="_3-jinfo-查询虚拟机参数配置工具" tabindex="-1">3. jinfo（查询虚拟机参数配置工具） <a class="header-anchor" href="#_3-jinfo-查询虚拟机参数配置工具" aria-label="Permalink to &quot;3. jinfo（查询虚拟机参数配置工具）&quot;">​</a></h4><p>jinfo（Configuration Info for Java）用于查看和调整虚拟机各项参数。语法如下：</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">jinfo </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">option</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">pid</span><span style="color:#F97583;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">jinfo </span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">option</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">pid</span><span style="color:#D73A49;">&gt;</span></span></code></pre></div><p>查看 JVM 参数示例如下：</p><div class="language-powershell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">➜  jinfo </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">flags </span><span style="color:#79B8FF;">45129</span></span>
<span class="line"><span style="color:#E1E4E8;">VM Flags:</span></span>
<span class="line"><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">XX:CICompilerCount</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">XX:InitialHeapSize</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">268435456</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">XX:MaxHeapSize</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">4294967296</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">XX:MaxNewSize</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">1431306240</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">XX:MinHeapDeltaBytes</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">524288</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">XX:NewSize</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">89128960</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">XX:OldSize</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">179306496</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">XX:</span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;">UseCompressedClassPointers </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">XX:</span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;">UseCompressedOops </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">XX:</span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;">UseFastUnorderedTimeStamps </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">XX:</span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;">UseParallelGC</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">➜  jinfo </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">flags </span><span style="color:#005CC5;">45129</span></span>
<span class="line"><span style="color:#24292E;">VM Flags:</span></span>
<span class="line"><span style="color:#D73A49;">-</span><span style="color:#24292E;">XX:CICompilerCount</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">3</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">XX:InitialHeapSize</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">268435456</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">XX:MaxHeapSize</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">4294967296</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">XX:MaxNewSize</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">1431306240</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">XX:MinHeapDeltaBytes</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">524288</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">XX:NewSize</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">89128960</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">XX:OldSize</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">179306496</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">XX:</span><span style="color:#D73A49;">+</span><span style="color:#24292E;">UseCompressedClassPointers </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">XX:</span><span style="color:#D73A49;">+</span><span style="color:#24292E;">UseCompressedOops </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">XX:</span><span style="color:#D73A49;">+</span><span style="color:#24292E;">UseFastUnorderedTimeStamps </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">XX:</span><span style="color:#D73A49;">+</span><span style="color:#24292E;">UseParallelGC</span></span></code></pre></div><p>其中 45129 是使用 jps 查询的 LVMID。</p><p>我们可以通过 jinfo -flag [+/-]name 来修改虚拟机的参数值，比如下面的示例：</p><div class="language-powershell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">➜  jinfo </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">flag PrintGC </span><span style="color:#79B8FF;">45129</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 查询是否开启 GC 打印</span></span>
<span class="line"><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">XX:</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">PrintGC</span></span>
<span class="line"><span style="color:#E1E4E8;">➜  jinfo </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">flag </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;">PrintGC </span><span style="color:#79B8FF;">45129</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 开启 GC 打印</span></span>
<span class="line"><span style="color:#E1E4E8;">➜  jinfo </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">flag PrintGC </span><span style="color:#79B8FF;">45129</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 查询是否开启 GC 打印</span></span>
<span class="line"><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">XX:</span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;">PrintGC</span></span>
<span class="line"><span style="color:#E1E4E8;">➜  jinfo </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">flag </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">PrintGC </span><span style="color:#79B8FF;">45129</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 关闭 GC 打印</span></span>
<span class="line"><span style="color:#E1E4E8;">➜  jinfo </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">flag PrintGC </span><span style="color:#79B8FF;">45129</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 查询是否开启 GC 打印</span></span>
<span class="line"><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">XX:</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">PrintGC</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">➜  jinfo </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">flag PrintGC </span><span style="color:#005CC5;">45129</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 查询是否开启 GC 打印</span></span>
<span class="line"><span style="color:#D73A49;">-</span><span style="color:#24292E;">XX:</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">PrintGC</span></span>
<span class="line"><span style="color:#24292E;">➜  jinfo </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">flag </span><span style="color:#D73A49;">+</span><span style="color:#24292E;">PrintGC </span><span style="color:#005CC5;">45129</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 开启 GC 打印</span></span>
<span class="line"><span style="color:#24292E;">➜  jinfo </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">flag PrintGC </span><span style="color:#005CC5;">45129</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 查询是否开启 GC 打印</span></span>
<span class="line"><span style="color:#D73A49;">-</span><span style="color:#24292E;">XX:</span><span style="color:#D73A49;">+</span><span style="color:#24292E;">PrintGC</span></span>
<span class="line"><span style="color:#24292E;">➜  jinfo </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">flag </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">PrintGC </span><span style="color:#005CC5;">45129</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 关闭 GC 打印</span></span>
<span class="line"><span style="color:#24292E;">➜  jinfo </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">flag PrintGC </span><span style="color:#005CC5;">45129</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 查询是否开启 GC 打印</span></span>
<span class="line"><span style="color:#D73A49;">-</span><span style="color:#24292E;">XX:</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">PrintGC</span></span></code></pre></div><h4 id="_4-jmap-堆快照生成工具" tabindex="-1">4. jmap（堆快照生成工具） <a class="header-anchor" href="#_4-jmap-堆快照生成工具" aria-label="Permalink to &quot;4. jmap（堆快照生成工具）&quot;">​</a></h4><p>jmap（Memory Map for Java）用于查询堆的快照信息。</p><p>查询堆信息示例如下：</p><div class="language-powershell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">➜  jmap </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">heap </span><span style="color:#79B8FF;">45129</span></span>
<span class="line"><span style="color:#E1E4E8;">Attaching to </span><span style="color:#F97583;">process</span><span style="color:#E1E4E8;"> ID </span><span style="color:#79B8FF;">45129</span><span style="color:#F97583;">,</span><span style="color:#E1E4E8;"> please wait...</span></span>
<span class="line"><span style="color:#E1E4E8;">Debugger attached successfully.</span></span>
<span class="line"><span style="color:#E1E4E8;">Server compiler detected.</span></span>
<span class="line"><span style="color:#E1E4E8;">JVM version is </span><span style="color:#79B8FF;">25.101</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">b13</span></span>
<span class="line"><span style="color:#E1E4E8;">using thread</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">local object allocation.</span></span>
<span class="line"><span style="color:#F97583;">Parallel</span><span style="color:#E1E4E8;"> GC with </span><span style="color:#79B8FF;">6</span><span style="color:#E1E4E8;"> thread(s)</span></span>
<span class="line"><span style="color:#E1E4E8;">Heap Configuration:</span></span>
<span class="line"><span style="color:#E1E4E8;">   MinHeapFreeRatio         </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#E1E4E8;">   MaxHeapFreeRatio         </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">100</span></span>
<span class="line"><span style="color:#E1E4E8;">   MaxHeapSize              </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">4294967296</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">4096.0</span><span style="color:#F97583;">MB</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">   NewSize                  </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">89128960</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">85.0</span><span style="color:#F97583;">MB</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">   MaxNewSize               </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1431306240</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">1365.0</span><span style="color:#F97583;">MB</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">   OldSize                  </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">179306496</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">171.0</span><span style="color:#F97583;">MB</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">   NewRatio                 </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2</span></span>
<span class="line"><span style="color:#E1E4E8;">   SurvivorRatio            </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">8</span></span>
<span class="line"><span style="color:#E1E4E8;">   MetaspaceSize            </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">21807104</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">20.796875</span><span style="color:#F97583;">MB</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">   CompressedClassSpaceSize </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1073741824</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">1024.0</span><span style="color:#F97583;">MB</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">   MaxMetaspaceSize         </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">17592186044415</span><span style="color:#E1E4E8;"> MB</span></span>
<span class="line"><span style="color:#E1E4E8;">   G1HeapRegionSize         </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">0.0</span><span style="color:#F97583;">MB</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">Heap Usage:</span></span>
<span class="line"><span style="color:#E1E4E8;">PS Young Generation</span></span>
<span class="line"><span style="color:#E1E4E8;">Eden Space:</span></span>
<span class="line"><span style="color:#E1E4E8;">   capacity </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">67108864</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">64.0</span><span style="color:#F97583;">MB</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">   used     </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5369232</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">5.1204986572265625</span><span style="color:#F97583;">MB</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">   free     </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">61739632</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">58.87950134277344</span><span style="color:#F97583;">MB</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">8.000779151916504</span><span style="color:#F97583;">%</span><span style="color:#E1E4E8;"> used</span></span>
<span class="line"><span style="color:#F97583;">From</span><span style="color:#E1E4E8;"> Space:</span></span>
<span class="line"><span style="color:#E1E4E8;">   capacity </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">11010048</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">10.5</span><span style="color:#F97583;">MB</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">   used     </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">0.0</span><span style="color:#F97583;">MB</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">   free     </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">11010048</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">10.5</span><span style="color:#F97583;">MB</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0.0</span><span style="color:#F97583;">%</span><span style="color:#E1E4E8;"> used</span></span>
<span class="line"><span style="color:#E1E4E8;">To Space:</span></span>
<span class="line"><span style="color:#E1E4E8;">   capacity </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">11010048</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">10.5</span><span style="color:#F97583;">MB</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">   used     </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">0.0</span><span style="color:#F97583;">MB</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">   free     </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">11010048</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">10.5</span><span style="color:#F97583;">MB</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0.0</span><span style="color:#F97583;">%</span><span style="color:#E1E4E8;"> used</span></span>
<span class="line"><span style="color:#E1E4E8;">PS Old Generation</span></span>
<span class="line"><span style="color:#E1E4E8;">   capacity </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">179306496</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">171.0</span><span style="color:#F97583;">MB</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">   used     </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">0.0</span><span style="color:#F97583;">MB</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">   free     </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">179306496</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">171.0</span><span style="color:#F97583;">MB</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0.0</span><span style="color:#F97583;">%</span><span style="color:#E1E4E8;"> used</span></span>
<span class="line"></span>
<span class="line"><span style="color:#79B8FF;">2158</span><span style="color:#E1E4E8;"> interned Strings occupying </span><span style="color:#79B8FF;">152472</span><span style="color:#E1E4E8;"> bytes.</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">➜  jmap </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">heap </span><span style="color:#005CC5;">45129</span></span>
<span class="line"><span style="color:#24292E;">Attaching to </span><span style="color:#D73A49;">process</span><span style="color:#24292E;"> ID </span><span style="color:#005CC5;">45129</span><span style="color:#D73A49;">,</span><span style="color:#24292E;"> please wait...</span></span>
<span class="line"><span style="color:#24292E;">Debugger attached successfully.</span></span>
<span class="line"><span style="color:#24292E;">Server compiler detected.</span></span>
<span class="line"><span style="color:#24292E;">JVM version is </span><span style="color:#005CC5;">25.101</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">b13</span></span>
<span class="line"><span style="color:#24292E;">using thread</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">local object allocation.</span></span>
<span class="line"><span style="color:#D73A49;">Parallel</span><span style="color:#24292E;"> GC with </span><span style="color:#005CC5;">6</span><span style="color:#24292E;"> thread(s)</span></span>
<span class="line"><span style="color:#24292E;">Heap Configuration:</span></span>
<span class="line"><span style="color:#24292E;">   MinHeapFreeRatio         </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#24292E;">   MaxHeapFreeRatio         </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">100</span></span>
<span class="line"><span style="color:#24292E;">   MaxHeapSize              </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">4294967296</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">4096.0</span><span style="color:#D73A49;">MB</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">   NewSize                  </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">89128960</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">85.0</span><span style="color:#D73A49;">MB</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">   MaxNewSize               </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1431306240</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">1365.0</span><span style="color:#D73A49;">MB</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">   OldSize                  </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">179306496</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">171.0</span><span style="color:#D73A49;">MB</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">   NewRatio                 </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2</span></span>
<span class="line"><span style="color:#24292E;">   SurvivorRatio            </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">8</span></span>
<span class="line"><span style="color:#24292E;">   MetaspaceSize            </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">21807104</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">20.796875</span><span style="color:#D73A49;">MB</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">   CompressedClassSpaceSize </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1073741824</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">1024.0</span><span style="color:#D73A49;">MB</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">   MaxMetaspaceSize         </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">17592186044415</span><span style="color:#24292E;"> MB</span></span>
<span class="line"><span style="color:#24292E;">   G1HeapRegionSize         </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">0.0</span><span style="color:#D73A49;">MB</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">Heap Usage:</span></span>
<span class="line"><span style="color:#24292E;">PS Young Generation</span></span>
<span class="line"><span style="color:#24292E;">Eden Space:</span></span>
<span class="line"><span style="color:#24292E;">   capacity </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">67108864</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">64.0</span><span style="color:#D73A49;">MB</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">   used     </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5369232</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">5.1204986572265625</span><span style="color:#D73A49;">MB</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">   free     </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">61739632</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">58.87950134277344</span><span style="color:#D73A49;">MB</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#005CC5;">8.000779151916504</span><span style="color:#D73A49;">%</span><span style="color:#24292E;"> used</span></span>
<span class="line"><span style="color:#D73A49;">From</span><span style="color:#24292E;"> Space:</span></span>
<span class="line"><span style="color:#24292E;">   capacity </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">11010048</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">10.5</span><span style="color:#D73A49;">MB</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">   used     </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">0.0</span><span style="color:#D73A49;">MB</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">   free     </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">11010048</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">10.5</span><span style="color:#D73A49;">MB</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#005CC5;">0.0</span><span style="color:#D73A49;">%</span><span style="color:#24292E;"> used</span></span>
<span class="line"><span style="color:#24292E;">To Space:</span></span>
<span class="line"><span style="color:#24292E;">   capacity </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">11010048</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">10.5</span><span style="color:#D73A49;">MB</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">   used     </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">0.0</span><span style="color:#D73A49;">MB</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">   free     </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">11010048</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">10.5</span><span style="color:#D73A49;">MB</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#005CC5;">0.0</span><span style="color:#D73A49;">%</span><span style="color:#24292E;"> used</span></span>
<span class="line"><span style="color:#24292E;">PS Old Generation</span></span>
<span class="line"><span style="color:#24292E;">   capacity </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">179306496</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">171.0</span><span style="color:#D73A49;">MB</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">   used     </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">0.0</span><span style="color:#D73A49;">MB</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">   free     </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">179306496</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">171.0</span><span style="color:#D73A49;">MB</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#005CC5;">0.0</span><span style="color:#D73A49;">%</span><span style="color:#24292E;"> used</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;">2158</span><span style="color:#24292E;"> interned Strings occupying </span><span style="color:#005CC5;">152472</span><span style="color:#24292E;"> bytes.</span></span></code></pre></div><p>我们也可以直接生成堆快照文件，示例如下：</p><div class="language-powershell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">➜  jmap </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">dump:format</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">b</span><span style="color:#F97583;">,</span><span style="color:#E1E4E8;">file</span><span style="color:#F97583;">=/</span><span style="color:#E1E4E8;">Users</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">admin</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Documents</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">2020.</span><span style="color:#E1E4E8;">dump </span><span style="color:#79B8FF;">47380</span></span>
<span class="line"><span style="color:#E1E4E8;">Dumping heap to </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Users</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">admin</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Documents</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">2020.</span><span style="color:#E1E4E8;">dump ...</span></span>
<span class="line"><span style="color:#E1E4E8;">Heap dump file created</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">➜  jmap </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">dump:format</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">b</span><span style="color:#D73A49;">,</span><span style="color:#24292E;">file</span><span style="color:#D73A49;">=/</span><span style="color:#24292E;">Users</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">admin</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Documents</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">2020.</span><span style="color:#24292E;">dump </span><span style="color:#005CC5;">47380</span></span>
<span class="line"><span style="color:#24292E;">Dumping heap to </span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Users</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">admin</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Documents</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">2020.</span><span style="color:#24292E;">dump ...</span></span>
<span class="line"><span style="color:#24292E;">Heap dump file created</span></span></code></pre></div><h4 id="_5-jhat-堆快照分析功能" tabindex="-1">5. jhat（堆快照分析功能） <a class="header-anchor" href="#_5-jhat-堆快照分析功能" aria-label="Permalink to &quot;5. jhat（堆快照分析功能）&quot;">​</a></h4><p>jhat（JVM Heap Analysis Tool，堆快照分析工具）和 jmap 搭配使用，用于启动一个 web 站点来分析 jmap 生成的快照文件。</p><p>执行示例如下：</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">jhat </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Users</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">admin</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Documents</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">2020.dump</span></span>
<span class="line"><span style="color:#E1E4E8;">Reading from </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Users</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">admin</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Documents</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">2020.dump...</span></span>
<span class="line"><span style="color:#E1E4E8;">Dump file created Tue May </span><span style="color:#79B8FF;">26</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">16</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">12</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">41</span><span style="color:#E1E4E8;"> CST </span><span style="color:#79B8FF;">2020</span></span>
<span class="line"><span style="color:#E1E4E8;">Snapshot read, resolving...</span></span>
<span class="line"><span style="color:#E1E4E8;">Resolving </span><span style="color:#79B8FF;">17797</span><span style="color:#E1E4E8;"> objects...</span></span>
<span class="line"><span style="color:#E1E4E8;">Chasing references, expect </span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;"> dots...</span></span>
<span class="line"><span style="color:#E1E4E8;">Eliminating duplicate references...</span></span>
<span class="line"><span style="color:#E1E4E8;">Snapshot resolved.</span></span>
<span class="line"><span style="color:#E1E4E8;">Started HTTP server on port </span><span style="color:#79B8FF;">7000</span></span>
<span class="line"><span style="color:#E1E4E8;">Server is ready.</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">jhat </span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Users</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">admin</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Documents</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">2020.dump</span></span>
<span class="line"><span style="color:#24292E;">Reading from </span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Users</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">admin</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Documents</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">2020.dump...</span></span>
<span class="line"><span style="color:#24292E;">Dump file created Tue May </span><span style="color:#005CC5;">26</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">16</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">12</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">41</span><span style="color:#24292E;"> CST </span><span style="color:#005CC5;">2020</span></span>
<span class="line"><span style="color:#24292E;">Snapshot read, resolving...</span></span>
<span class="line"><span style="color:#24292E;">Resolving </span><span style="color:#005CC5;">17797</span><span style="color:#24292E;"> objects...</span></span>
<span class="line"><span style="color:#24292E;">Chasing references, expect </span><span style="color:#005CC5;">3</span><span style="color:#24292E;"> dots...</span></span>
<span class="line"><span style="color:#24292E;">Eliminating duplicate references...</span></span>
<span class="line"><span style="color:#24292E;">Snapshot resolved.</span></span>
<span class="line"><span style="color:#24292E;">Started HTTP server on port </span><span style="color:#005CC5;">7000</span></span>
<span class="line"><span style="color:#24292E;">Server is ready.</span></span></code></pre></div><p>上述信息表示 jhat 启动了一个 http 的服务器端口为 7000 的站点来展示信息，此时我们在浏览器中输入：<a href="http://localhost:7000/" target="_blank" rel="noreferrer">http://localhost:7000/</a>，会看到如下图所示的信息：</p>`,36),C=l(`<h4 id="_6-jstack-查询虚拟机当前的线程快照信息" tabindex="-1">6. jstack（查询虚拟机当前的线程快照信息） <a class="header-anchor" href="#_6-jstack-查询虚拟机当前的线程快照信息" aria-label="Permalink to &quot;6. jstack（查询虚拟机当前的线程快照信息）&quot;">​</a></h4><p>jstack（Stack Trace for Java）用于查看当前虚拟机的线程快照，用它可以排查线程的执行状况，例如排查死锁、死循环等问题。</p><p>比如，我们先写一段死锁的代码：</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">NativeOptimize</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">private</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">static</span><span style="color:#E1E4E8;"> Object obj1 </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Object</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">private</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">static</span><span style="color:#E1E4E8;"> Object obj2 </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Object</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">static</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">main</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">String</span><span style="color:#E1E4E8;">[] </span><span style="color:#FFAB70;">args</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Thread</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Runnable</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">            @</span><span style="color:#F97583;">Override</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">run</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">synchronized</span><span style="color:#E1E4E8;"> (obj2) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                    System.out.</span><span style="color:#B392F0;">println</span><span style="color:#E1E4E8;">(Thread.</span><span style="color:#B392F0;">currentThread</span><span style="color:#E1E4E8;">().</span><span style="color:#B392F0;">getName</span><span style="color:#E1E4E8;">() </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;锁住 obj2&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">                    </span><span style="color:#F97583;">try</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">                        Thread.</span><span style="color:#B392F0;">sleep</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">1000</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">                    } </span><span style="color:#F97583;">catch</span><span style="color:#E1E4E8;"> (InterruptedException </span><span style="color:#FFAB70;">e</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                        e.</span><span style="color:#B392F0;">printStackTrace</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">                    }</span></span>
<span class="line"><span style="color:#E1E4E8;">                    </span><span style="color:#F97583;">synchronized</span><span style="color:#E1E4E8;"> (obj1) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                        </span><span style="color:#6A737D;">// 执行不到这里</span></span>
<span class="line"><span style="color:#E1E4E8;">                        System.out.</span><span style="color:#B392F0;">println</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;1秒钟后，&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> Thread.</span><span style="color:#B392F0;">currentThread</span><span style="color:#E1E4E8;">().</span><span style="color:#B392F0;">getName</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#E1E4E8;">                                </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;锁住 obj1&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">                    }</span></span>
<span class="line"><span style="color:#E1E4E8;">                }</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"><span style="color:#E1E4E8;">        }).</span><span style="color:#B392F0;">start</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">synchronized</span><span style="color:#E1E4E8;"> (obj1) {</span></span>
<span class="line"><span style="color:#E1E4E8;">            System.out.</span><span style="color:#B392F0;">println</span><span style="color:#E1E4E8;">(Thread.</span><span style="color:#B392F0;">currentThread</span><span style="color:#E1E4E8;">().</span><span style="color:#B392F0;">getName</span><span style="color:#E1E4E8;">() </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;锁住 obj1&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">try</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">                Thread.</span><span style="color:#B392F0;">sleep</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">1000</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">            } </span><span style="color:#F97583;">catch</span><span style="color:#E1E4E8;"> (InterruptedException </span><span style="color:#FFAB70;">e</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                e.</span><span style="color:#B392F0;">printStackTrace</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">synchronized</span><span style="color:#E1E4E8;"> (obj2) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#6A737D;">// 执行不到这里</span></span>
<span class="line"><span style="color:#E1E4E8;">                System.out.</span><span style="color:#B392F0;">println</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;1秒钟后，&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> Thread.</span><span style="color:#B392F0;">currentThread</span><span style="color:#E1E4E8;">().</span><span style="color:#B392F0;">getName</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#E1E4E8;">                        </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;锁住 obj2&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">NativeOptimize</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> Object obj1 </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Object</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> Object obj2 </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Object</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">main</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">String</span><span style="color:#24292E;">[] </span><span style="color:#E36209;">args</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Thread</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Runnable</span><span style="color:#24292E;">() {</span></span>
<span class="line"><span style="color:#24292E;">            @</span><span style="color:#D73A49;">Override</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">run</span><span style="color:#24292E;">() {</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#D73A49;">synchronized</span><span style="color:#24292E;"> (obj2) {</span></span>
<span class="line"><span style="color:#24292E;">                    System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(Thread.</span><span style="color:#6F42C1;">currentThread</span><span style="color:#24292E;">().</span><span style="color:#6F42C1;">getName</span><span style="color:#24292E;">() </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;锁住 obj2&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">                    </span><span style="color:#D73A49;">try</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">                        Thread.</span><span style="color:#6F42C1;">sleep</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">1000</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">                    } </span><span style="color:#D73A49;">catch</span><span style="color:#24292E;"> (InterruptedException </span><span style="color:#E36209;">e</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">                        e.</span><span style="color:#6F42C1;">printStackTrace</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">                    }</span></span>
<span class="line"><span style="color:#24292E;">                    </span><span style="color:#D73A49;">synchronized</span><span style="color:#24292E;"> (obj1) {</span></span>
<span class="line"><span style="color:#24292E;">                        </span><span style="color:#6A737D;">// 执行不到这里</span></span>
<span class="line"><span style="color:#24292E;">                        System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;1秒钟后，&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> Thread.</span><span style="color:#6F42C1;">currentThread</span><span style="color:#24292E;">().</span><span style="color:#6F42C1;">getName</span><span style="color:#24292E;">()</span></span>
<span class="line"><span style="color:#24292E;">                                </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;锁住 obj1&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">                    }</span></span>
<span class="line"><span style="color:#24292E;">                }</span></span>
<span class="line"><span style="color:#24292E;">            }</span></span>
<span class="line"><span style="color:#24292E;">        }).</span><span style="color:#6F42C1;">start</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">synchronized</span><span style="color:#24292E;"> (obj1) {</span></span>
<span class="line"><span style="color:#24292E;">            System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(Thread.</span><span style="color:#6F42C1;">currentThread</span><span style="color:#24292E;">().</span><span style="color:#6F42C1;">getName</span><span style="color:#24292E;">() </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;锁住 obj1&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">try</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">                Thread.</span><span style="color:#6F42C1;">sleep</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">1000</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">            } </span><span style="color:#D73A49;">catch</span><span style="color:#24292E;"> (InterruptedException </span><span style="color:#E36209;">e</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">                e.</span><span style="color:#6F42C1;">printStackTrace</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">            }</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">synchronized</span><span style="color:#24292E;"> (obj2) {</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#6A737D;">// 执行不到这里</span></span>
<span class="line"><span style="color:#24292E;">                System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;1秒钟后，&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> Thread.</span><span style="color:#6F42C1;">currentThread</span><span style="color:#24292E;">().</span><span style="color:#6F42C1;">getName</span><span style="color:#24292E;">()</span></span>
<span class="line"><span style="color:#24292E;">                        </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;锁住 obj2&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">            }</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><p>以上程序的执行结果如下：</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">main：锁住 obj1</span></span>
<span class="line"><span style="color:#E1E4E8;">Thread</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">：锁住 obj2</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">main：锁住 obj1</span></span>
<span class="line"><span style="color:#24292E;">Thread</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">：锁住 obj2</span></span></code></pre></div><p>此时我们使用 jstack 工具打印一下当前线程的快照信息，结果如下：</p><div class="language-powershell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">➜  bin jstack </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">l </span><span style="color:#79B8FF;">50016</span></span>
<span class="line"><span style="color:#79B8FF;">2020</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">05</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">26</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">18</span><span style="color:#E1E4E8;">:</span><span style="color:#79B8FF;">01</span><span style="color:#E1E4E8;">:</span><span style="color:#79B8FF;">41</span></span>
<span class="line"><span style="color:#E1E4E8;">Full thread dump Java HotSpot(TM) </span><span style="color:#79B8FF;">64</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">Bit Server VM (</span><span style="color:#79B8FF;">25.101</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">b13 mixed mode):</span></span>
<span class="line"><span style="color:#9ECBFF;">&quot;Attach Listener&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">#10 daemon prio=9 os_prio=31 tid=0x00007f8c00840800 nid=0x3c03 waiting on condition [0x0000000000000000]</span></span>
<span class="line"><span style="color:#E1E4E8;">   java.lang.Thread.State: RUNNABLE</span></span>
<span class="line"><span style="color:#E1E4E8;">   Locked ownable synchronizers:</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> None</span></span>
<span class="line"><span style="color:#9ECBFF;">&quot;Thread-0&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">#9 prio=5 os_prio=31 tid=0x00007f8c00840000 nid=0x3e03 waiting for monitor entry [0x00007000100c8000]</span></span>
<span class="line"><span style="color:#E1E4E8;">   java.lang.Thread.State: BLOCKED (on object monitor)</span></span>
<span class="line"><span style="color:#E1E4E8;">	at com.example.optimize.NativeOptimize$1.run(NativeOptimize.java:</span><span style="color:#79B8FF;">25</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> waiting to lock </span><span style="color:#F97583;">&lt;</span><span style="color:#79B8FF;">0x000000076abb62d0</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> (a java.lang.Object)</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> locked </span><span style="color:#F97583;">&lt;</span><span style="color:#79B8FF;">0x000000076abb62e0</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> (a java.lang.Object)</span></span>
<span class="line"><span style="color:#E1E4E8;">	at java.lang.Thread.run(Thread.java:</span><span style="color:#79B8FF;">745</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">   Locked ownable synchronizers:</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> None</span></span>
<span class="line"><span style="color:#9ECBFF;">&quot;Service Thread&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">#8 daemon prio=9 os_prio=31 tid=0x00007f8c01814800 nid=0x4103 runnable [0x0000000000000000]</span></span>
<span class="line"><span style="color:#E1E4E8;">   java.lang.Thread.State: RUNNABLE</span></span>
<span class="line"><span style="color:#E1E4E8;">   Locked ownable synchronizers:</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> None</span></span>
<span class="line"><span style="color:#9ECBFF;">&quot;C1 CompilerThread2&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">#7 daemon prio=9 os_prio=31 tid=0x00007f8c0283c800 nid=0x4303 waiting on condition [0x0000000000000000]</span></span>
<span class="line"><span style="color:#E1E4E8;">   java.lang.Thread.State: RUNNABLE</span></span>
<span class="line"><span style="color:#E1E4E8;">   Locked ownable synchronizers:</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> None</span></span>
<span class="line"><span style="color:#9ECBFF;">&quot;C2 CompilerThread1&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">#6 daemon prio=9 os_prio=31 tid=0x00007f8c0300a800 nid=0x4403 waiting on condition [0x0000000000000000]</span></span>
<span class="line"><span style="color:#E1E4E8;">   java.lang.Thread.State: RUNNABLE</span></span>
<span class="line"><span style="color:#E1E4E8;">   Locked ownable synchronizers:</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> None</span></span>
<span class="line"><span style="color:#9ECBFF;">&quot;C2 CompilerThread0&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">#5 daemon prio=9 os_prio=31 tid=0x00007f8c0283c000 nid=0x3603 waiting on condition [0x0000000000000000]</span></span>
<span class="line"><span style="color:#E1E4E8;">   java.lang.Thread.State: RUNNABLE</span></span>
<span class="line"><span style="color:#E1E4E8;">   Locked ownable synchronizers:</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> None</span></span>
<span class="line"><span style="color:#9ECBFF;">&quot;Signal Dispatcher&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">#4 daemon prio=9 os_prio=31 tid=0x00007f8c0283b000 nid=0x4603 runnable [0x0000000000000000]</span></span>
<span class="line"><span style="color:#E1E4E8;">   java.lang.Thread.State: RUNNABLE</span></span>
<span class="line"><span style="color:#E1E4E8;">   Locked ownable synchronizers:</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> None</span></span>
<span class="line"><span style="color:#9ECBFF;">&quot;Finalizer&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">#3 daemon prio=8 os_prio=31 tid=0x00007f8c03001000 nid=0x5003 in Object.wait() [0x000070000f8ad000]</span></span>
<span class="line"><span style="color:#E1E4E8;">   java.lang.Thread.State: WAITING (on object monitor)</span></span>
<span class="line"><span style="color:#E1E4E8;">	at java.lang.Object.wait(Native Method)</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> waiting on </span><span style="color:#F97583;">&lt;</span><span style="color:#79B8FF;">0x000000076ab08ee0</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> (a java.lang.ref.ReferenceQueue$Lock)</span></span>
<span class="line"><span style="color:#E1E4E8;">	at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:</span><span style="color:#79B8FF;">143</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> locked </span><span style="color:#F97583;">&lt;</span><span style="color:#79B8FF;">0x000000076ab08ee0</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> (a java.lang.ref.ReferenceQueue$Lock)</span></span>
<span class="line"><span style="color:#E1E4E8;">	at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:</span><span style="color:#79B8FF;">164</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">	at java.lang.ref.Finalizer$FinalizerThread.run(Finalizer.java:</span><span style="color:#79B8FF;">209</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">   Locked ownable synchronizers:</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> None</span></span>
<span class="line"><span style="color:#9ECBFF;">&quot;Reference Handler&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">#2 daemon prio=10 os_prio=31 tid=0x00007f8c03000000 nid=0x2f03 in Object.wait() [0x000070000f7aa000]</span></span>
<span class="line"><span style="color:#E1E4E8;">   java.lang.Thread.State: WAITING (on object monitor)</span></span>
<span class="line"><span style="color:#E1E4E8;">	at java.lang.Object.wait(Native Method)</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> waiting on </span><span style="color:#F97583;">&lt;</span><span style="color:#79B8FF;">0x000000076ab06b50</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> (a java.lang.ref.Reference$Lock)</span></span>
<span class="line"><span style="color:#E1E4E8;">	at java.lang.Object.wait(Object.java:</span><span style="color:#79B8FF;">502</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">	at java.lang.ref.Reference.tryHandlePending(Reference.java:</span><span style="color:#79B8FF;">191</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> locked </span><span style="color:#F97583;">&lt;</span><span style="color:#79B8FF;">0x000000076ab06b50</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> (a java.lang.ref.Reference$Lock)</span></span>
<span class="line"><span style="color:#E1E4E8;">	at java.lang.ref.Reference$ReferenceHandler.run(Reference.java:</span><span style="color:#79B8FF;">153</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">   Locked ownable synchronizers:</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> None</span></span>
<span class="line"><span style="color:#9ECBFF;">&quot;main&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">#1 prio=5 os_prio=31 tid=0x00007f8c00802800 nid=0x1003 waiting for monitor entry [0x000070000ef92000]</span></span>
<span class="line"><span style="color:#E1E4E8;">   java.lang.Thread.State: BLOCKED (on object monitor)</span></span>
<span class="line"><span style="color:#E1E4E8;">	at com.example.optimize.NativeOptimize.main(NativeOptimize.java:</span><span style="color:#79B8FF;">41</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> waiting to lock </span><span style="color:#F97583;">&lt;</span><span style="color:#79B8FF;">0x000000076abb62e0</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> (a java.lang.Object)</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> locked </span><span style="color:#F97583;">&lt;</span><span style="color:#79B8FF;">0x000000076abb62d0</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> (a java.lang.Object)</span></span>
<span class="line"><span style="color:#E1E4E8;">   Locked ownable synchronizers:</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> None</span></span>
<span class="line"><span style="color:#9ECBFF;">&quot;VM Thread&quot;</span><span style="color:#E1E4E8;"> os_prio</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">31</span><span style="color:#E1E4E8;"> tid</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">0x00007f8c01008800</span><span style="color:#E1E4E8;"> nid</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">0x2e03</span><span style="color:#E1E4E8;"> runnable</span></span>
<span class="line"><span style="color:#9ECBFF;">&quot;GC task thread#0 (ParallelGC)&quot;</span><span style="color:#E1E4E8;"> os_prio</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">31</span><span style="color:#E1E4E8;"> tid</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">0x00007f8c00803000</span><span style="color:#E1E4E8;"> nid</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">0x2007</span><span style="color:#E1E4E8;"> runnable</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9ECBFF;">&quot;GC task thread#1 (ParallelGC)&quot;</span><span style="color:#E1E4E8;"> os_prio</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">31</span><span style="color:#E1E4E8;"> tid</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">0x00007f8c00006800</span><span style="color:#E1E4E8;"> nid</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">0x2403</span><span style="color:#E1E4E8;"> runnable</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9ECBFF;">&quot;GC task thread#2 (ParallelGC)&quot;</span><span style="color:#E1E4E8;"> os_prio</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">31</span><span style="color:#E1E4E8;"> tid</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">0x00007f8c01800800</span><span style="color:#E1E4E8;"> nid</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">0x2303</span><span style="color:#E1E4E8;"> runnable</span></span>
<span class="line"><span style="color:#9ECBFF;">&quot;GC task thread#3 (ParallelGC)&quot;</span><span style="color:#E1E4E8;"> os_prio</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">31</span><span style="color:#E1E4E8;"> tid</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">0x00007f8c01801800</span><span style="color:#E1E4E8;"> nid</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">0x2a03</span><span style="color:#E1E4E8;"> runnable</span></span>
<span class="line"><span style="color:#9ECBFF;">&quot;GC task thread#4 (ParallelGC)&quot;</span><span style="color:#E1E4E8;"> os_prio</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">31</span><span style="color:#E1E4E8;"> tid</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">0x00007f8c01802000</span><span style="color:#E1E4E8;"> nid</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">0x5403</span><span style="color:#E1E4E8;"> runnable</span></span>
<span class="line"><span style="color:#9ECBFF;">&quot;GC task thread#5 (ParallelGC)&quot;</span><span style="color:#E1E4E8;"> os_prio</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">31</span><span style="color:#E1E4E8;"> tid</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">0x00007f8c01006800</span><span style="color:#E1E4E8;"> nid</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">0x2d03</span><span style="color:#E1E4E8;"> runnable</span></span>
<span class="line"><span style="color:#9ECBFF;">&quot;VM Periodic Task Thread&quot;</span><span style="color:#E1E4E8;"> os_prio</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">31</span><span style="color:#E1E4E8;"> tid</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">0x00007f8c00010800</span><span style="color:#E1E4E8;"> nid</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">0x3803</span><span style="color:#E1E4E8;"> waiting on condition</span></span>
<span class="line"><span style="color:#E1E4E8;">JNI global references: </span><span style="color:#79B8FF;">6</span></span>
<span class="line"><span style="color:#E1E4E8;">Found one Java</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">level deadlock:</span></span>
<span class="line"><span style="color:#F97583;">=============================</span></span>
<span class="line"><span style="color:#9ECBFF;">&quot;Thread-0&quot;</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  waiting to lock monitor </span><span style="color:#79B8FF;">0x00007f8c000102a8</span><span style="color:#E1E4E8;"> (object </span><span style="color:#79B8FF;">0x000000076abb62d0</span><span style="color:#F97583;">,</span><span style="color:#E1E4E8;"> a java.lang.Object)</span><span style="color:#F97583;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  which is held by </span><span style="color:#9ECBFF;">&quot;main&quot;</span></span>
<span class="line"><span style="color:#9ECBFF;">&quot;main&quot;</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  waiting to lock monitor </span><span style="color:#79B8FF;">0x00007f8c0000ed58</span><span style="color:#E1E4E8;"> (object </span><span style="color:#79B8FF;">0x000000076abb62e0</span><span style="color:#F97583;">,</span><span style="color:#E1E4E8;"> a java.lang.Object)</span><span style="color:#F97583;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  which is held by </span><span style="color:#9ECBFF;">&quot;Thread-0&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">Java stack information </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> the threads listed above:</span></span>
<span class="line"><span style="color:#F97583;">===================================================</span></span>
<span class="line"><span style="color:#9ECBFF;">&quot;Thread-0&quot;</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">	at com.example.optimize.NativeOptimize$1.run(NativeOptimize.java:</span><span style="color:#79B8FF;">25</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> waiting to lock </span><span style="color:#F97583;">&lt;</span><span style="color:#79B8FF;">0x000000076abb62d0</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> (a java.lang.Object)</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> locked </span><span style="color:#F97583;">&lt;</span><span style="color:#79B8FF;">0x000000076abb62e0</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> (a java.lang.Object)</span></span>
<span class="line"><span style="color:#E1E4E8;">	at java.lang.Thread.run(Thread.java:</span><span style="color:#79B8FF;">745</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#9ECBFF;">&quot;main&quot;</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">	at com.example.optimize.NativeOptimize.main(NativeOptimize.java:</span><span style="color:#79B8FF;">41</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> waiting to lock </span><span style="color:#F97583;">&lt;</span><span style="color:#79B8FF;">0x000000076abb62e0</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> (a java.lang.Object)</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> locked </span><span style="color:#F97583;">&lt;</span><span style="color:#79B8FF;">0x000000076abb62d0</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> (a java.lang.Object)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">Found </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> deadlock.</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">➜  bin jstack </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">l </span><span style="color:#005CC5;">50016</span></span>
<span class="line"><span style="color:#005CC5;">2020</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">05</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">26</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">18</span><span style="color:#24292E;">:</span><span style="color:#005CC5;">01</span><span style="color:#24292E;">:</span><span style="color:#005CC5;">41</span></span>
<span class="line"><span style="color:#24292E;">Full thread dump Java HotSpot(TM) </span><span style="color:#005CC5;">64</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">Bit Server VM (</span><span style="color:#005CC5;">25.101</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">b13 mixed mode):</span></span>
<span class="line"><span style="color:#032F62;">&quot;Attach Listener&quot;</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#10 daemon prio=9 os_prio=31 tid=0x00007f8c00840800 nid=0x3c03 waiting on condition [0x0000000000000000]</span></span>
<span class="line"><span style="color:#24292E;">   java.lang.Thread.State: RUNNABLE</span></span>
<span class="line"><span style="color:#24292E;">   Locked ownable synchronizers:</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> None</span></span>
<span class="line"><span style="color:#032F62;">&quot;Thread-0&quot;</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#9 prio=5 os_prio=31 tid=0x00007f8c00840000 nid=0x3e03 waiting for monitor entry [0x00007000100c8000]</span></span>
<span class="line"><span style="color:#24292E;">   java.lang.Thread.State: BLOCKED (on object monitor)</span></span>
<span class="line"><span style="color:#24292E;">	at com.example.optimize.NativeOptimize$1.run(NativeOptimize.java:</span><span style="color:#005CC5;">25</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> waiting to lock </span><span style="color:#D73A49;">&lt;</span><span style="color:#005CC5;">0x000000076abb62d0</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> (a java.lang.Object)</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> locked </span><span style="color:#D73A49;">&lt;</span><span style="color:#005CC5;">0x000000076abb62e0</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> (a java.lang.Object)</span></span>
<span class="line"><span style="color:#24292E;">	at java.lang.Thread.run(Thread.java:</span><span style="color:#005CC5;">745</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">   Locked ownable synchronizers:</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> None</span></span>
<span class="line"><span style="color:#032F62;">&quot;Service Thread&quot;</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#8 daemon prio=9 os_prio=31 tid=0x00007f8c01814800 nid=0x4103 runnable [0x0000000000000000]</span></span>
<span class="line"><span style="color:#24292E;">   java.lang.Thread.State: RUNNABLE</span></span>
<span class="line"><span style="color:#24292E;">   Locked ownable synchronizers:</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> None</span></span>
<span class="line"><span style="color:#032F62;">&quot;C1 CompilerThread2&quot;</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#7 daemon prio=9 os_prio=31 tid=0x00007f8c0283c800 nid=0x4303 waiting on condition [0x0000000000000000]</span></span>
<span class="line"><span style="color:#24292E;">   java.lang.Thread.State: RUNNABLE</span></span>
<span class="line"><span style="color:#24292E;">   Locked ownable synchronizers:</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> None</span></span>
<span class="line"><span style="color:#032F62;">&quot;C2 CompilerThread1&quot;</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#6 daemon prio=9 os_prio=31 tid=0x00007f8c0300a800 nid=0x4403 waiting on condition [0x0000000000000000]</span></span>
<span class="line"><span style="color:#24292E;">   java.lang.Thread.State: RUNNABLE</span></span>
<span class="line"><span style="color:#24292E;">   Locked ownable synchronizers:</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> None</span></span>
<span class="line"><span style="color:#032F62;">&quot;C2 CompilerThread0&quot;</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#5 daemon prio=9 os_prio=31 tid=0x00007f8c0283c000 nid=0x3603 waiting on condition [0x0000000000000000]</span></span>
<span class="line"><span style="color:#24292E;">   java.lang.Thread.State: RUNNABLE</span></span>
<span class="line"><span style="color:#24292E;">   Locked ownable synchronizers:</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> None</span></span>
<span class="line"><span style="color:#032F62;">&quot;Signal Dispatcher&quot;</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#4 daemon prio=9 os_prio=31 tid=0x00007f8c0283b000 nid=0x4603 runnable [0x0000000000000000]</span></span>
<span class="line"><span style="color:#24292E;">   java.lang.Thread.State: RUNNABLE</span></span>
<span class="line"><span style="color:#24292E;">   Locked ownable synchronizers:</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> None</span></span>
<span class="line"><span style="color:#032F62;">&quot;Finalizer&quot;</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#3 daemon prio=8 os_prio=31 tid=0x00007f8c03001000 nid=0x5003 in Object.wait() [0x000070000f8ad000]</span></span>
<span class="line"><span style="color:#24292E;">   java.lang.Thread.State: WAITING (on object monitor)</span></span>
<span class="line"><span style="color:#24292E;">	at java.lang.Object.wait(Native Method)</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> waiting on </span><span style="color:#D73A49;">&lt;</span><span style="color:#005CC5;">0x000000076ab08ee0</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> (a java.lang.ref.ReferenceQueue$Lock)</span></span>
<span class="line"><span style="color:#24292E;">	at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:</span><span style="color:#005CC5;">143</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> locked </span><span style="color:#D73A49;">&lt;</span><span style="color:#005CC5;">0x000000076ab08ee0</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> (a java.lang.ref.ReferenceQueue$Lock)</span></span>
<span class="line"><span style="color:#24292E;">	at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:</span><span style="color:#005CC5;">164</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">	at java.lang.ref.Finalizer$FinalizerThread.run(Finalizer.java:</span><span style="color:#005CC5;">209</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">   Locked ownable synchronizers:</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> None</span></span>
<span class="line"><span style="color:#032F62;">&quot;Reference Handler&quot;</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#2 daemon prio=10 os_prio=31 tid=0x00007f8c03000000 nid=0x2f03 in Object.wait() [0x000070000f7aa000]</span></span>
<span class="line"><span style="color:#24292E;">   java.lang.Thread.State: WAITING (on object monitor)</span></span>
<span class="line"><span style="color:#24292E;">	at java.lang.Object.wait(Native Method)</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> waiting on </span><span style="color:#D73A49;">&lt;</span><span style="color:#005CC5;">0x000000076ab06b50</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> (a java.lang.ref.Reference$Lock)</span></span>
<span class="line"><span style="color:#24292E;">	at java.lang.Object.wait(Object.java:</span><span style="color:#005CC5;">502</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">	at java.lang.ref.Reference.tryHandlePending(Reference.java:</span><span style="color:#005CC5;">191</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> locked </span><span style="color:#D73A49;">&lt;</span><span style="color:#005CC5;">0x000000076ab06b50</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> (a java.lang.ref.Reference$Lock)</span></span>
<span class="line"><span style="color:#24292E;">	at java.lang.ref.Reference$ReferenceHandler.run(Reference.java:</span><span style="color:#005CC5;">153</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">   Locked ownable synchronizers:</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> None</span></span>
<span class="line"><span style="color:#032F62;">&quot;main&quot;</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#1 prio=5 os_prio=31 tid=0x00007f8c00802800 nid=0x1003 waiting for monitor entry [0x000070000ef92000]</span></span>
<span class="line"><span style="color:#24292E;">   java.lang.Thread.State: BLOCKED (on object monitor)</span></span>
<span class="line"><span style="color:#24292E;">	at com.example.optimize.NativeOptimize.main(NativeOptimize.java:</span><span style="color:#005CC5;">41</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> waiting to lock </span><span style="color:#D73A49;">&lt;</span><span style="color:#005CC5;">0x000000076abb62e0</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> (a java.lang.Object)</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> locked </span><span style="color:#D73A49;">&lt;</span><span style="color:#005CC5;">0x000000076abb62d0</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> (a java.lang.Object)</span></span>
<span class="line"><span style="color:#24292E;">   Locked ownable synchronizers:</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> None</span></span>
<span class="line"><span style="color:#032F62;">&quot;VM Thread&quot;</span><span style="color:#24292E;"> os_prio</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">31</span><span style="color:#24292E;"> tid</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">0x00007f8c01008800</span><span style="color:#24292E;"> nid</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">0x2e03</span><span style="color:#24292E;"> runnable</span></span>
<span class="line"><span style="color:#032F62;">&quot;GC task thread#0 (ParallelGC)&quot;</span><span style="color:#24292E;"> os_prio</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">31</span><span style="color:#24292E;"> tid</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">0x00007f8c00803000</span><span style="color:#24292E;"> nid</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">0x2007</span><span style="color:#24292E;"> runnable</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032F62;">&quot;GC task thread#1 (ParallelGC)&quot;</span><span style="color:#24292E;"> os_prio</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">31</span><span style="color:#24292E;"> tid</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">0x00007f8c00006800</span><span style="color:#24292E;"> nid</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">0x2403</span><span style="color:#24292E;"> runnable</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032F62;">&quot;GC task thread#2 (ParallelGC)&quot;</span><span style="color:#24292E;"> os_prio</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">31</span><span style="color:#24292E;"> tid</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">0x00007f8c01800800</span><span style="color:#24292E;"> nid</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">0x2303</span><span style="color:#24292E;"> runnable</span></span>
<span class="line"><span style="color:#032F62;">&quot;GC task thread#3 (ParallelGC)&quot;</span><span style="color:#24292E;"> os_prio</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">31</span><span style="color:#24292E;"> tid</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">0x00007f8c01801800</span><span style="color:#24292E;"> nid</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">0x2a03</span><span style="color:#24292E;"> runnable</span></span>
<span class="line"><span style="color:#032F62;">&quot;GC task thread#4 (ParallelGC)&quot;</span><span style="color:#24292E;"> os_prio</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">31</span><span style="color:#24292E;"> tid</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">0x00007f8c01802000</span><span style="color:#24292E;"> nid</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">0x5403</span><span style="color:#24292E;"> runnable</span></span>
<span class="line"><span style="color:#032F62;">&quot;GC task thread#5 (ParallelGC)&quot;</span><span style="color:#24292E;"> os_prio</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">31</span><span style="color:#24292E;"> tid</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">0x00007f8c01006800</span><span style="color:#24292E;"> nid</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">0x2d03</span><span style="color:#24292E;"> runnable</span></span>
<span class="line"><span style="color:#032F62;">&quot;VM Periodic Task Thread&quot;</span><span style="color:#24292E;"> os_prio</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">31</span><span style="color:#24292E;"> tid</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">0x00007f8c00010800</span><span style="color:#24292E;"> nid</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">0x3803</span><span style="color:#24292E;"> waiting on condition</span></span>
<span class="line"><span style="color:#24292E;">JNI global references: </span><span style="color:#005CC5;">6</span></span>
<span class="line"><span style="color:#24292E;">Found one Java</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">level deadlock:</span></span>
<span class="line"><span style="color:#D73A49;">=============================</span></span>
<span class="line"><span style="color:#032F62;">&quot;Thread-0&quot;</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  waiting to lock monitor </span><span style="color:#005CC5;">0x00007f8c000102a8</span><span style="color:#24292E;"> (object </span><span style="color:#005CC5;">0x000000076abb62d0</span><span style="color:#D73A49;">,</span><span style="color:#24292E;"> a java.lang.Object)</span><span style="color:#D73A49;">,</span></span>
<span class="line"><span style="color:#24292E;">  which is held by </span><span style="color:#032F62;">&quot;main&quot;</span></span>
<span class="line"><span style="color:#032F62;">&quot;main&quot;</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  waiting to lock monitor </span><span style="color:#005CC5;">0x00007f8c0000ed58</span><span style="color:#24292E;"> (object </span><span style="color:#005CC5;">0x000000076abb62e0</span><span style="color:#D73A49;">,</span><span style="color:#24292E;"> a java.lang.Object)</span><span style="color:#D73A49;">,</span></span>
<span class="line"><span style="color:#24292E;">  which is held by </span><span style="color:#032F62;">&quot;Thread-0&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">Java stack information </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> the threads listed above:</span></span>
<span class="line"><span style="color:#D73A49;">===================================================</span></span>
<span class="line"><span style="color:#032F62;">&quot;Thread-0&quot;</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">	at com.example.optimize.NativeOptimize$1.run(NativeOptimize.java:</span><span style="color:#005CC5;">25</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> waiting to lock </span><span style="color:#D73A49;">&lt;</span><span style="color:#005CC5;">0x000000076abb62d0</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> (a java.lang.Object)</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> locked </span><span style="color:#D73A49;">&lt;</span><span style="color:#005CC5;">0x000000076abb62e0</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> (a java.lang.Object)</span></span>
<span class="line"><span style="color:#24292E;">	at java.lang.Thread.run(Thread.java:</span><span style="color:#005CC5;">745</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#032F62;">&quot;main&quot;</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">	at com.example.optimize.NativeOptimize.main(NativeOptimize.java:</span><span style="color:#005CC5;">41</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> waiting to lock </span><span style="color:#D73A49;">&lt;</span><span style="color:#005CC5;">0x000000076abb62e0</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> (a java.lang.Object)</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> locked </span><span style="color:#D73A49;">&lt;</span><span style="color:#005CC5;">0x000000076abb62d0</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> (a java.lang.Object)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">Found </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> deadlock.</span></span></code></pre></div><p>从上述信息可以看出使用 jstack ，可以很方便地排查出代码中出现&quot;deadlock&quot;（死锁）的问题。</p><h3 id="考点分析" tabindex="-1">考点分析 <a class="header-anchor" href="#考点分析" aria-label="Permalink to &quot;考点分析&quot;">​</a></h3><p>Java 虚拟机的排查工具是一个合格程序员必备的技能，使用它我们可以很方便地定位出问题的所在，尤其在团队合作的今天，每个人各守一摊很容易出现隐藏的 bug（缺陷）。因此使用这些排查功能可以帮我们快速地定位并解决问题，所以它也是面试中常问的问题之一。</p><p>和此知识点相关的面试题还有以下这些：</p><ul><li><p>除了比较实用的命令行工具之外，有没有方便一点的排查工具？</p></li><li><p>JVM 常见的调优手段有哪些？</p></li></ul><h3 id="知识扩展" tabindex="-1">知识扩展 <a class="header-anchor" href="#知识扩展" aria-label="Permalink to &quot;知识扩展&quot;">​</a></h3><h4 id="可视化排查工具" tabindex="-1">可视化排查工具 <a class="header-anchor" href="#可视化排查工具" aria-label="Permalink to &quot;可视化排查工具&quot;">​</a></h4><p>JVM 除了上面的 6 个基础命令行工具之外，还有两个重要的视图调试工具，即 JConsole 和 JVisualVM，它们相比于命令行工具使用更方便、操作更简单、结果展现也更直观。</p><p>JConsole 和 JVisualVM 都位于 JDK 的 bin 目录下，JConsole（Java Monitoring and Management Console）是最早期的视图调试工具，其启动页面如下图所示：</p>`,17),D=s("p",null,"可以看出我们可以用它来连接远程的服务器，或者是直接调试本机，这样就可以在不消耗生产环境的性能下，从本机启动 JConsole 来连接服务器。选择了调试的进程之后，运行界面如下图所示：",-1),A=s("p",null,"从上图可以看出，使用 JConsole 可以监控线程、CPU、类、堆以及 VM 的相关信息，同样我们可以通过线程这一页的信息，发现之前我们故意写的死锁问题，如下图所示：",-1),u=s("p",null,"可以看到 main（主线程）和 Thread-0 线程处于死锁状态。",-1),h=s("p",null,"JVisualVM 的启动图如下图所示：",-1),g=s("p",null,"由上图可知，JVisualVM 既可以调试本地也可以调试远程服务器，当我们选择了相关的进程之后，运行如下图所示：",-1),m=s("p",null,"可以看出 JVisualVM 除了包含了 JConsole 的信息之外，还有更多的详细信息，并且更加智能。例如，线程死锁检查的这页内容如下图所示：",-1),b=l('<p>可以看出 JVisualVM 会直接给你一个死锁的提示，而 JConsole 则需要程序员自己分析。</p><h4 id="jvm-调优" tabindex="-1">JVM 调优 <a class="header-anchor" href="#jvm-调优" aria-label="Permalink to &quot;JVM 调优&quot;">​</a></h4><p>JVM 调优主要是根据实际的硬件配置信息重新设置 JVM 参数来进行调优的，例如，硬件的内存配置很高，但 JVM 因为是默认参数，所以最大内存和初始化堆内存很小，这样就不能更好地利用本地的硬件优势了。因此，需要调整这些参数，让 JVM 在固定的配置下发挥最大的价值。</p><p>JVM 常见调优参数包含以下这些：</p><ul><li><p>-Xmx，设置最大堆内存大小；</p></li><li><p>-Xms，设置初始堆内存大小；</p></li><li><p>-XX:MaxNewSize，设置新生代的最大内存；</p></li><li><p>-XX:MaxTenuringThreshold，设置新生代对象经过一定的次数晋升到老生代；</p></li><li><p>-XX:PretrnureSizeThreshold，设置大对象的值，超过这个值的对象会直接进入老生代；</p></li><li><p>-XX:NewRatio，设置分代垃圾回收器新生代和老生代内存占比；</p></li><li><p>-XX:SurvivorRatio，设置新生代 Eden、Form Survivor、To Survivor 占比。</p></li></ul><p>我们要根据自己的业务场景和硬件配置来设置这些值。例如，当我们的业务场景会有很多大的临时对象产生时，因为这些大对象只有很短的生命周期，因此需要把&quot;-XX:MaxNewSize&quot;的值设置的尽量大一些，否则就会造成大量短生命周期的大对象进入老生代，从而很快消耗掉了老生代的内存，这样就会频繁地触发 full gc，从而影响了业务的正常运行。</p><h3 id="小结" tabindex="-1">小结 <a class="header-anchor" href="#小结" aria-label="Permalink to &quot;小结&quot;">​</a></h3><p>本课时我们讲了 JVM 排查的 6 个基本命令行工具：jps、jstat、jinfo、jmap、jhat、jstack，以及 2 个视图排查工具：JConsole 和 JVisualVM；同时还讲了 JVM 的常见调优参数，希望本课时的内容可以切实的帮助到你。</p>',8);function j(B,v,f,x,k,q){const a=o("Image");return e(),t("div",null,[y,E,i,F,n(a,{alt:"Drawing 0.png",src:"https://s0.lgstatic.com/i/image/M00/19/15/CgqCHl7Z6XeAXH4mAAQG2yKoYrQ797.png"}),d,n(a,{alt:"Drawing 1.png",src:"https://s0.lgstatic.com/i/image/M00/19/0A/Ciqc1F7Z6YyAZxEUAAHRgiBjrK8704.png"}),C,n(a,{alt:"Drawing 2.png",src:"https://s0.lgstatic.com/i/image/M00/19/0A/Ciqc1F7Z6ZuAZOoBAAIE-PlP8mY751.png"}),D,n(a,{alt:"Drawing 3.png",src:"https://s0.lgstatic.com/i/image/M00/19/16/CgqCHl7Z6aKAZfp0AAKE9E3ar6c820.png"}),A,n(a,{alt:"Drawing 4.png",src:"https://s0.lgstatic.com/i/image/M00/19/16/CgqCHl7Z6amAF-LOAAKoeNJzszw795.png"}),u,h,n(a,{alt:"Drawing 5.png",src:"https://s0.lgstatic.com/i/image/M00/19/16/CgqCHl7Z6a-AK0DMAAHTxm7JgYI402.png"}),g,n(a,{alt:"Drawing 6.png",src:"https://s0.lgstatic.com/i/image/M00/19/16/CgqCHl7Z6beAUJ6sAAMkaaTyA9U352.png"}),m,n(a,{alt:"Drawing 7.png",src:"https://s0.lgstatic.com/i/image/M00/19/0A/Ciqc1F7Z6b2Aa8CCAANpsufYncw124.png"}),b])}const M=p(r,[["render",j]]);export{_ as __pageData,M as default};
