import{_ as t,j as a,o as e,g as _,k as n,h as p,s as l,Q as o}from"./chunks/framework.b3d8e22e.js";const Q=JSON.parse('{"title":"InnoDB 死锁","description":"","frontmatter":{},"headers":[],"relativePath":"posts/backEnd/040_高性能MySQL实战/(50) 第02讲：深入理解事务与锁机制（下）.md","filePath":"posts/backEnd/040_高性能MySQL实战/(50) 第02讲：深入理解事务与锁机制（下）.md","lastUpdated":1696417798000}'),s={name:"posts/backEnd/040_高性能MySQL实战/(50) 第02讲：深入理解事务与锁机制（下）.md"},d=l("p",null,[l("strong",null,"MySQL 锁分类")],-1),c=l("p",null,"前文提到了锁，下面将详细讲解 MySQL 的锁，我们先来看看锁的分类，在 MySQL 中有三种级别的锁：页级锁、表级锁、行级锁。",-1),r=l("ul",null,[l("li",null,[l("p",null,"表级锁：开销小，加锁快；不会出现死锁；锁定粒度大，发生锁冲突的概率最高，并发度最低。 会发生在：MyISAM、memory、InnoDB、BDB 等存储引擎中。")]),l("li",null,[l("p",null,"行级锁：开销大，加锁慢；会出现死锁；锁定粒度最小，发生锁冲突的概率最低，并发度最高。会发生在：InnoDB 存储引擎。")]),l("li",null,[l("p",null,"页级锁：开销和加锁时间界于表锁和行锁之间；会出现死锁；锁定粒度界于表锁和行锁之间，并发度一般。会发生在：BDB 存储引擎。")])],-1),u=l("p",null,"三种级别的锁分别对应存储引擎关系如下图所示。",-1),h=o("",10),A=l("p",null,"InnoDB 锁关系矩阵如下图所示，其中：+ 表示兼容，- 表示不兼容。",-1),m=o("",10),I=l("p",null,"假设条件是：",-1),g=l("ul",null,[l("li",null,[l("p",null,"update t1 set name='XX' where id=10。")]),l("li",null,[l("p",null,"id 为主键索引。")])],-1),D=l("p",null,"加锁行为：仅在 id=10 的主键索引记录上加 X锁。",-1),T=l("p",null,"第二种情况：唯一键 + RR，如下图所示。",-1),B=o("",5),b=o("",5),S=o("",14),k=l("p",null,"session1 首先拿到 id=1 的锁，session2 同期拿到了 id=5 的锁后，两者分别想拿到对方持有的锁，于是产生死锁。",-1),R=l("h2",{id:"元数据锁",tabindex:"-1"},[p("元数据锁 "),l("a",{class:"header-anchor",href:"#元数据锁","aria-label":'Permalink to "元数据锁"'},"​")],-1),M=l("p",null,"下面分享一个 Metadata lock（即元数据锁）导致的死锁的情况，如下图所示。",-1),C=o("",5);function L(y,P,V,X,E,f){const i=a("Image");return e(),_("div",null,[d,c,r,u,n(i,{alt:"",src:"http://s0.lgstatic.com/i/image2/M01/89/D4/CgoB5l13JAaAMAAJAAAVsgPHWMQ811.png"}),h,n(i,{alt:"",src:"http://s0.lgstatic.com/i/image2/M01/89/D4/CgoB5l13JAaAE19WAAB04iNLUm8099.png"}),A,n(i,{alt:"",src:"http://s0.lgstatic.com/i/image2/M01/89/F4/CgotOV13JAaAPHdtAAAV6sAJZJU546.png"}),p(),m,n(i,{alt:"",src:"http://s0.lgstatic.com/i/image2/M01/89/D4/CgoB5l13JAaAbttnAADhQqAn2AA031.png"}),I,g,D,T,n(i,{alt:"",src:"http://s0.lgstatic.com/i/image2/M01/89/F4/CgotOV13JAaARFQyAAEDy1rKntM893.png"}),B,n(i,{alt:"",src:"http://s0.lgstatic.com/i/image2/M01/89/D4/CgoB5l13JAeAXno8AAEx6KKaJgs480.png"}),b,n(i,{alt:"",src:"http://s0.lgstatic.com/i/image2/M01/89/F4/CgotOV13JAeARw3uAAFMccO4RTA164.png"}),S,n(i,{alt:"",src:"http://s0.lgstatic.com/i/image2/M01/89/D4/CgoB5l13JAeAGUj0AAIHGdgOf2U103.png"}),k,R,M,n(i,{alt:"",src:"http://s0.lgstatic.com/i/image2/M01/89/F4/CgotOV13JAeAfDhaAAKx8-t0UEg960.png"}),C])}const N=t(s,[["render",L]]);export{Q as __pageData,N as default};
