import{_ as p,j as t,o as e,g as c,k as l,h as a,s,Q as o}from"./chunks/framework.4e7d56ce.js";const $=JSON.parse('{"title":"36如何使用ELK进行日志采集以及统一处理？","description":"","frontmatter":{},"headers":[],"relativePath":"posts/backEnd/Go 微服务实战 38 讲_文档/(3831) 36  如何使用 ELK 进行日志采集以及统一处理？.md","filePath":"posts/backEnd/Go 微服务实战 38 讲_文档/(3831) 36  如何使用 ELK 进行日志采集以及统一处理？.md","lastUpdated":1696682708000}'),r={name:"posts/backEnd/Go 微服务实战 38 讲_文档/(3831) 36  如何使用 ELK 进行日志采集以及统一处理？.md"},y=s("h1",{id:"_36如何使用elk进行日志采集以及统一处理",tabindex:"-1"},[a("36如何使用ELK进行日志采集以及统一处理？ "),s("a",{class:"header-anchor",href:"#_36如何使用elk进行日志采集以及统一处理","aria-label":'Permalink to "36如何使用ELK进行日志采集以及统一处理？"'},"​")],-1),E=s("p",null,'在前面的一系列课时，我们介绍了微服务各个组件的相关实践，从本课时开始我们将会介绍微服务日常开发的一些"利器"，这些工具会帮助我们构建更加健壮的微服务系统，并帮助排查解决微服务系统中的问题与性能瓶颈等。',-1),i=o('<p>ELK 技术栈</p><p>本课时将重点介绍<strong>微服务架构中的日志收集方案 ELK</strong>（ELK 是 Elasticsearch、Logstash 和 Kibana 的简称），准确地说是 ELKB，即 ELK + Filebeat，其中 Filebeat 是用于转发和集中日志数据的轻量级传送工具。</p><h3 id="为什么需要分布式日志系统" tabindex="-1">为什么需要分布式日志系统 <a class="header-anchor" href="#为什么需要分布式日志系统" aria-label="Permalink to &quot;为什么需要分布式日志系统&quot;">​</a></h3><p>在以前的项目中，如果想要在生产环境中通过日志定位业务服务的 Bug 或者性能问题，则需要运维人员使用命令挨个服务实例去查询日志文件，这样导致的结果就是：排查问题的效率非常低。</p><p>在微服务架构中，服务多实例部署在不同的物理机上，各个微服务的日志也被分散储存在不同的物理机。集群足够大的话，使用上述传统的方式查阅日志就变得非常不合适。因此需要集中化管理分布式系统中的日志，其中有开源的组件如 Syslog，用于将所有服务器上的日志收集汇总。</p><p>然而集中化日志文件之后，我们面临的是对这些日志文件进行统计和检索，比如哪些服务有报警和异常，这些都需要有详细的统计。所以，在以前出现线上故障时，经常会看到开发和运维人员下载服务的日志，并基于 Linux 下的一些命令（如 grep、awk 和 wc 等）进行检索和统计。这样的方式不仅工作量大、效率低，而且对于要求更高的查询、排序和统计等操作，以及庞大的机器数量，难免会有点&quot;力不从心&quot;，无法很好地胜任。</p><h3 id="elkb-分布式日志系统" tabindex="-1">ELKB 分布式日志系统 <a class="header-anchor" href="#elkb-分布式日志系统" aria-label="Permalink to &quot;ELKB 分布式日志系统&quot;">​</a></h3><p><strong>ELKB 是一个完整的分布式日志收集系统</strong>，很好地解决了上述提到的日志收集难、检索和分析难的问题。</p><p>ELKB 分别是指 Elasticsearch、Logstash、Kibana 和 Filebeat。Elastic 提供的一整套组件可以看作是 MVC 模型：Logstash 对应逻辑控制 Controller 层，Elasticsearch 是一个数据模型 Model 层，而 Kibana 则是视图 View 层。Logstash 和 Elasticsearch 是基于 Java 编写实现的，Kibana 则使用的是 Node.js 框架。</p>',9),F=o(`<p>ELKB 日志采集系统</p><p>下面我们就来依次介绍这几个组件的功能，以及它们在日志采集系统中的作用。</p><h4 id="elasticsearch-的安装与使用" tabindex="-1">Elasticsearch 的安装与使用 <a class="header-anchor" href="#elasticsearch-的安装与使用" aria-label="Permalink to &quot;Elasticsearch 的安装与使用&quot;">​</a></h4><p><strong>Elasticsearch 是分布式系统中的实时搜索分析引擎</strong>，使用 Java 语言实现，基于 Apache Lucene 搜索引擎库构建，可以用来进行全文检索、结构化搜索、分析以及这三个功能的组合。Elasticsearch 支持数百个节点的扩展，能够存储 PB 级别的数据。</p><p>另外，Elasticsearch 是面向文档的，它可以存储和搜索整个对象或文档。在 Elasticsearch 中，你可以对整个文档进行索引、检索、排序和过滤，这不同于传统的关系型数据库对行列数据进行操作。</p><p>为了方便，我们直接使用 Docker 安装 Elasticsearch：</p><div class="language-dart vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">dart</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">$ docker run </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">d </span><span style="color:#F97583;">--</span><span style="color:#E1E4E8;">name elasticsearch  docker.elastic.co</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">elasticsearch</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">elasticsearch</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">5.4</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">0</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">$ docker run </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">d </span><span style="color:#D73A49;">--</span><span style="color:#24292E;">name elasticsearch  docker.elastic.co</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">elasticsearch</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">elasticsearch</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">5.4</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">0</span></span></code></pre></div><p>需要注意的是，Elasticsearch 启动之后需要进行简单的设置，xpack.security.enabled 默认是开启的，但我们为了方便测试，就取消登录认证，将该配置设置为 false。登入容器内部，执行如下的命令：</p><div class="language-dart vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">dart</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;"># 进入启动好的容器</span></span>
<span class="line"><span style="color:#E1E4E8;">$ docker exec </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">it elasticsearch bash</span></span>
<span class="line"><span style="color:#E1E4E8;"># 编辑配置文件</span></span>
<span class="line"><span style="color:#E1E4E8;">$ vim config</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">elasticsearch.yml</span></span>
<span class="line"><span style="color:#E1E4E8;">cluster.name</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;docker-cluster&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">network.host</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0.0</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">0.0</span></span>
<span class="line"><span style="color:#E1E4E8;">http.cors.enabled</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">true</span></span>
<span class="line"><span style="color:#E1E4E8;">http.cors.allow</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">origin</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;*&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">xpack.security.enabled</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">false</span></span>
<span class="line"><span style="color:#E1E4E8;"># minimum_master_nodes need to be explicitly </span><span style="color:#F97583;">set</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">when</span><span style="color:#E1E4E8;"> bound </span><span style="color:#F97583;">on</span><span style="color:#E1E4E8;"> a public </span><span style="color:#79B8FF;">IP</span></span>
<span class="line"><span style="color:#E1E4E8;"># </span><span style="color:#F97583;">set</span><span style="color:#E1E4E8;"> to </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> to allow single node clusters</span></span>
<span class="line"><span style="color:#E1E4E8;"># </span><span style="color:#79B8FF;">Details</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> https</span><span style="color:#F97583;">:</span><span style="color:#6A737D;">//github.com/elastic/elasticsearch/pull/17288</span></span>
<span class="line"><span style="color:#E1E4E8;">discovery.zen.minimum_master_nodes</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;"># 进入启动好的容器</span></span>
<span class="line"><span style="color:#24292E;">$ docker exec </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">it elasticsearch bash</span></span>
<span class="line"><span style="color:#24292E;"># 编辑配置文件</span></span>
<span class="line"><span style="color:#24292E;">$ vim config</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">elasticsearch.yml</span></span>
<span class="line"><span style="color:#24292E;">cluster.name</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;docker-cluster&quot;</span></span>
<span class="line"><span style="color:#24292E;">network.host</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0.0</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">0.0</span></span>
<span class="line"><span style="color:#24292E;">http.cors.enabled</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">true</span></span>
<span class="line"><span style="color:#24292E;">http.cors.allow</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">origin</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;*&quot;</span></span>
<span class="line"><span style="color:#24292E;">xpack.security.enabled</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">false</span></span>
<span class="line"><span style="color:#24292E;"># minimum_master_nodes need to be explicitly </span><span style="color:#D73A49;">set</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">when</span><span style="color:#24292E;"> bound </span><span style="color:#D73A49;">on</span><span style="color:#24292E;"> a public </span><span style="color:#005CC5;">IP</span></span>
<span class="line"><span style="color:#24292E;"># </span><span style="color:#D73A49;">set</span><span style="color:#24292E;"> to </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> to allow single node clusters</span></span>
<span class="line"><span style="color:#24292E;"># </span><span style="color:#005CC5;">Details</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> https</span><span style="color:#D73A49;">:</span><span style="color:#6A737D;">//github.com/elastic/elasticsearch/pull/17288</span></span>
<span class="line"><span style="color:#24292E;">discovery.zen.minimum_master_nodes</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span></span></code></pre></div><p>修改好配置文件之后，退出容器，再重启容器即可完成配置。我们为了后面使用时能够保留配置，就需要从该容器创建一个新的镜像。首先获取到该容器对应的 ContainerId，然后基于该容器提交成一个新的镜像。</p><div class="language-dart vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">dart</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">$ docker commit </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">a </span><span style="color:#9ECBFF;">&quot;add config&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">m </span><span style="color:#9ECBFF;">&quot;dev&quot;</span><span style="color:#E1E4E8;"> a404c6c174a2  es</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;">latest</span></span>
<span class="line"><span style="color:#E1E4E8;">sha256</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;">5cb8c995ca819765323e76cccea8f55b423a6fa2eecd9c1048b2787818c1a994</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">$ docker commit </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">a </span><span style="color:#032F62;">&quot;add config&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">m </span><span style="color:#032F62;">&quot;dev&quot;</span><span style="color:#24292E;"> a404c6c174a2  es</span><span style="color:#D73A49;">:</span><span style="color:#24292E;">latest</span></span>
<span class="line"><span style="color:#24292E;">sha256</span><span style="color:#D73A49;">:</span><span style="color:#24292E;">5cb8c995ca819765323e76cccea8f55b423a6fa2eecd9c1048b2787818c1a994</span></span></code></pre></div><p>这样我们就得到了一个新的镜像 es:latest。我们运行新的镜像：</p><div class="language-dart vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">dart</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">docker run </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">d </span><span style="color:#F97583;">--</span><span style="color:#E1E4E8;">name es </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">p </span><span style="color:#79B8FF;">9200</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">9200</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">p </span><span style="color:#79B8FF;">9300</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">9300</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">e </span><span style="color:#9ECBFF;">&quot;discovery.type=single-node&quot;</span><span style="color:#E1E4E8;"> es</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;">latest</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">docker run </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">d </span><span style="color:#D73A49;">--</span><span style="color:#24292E;">name es </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">p </span><span style="color:#005CC5;">9200</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">9200</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">p </span><span style="color:#005CC5;">9300</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">9300</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">e </span><span style="color:#032F62;">&quot;discovery.type=single-node&quot;</span><span style="color:#24292E;"> es</span><span style="color:#D73A49;">:</span><span style="color:#24292E;">latest</span></span></code></pre></div><p>通过访问 Elasticsearch 提供的内置端点，我们检查 Elasticsearch 是否安装成功。</p><div class="language-dart vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">dart</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">$ curl </span><span style="color:#9ECBFF;">&#39;http://localhost:9200/_nodes/http?pretty&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">&quot;_nodes&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&quot;total&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&quot;successful&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&quot;failed&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#E1E4E8;">  }, # 集群大小</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">&quot;cluster_name&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;docker-cluster&quot;</span><span style="color:#E1E4E8;">, # 设置的集群名称</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">&quot;nodes&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> { # 节点的详细信息</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&quot;8iH5v9C-Q9GA3aSupm4caw&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#9ECBFF;">&quot;name&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;8iH5v9C&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#9ECBFF;">&quot;transport_address&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;10.0.1.14:9300&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#9ECBFF;">&quot;host&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;10.0.1.14&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#9ECBFF;">&quot;ip&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;10.0.1.14&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#9ECBFF;">&quot;version&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;5.4.0&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#9ECBFF;">&quot;build_hash&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;780f8c4&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#9ECBFF;">&quot;roles&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> [</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">&quot;master&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">&quot;data&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">&quot;ingest&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">      ],</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#9ECBFF;">&quot;attributes&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">&quot;ml.enabled&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;true&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">      },</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#9ECBFF;">&quot;http&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> { # 绑定的 http 端口</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">&quot;bound_address&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> [</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#9ECBFF;">&quot;[::]:9200&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">        ],</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">&quot;publish_address&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;10.0.1.14:9200&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">&quot;max_content_length_in_bytes&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">104857600</span></span>
<span class="line"><span style="color:#E1E4E8;">      }</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">$ curl </span><span style="color:#032F62;">&#39;http://localhost:9200/_nodes/http?pretty&#39;</span></span>
<span class="line"><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">&quot;_nodes&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&quot;total&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&quot;successful&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&quot;failed&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#24292E;">  }, # 集群大小</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">&quot;cluster_name&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;docker-cluster&quot;</span><span style="color:#24292E;">, # 设置的集群名称</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">&quot;nodes&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> { # 节点的详细信息</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&quot;8iH5v9C-Q9GA3aSupm4caw&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#032F62;">&quot;name&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;8iH5v9C&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#032F62;">&quot;transport_address&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;10.0.1.14:9300&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#032F62;">&quot;host&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;10.0.1.14&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#032F62;">&quot;ip&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;10.0.1.14&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#032F62;">&quot;version&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;5.4.0&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#032F62;">&quot;build_hash&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;780f8c4&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#032F62;">&quot;roles&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> [</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#032F62;">&quot;master&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#032F62;">&quot;data&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#032F62;">&quot;ingest&quot;</span></span>
<span class="line"><span style="color:#24292E;">      ],</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#032F62;">&quot;attributes&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#032F62;">&quot;ml.enabled&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;true&quot;</span></span>
<span class="line"><span style="color:#24292E;">      },</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#032F62;">&quot;http&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> { # 绑定的 http 端口</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#032F62;">&quot;bound_address&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> [</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#032F62;">&quot;[::]:9200&quot;</span></span>
<span class="line"><span style="color:#24292E;">        ],</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#032F62;">&quot;publish_address&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;10.0.1.14:9200&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#032F62;">&quot;max_content_length_in_bytes&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">104857600</span></span>
<span class="line"><span style="color:#24292E;">      }</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">  }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><p>可以看到，我们成功安装了 Elasticsearch。另外，为了方便查看数据，我们需要安装 Elasticsearch 的可视化工具：elasticsearch-head。这个安装方法就很简单了：</p><div class="language-dart vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">dart</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">$ docker run </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">p </span><span style="color:#79B8FF;">9100</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">9100</span><span style="color:#E1E4E8;"> mobz</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">elasticsearch</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">head</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">5</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">$ docker run </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">p </span><span style="color:#005CC5;">9100</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">9100</span><span style="color:#24292E;"> mobz</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">elasticsearch</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">head</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">5</span></span></code></pre></div><p>elasticsearch-head 是一款 Elasticsearch 可视化工具，能够显示 Elasticsearch 状态，除了数据可视化，还可以执行增、删、改、查等操作。</p><p>安装之后的界面如下所示：</p>`,19),u=s("p",null,"elasticsearch-head 界面",-1),C=s("h4",{id:"logstash-的安装与使用",tabindex:"-1"},[a("Logstash 的安装与使用 "),s("a",{class:"header-anchor",href:"#logstash-的安装与使用","aria-label":'Permalink to "Logstash 的安装与使用"'},"​")],-1),g=s("p",null,"Logstash 是一个数据分析软件，主要用于分析 Log 日志。其工作原理如下所示：",-1),h=o(`<p>Logstash 工作原理图</p><p>数据源首先将数据传给 Logstash（这里我们使用的是 Filebeat 传输日志数据），它主要包括 Input 数据输入、Filter 数据源过滤和 Output 数据输出三部分。</p><p>Logstash 可以对数据进行处理，包括数据的过滤和格式化，之后发送到 Elasticsearch 存储，并在 Elasticsearch 中建立相应的索引。</p><p>下面我们就来安装和使用 Logstash。首先，下载并解压 Logstash：</p><div class="language-dart vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">dart</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;"># 下载 logstash</span></span>
<span class="line"><span style="color:#E1E4E8;">$ wget https</span><span style="color:#F97583;">:</span><span style="color:#6A737D;">//artifacts.elastic.co/downloads/logstash/logstash-5.4.3.tar.gz</span></span>
<span class="line"><span style="color:#E1E4E8;"># 解压 logstash</span></span>
<span class="line"><span style="color:#E1E4E8;">$ tar </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">zxvf logstash</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">5.4</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">3.</span><span style="color:#E1E4E8;">tar.gz</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;"># 下载 logstash</span></span>
<span class="line"><span style="color:#24292E;">$ wget https</span><span style="color:#D73A49;">:</span><span style="color:#6A737D;">//artifacts.elastic.co/downloads/logstash/logstash-5.4.3.tar.gz</span></span>
<span class="line"><span style="color:#24292E;"># 解压 logstash</span></span>
<span class="line"><span style="color:#24292E;">$ tar </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">zxvf logstash</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">5.4</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">3.</span><span style="color:#24292E;">tar.gz</span></span></code></pre></div><p>下载速度可能比较慢，如果你想速度稍微快点，可以选择国内的镜像源。解压成功之后，我们需要配置 Logstash，主要就是我们前面所提到的输入、过滤和输出。</p><div class="language-powershell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">$ vi logstash</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">5.4</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">3</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">client.conf</span></span>
<span class="line"><span style="color:#E1E4E8;">input {  </span><span style="color:#6A737D;"># 输入的设置，使用 filebeat</span></span>
<span class="line"><span style="color:#E1E4E8;">    beats {</span></span>
<span class="line"><span style="color:#E1E4E8;">        port </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5044</span></span>
<span class="line"><span style="color:#E1E4E8;">        codec </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;json&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"><span style="color:#E1E4E8;">output { </span><span style="color:#6A737D;">#输出到 ES 中</span></span>
<span class="line"><span style="color:#E1E4E8;">    elasticsearch {</span></span>
<span class="line"><span style="color:#E1E4E8;">        hosts </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> [</span><span style="color:#9ECBFF;">&quot;127.0.0.1:9200&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">        index </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;logstash-app-error-%{+YYYY.MM.dd}&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">    stdout {codec </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> rubydebug}</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">$ vi logstash</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">5.4</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">3</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">client.conf</span></span>
<span class="line"><span style="color:#24292E;">input {  </span><span style="color:#6A737D;"># 输入的设置，使用 filebeat</span></span>
<span class="line"><span style="color:#24292E;">    beats {</span></span>
<span class="line"><span style="color:#24292E;">        port </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5044</span></span>
<span class="line"><span style="color:#24292E;">        codec </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;json&quot;</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#24292E;">output { </span><span style="color:#6A737D;">#输出到 ES 中</span></span>
<span class="line"><span style="color:#24292E;">    elasticsearch {</span></span>
<span class="line"><span style="color:#24292E;">        hosts </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> [</span><span style="color:#032F62;">&quot;127.0.0.1:9200&quot;</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">        index </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;logstash-app-error-%{+YYYY.MM.dd}&quot;</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">    stdout {codec </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> rubydebug}</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><p><strong>输入</strong>支持文件、Syslog 和 Beats，我们在配置时只能选择其中一种。这里我们配置了 Filebeats 方式。</p><p><strong>过滤</strong>则用于处理一些特定的行为，如匹配特定规则的事件流。常见的 filters 有：geoip 添加地理信息、drop 丢弃部分事件和 mutate 修改文档等。如下是一个 filter 使用的示例：</p><div class="language-dart vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">dart</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">filter {</span></span>
<span class="line"><span style="color:#E1E4E8;">  #定义客户端的 </span><span style="color:#79B8FF;">IP</span><span style="color:#E1E4E8;"> 是哪个字段</span></span>
<span class="line"><span style="color:#E1E4E8;">  geoip {</span></span>
<span class="line"><span style="color:#E1E4E8;">    source </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;clientIp&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">filter {</span></span>
<span class="line"><span style="color:#24292E;">  #定义客户端的 </span><span style="color:#005CC5;">IP</span><span style="color:#24292E;"> 是哪个字段</span></span>
<span class="line"><span style="color:#24292E;">  geoip {</span></span>
<span class="line"><span style="color:#24292E;">    source </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;clientIp&quot;</span></span>
<span class="line"><span style="color:#24292E;">  }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><p><strong>输出</strong>支持 Elasticsearch、File、Graphite 和 StatsD，默认情况下将过滤的数据输出到 Elasticsearch，当我们不需要输出到 Elasticsearch 时就需要特别声明输出的方式是哪一种。Logstash 支持同时配置多个输出源。</p><p>我们在配置中，将日志信息输出到 Elasticsearch。配置文件搞定之后，我们开始启动 Logstash：</p><div class="language-dart vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">dart</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">$ bin</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">logstash  </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">f client.conf</span></span>
<span class="line"><span style="color:#79B8FF;">Sending</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Logstash</span><span style="color:#9ECBFF;">&#39;s logs to /elk/logstash-5.4.3/logs which is now configured via log4j2.properties</span></span>
<span class="line"><span style="color:#9ECBFF;">[2020-10-12T14:12:26,056][INFO ][logstash.outputs.elasticsearch] Elasticsearch pool URLs updated {:changes=&gt;{:removed=&gt;[], :added=&gt;[http://127.0.0.1:9200/]}}</span></span>
<span class="line"><span style="color:#9ECBFF;">[2020-10-12T14:12:26,062][INFO ][logstash.outputs.elasticsearch] Running health check to see if an Elasticsearch connection is working {:healthcheck_url=&gt;http://127.0.0.1:9200/, :path=&gt;&quot;/&quot;}</span></span>
<span class="line"><span style="color:#9ECBFF;">log4j:WARN No appenders could be found for logger (org.apache.http.client.protocol.RequestAuthCache).</span></span>
<span class="line"><span style="color:#9ECBFF;">log4j:WARN Please initialize the log4j system properly.</span></span>
<span class="line"><span style="color:#9ECBFF;">log4j:WARN See http://logging.apache.org/log4j/1.2/faq.html#noconfig for more info.</span></span>
<span class="line"><span style="color:#9ECBFF;">[2020-10-12T14:12:26,209][WARN ][logstash.outputs.elasticsearch] Restored connection to ES instance {:url=&gt;#&lt;URI::HTTP:0x1abac0 URL:http://127.0.0.1:9200/&gt;}[2020-10-12T14:12:26,225][INFO ][logstash.outputs.elasticsearch] Using mapping template from {:path=&gt;nil}</span></span>
<span class="line"><span style="color:#9ECBFF;">[2020-10-12T14:12:26,288][INFO ][logstash.outputs.elasticsearch] Attempting to install template {:manage_template=&gt;{&quot;template&quot;=&gt;&quot;logstash-*&quot;, &quot;version&quot;=&gt;50001, &quot;settings&quot;=&gt;{&quot;index.refresh_interval&quot;=&gt;&quot;5s&quot;}, &quot;mappings&quot;=&gt;{&quot;_default_&quot;=&gt;{&quot;_all&quot;=&gt;{&quot;enabled&quot;=&gt;true, &quot;norms&quot;=&gt;false}, &quot;dynamic_templates&quot;=&gt;[{&quot;message_field&quot;=&gt;{&quot;path_match&quot;=&gt;&quot;message&quot;, &quot;match_mapping_type&quot;=&gt;&quot;string&quot;, &quot;mapping&quot;=&gt;{&quot;type&quot;=&gt;&quot;text&quot;, &quot;norms&quot;=&gt;false}}}, {&quot;string_fields&quot;=&gt;{&quot;match&quot;=&gt;&quot;*&quot;, &quot;match_mapping_type&quot;=&gt;&quot;string&quot;, &quot;mapping&quot;=&gt;{&quot;type&quot;=&gt;&quot;text&quot;, &quot;norms&quot;=&gt;false, &quot;fields&quot;=&gt;{&quot;keyword&quot;=&gt;{&quot;type&quot;=&gt;&quot;keyword&quot;}}}}}], &quot;properties&quot;=&gt;{&quot;@timestamp&quot;=&gt;{&quot;type&quot;=&gt;&quot;date&quot;, &quot;include_in_all&quot;=&gt;false}, &quot;@version&quot;=&gt;{&quot;type&quot;=&gt;&quot;keyword&quot;, &quot;include_in_all&quot;=&gt;false}, &quot;geoip&quot;=&gt;{&quot;dynamic&quot;=&gt;true, &quot;properties&quot;=&gt;{&quot;ip&quot;=&gt;{&quot;type&quot;=&gt;&quot;ip&quot;}, &quot;location&quot;=&gt;{&quot;type&quot;=&gt;&quot;geo_point&quot;}, &quot;latitude&quot;=&gt;{&quot;type&quot;=&gt;&quot;half_float&quot;}, &quot;longitude&quot;=&gt;{&quot;type&quot;=&gt;&quot;half_float&quot;}}}}}}}}</span></span>
<span class="line"><span style="color:#9ECBFF;">[2020-10-12T14:12:26,304][INFO ][logstash.outputs.elasticsearch] New Elasticsearch output {:class=&gt;&quot;LogStash::Outputs::ElasticSearch&quot;, :hosts=&gt;[#&lt;URI::Generic:0x2fec3fe6 URL://127.0.0.1:9200&gt;]}</span></span>
<span class="line"><span style="color:#9ECBFF;">[2020-10-12T14:12:26,312][INFO ][logstash.pipeline        ] Starting pipeline {&quot;id&quot;=&gt;&quot;main&quot;, &quot;pipeline.workers&quot;=&gt;4, &quot;pipeline.batch.size&quot;=&gt;125, &quot;pipeline.batch.delay&quot;=&gt;5, &quot;pipeline.max_inflight&quot;=&gt;500}</span></span>
<span class="line"><span style="color:#9ECBFF;">[2020-10-12T14:12:27,226][INFO ][logstash.inputs.beats    ] Beats inputs: Starting input listener {:address=&gt;&quot;0.0.0.0:5044&quot;}</span></span>
<span class="line"><span style="color:#9ECBFF;">[2020-10-12T14:12:27,319][INFO ][logstash.pipeline        ] Pipeline main started</span></span>
<span class="line"><span style="color:#9ECBFF;">[2020-10-12T14:12:27,422][INFO ][logstash.agent           ] Successfully started Logstash API endpoint {:port=&gt;9600}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">$ bin</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">logstash  </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">f client.conf</span></span>
<span class="line"><span style="color:#005CC5;">Sending</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Logstash</span><span style="color:#032F62;">&#39;s logs to /elk/logstash-5.4.3/logs which is now configured via log4j2.properties</span></span>
<span class="line"><span style="color:#032F62;">[2020-10-12T14:12:26,056][INFO ][logstash.outputs.elasticsearch] Elasticsearch pool URLs updated {:changes=&gt;{:removed=&gt;[], :added=&gt;[http://127.0.0.1:9200/]}}</span></span>
<span class="line"><span style="color:#032F62;">[2020-10-12T14:12:26,062][INFO ][logstash.outputs.elasticsearch] Running health check to see if an Elasticsearch connection is working {:healthcheck_url=&gt;http://127.0.0.1:9200/, :path=&gt;&quot;/&quot;}</span></span>
<span class="line"><span style="color:#032F62;">log4j:WARN No appenders could be found for logger (org.apache.http.client.protocol.RequestAuthCache).</span></span>
<span class="line"><span style="color:#032F62;">log4j:WARN Please initialize the log4j system properly.</span></span>
<span class="line"><span style="color:#032F62;">log4j:WARN See http://logging.apache.org/log4j/1.2/faq.html#noconfig for more info.</span></span>
<span class="line"><span style="color:#032F62;">[2020-10-12T14:12:26,209][WARN ][logstash.outputs.elasticsearch] Restored connection to ES instance {:url=&gt;#&lt;URI::HTTP:0x1abac0 URL:http://127.0.0.1:9200/&gt;}[2020-10-12T14:12:26,225][INFO ][logstash.outputs.elasticsearch] Using mapping template from {:path=&gt;nil}</span></span>
<span class="line"><span style="color:#032F62;">[2020-10-12T14:12:26,288][INFO ][logstash.outputs.elasticsearch] Attempting to install template {:manage_template=&gt;{&quot;template&quot;=&gt;&quot;logstash-*&quot;, &quot;version&quot;=&gt;50001, &quot;settings&quot;=&gt;{&quot;index.refresh_interval&quot;=&gt;&quot;5s&quot;}, &quot;mappings&quot;=&gt;{&quot;_default_&quot;=&gt;{&quot;_all&quot;=&gt;{&quot;enabled&quot;=&gt;true, &quot;norms&quot;=&gt;false}, &quot;dynamic_templates&quot;=&gt;[{&quot;message_field&quot;=&gt;{&quot;path_match&quot;=&gt;&quot;message&quot;, &quot;match_mapping_type&quot;=&gt;&quot;string&quot;, &quot;mapping&quot;=&gt;{&quot;type&quot;=&gt;&quot;text&quot;, &quot;norms&quot;=&gt;false}}}, {&quot;string_fields&quot;=&gt;{&quot;match&quot;=&gt;&quot;*&quot;, &quot;match_mapping_type&quot;=&gt;&quot;string&quot;, &quot;mapping&quot;=&gt;{&quot;type&quot;=&gt;&quot;text&quot;, &quot;norms&quot;=&gt;false, &quot;fields&quot;=&gt;{&quot;keyword&quot;=&gt;{&quot;type&quot;=&gt;&quot;keyword&quot;}}}}}], &quot;properties&quot;=&gt;{&quot;@timestamp&quot;=&gt;{&quot;type&quot;=&gt;&quot;date&quot;, &quot;include_in_all&quot;=&gt;false}, &quot;@version&quot;=&gt;{&quot;type&quot;=&gt;&quot;keyword&quot;, &quot;include_in_all&quot;=&gt;false}, &quot;geoip&quot;=&gt;{&quot;dynamic&quot;=&gt;true, &quot;properties&quot;=&gt;{&quot;ip&quot;=&gt;{&quot;type&quot;=&gt;&quot;ip&quot;}, &quot;location&quot;=&gt;{&quot;type&quot;=&gt;&quot;geo_point&quot;}, &quot;latitude&quot;=&gt;{&quot;type&quot;=&gt;&quot;half_float&quot;}, &quot;longitude&quot;=&gt;{&quot;type&quot;=&gt;&quot;half_float&quot;}}}}}}}}</span></span>
<span class="line"><span style="color:#032F62;">[2020-10-12T14:12:26,304][INFO ][logstash.outputs.elasticsearch] New Elasticsearch output {:class=&gt;&quot;LogStash::Outputs::ElasticSearch&quot;, :hosts=&gt;[#&lt;URI::Generic:0x2fec3fe6 URL://127.0.0.1:9200&gt;]}</span></span>
<span class="line"><span style="color:#032F62;">[2020-10-12T14:12:26,312][INFO ][logstash.pipeline        ] Starting pipeline {&quot;id&quot;=&gt;&quot;main&quot;, &quot;pipeline.workers&quot;=&gt;4, &quot;pipeline.batch.size&quot;=&gt;125, &quot;pipeline.batch.delay&quot;=&gt;5, &quot;pipeline.max_inflight&quot;=&gt;500}</span></span>
<span class="line"><span style="color:#032F62;">[2020-10-12T14:12:27,226][INFO ][logstash.inputs.beats    ] Beats inputs: Starting input listener {:address=&gt;&quot;0.0.0.0:5044&quot;}</span></span>
<span class="line"><span style="color:#032F62;">[2020-10-12T14:12:27,319][INFO ][logstash.pipeline        ] Pipeline main started</span></span>
<span class="line"><span style="color:#032F62;">[2020-10-12T14:12:27,422][INFO ][logstash.agent           ] Successfully started Logstash API endpoint {:port=&gt;9600}</span></span></code></pre></div><p>根据控制台输出的日志，我们知道 Logstash 已经正常启动。Elasticsearch 的数据实现可视化就需要结合 Kibana 提供前端的页面视图，你可以在 Kibana 页面进行搜索，使得结果变成图表可视化。</p><h4 id="kibana-的安装与使用" tabindex="-1">Kibana 的安装与使用 <a class="header-anchor" href="#kibana-的安装与使用" aria-label="Permalink to &quot;Kibana 的安装与使用&quot;">​</a></h4><p>介绍完 Elasticsearch 和 Logstash，下面我们再来了解下 Kibana 的相关概念。Kibana 用于搜索、分析和可视化存储在 Elasticsearch 指标中的日志数据，是一个 Web 网页。Kibana 利用 Elasticsearch 的 REST 接口来检索数据，调用 Elasticsearch 存储的数据，将其可视化。它不仅允许用户自定义视图，还支持以特殊的方式查询和过滤数据。</p><p>Kibana 的安装比较简单，基于 Docker 安装即可：</p><div class="language-dart vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">dart</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">docker run </span><span style="color:#F97583;">--</span><span style="color:#E1E4E8;">name kibana </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">e </span><span style="color:#79B8FF;">ELASTICSEARCH_URL</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">http</span><span style="color:#F97583;">:</span><span style="color:#6A737D;">//127.0.0.1:9200 -p 5601:5601 -d kibana:5.6.9</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">docker run </span><span style="color:#D73A49;">--</span><span style="color:#24292E;">name kibana </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">e </span><span style="color:#005CC5;">ELASTICSEARCH_URL</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">http</span><span style="color:#D73A49;">:</span><span style="color:#6A737D;">//127.0.0.1:9200 -p 5601:5601 -d kibana:5.6.9</span></span></code></pre></div><p>我们在启动命令中指定了 ELASTICSEARCH 的环境变量，就是本地的<code>127.0.0.1:9200</code>。</p><h4 id="filebeat-的安装与使用" tabindex="-1">Filebeat 的安装与使用 <a class="header-anchor" href="#filebeat-的安装与使用" aria-label="Permalink to &quot;Filebeat 的安装与使用&quot;">​</a></h4><p>ELKB 中的 Filebeat 是最后研发的，并剥离出 Logstash 的数据转发功能。<strong>Filebeat 基于 Go 语言开发，是用于转发和集中日志数据的轻量级传送工具</strong>。通过配置 Filebeat，我们可以监听日志文件或位置、收集日志事件，并将这些文件转发到 Logstash、Kafka、Redis 等，当然也可以直接转发到 Elasticsearch 进行索引。</p>`,21),d=o(`<p>Filebeat 工作原理图</p><p>下面我们就按照如下命令开始安装和配置 Filebeat：</p><div class="language-powershell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># 下载 filebeat</span></span>
<span class="line"><span style="color:#E1E4E8;">$ wget https:</span><span style="color:#F97583;">//</span><span style="color:#E1E4E8;">artifacts.elastic.co</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">downloads</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">beats</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">filebeat</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">filebeat</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">5.4</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">3</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">linux</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">x86_64.tar.gz</span></span>
<span class="line"><span style="color:#E1E4E8;">$ tar </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">zxvf filebeat</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">5.4</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">3</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">linux</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">x86_64.tar.gz</span></span>
<span class="line"><span style="color:#E1E4E8;">$ mv filebeat</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">5.4</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">3</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">linux</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">x86_64 filebeat</span></span>
<span class="line"><span style="color:#6A737D;"># 进入目录</span></span>
<span class="line"><span style="color:#E1E4E8;">$ cd filebeat</span></span>
<span class="line"><span style="color:#6A737D;"># 配置 filebeat</span></span>
<span class="line"><span style="color:#E1E4E8;">$ vi filebeat</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">client.yml</span></span>
<span class="line"><span style="color:#E1E4E8;">filebeat.prospectors:</span></span>
<span class="line"><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> input_type: log</span></span>
<span class="line"><span style="color:#E1E4E8;">  paths:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">/var/</span><span style="color:#E1E4E8;">log</span><span style="color:#F97583;">/*</span><span style="color:#E1E4E8;">.log</span></span>
<span class="line"><span style="color:#E1E4E8;">output.logstash:</span></span>
<span class="line"><span style="color:#E1E4E8;">  hosts: [</span><span style="color:#9ECBFF;">&quot;localhost:5044&quot;</span><span style="color:#E1E4E8;">]</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 下载 filebeat</span></span>
<span class="line"><span style="color:#24292E;">$ wget https:</span><span style="color:#D73A49;">//</span><span style="color:#24292E;">artifacts.elastic.co</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">downloads</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">beats</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">filebeat</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">filebeat</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">5.4</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">3</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">linux</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">x86_64.tar.gz</span></span>
<span class="line"><span style="color:#24292E;">$ tar </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">zxvf filebeat</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">5.4</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">3</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">linux</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">x86_64.tar.gz</span></span>
<span class="line"><span style="color:#24292E;">$ mv filebeat</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">5.4</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">3</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">linux</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">x86_64 filebeat</span></span>
<span class="line"><span style="color:#6A737D;"># 进入目录</span></span>
<span class="line"><span style="color:#24292E;">$ cd filebeat</span></span>
<span class="line"><span style="color:#6A737D;"># 配置 filebeat</span></span>
<span class="line"><span style="color:#24292E;">$ vi filebeat</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">client.yml</span></span>
<span class="line"><span style="color:#24292E;">filebeat.prospectors:</span></span>
<span class="line"><span style="color:#D73A49;">-</span><span style="color:#24292E;"> input_type: log</span></span>
<span class="line"><span style="color:#24292E;">  paths:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">/var/</span><span style="color:#24292E;">log</span><span style="color:#D73A49;">/*</span><span style="color:#24292E;">.log</span></span>
<span class="line"><span style="color:#24292E;">output.logstash:</span></span>
<span class="line"><span style="color:#24292E;">  hosts: [</span><span style="color:#032F62;">&quot;localhost:5044&quot;</span><span style="color:#24292E;">]</span></span></code></pre></div><p>在 Filebeat 的配置中，input_type 支持从 Log、Syslog、Stdin、Redis、UDP、Docker、TCP、NetFlow 输入。上述命令配置了从 Log 中读取日志信息，并且配置了只输入 /var/log/ 目录下的日志文件；output 将 Filebeat 配置为使用 Logstash 作为输出，并且使用 Logstash 对 Filebeat 收集的数据执行过滤等处理。</p><p>配置好之后，我们启动 Filebeat：</p><div class="language-dart vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">dart</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">$ .</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">filebeat  </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">e  </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">c client.yml</span></span>
<span class="line"><span style="color:#79B8FF;">2020</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">10</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">12</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">06</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">46</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">31.764391</span><span style="color:#E1E4E8;"> beat.go</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">285</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">INFO</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Home</span><span style="color:#E1E4E8;"> path</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> [</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">elk</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">filebeat] </span><span style="color:#79B8FF;">Config</span><span style="color:#E1E4E8;"> path</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> [</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">elk</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">filebeat] </span><span style="color:#79B8FF;">Data</span><span style="color:#E1E4E8;"> path</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> [</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">elk</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">filebeat</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">data] </span><span style="color:#79B8FF;">Logs</span><span style="color:#E1E4E8;"> path</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> [</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">elk</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">filebeat</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">logs]</span></span>
<span class="line"><span style="color:#79B8FF;">2020</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">10</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">12</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">06</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">46</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">31.764426</span><span style="color:#E1E4E8;"> beat.go</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">186</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">INFO</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Setup</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Beat</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> filebeat; </span><span style="color:#79B8FF;">Version</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5.4</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">3</span></span>
<span class="line"><span style="color:#79B8FF;">2020</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">10</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">12</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">06</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">46</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">31.764522</span><span style="color:#E1E4E8;"> logstash.go</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">90</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">INFO</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Max</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Retries</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">set</span><span style="color:#E1E4E8;"> to</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">3</span></span>
<span class="line"><span style="color:#79B8FF;">2020</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">10</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">12</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">06</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">46</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">31.764588</span><span style="color:#E1E4E8;"> outputs.go</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">108</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">INFO</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Activated</span><span style="color:#E1E4E8;"> logstash </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> output plugin.</span></span>
<span class="line"><span style="color:#79B8FF;">2020</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">10</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">12</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">06</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">46</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">31.764586</span><span style="color:#E1E4E8;"> metrics.go</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">23</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">INFO</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Metrics</span><span style="color:#E1E4E8;"> logging every 30s</span></span>
<span class="line"><span style="color:#79B8FF;">2020</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">10</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">12</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">06</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">46</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">31.764664</span><span style="color:#E1E4E8;"> publish.go</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">295</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">INFO</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Publisher</span><span style="color:#E1E4E8;"> name</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">VM_1_14_centos</span></span>
<span class="line"><span style="color:#79B8FF;">2020</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">10</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">12</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">06</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">46</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">31.765299</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">async</span><span style="color:#E1E4E8;">.go</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">63</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">INFO</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Flush</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Interval</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">set</span><span style="color:#E1E4E8;"> to</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> 1s</span></span>
<span class="line"><span style="color:#79B8FF;">2020</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">10</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">12</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">06</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">46</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">31.765315</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">async</span><span style="color:#E1E4E8;">.go</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">64</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">INFO</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Max</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Bulk</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Size</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">set</span><span style="color:#E1E4E8;"> to</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2048</span></span>
<span class="line"><span style="color:#79B8FF;">2020</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">10</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">12</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">06</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">46</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">31.765563</span><span style="color:#E1E4E8;"> beat.go</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">221</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">INFO</span><span style="color:#E1E4E8;"> filebeat start running.</span></span>
<span class="line"><span style="color:#79B8FF;">2020</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">10</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">12</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">06</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">46</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">31.765592</span><span style="color:#E1E4E8;"> registrar.go</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">85</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">INFO</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Registry</span><span style="color:#E1E4E8;"> file </span><span style="color:#F97583;">set</span><span style="color:#E1E4E8;"> to</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">elk</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">filebeat</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">data</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">registry</span></span>
<span class="line"><span style="color:#79B8FF;">2020</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">10</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">12</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">06</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">46</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">31.765630</span><span style="color:#E1E4E8;"> registrar.go</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">106</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">INFO</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Loading</span><span style="color:#E1E4E8;"> registrar data from </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">elk</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">filebeat</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">data</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">registry</span></span>
<span class="line"><span style="color:#79B8FF;">2020</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">10</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">12</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">06</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">46</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">31.766100</span><span style="color:#E1E4E8;"> registrar.go</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">123</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">INFO</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">States</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Loaded</span><span style="color:#E1E4E8;"> from registrar</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">6</span></span>
<span class="line"><span style="color:#79B8FF;">2020</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">10</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">12</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">06</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">46</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">31.766136</span><span style="color:#E1E4E8;"> crawler.go</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">38</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">INFO</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Loading</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Prospectors</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span></span>
<span class="line"><span style="color:#79B8FF;">2020</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">10</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">12</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">06</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">46</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">31.766209</span><span style="color:#E1E4E8;"> registrar.go</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">236</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">INFO</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Starting</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Registrar</span></span>
<span class="line"><span style="color:#79B8FF;">2020</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">10</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">12</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">06</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">46</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">31.766256</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">sync</span><span style="color:#E1E4E8;">.go</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">41</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">INFO</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Start</span><span style="color:#E1E4E8;"> sending events to output</span></span>
<span class="line"><span style="color:#79B8FF;">2020</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">10</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">12</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">06</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">46</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">31.766291</span><span style="color:#E1E4E8;"> prospector_log.go</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">65</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">INFO</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Prospector</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">with</span><span style="color:#E1E4E8;"> previous states loaded</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#79B8FF;">2020</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">10</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">12</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">06</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">46</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">31.766390</span><span style="color:#E1E4E8;"> prospector.go</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">124</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">INFO</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Starting</span><span style="color:#E1E4E8;"> prospector of type</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> log; id</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2536729917787673381</span></span>
<span class="line"><span style="color:#79B8FF;">2020</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">10</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">12</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">06</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">46</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">31.766422</span><span style="color:#E1E4E8;"> crawler.go</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">58</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">INFO</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Loading</span><span style="color:#E1E4E8;"> and starting </span><span style="color:#79B8FF;">Prospectors</span><span style="color:#E1E4E8;"> completed. </span><span style="color:#79B8FF;">Enabled</span><span style="color:#E1E4E8;"> prospectors</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span></span>
<span class="line"><span style="color:#79B8FF;">2020</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">10</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">12</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">06</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">46</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">31.766430</span><span style="color:#E1E4E8;"> spooler.go</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">63</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">INFO</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Starting</span><span style="color:#E1E4E8;"> spooler</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> spool_size</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2048</span><span style="color:#E1E4E8;">; idle_timeout</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> 5s</span></span>
<span class="line"><span style="color:#79B8FF;">2020</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">10</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">12</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">06</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">47</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">01.764888</span><span style="color:#E1E4E8;"> metrics.go</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">34</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">INFO</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">No</span><span style="color:#E1E4E8;"> non</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">zero metrics </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> the last 30s</span></span>
<span class="line"><span style="color:#79B8FF;">2020</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">10</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">12</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">06</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">47</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">31.764929</span><span style="color:#E1E4E8;"> metrics.go</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">34</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">INFO</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">No</span><span style="color:#E1E4E8;"> non</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">zero metrics </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> the last 30s</span></span>
<span class="line"><span style="color:#79B8FF;">2020</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">10</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">12</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">06</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">48</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">01.765134</span><span style="color:#E1E4E8;"> metrics.go</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">34</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">INFO</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">No</span><span style="color:#E1E4E8;"> non</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">zero metrics </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> the last 30s</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">$ .</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">filebeat  </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">e  </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">c client.yml</span></span>
<span class="line"><span style="color:#005CC5;">2020</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">10</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">12</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">06</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">46</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">31.764391</span><span style="color:#24292E;"> beat.go</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">285</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">INFO</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Home</span><span style="color:#24292E;"> path</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> [</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">elk</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">filebeat] </span><span style="color:#005CC5;">Config</span><span style="color:#24292E;"> path</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> [</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">elk</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">filebeat] </span><span style="color:#005CC5;">Data</span><span style="color:#24292E;"> path</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> [</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">elk</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">filebeat</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">data] </span><span style="color:#005CC5;">Logs</span><span style="color:#24292E;"> path</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> [</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">elk</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">filebeat</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">logs]</span></span>
<span class="line"><span style="color:#005CC5;">2020</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">10</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">12</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">06</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">46</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">31.764426</span><span style="color:#24292E;"> beat.go</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">186</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">INFO</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Setup</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Beat</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> filebeat; </span><span style="color:#005CC5;">Version</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5.4</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">3</span></span>
<span class="line"><span style="color:#005CC5;">2020</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">10</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">12</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">06</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">46</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">31.764522</span><span style="color:#24292E;"> logstash.go</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">90</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">INFO</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Max</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Retries</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">set</span><span style="color:#24292E;"> to</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">3</span></span>
<span class="line"><span style="color:#005CC5;">2020</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">10</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">12</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">06</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">46</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">31.764588</span><span style="color:#24292E;"> outputs.go</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">108</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">INFO</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Activated</span><span style="color:#24292E;"> logstash </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> output plugin.</span></span>
<span class="line"><span style="color:#005CC5;">2020</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">10</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">12</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">06</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">46</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">31.764586</span><span style="color:#24292E;"> metrics.go</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">23</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">INFO</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Metrics</span><span style="color:#24292E;"> logging every 30s</span></span>
<span class="line"><span style="color:#005CC5;">2020</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">10</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">12</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">06</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">46</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">31.764664</span><span style="color:#24292E;"> publish.go</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">295</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">INFO</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Publisher</span><span style="color:#24292E;"> name</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">VM_1_14_centos</span></span>
<span class="line"><span style="color:#005CC5;">2020</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">10</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">12</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">06</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">46</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">31.765299</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">async</span><span style="color:#24292E;">.go</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">63</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">INFO</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Flush</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Interval</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">set</span><span style="color:#24292E;"> to</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> 1s</span></span>
<span class="line"><span style="color:#005CC5;">2020</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">10</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">12</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">06</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">46</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">31.765315</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">async</span><span style="color:#24292E;">.go</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">64</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">INFO</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Max</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Bulk</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Size</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">set</span><span style="color:#24292E;"> to</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2048</span></span>
<span class="line"><span style="color:#005CC5;">2020</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">10</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">12</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">06</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">46</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">31.765563</span><span style="color:#24292E;"> beat.go</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">221</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">INFO</span><span style="color:#24292E;"> filebeat start running.</span></span>
<span class="line"><span style="color:#005CC5;">2020</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">10</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">12</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">06</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">46</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">31.765592</span><span style="color:#24292E;"> registrar.go</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">85</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">INFO</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Registry</span><span style="color:#24292E;"> file </span><span style="color:#D73A49;">set</span><span style="color:#24292E;"> to</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">/</span><span style="color:#24292E;">elk</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">filebeat</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">data</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">registry</span></span>
<span class="line"><span style="color:#005CC5;">2020</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">10</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">12</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">06</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">46</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">31.765630</span><span style="color:#24292E;"> registrar.go</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">106</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">INFO</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Loading</span><span style="color:#24292E;"> registrar data from </span><span style="color:#D73A49;">/</span><span style="color:#24292E;">elk</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">filebeat</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">data</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">registry</span></span>
<span class="line"><span style="color:#005CC5;">2020</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">10</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">12</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">06</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">46</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">31.766100</span><span style="color:#24292E;"> registrar.go</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">123</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">INFO</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">States</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Loaded</span><span style="color:#24292E;"> from registrar</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">6</span></span>
<span class="line"><span style="color:#005CC5;">2020</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">10</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">12</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">06</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">46</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">31.766136</span><span style="color:#24292E;"> crawler.go</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">38</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">INFO</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Loading</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Prospectors</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span></span>
<span class="line"><span style="color:#005CC5;">2020</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">10</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">12</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">06</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">46</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">31.766209</span><span style="color:#24292E;"> registrar.go</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">236</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">INFO</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Starting</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Registrar</span></span>
<span class="line"><span style="color:#005CC5;">2020</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">10</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">12</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">06</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">46</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">31.766256</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">sync</span><span style="color:#24292E;">.go</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">41</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">INFO</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Start</span><span style="color:#24292E;"> sending events to output</span></span>
<span class="line"><span style="color:#005CC5;">2020</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">10</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">12</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">06</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">46</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">31.766291</span><span style="color:#24292E;"> prospector_log.go</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">65</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">INFO</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Prospector</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">with</span><span style="color:#24292E;"> previous states loaded</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#005CC5;">2020</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">10</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">12</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">06</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">46</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">31.766390</span><span style="color:#24292E;"> prospector.go</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">124</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">INFO</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Starting</span><span style="color:#24292E;"> prospector of type</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> log; id</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2536729917787673381</span></span>
<span class="line"><span style="color:#005CC5;">2020</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">10</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">12</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">06</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">46</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">31.766422</span><span style="color:#24292E;"> crawler.go</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">58</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">INFO</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Loading</span><span style="color:#24292E;"> and starting </span><span style="color:#005CC5;">Prospectors</span><span style="color:#24292E;"> completed. </span><span style="color:#005CC5;">Enabled</span><span style="color:#24292E;"> prospectors</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span></span>
<span class="line"><span style="color:#005CC5;">2020</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">10</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">12</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">06</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">46</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">31.766430</span><span style="color:#24292E;"> spooler.go</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">63</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">INFO</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Starting</span><span style="color:#24292E;"> spooler</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> spool_size</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2048</span><span style="color:#24292E;">; idle_timeout</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> 5s</span></span>
<span class="line"><span style="color:#005CC5;">2020</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">10</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">12</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">06</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">47</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">01.764888</span><span style="color:#24292E;"> metrics.go</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">34</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">INFO</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">No</span><span style="color:#24292E;"> non</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">zero metrics </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> the last 30s</span></span>
<span class="line"><span style="color:#005CC5;">2020</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">10</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">12</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">06</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">47</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">31.764929</span><span style="color:#24292E;"> metrics.go</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">34</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">INFO</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">No</span><span style="color:#24292E;"> non</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">zero metrics </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> the last 30s</span></span>
<span class="line"><span style="color:#005CC5;">2020</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">10</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">12</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">06</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">48</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">01.765134</span><span style="color:#24292E;"> metrics.go</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">34</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">INFO</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">No</span><span style="color:#24292E;"> non</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">zero metrics </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> the last 30s</span></span></code></pre></div><p>Filebeat 将启动一个或多个输入日志或文件位置，这些输入将在日志数据指定的位置中查找。除此之外，Filebeat 还会将监听到的数据发送到其预先配置好的指定输出源。</p><h3 id="elkb-的使用实践" tabindex="-1">ELKB 的使用实践 <a class="header-anchor" href="#elkb-的使用实践" aria-label="Permalink to &quot;ELKB 的使用实践&quot;">​</a></h3><p>安装好 ELKB 组件之后，我们开始整合这些组件。首先看下 ELKB 收集日志的流程：</p>`,9),q=s("p",null,"ELKB 收集日志的流程图",-1),A=s("p",null,"Filebeat 监听应用的日志文件，随后将数据发送给 Logstash；Logstash 会对数据进行过滤和格式化，如 JSON 格式化，之后将处理好的日志数据发送给 Elasticsearch；Elasticsearch 存储并建立搜索的索引；Kibana 则会调用 Elasticsearch 的存储，为用户提供可视化的视图页面。",-1),B=s("p",null,"我们运行所有的组件之后，首先看下 elasticsearch-head 中的索引变化：",-1),D=s("p",null,"elasticsearch-head 中的索引界面",-1),b=s("p",null,[a("可以看到多了一个"),s("code",null,"filebeat-2020.10.12"),a("的索引，这说明 ELKB 分布式日志收集框架搭建成功。访问 "),s("a",{href:"http://localhost:9100",target:"_blank",rel:"noreferrer"},"http://localhost:9100"),a("，我们来具体看下索引中的具体数据：")],-1),_=s("p",null,"日志信息截图",-1),m=s("p",null,"从上面截图可以看到，/var/log/ 目录下的 mysqld.log 文件中产生了新的日志数据，这些数据非常多，我们在生产环境中需要根据实际的业务进行过滤，并处理相应的日志格式。",-1),f=s("p",null,"Kibana 日志界面",-1),k=s("p",null,[a("elasticsearch-head 仅仅是一个简单的 Elasticsearch 客户端，为了更加完整地统计和搜索需求，就需要借助于 Kibana，Kibana 具有很强大的分析能力。上面的 Kibana（访问 "),s("a",{href:"http://localhost:5601",target:"_blank",rel:"noreferrer"},"http://localhost:5601"),a("）运行截图展示了 Filebeat 监听到的 mysql 日志，图中可以看到这些日志信息。")],-1),v=s("p",null,"基于 Elasticsearch，Kibana 可以友好地展示海量日志的统计视图，并根据结果生成折线图、直方图和饼图等，这里就不一一展示了。",-1),I=s("h3",{id:"小结",tabindex:"-1"},[a("小结 "),s("a",{class:"header-anchor",href:"#小结","aria-label":'Permalink to "小结"'},"​")],-1),N=s("p",null,"本课时主要介绍了分布式日志采集系统 ELKB。日志主要用来记录离散的事件，包含程序执行到某一点或某一阶段的详细信息。ELKB 很好地解决了微服务架构下，服务实例众多且分散、日志难以收集和分析的问题。限于篇幅，本课时只介绍了 ELKB 的安装和使用，其实 Go 微服务中一般使用日志框架（如 logrus、zap 等），按照一定的格式将日志输出到指定的位置，这里就交给你自行构建一个微服务进行实践了。",-1),L=s("p",null,"在第 33 课时，我们讲解了使用分布式链路追踪组件来追踪分布式系统调用链路的问题，而本课时所讲的分布式日志框架也是用来解决分布式系统中发生的问题。关于二者的区别，以及使用的场景，你有什么经验和想法？欢迎你在留言区和我分享。",-1);function O(S,w,x,T,K,P){const n=t("Image");return e(),c("div",null,[y,E,l(n,{alt:"Drawing 0.png",src:"https://s0.lgstatic.com/i/image/M00/63/AB/Ciqc1F-WrqCAfyhyAAG2q-6nf6o454.png"}),a(),i,l(n,{alt:"Drawing 1.png",src:"https://s0.lgstatic.com/i/image/M00/63/B6/CgqCHl-Wrq-AE2cPAAMTezenVUk045.png"}),a(),F,l(n,{alt:"Drawing 2.png",src:"https://s0.lgstatic.com/i/image/M00/63/B6/CgqCHl-Wrt6AFxP1AA0vHSwXInE125.png"}),a(),u,C,g,l(n,{alt:"Drawing 3.png",src:"https://s0.lgstatic.com/i/image/M00/63/AB/Ciqc1F-WruaAULiSAABppBq55b8500.png"}),a(),h,l(n,{alt:"Drawing 4.png",src:"https://s0.lgstatic.com/i/image/M00/63/B6/CgqCHl-WrwmAbLLsAAEIOMM6eEI271.png"}),a(),d,l(n,{alt:"Go_微服务36_图（代替换）.png",src:"https://s0.lgstatic.com/i/image/M00/65/9A/Ciqc1F-bhKiASToRAAC-S76rRng777.png"}),a(),q,A,B,l(n,{alt:"Drawing 6.png",src:"https://s0.lgstatic.com/i/image/M00/63/AB/Ciqc1F-WryuAUHJAAAP7hK4sVTI416.png"}),a(),D,b,l(n,{alt:"Drawing 7.png",src:"https://s0.lgstatic.com/i/image/M00/63/AB/Ciqc1F-WrzWAHy_vABMEnUwlyUg879.png"}),a(),_,m,l(n,{alt:"Drawing 8.png",src:"https://s0.lgstatic.com/i/image/M00/63/B6/CgqCHl-Wrz2ACUhmAAsQ22P7Ts4988.png"}),a(),f,k,v,I,N,L])}const z=p(r,[["render",O]]);export{$ as __pageData,z as default};
