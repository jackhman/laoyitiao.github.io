import{_ as s,o as a,g as n,Q as l}from"./chunks/framework.f949202b.js";const h=JSON.parse('{"title":"网站入侵检测 ","description":"","frontmatter":{},"headers":[],"relativePath":"posts/frontEnd/Web 安全攻防之道_文档/(5987) 19  入侵排查：阻断与追踪黑客.md","filePath":"posts/frontEnd/Web 安全攻防之道_文档/(5987) 19  入侵排查：阻断与追踪黑客.md","lastUpdated":null}'),p={name:"posts/frontEnd/Web 安全攻防之道_文档/(5987) 19  入侵排查：阻断与追踪黑客.md"},o=l(`<p>本套课程花了不少篇幅讲解各种常见的 Web 漏洞攻防知识，但很多情况下，我们是无法保证 100% 的绝对安全。</p><p>如果你的网站真的被入侵攻击了，那应该怎么办呢？如何将损伤控制到最小？如何防止被再一次入侵？如何去追踪黑客的攻击来源？</p><p>所以，这节课我们就重点聊下如何进行入侵排查去阻断与追踪黑客。</p><p>网站被入侵的常见方法是上传 Webshell，这些在<a href="https://kaiwu.lagou.com/course/courseInfo.htm?courseId=585&amp;sid=20-h5Url-0#/detail/pc?id=5981" target="_blank" rel="noreferrer">《13 | 文件上传漏洞：种植服务器木马的捷径》</a>中都介绍过。因此本节课主要针对利用漏洞入侵后上传 Webshell 获取控制权的情况，介绍一些 Webshell 入侵应急处理方法，并会结合前面课程演示过的入侵过程，以实例来讲解入侵排查过程。</p><blockquote><p>这一过程，我们仍然以 Linux 平台为主。</p></blockquote><h3 id="网站入侵检测" tabindex="-1">网站入侵检测 <a class="header-anchor" href="#网站入侵检测" aria-label="Permalink to &quot;网站入侵检测&quot;">​</a></h3><p>想要获取被入侵的情况，除了外部报告、网页被篡改这两种途径，你自己还需要建立完善的入侵检测能力。</p><p>毕竟多数情况下，外部报告是为了获取奖金，看看国内外的 SRC 平台就知道；而网页被篡改通常是为了炫耀，这种反而不多，因此攻击者都会以隐藏为主，以保持对服务器的长期控制。</p><p>基于上述情况，如果你想更加主动、及时、全面地感知到网站被入侵，就需要有一套自己的入侵检测系统，可以自研或者采购，常见的网站入侵检测方法有以下三种。</p><ul><li><strong>基于流量检测</strong></li></ul><p>通过收集服务器的网络流量进行数据分析，检测攻击者发送的 payload 攻击特征，特别是 Webshell 特征进行检测和告警，以便及时发现被入侵情况。</p><ul><li><strong>基于文件检测</strong></li></ul><p>通过分析文件判断是否为恶意后门，与我们平常的病毒扫描一样，同时排查日志文件也可以发现入侵过程，有利于回溯整个攻击过程，比如稍后会介绍的河马检测工具。</p><ul><li><strong>基于行为检测</strong></li></ul><p>通过动态检测系统上的执行行为来判断是否为恶意行为，是否被入侵攻击。<a href="https://kaiwu.lagou.com/course/courseInfo.htm?courseId=585&amp;sid=20-h5Url-0#/detail/pc?id=5976" target="_blank" rel="noreferrer">《08 | SQL 注入：漏洞的检测与防御》</a>已介绍过的 RASP 也是检测入侵攻击的手段，比如通过 hook java/php 底层的命令执行函数，来判断当前是否执行到命令执行函数，若是，就表明可能已经被外部入侵。</p><h3 id="应急处置流程" tabindex="-1">应急处置流程 <a class="header-anchor" href="#应急处置流程" aria-label="Permalink to &quot;应急处置流程&quot;">​</a></h3><p>网站入侵，通常是由于网站漏洞的存在，导致被上传了 Webshell 文件。所以围绕漏洞，你可以采取以下步骤进行应急处置。</p><h4 id="_1-关闭外网进行排查" tabindex="-1">1.关闭外网进行排查 <a class="header-anchor" href="#_1-关闭外网进行排查" aria-label="Permalink to &quot;1.关闭外网进行排查&quot;">​</a></h4><p>为防止被进一步入侵窃取敏感信息，或者被内网渗透，应该在第一时间关闭外网，保留现场环境进行排查，等处理完善后再上线。先用 IPConfig 查看公司 IP 所在的网卡，比如是 eth1，那么就可以使用 ifdown eth1 关闭外网。</p><h4 id="_2-webshell-检测、分析与清除" tabindex="-1">2.Webshell 检测、分析与清除 <a class="header-anchor" href="#_2-webshell-检测、分析与清除" aria-label="Permalink to &quot;2.Webshell 检测、分析与清除&quot;">​</a></h4><ul><li><strong>检测</strong>Webshell 可以使用一些现成工具，比如 Windows 上的 D 盾、支持 Windows 和 Linux 的河马，还有支持 Linux 的长亭云牧，使用都很简单，指定目录/文件进行扫描即可。</li></ul><blockquote><p>更具体的使用介绍可以参考下文的&quot;常用的排查工具&quot;。</p></blockquote><ul><li><p>通过<strong>分析</strong>Webshell 文件的创建时间，也可以推测出入侵事件发生的时间段，不过有时候文件创建时间也可能被篡改，注意结合日志信息来综合判断；接着就是分析 Webshell 的行为，看是否还有其他后门存在，或者一些破坏性行为。</p></li><li><p>最后<strong>清除</strong>所有后门文件，清除前先留存一份，方便后续分析。</p></li></ul><h4 id="_3-web-日志分析" tabindex="-1">3.Web 日志分析 <a class="header-anchor" href="#_3-web-日志分析" aria-label="Permalink to &quot;3.Web 日志分析&quot;">​</a></h4><p>上一节课<a href="https://kaiwu.lagou.com/course/courseInfo.htm?courseId=585&amp;sid=20-h5Url-0#/detail/pc?id=5986" target="_blank" rel="noreferrer">《18 | 构建防线：服务器安全加固》</a>中就提到要开启 Web 日志，目的就用于此处。通过分析日志，帮助我们找到漏洞的位置，回溯整个攻击过程，同时通过定位 IP 来追踪黑客。</p><p>不同的服务器系统有不同的日志位置：</p><p><img src="https://s0.lgstatic.com/i/image6/M00/04/5F/Cgp9HWAqXSOADMa3AAEdCFivCf4606.png" alt="图片5.png"></p><h4 id="_4-系统后门与日志排查" tabindex="-1">4. 系统后门与日志排查 <a class="header-anchor" href="#_4-系统后门与日志排查" aria-label="Permalink to &quot;4. 系统后门与日志排查&quot;">​</a></h4><p>攻击者为了实现对服务器的长期控制，通常会在系统上留存后门等恶意程序。</p><p>所以在清除 Webshell 后，还应该对系统进行全面排查，比如是否有可疑文件、进程，进行一次本地病毒的查杀，确保所有恶意程序都被清除干净；否则，即使你修复漏洞了，攻击者仍可通过后门控制你的服务器，再一次遭遇被入侵的局面。</p><p>为方便你使用，我整理了一份常用的排查命令和工具的使用列表。</p><p><img src="https://s0.lgstatic.com/i/image6/M00/04/5C/CioPOWAqXT6AUHbKAAiWbH7k9uk805.png" alt="图片6.png"></p><h4 id="_5-漏洞分析、复现与修复" tabindex="-1">5. 漏洞分析、复现与修复 <a class="header-anchor" href="#_5-漏洞分析、复现与修复" aria-label="Permalink to &quot;5. 漏洞分析、复现与修复&quot;">​</a></h4><p>通过前面分析 Web 日志来定位漏洞，通过访问 Webshell 的 IP 来收集此 IP 的所有访问记录，根据记录我们可以推测出以下两种情况：</p><ul><li><p>比如，访问上传接口后就访问 Webshell，那就有可能存在上传文件漏洞；</p></li><li><p>比如，大批量地尝试登录后台，那可能是在暴力破解密码，可以看攻击者是否成功访问后台，来判断是否破解成功。</p></li></ul><p>之后就是去尝试<strong>重现</strong> 漏洞，以验证前面的推测。若确认漏洞存在，就需要进行<strong>修复</strong>，修复后才能上线。</p><h4 id="_6-安全加固后上线" tabindex="-1">6. 安全加固后上线 <a class="header-anchor" href="#_6-安全加固后上线" aria-label="Permalink to &quot;6. 安全加固后上线&quot;">​</a></h4><p>可参考<a href="https://kaiwu.lagou.com/course/courseInfo.htm?courseId=585&amp;sid=20-h5Url-0#/detail/pc?id=5986" target="_blank" rel="noreferrer">《18 | 构建防线：服务器安全加固》</a>介绍的服务器加固方法进行安全加固，此处不再赘述，等加固完成后再上线恢复业务。</p><h3 id="常用的排查工具" tabindex="-1">常用的排查工具 <a class="header-anchor" href="#常用的排查工具" aria-label="Permalink to &quot;常用的排查工具&quot;">​</a></h3><h4 id="_1-河马" tabindex="-1">1.<a href="https://www.shellpub.com/" target="_blank" rel="noreferrer">河马</a> <a class="header-anchor" href="#_1-河马" aria-label="Permalink to &quot;1.[河马](https://www.shellpub.com/)&quot;">​</a></h4><p>专注于 Webshell 查杀研究的工具，采用传统特征与云端大数据双引擎的查杀技术，支持 Windows 与 Linux 平台，跨平台的工具比较方便，使用也简单，通过指定目录路径即可开启扫描：</p><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">hm scan .</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Web目录</span></span>
<span class="line"><span style="color:#E1E4E8;">hm deepscan .</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Web目录</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">hm scan .</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Web目录</span></span>
<span class="line"><span style="color:#24292E;">hm deepscan .</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Web目录</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="_2-牧云-cloudwalker" tabindex="-1">2.<a href="https://github.com/chaitin/cloudwalker" target="_blank" rel="noreferrer">牧云（CloudWalker）</a> <a class="header-anchor" href="#_2-牧云-cloudwalker" aria-label="Permalink to &quot;2.[牧云（CloudWalker）](https://github.com/chaitin/cloudwalker)&quot;">​</a></h4><p>牧云是由长亭科技开发的一款开源的 Webshell 检测工具，支持 macOS 与 Linux 系统，可以输出 Html 检测报告。目前检测结果分为 5 个级别（Risk:1~5），如下图所示，级别越高说明检测出 Webshell 的可能性越高，如果没有级别则说明不存在 Webshell 风险。</p><blockquote><p>该开源工具已停止更新，长亭已经转做企业版收费，不再开源。</p></blockquote><p>牧云使用如下命令扫描指定目录并生成报告：</p><pre><code>$ ./webshell-detector -html -output result.html /path/to/web-root/
</code></pre><p><img src="https://s0.lgstatic.com/i/image6/M00/04/5F/Cgp9HWAqXW2AaS4sAB64Um8gdIs285.png" alt="图片1.png"><br> 牧云</p><h4 id="_3-php-malware-finder" tabindex="-1">3.<a href="https://github.com/jvoisin/php-malware-finder" target="_blank" rel="noreferrer">PHP Malware Finder</a> <a class="header-anchor" href="#_3-php-malware-finder" aria-label="Permalink to &quot;3.[PHP Malware Finder](https://github.com/jvoisin/php-malware-finder)&quot;">​</a></h4><p>PHP Malware Finder 是一款基于 yara 规则检测 Webshell 和恶意软件混淆代码的工具，在检测一些混淆编码的 Webshell 时比较有效。</p><p>使用如下命令来扫描指定目录以检测是否存在恶意的 Webshell：</p><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">.</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">phpmalwarefinder  [</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">cfhtv] [</span><span style="color:#F97583;">-</span><span style="color:#B392F0;">l</span><span style="color:#E1E4E8;"> (php</span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">asp)] </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">file</span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">folder</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#E1E4E8;">yara </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">r .</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">php.yar </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">var</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">www</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">.</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">phpmalwarefinder  [</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">cfhtv] [</span><span style="color:#D73A49;">-</span><span style="color:#6F42C1;">l</span><span style="color:#24292E;"> (php</span><span style="color:#D73A49;">|</span><span style="color:#24292E;">asp)] </span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">file</span><span style="color:#D73A49;">|</span><span style="color:#24292E;">folder</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#24292E;">yara </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">r .</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">php.yar </span><span style="color:#D73A49;">/</span><span style="color:#24292E;">var</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">www</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="_4-d-盾" tabindex="-1">4.<a href="http://www.d99net.net/" target="_blank" rel="noreferrer">D 盾</a> <a class="header-anchor" href="#_4-d-盾" aria-label="Permalink to &quot;4.[D 盾](http://www.d99net.net/)&quot;">​</a></h4><p>D 盾是 Windows 平台上的 Web 防火墙，但它也支持 Webshell 查杀。目前它仅支持 Windows，是 Windows 上使用比较广泛的 Web 查杀软件；若 Linux 系统也需要用，可以拷贝文件到 Windows 上进行扫描，或者尝试使用 Wine。</p><p><img src="https://s0.lgstatic.com/i/image6/M00/04/5F/Cgp9HWAqXYiAGKGXABBu6zfx9FY061.png" alt="图片2.png"><br> D 盾 Web 查杀</p><h4 id="_5-lorg-apache-日志分析工具" tabindex="-1">5.<a href="https://github.com/jensvoid/lorg" target="_blank" rel="noreferrer">Lorg：Apache 日志分析工具</a> <a class="header-anchor" href="#_5-lorg-apache-日志分析工具" aria-label="Permalink to &quot;5.[Lorg：Apache 日志分析工具](https://github.com/jensvoid/lorg)&quot;">​</a></h4><p>Lorg 是一款 Apache 日志的安全分析工具，可以帮助你识别日志中潜在的 Web 漏洞攻击行为，便于你快速定位漏洞位置，支持多种常见 Web 漏洞类型的识别，支持 html、json、xml、csv 多个格式的检测报告输出。</p><p>使用如下命令来指定访问日志路径进行分析：</p><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">.</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">lorg </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">d phpids </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">u </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">g </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">path</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">to</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">access_log</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">.</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">lorg </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">d phpids </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">u </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">g </span><span style="color:#D73A49;">/</span><span style="color:#24292E;">path</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">to</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">access_log</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="实例演示" tabindex="-1">实例演示 <a class="header-anchor" href="#实例演示" aria-label="Permalink to &quot;实例演示&quot;">​</a></h3><p>接下来，我们以<a href="https://kaiwu.lagou.com/course/courseInfo.htm?courseId=585&amp;sid=20-h5Url-0#/detail/pc?id=5981" target="_blank" rel="noreferrer">《13 | 文件上传漏洞：种植服务器木马的捷径》</a>的上传文件漏洞为例，在利用漏洞上传 Webshell 完成入侵后，按照刚刚&quot;应急处置流程&quot;中讲解的步骤，从防御者的角度来看如何应急响应。</p><h4 id="_1-关闭外网进行排查-1" tabindex="-1">1.关闭外网进行排查 <a class="header-anchor" href="#_1-关闭外网进行排查-1" aria-label="Permalink to &quot;1.关闭外网进行排查&quot;">​</a></h4><p>先关闭外网，然后登录服务器进行排查。先借助 Wappalyzer 插件看下目标网站的指纹信息，如下图所示，可以看到是 Apache、Ubuntu 与 PHP 的环境，Apache 的网站目录通常位于 /var/www/html，直接打开验证下就知道（DVWA 靶场也确实位于此目录下）。</p><p><img src="https://s0.lgstatic.com/i/image6/M00/04/5F/Cgp9HWAqXZ-ABTXGAAJmjKlYcNU577.png" alt="图片3.png"><br> DVWA 靶场网站指纹</p><h4 id="_2-webshell-检测" tabindex="-1">2.Webshell 检测 <a class="header-anchor" href="#_2-webshell-检测" aria-label="Permalink to &quot;2.Webshell 检测&quot;">​</a></h4><p>接下来用河马对网站根目录进行 Webshell 扫描，采用<strong>深度扫描模式</strong>，否则它会扫描指定目录，而不会循环遍历目录扫描：</p><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">root@</span><span style="color:#F97583;">346953e9d6e9:/</span><span style="color:#E1E4E8;"># .</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">hm scan </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">var</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">www</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">html</span></span>
<span class="line"><span style="color:#E1E4E8;">                                 {</span><span style="color:#79B8FF;">1.8</span><span style="color:#E1E4E8;">.</span><span style="color:#FDAEB7;font-style:italic;">2</span><span style="color:#E1E4E8;"> hm#linux</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">amd64.</span><span style="color:#FDAEB7;font-style:italic;">24fbb40</span><span style="color:#E1E4E8;">}</span></span>
<span class="line"><span style="color:#E1E4E8;"> __</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">|--</span><span style="color:#E1E4E8;">.</span><span style="color:#F97583;">-----</span><span style="color:#E1E4E8;">.</span><span style="color:#F97583;">--------</span><span style="color:#E1E4E8;">.</span><span style="color:#F97583;">---</span><span style="color:#E1E4E8;">.</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">.</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">     </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">__</span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">  _  </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">__</span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">__</span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">_____</span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">__</span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">__</span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">__</span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">___._</span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#E1E4E8;">                                 http</span><span style="color:#F97583;">:</span><span style="color:#6A737D;">//www.shellpub.com</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">[</span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">] 扫描预处理 </span><span style="color:#79B8FF;">2021</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">02</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">12</span><span style="color:#E1E4E8;"> 08</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">13</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">18</span></span>
<span class="line"><span style="color:#E1E4E8;">[</span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">] 开始扫描 </span><span style="color:#79B8FF;">2021</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">02</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">12</span><span style="color:#E1E4E8;"> 08</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">13</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">18</span></span>
<span class="line"><span style="color:#F97583;">ERRO</span><span style="color:#E1E4E8;">[</span><span style="color:#79B8FF;">0001</span><span style="color:#E1E4E8;">] cloud invalid error</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> invalid character </span><span style="color:#9ECBFF;">&#39;&lt;&#39;</span><span style="color:#E1E4E8;"> looking </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> beginning of value </span></span>
<span class="line"><span style="color:#F97583;">+------+----------+------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> 类型 </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> 深度查杀 </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> 数量 </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">+------+----------+------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> 后门 </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> 疑似 </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">+------+----------+------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">          总计   </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">+------+----------+------+</span></span>
<span class="line"><span style="color:#E1E4E8;">[</span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">] 恭喜</span><span style="color:#F97583;">!</span><span style="color:#E1E4E8;">没有发现网站后门,  请您继续保持</span><span style="color:#F97583;">!</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">root@</span><span style="color:#D73A49;">346953e9d6e9:/</span><span style="color:#24292E;"># .</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">hm scan </span><span style="color:#D73A49;">/</span><span style="color:#24292E;">var</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">www</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">html</span></span>
<span class="line"><span style="color:#24292E;">                                 {</span><span style="color:#005CC5;">1.8</span><span style="color:#24292E;">.</span><span style="color:#B31D28;font-style:italic;">2</span><span style="color:#24292E;"> hm#linux</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">amd64.</span><span style="color:#B31D28;font-style:italic;">24fbb40</span><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#24292E;"> __</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;">  </span><span style="color:#D73A49;">|--</span><span style="color:#24292E;">.</span><span style="color:#D73A49;">-----</span><span style="color:#24292E;">.</span><span style="color:#D73A49;">--------</span><span style="color:#24292E;">.</span><span style="color:#D73A49;">---</span><span style="color:#24292E;">.</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">.</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;">     </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">  </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">__</span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">  _  </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;">__</span><span style="color:#D73A49;">|</span><span style="color:#24292E;">__</span><span style="color:#D73A49;">|</span><span style="color:#24292E;">_____</span><span style="color:#D73A49;">|</span><span style="color:#24292E;">__</span><span style="color:#D73A49;">|</span><span style="color:#24292E;">__</span><span style="color:#D73A49;">|</span><span style="color:#24292E;">__</span><span style="color:#D73A49;">|</span><span style="color:#24292E;">___._</span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#24292E;">                                 http</span><span style="color:#D73A49;">:</span><span style="color:#6A737D;">//www.shellpub.com</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#D73A49;">*</span><span style="color:#24292E;">] 扫描预处理 </span><span style="color:#005CC5;">2021</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">02</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">12</span><span style="color:#24292E;"> 08</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">13</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">18</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#D73A49;">*</span><span style="color:#24292E;">] 开始扫描 </span><span style="color:#005CC5;">2021</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">02</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">12</span><span style="color:#24292E;"> 08</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">13</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">18</span></span>
<span class="line"><span style="color:#D73A49;">ERRO</span><span style="color:#24292E;">[</span><span style="color:#005CC5;">0001</span><span style="color:#24292E;">] cloud invalid error</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> invalid character </span><span style="color:#032F62;">&#39;&lt;&#39;</span><span style="color:#24292E;"> looking </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> beginning of value </span></span>
<span class="line"><span style="color:#D73A49;">+------+----------+------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> 类型 </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> 深度查杀 </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> 数量 </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">+------+----------+------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> 后门 </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">    </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> 疑似 </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">    </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">+------+----------+------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;">          总计   </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">+------+----------+------+</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#D73A49;">*</span><span style="color:#24292E;">] 恭喜</span><span style="color:#D73A49;">!</span><span style="color:#24292E;">没有发现网站后门,  请您继续保持</span><span style="color:#D73A49;">!</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>为什么扫不到呢？这是河马扫描机制的一个缺陷，因为 /var/www/html 是个指向 /app 的软链接：</p><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">root@</span><span style="color:#F97583;">346953e9d6e9:/</span><span style="color:#E1E4E8;"># ll </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">var</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">www</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">html</span></span>
<span class="line"><span style="color:#E1E4E8;">lrwxrwxrwx </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> root root </span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;"> Feb </span><span style="color:#79B8FF;">15</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">2016</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">var</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">www</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">html </span><span style="color:#F97583;">-&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">app</span><span style="color:#F97583;">/</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">root@</span><span style="color:#D73A49;">346953e9d6e9:/</span><span style="color:#24292E;"># ll </span><span style="color:#D73A49;">/</span><span style="color:#24292E;">var</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">www</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">html</span></span>
<span class="line"><span style="color:#24292E;">lrwxrwxrwx </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> root root </span><span style="color:#005CC5;">4</span><span style="color:#24292E;"> Feb </span><span style="color:#005CC5;">15</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">2016</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">/</span><span style="color:#24292E;">var</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">www</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">html </span><span style="color:#D73A49;">-&gt;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">/</span><span style="color:#24292E;">app</span><span style="color:#D73A49;">/</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>所以应该直接扫描 /app 目录：</p><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">root@</span><span style="color:#F97583;">346953e9d6e9:/</span><span style="color:#E1E4E8;"># .</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">hm scan </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">app</span></span>
<span class="line"><span style="color:#E1E4E8;">                                 {</span><span style="color:#79B8FF;">1.8</span><span style="color:#E1E4E8;">.</span><span style="color:#FDAEB7;font-style:italic;">2</span><span style="color:#E1E4E8;"> hm#linux</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">amd64.</span><span style="color:#FDAEB7;font-style:italic;">24fbb40</span><span style="color:#E1E4E8;">}</span></span>
<span class="line"><span style="color:#E1E4E8;"> __</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">|--</span><span style="color:#E1E4E8;">.</span><span style="color:#F97583;">-----</span><span style="color:#E1E4E8;">.</span><span style="color:#F97583;">--------</span><span style="color:#E1E4E8;">.</span><span style="color:#F97583;">---</span><span style="color:#E1E4E8;">.</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">.</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">     </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">__</span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">  _  </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">__</span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">__</span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">_____</span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">__</span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">__</span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">__</span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">___._</span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#E1E4E8;">                                 http</span><span style="color:#F97583;">:</span><span style="color:#6A737D;">//www.shellpub.com</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">[</span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">] 扫描预处理 </span><span style="color:#79B8FF;">2021</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">02</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">12</span><span style="color:#E1E4E8;"> 08</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">16</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">21</span></span>
<span class="line"><span style="color:#E1E4E8;">[</span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">] 开始扫描 </span><span style="color:#79B8FF;">2021</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">02</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">12</span><span style="color:#E1E4E8;"> 08</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">16</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">21</span></span>
<span class="line"><span style="color:#F97583;">|----------|</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">584</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#F97583;">%</span><span style="color:#E1E4E8;"> [elapsed</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> 56.</span><span style="color:#FDAEB7;font-style:italic;">037µs</span><span style="color:#E1E4E8;"> left</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> 0s,  </span><span style="color:#79B8FF;">0.00</span><span style="color:#E1E4E8;"> iters</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">sec]</span><span style="color:#79B8FF;">2021</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">02</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">12</span><span style="color:#E1E4E8;"> 08</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">16</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">22</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#E1E4E8;"> cloud scan error</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> invalid character </span><span style="color:#9ECBFF;">&#39;&lt;&#39;</span><span style="color:#E1E4E8;"> looking </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> beginning of value</span></span>
<span class="line"><span style="color:#F97583;">ERRO</span><span style="color:#E1E4E8;">[</span><span style="color:#79B8FF;">0002</span><span style="color:#E1E4E8;">] cloud invalid error</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> invalid character </span><span style="color:#9ECBFF;">&#39;&lt;&#39;</span><span style="color:#E1E4E8;"> looking </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> beginning of value </span></span>
<span class="line"><span style="color:#F97583;">+------+----------+------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> 类型 </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> 深度查杀 </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> 数量 </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">+------+----------+------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> 后门 </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> 疑似 </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">7</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">+------+----------+------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">          总计   </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">8</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">+------+----------+------+</span></span>
<span class="line"><span style="color:#E1E4E8;">[</span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">] 详细结果已经保存到结果路径的result.csv文件中</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">##########</span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">584</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">584</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">100</span><span style="color:#F97583;">%</span><span style="color:#E1E4E8;"> [elapsed</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> 1.</span><span style="color:#FDAEB7;font-style:italic;">000189195s</span><span style="color:#E1E4E8;"> left</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> 0s, </span><span style="color:#79B8FF;">583.89</span><span style="color:#E1E4E8;"> iters</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">sec]</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">root@</span><span style="color:#D73A49;">346953e9d6e9:/</span><span style="color:#24292E;"># .</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">hm scan </span><span style="color:#D73A49;">/</span><span style="color:#24292E;">app</span></span>
<span class="line"><span style="color:#24292E;">                                 {</span><span style="color:#005CC5;">1.8</span><span style="color:#24292E;">.</span><span style="color:#B31D28;font-style:italic;">2</span><span style="color:#24292E;"> hm#linux</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">amd64.</span><span style="color:#B31D28;font-style:italic;">24fbb40</span><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#24292E;"> __</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;">  </span><span style="color:#D73A49;">|--</span><span style="color:#24292E;">.</span><span style="color:#D73A49;">-----</span><span style="color:#24292E;">.</span><span style="color:#D73A49;">--------</span><span style="color:#24292E;">.</span><span style="color:#D73A49;">---</span><span style="color:#24292E;">.</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">.</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;">     </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">  </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">__</span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">  _  </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;">__</span><span style="color:#D73A49;">|</span><span style="color:#24292E;">__</span><span style="color:#D73A49;">|</span><span style="color:#24292E;">_____</span><span style="color:#D73A49;">|</span><span style="color:#24292E;">__</span><span style="color:#D73A49;">|</span><span style="color:#24292E;">__</span><span style="color:#D73A49;">|</span><span style="color:#24292E;">__</span><span style="color:#D73A49;">|</span><span style="color:#24292E;">___._</span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#24292E;">                                 http</span><span style="color:#D73A49;">:</span><span style="color:#6A737D;">//www.shellpub.com</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#D73A49;">*</span><span style="color:#24292E;">] 扫描预处理 </span><span style="color:#005CC5;">2021</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">02</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">12</span><span style="color:#24292E;"> 08</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">16</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">21</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#D73A49;">*</span><span style="color:#24292E;">] 开始扫描 </span><span style="color:#005CC5;">2021</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">02</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">12</span><span style="color:#24292E;"> 08</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">16</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">21</span></span>
<span class="line"><span style="color:#D73A49;">|----------|</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">584</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#D73A49;">%</span><span style="color:#24292E;"> [elapsed</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> 56.</span><span style="color:#B31D28;font-style:italic;">037µs</span><span style="color:#24292E;"> left</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> 0s,  </span><span style="color:#005CC5;">0.00</span><span style="color:#24292E;"> iters</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">sec]</span><span style="color:#005CC5;">2021</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">02</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">12</span><span style="color:#24292E;"> 08</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">16</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">22</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#24292E;"> cloud scan error</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> invalid character </span><span style="color:#032F62;">&#39;&lt;&#39;</span><span style="color:#24292E;"> looking </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> beginning of value</span></span>
<span class="line"><span style="color:#D73A49;">ERRO</span><span style="color:#24292E;">[</span><span style="color:#005CC5;">0002</span><span style="color:#24292E;">] cloud invalid error</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> invalid character </span><span style="color:#032F62;">&#39;&lt;&#39;</span><span style="color:#24292E;"> looking </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> beginning of value </span></span>
<span class="line"><span style="color:#D73A49;">+------+----------+------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> 类型 </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> 深度查杀 </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> 数量 </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">+------+----------+------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> 后门 </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">    </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> 疑似 </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">    </span><span style="color:#005CC5;">7</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">+------+----------+------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;">          总计   </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">8</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">+------+----------+------+</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#D73A49;">*</span><span style="color:#24292E;">] 详细结果已经保存到结果路径的result.csv文件中</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;">##########</span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">584</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">584</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">100</span><span style="color:#D73A49;">%</span><span style="color:#24292E;"> [elapsed</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> 1.</span><span style="color:#B31D28;font-style:italic;">000189195s</span><span style="color:#24292E;"> left</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> 0s, </span><span style="color:#005CC5;">583.89</span><span style="color:#24292E;"> iters</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">sec]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>扫到一个后门，打开 result.csv 看下：</p><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">root@</span><span style="color:#F97583;">346953e9d6e9:/</span><span style="color:#E1E4E8;"># cat result.csv </span></span>
<span class="line"><span style="color:#E1E4E8;">序号,类型,路径</span></span>
<span class="line"><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">,冰蝎3.</span><span style="color:#FDAEB7;font-style:italic;">0</span><span style="color:#E1E4E8;"> PHP</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">PHP后门，建议清理,</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">app</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">hackable</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">uploads</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">shell.php</span></span>
<span class="line"><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">,疑似PHP后门</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">建议人工确认,</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">app</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">external</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">phpids</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">0.6</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">lib</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">IDS</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">vendors</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">htmlpurifier</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">HTMLPurifier</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">AttrDef</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">HTML</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Color.php</span></span>
<span class="line"><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;">,疑似PHP后门</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">建议人工确认,</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">app</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">external</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">phpids</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">0.6</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">tests</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">IDS</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">MonitorTest.php</span></span>
<span class="line"><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;">,疑似PHP后门</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">建议人工确认,</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">app</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">vulnerabilities</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">exec</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">source</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">high.php</span></span>
<span class="line"><span style="color:#79B8FF;">5</span><span style="color:#E1E4E8;">,疑似PHP后门</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">建议人工确认,</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">app</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">vulnerabilities</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">exec</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">source</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">impossible.php</span></span>
<span class="line"><span style="color:#79B8FF;">6</span><span style="color:#E1E4E8;">,疑似PHP后门</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">建议人工确认,</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">app</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">vulnerabilities</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">exec</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">source</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">low.php</span></span>
<span class="line"><span style="color:#79B8FF;">7</span><span style="color:#E1E4E8;">,疑似PHP后门</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">建议人工确认,</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">app</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">vulnerabilities</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">exec</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">source</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">medium.php</span></span>
<span class="line"><span style="color:#79B8FF;">8</span><span style="color:#E1E4E8;">,疑似PHP后门</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">建议人工确认,</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">app</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">vulnerabilities</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">upload</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">help</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">help.php</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">root@</span><span style="color:#D73A49;">346953e9d6e9:/</span><span style="color:#24292E;"># cat result.csv </span></span>
<span class="line"><span style="color:#24292E;">序号,类型,路径</span></span>
<span class="line"><span style="color:#005CC5;">1</span><span style="color:#24292E;">,冰蝎3.</span><span style="color:#B31D28;font-style:italic;">0</span><span style="color:#24292E;"> PHP</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">PHP后门，建议清理,</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">app</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">hackable</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">uploads</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">shell.php</span></span>
<span class="line"><span style="color:#005CC5;">2</span><span style="color:#24292E;">,疑似PHP后门</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">建议人工确认,</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">app</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">external</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">phpids</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">0.6</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">lib</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">IDS</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">vendors</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">htmlpurifier</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">HTMLPurifier</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">AttrDef</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">HTML</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Color.php</span></span>
<span class="line"><span style="color:#005CC5;">3</span><span style="color:#24292E;">,疑似PHP后门</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">建议人工确认,</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">app</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">external</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">phpids</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">0.6</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">tests</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">IDS</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">MonitorTest.php</span></span>
<span class="line"><span style="color:#005CC5;">4</span><span style="color:#24292E;">,疑似PHP后门</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">建议人工确认,</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">app</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">vulnerabilities</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">exec</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">source</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">high.php</span></span>
<span class="line"><span style="color:#005CC5;">5</span><span style="color:#24292E;">,疑似PHP后门</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">建议人工确认,</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">app</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">vulnerabilities</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">exec</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">source</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">impossible.php</span></span>
<span class="line"><span style="color:#005CC5;">6</span><span style="color:#24292E;">,疑似PHP后门</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">建议人工确认,</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">app</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">vulnerabilities</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">exec</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">source</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">low.php</span></span>
<span class="line"><span style="color:#005CC5;">7</span><span style="color:#24292E;">,疑似PHP后门</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">建议人工确认,</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">app</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">vulnerabilities</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">exec</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">source</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">medium.php</span></span>
<span class="line"><span style="color:#005CC5;">8</span><span style="color:#24292E;">,疑似PHP后门</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">建议人工确认,</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">app</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">vulnerabilities</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">upload</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">help</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">help.php</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>非常明确地识别出 /app/hackable/uploads/shell.php 是冰蝎 Webshell，其他一些疑似 PHP 后门大多是存在漏洞的代码，在实际应用中，我们需要进一步去排查这些疑似文件。</p><h4 id="_3-web-日志分析-1" tabindex="-1">3.Web 日志分析 <a class="header-anchor" href="#_3-web-日志分析-1" aria-label="Permalink to &quot;3.Web 日志分析&quot;">​</a></h4><p>找到此 shell.php，我们就可以通过分析日志去定位攻击者，主要还是用于回溯攻击过程，因为攻击上传此 shell.php 后一般都会去访问或执行其他操作。</p><p>Apache 日志位于 /var/log/apache2/access.log，先定位访问 shell.php 的 IP 地址是 172.17.0.1。</p><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">root@</span><span style="color:#F97583;">346953e9d6e9:/</span><span style="color:#E1E4E8;">var</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">log</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">apache2# cat access.log</span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">grep shell.php</span></span>
<span class="line"><span style="color:#79B8FF;">172.17</span><span style="color:#E1E4E8;">.</span><span style="color:#FDAEB7;font-style:italic;">0</span><span style="color:#E1E4E8;">.</span><span style="color:#FDAEB7;font-style:italic;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> [</span><span style="color:#79B8FF;">12</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Feb</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">2021</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">07</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">45</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">51</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#79B8FF;">0000</span><span style="color:#E1E4E8;">] </span><span style="color:#9ECBFF;">&quot;GET /hackable/uploads/shell.php HTTP/1.1&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">404</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">516</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;-&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.198 Safari/537.36&quot;</span></span>
<span class="line"><span style="color:#79B8FF;">172.17</span><span style="color:#E1E4E8;">.</span><span style="color:#FDAEB7;font-style:italic;">0</span><span style="color:#E1E4E8;">.</span><span style="color:#FDAEB7;font-style:italic;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> [</span><span style="color:#79B8FF;">12</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Feb</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">2021</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">07</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">45</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">55</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#79B8FF;">0000</span><span style="color:#E1E4E8;">] </span><span style="color:#9ECBFF;">&quot;GET /hackable/uploads/shell.php HTTP/1.1&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">404</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">515</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;-&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.198 Safari/537.36&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">......</span></span>
<span class="line"><span style="color:#79B8FF;">172.17</span><span style="color:#E1E4E8;">.</span><span style="color:#FDAEB7;font-style:italic;">0</span><span style="color:#E1E4E8;">.</span><span style="color:#FDAEB7;font-style:italic;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> [</span><span style="color:#79B8FF;">12</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Feb</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">2021</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;">08</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">13</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">35</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#79B8FF;">0000</span><span style="color:#E1E4E8;">] </span><span style="color:#9ECBFF;">&quot;POST /hackable/uploads/shell.php HTTP/1.1&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">200</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">3995</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;-&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;Mozilla/5.0 (iPod; CPU iPhone OS 13_6 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) CriOS/84.0.4147.122 Mobile/15E148 Safari/604.1&quot;</span></span>
<span class="line"><span style="color:#79B8FF;">172.17</span><span style="color:#E1E4E8;">.</span><span style="color:#FDAEB7;font-style:italic;">0</span><span style="color:#E1E4E8;">.</span><span style="color:#FDAEB7;font-style:italic;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> [</span><span style="color:#79B8FF;">12</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Feb</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">2021</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;">08</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">20</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">35</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#79B8FF;">0000</span><span style="color:#E1E4E8;">] </span><span style="color:#9ECBFF;">&quot;POST /hackable/uploads/shell.php HTTP/1.1&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">200</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">4527</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;-&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;Mozilla/5.0 (iPod; CPU iPhone OS 13_6 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) CriOS/84.0.4147.122 Mobile/15E148 Safari/604.1&quot;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">root@</span><span style="color:#D73A49;">346953e9d6e9:/</span><span style="color:#24292E;">var</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">log</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">apache2# cat access.log</span><span style="color:#D73A49;">|</span><span style="color:#24292E;">grep shell.php</span></span>
<span class="line"><span style="color:#005CC5;">172.17</span><span style="color:#24292E;">.</span><span style="color:#B31D28;font-style:italic;">0</span><span style="color:#24292E;">.</span><span style="color:#B31D28;font-style:italic;">1</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> [</span><span style="color:#005CC5;">12</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Feb</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">2021</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">07</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">45</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">51</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#005CC5;">0000</span><span style="color:#24292E;">] </span><span style="color:#032F62;">&quot;GET /hackable/uploads/shell.php HTTP/1.1&quot;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">404</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">516</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;-&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.198 Safari/537.36&quot;</span></span>
<span class="line"><span style="color:#005CC5;">172.17</span><span style="color:#24292E;">.</span><span style="color:#B31D28;font-style:italic;">0</span><span style="color:#24292E;">.</span><span style="color:#B31D28;font-style:italic;">1</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> [</span><span style="color:#005CC5;">12</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Feb</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">2021</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">07</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">45</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">55</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#005CC5;">0000</span><span style="color:#24292E;">] </span><span style="color:#032F62;">&quot;GET /hackable/uploads/shell.php HTTP/1.1&quot;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">404</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">515</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;-&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.198 Safari/537.36&quot;</span></span>
<span class="line"><span style="color:#24292E;">......</span></span>
<span class="line"><span style="color:#005CC5;">172.17</span><span style="color:#24292E;">.</span><span style="color:#B31D28;font-style:italic;">0</span><span style="color:#24292E;">.</span><span style="color:#B31D28;font-style:italic;">1</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> [</span><span style="color:#005CC5;">12</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Feb</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">2021</span><span style="color:#D73A49;">:</span><span style="color:#24292E;">08</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">13</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">35</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#005CC5;">0000</span><span style="color:#24292E;">] </span><span style="color:#032F62;">&quot;POST /hackable/uploads/shell.php HTTP/1.1&quot;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">200</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">3995</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;-&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;Mozilla/5.0 (iPod; CPU iPhone OS 13_6 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) CriOS/84.0.4147.122 Mobile/15E148 Safari/604.1&quot;</span></span>
<span class="line"><span style="color:#005CC5;">172.17</span><span style="color:#24292E;">.</span><span style="color:#B31D28;font-style:italic;">0</span><span style="color:#24292E;">.</span><span style="color:#B31D28;font-style:italic;">1</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> [</span><span style="color:#005CC5;">12</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Feb</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">2021</span><span style="color:#D73A49;">:</span><span style="color:#24292E;">08</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">20</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">35</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#005CC5;">0000</span><span style="color:#24292E;">] </span><span style="color:#032F62;">&quot;POST /hackable/uploads/shell.php HTTP/1.1&quot;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">200</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">4527</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;-&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;Mozilla/5.0 (iPod; CPU iPhone OS 13_6 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) CriOS/84.0.4147.122 Mobile/15E148 Safari/604.1&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="_4-漏洞定位与复现" tabindex="-1">4.漏洞定位与复现 <a class="header-anchor" href="#_4-漏洞定位与复现" aria-label="Permalink to &quot;4.漏洞定位与复现&quot;">​</a></h4><p>从输出结果看，访问此 Webshell 的最早时间是 2021-02-12 07:45:51，再看下此时间之间该攻击者还访问了哪些地址。</p><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">root@</span><span style="color:#F97583;">346953e9d6e9:/</span><span style="color:#E1E4E8;">var</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">log</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">apache2# cat access.log</span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">grep </span><span style="color:#79B8FF;">172.17</span><span style="color:#E1E4E8;">.</span><span style="color:#FDAEB7;font-style:italic;">0</span><span style="color:#E1E4E8;">.</span><span style="color:#FDAEB7;font-style:italic;">1</span></span>
<span class="line"><span style="color:#79B8FF;">172.17</span><span style="color:#E1E4E8;">.</span><span style="color:#FDAEB7;font-style:italic;">0</span><span style="color:#E1E4E8;">.</span><span style="color:#FDAEB7;font-style:italic;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> [</span><span style="color:#79B8FF;">12</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Feb</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">2021</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">07</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">43</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">03</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#79B8FF;">0000</span><span style="color:#E1E4E8;">] </span><span style="color:#9ECBFF;">&quot;GET / HTTP/1.1&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">302</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">385</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;-&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.198 Safari/537.36&quot;</span></span>
<span class="line"><span style="color:#79B8FF;">172.17</span><span style="color:#E1E4E8;">.</span><span style="color:#FDAEB7;font-style:italic;">0</span><span style="color:#E1E4E8;">.</span><span style="color:#FDAEB7;font-style:italic;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> [</span><span style="color:#79B8FF;">12</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Feb</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">2021</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">07</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">43</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">03</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#79B8FF;">0000</span><span style="color:#E1E4E8;">] </span><span style="color:#9ECBFF;">&quot;GET /login.php HTTP/1.1&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">302</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">384</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;-&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.198 Safari/537.36&quot;</span></span>
<span class="line"><span style="color:#79B8FF;">172.17</span><span style="color:#E1E4E8;">.</span><span style="color:#FDAEB7;font-style:italic;">0</span><span style="color:#E1E4E8;">.</span><span style="color:#FDAEB7;font-style:italic;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> [</span><span style="color:#79B8FF;">12</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Feb</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">2021</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">07</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">43</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">03</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#79B8FF;">0000</span><span style="color:#E1E4E8;">] </span><span style="color:#9ECBFF;">&quot;GET /setup.php HTTP/1.1&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">200</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1822</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;-&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.198 Safari/537.36&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">......</span></span>
<span class="line"><span style="color:#79B8FF;">172.17</span><span style="color:#E1E4E8;">.</span><span style="color:#FDAEB7;font-style:italic;">0</span><span style="color:#E1E4E8;">.</span><span style="color:#FDAEB7;font-style:italic;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> [</span><span style="color:#79B8FF;">12</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Feb</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">2021</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">07</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">43</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">42</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#79B8FF;">0000</span><span style="color:#E1E4E8;">] </span><span style="color:#9ECBFF;">&quot;GET /vulnerabilities/upload/ HTTP/1.1&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">200</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1838</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;http://127.0.0.1:8081/index.php&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.198 Safari/537.36&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">......</span></span>
<span class="line"><span style="color:#79B8FF;">172.17</span><span style="color:#E1E4E8;">.</span><span style="color:#FDAEB7;font-style:italic;">0</span><span style="color:#E1E4E8;">.</span><span style="color:#FDAEB7;font-style:italic;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> [</span><span style="color:#79B8FF;">12</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Feb</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">2021</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">07</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">45</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">51</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#79B8FF;">0000</span><span style="color:#E1E4E8;">] </span><span style="color:#9ECBFF;">&quot;GET /hackable/uploads/shell.php HTTP/1.1&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">404</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">516</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;-&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.198 Safari/537.36&quot;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">root@</span><span style="color:#D73A49;">346953e9d6e9:/</span><span style="color:#24292E;">var</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">log</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">apache2# cat access.log</span><span style="color:#D73A49;">|</span><span style="color:#24292E;">grep </span><span style="color:#005CC5;">172.17</span><span style="color:#24292E;">.</span><span style="color:#B31D28;font-style:italic;">0</span><span style="color:#24292E;">.</span><span style="color:#B31D28;font-style:italic;">1</span></span>
<span class="line"><span style="color:#005CC5;">172.17</span><span style="color:#24292E;">.</span><span style="color:#B31D28;font-style:italic;">0</span><span style="color:#24292E;">.</span><span style="color:#B31D28;font-style:italic;">1</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> [</span><span style="color:#005CC5;">12</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Feb</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">2021</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">07</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">43</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">03</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#005CC5;">0000</span><span style="color:#24292E;">] </span><span style="color:#032F62;">&quot;GET / HTTP/1.1&quot;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">302</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">385</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;-&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.198 Safari/537.36&quot;</span></span>
<span class="line"><span style="color:#005CC5;">172.17</span><span style="color:#24292E;">.</span><span style="color:#B31D28;font-style:italic;">0</span><span style="color:#24292E;">.</span><span style="color:#B31D28;font-style:italic;">1</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> [</span><span style="color:#005CC5;">12</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Feb</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">2021</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">07</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">43</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">03</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#005CC5;">0000</span><span style="color:#24292E;">] </span><span style="color:#032F62;">&quot;GET /login.php HTTP/1.1&quot;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">302</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">384</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;-&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.198 Safari/537.36&quot;</span></span>
<span class="line"><span style="color:#005CC5;">172.17</span><span style="color:#24292E;">.</span><span style="color:#B31D28;font-style:italic;">0</span><span style="color:#24292E;">.</span><span style="color:#B31D28;font-style:italic;">1</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> [</span><span style="color:#005CC5;">12</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Feb</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">2021</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">07</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">43</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">03</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#005CC5;">0000</span><span style="color:#24292E;">] </span><span style="color:#032F62;">&quot;GET /setup.php HTTP/1.1&quot;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">200</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1822</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;-&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.198 Safari/537.36&quot;</span></span>
<span class="line"><span style="color:#24292E;">......</span></span>
<span class="line"><span style="color:#005CC5;">172.17</span><span style="color:#24292E;">.</span><span style="color:#B31D28;font-style:italic;">0</span><span style="color:#24292E;">.</span><span style="color:#B31D28;font-style:italic;">1</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> [</span><span style="color:#005CC5;">12</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Feb</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">2021</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">07</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">43</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">42</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#005CC5;">0000</span><span style="color:#24292E;">] </span><span style="color:#032F62;">&quot;GET /vulnerabilities/upload/ HTTP/1.1&quot;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">200</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1838</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;http://127.0.0.1:8081/index.php&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.198 Safari/537.36&quot;</span></span>
<span class="line"><span style="color:#24292E;">......</span></span>
<span class="line"><span style="color:#005CC5;">172.17</span><span style="color:#24292E;">.</span><span style="color:#B31D28;font-style:italic;">0</span><span style="color:#24292E;">.</span><span style="color:#B31D28;font-style:italic;">1</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> [</span><span style="color:#005CC5;">12</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Feb</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">2021</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">07</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">45</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">51</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#005CC5;">0000</span><span style="color:#24292E;">] </span><span style="color:#032F62;">&quot;GET /hackable/uploads/shell.php HTTP/1.1&quot;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">404</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">516</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;-&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.198 Safari/537.36&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>可以看到，攻击者在访问 shell.php 前 GET 请求 /vulnerabilities/upload/ 地址，直接构造链接去访问下<a href="http://127.0.0.1:8081/vulnerabilities/upload/" target="_blank" rel="noreferrer">http://127.0.0.1/vulnerabilities/upload/</a>，上传入口就显现出来了。</p><p><img src="https://s0.lgstatic.com/i/image6/M01/04/5C/CioPOWAqXbiAWYuWAAJ4HkYrP7A665.png" alt="图片4.png"><br> 上传页面</p><p>由此可以推测出攻击者可能是利用上传漏洞上传 Webshell，从而控制服务器的，我们可以重现下漏洞攻击过程，以验证前面的推测是否准确。</p><blockquote><p>关于文件上传漏洞的测试过程在<a href="https://kaiwu.lagou.com/course/courseInfo.htm?courseId=585&amp;sid=20-h5Url-0#/detail/pc?id=5981" target="_blank" rel="noreferrer">《13 | 文件上传漏洞：种植服务器木马的捷径》</a>已经讲过，此处不再赘述。</p></blockquote><h4 id="_5-清除与加固" tabindex="-1">5.清除与加固 <a class="header-anchor" href="#_5-清除与加固" aria-label="Permalink to &quot;5.清除与加固&quot;">​</a></h4><p>接下来，我们就可以<strong>删除</strong> /app/hackable/uploads/shell.php，同时<strong>排查</strong> 下系统上是否还其他恶意程序，然后<strong>修复上传漏洞</strong>后再恢复网站。</p><p>此处演示中，我并没有留取 rootkit 或者前面内网渗透演示中的回连后门。你可以在完成前面内网渗透操作后，按照本课程的思路去进一步排查，看能否自己发现攻击者的渗透过程，并采取相应的安全解决方案。</p><h3 id="小结" tabindex="-1">小结 <a class="header-anchor" href="#小结" aria-label="Permalink to &quot;小结&quot;">​</a></h3><p>本节课主要介绍了网站入侵的检测方法，以及应急处理流程。</p><p>其中重点介绍 Webshell 查杀的方法和工具，并列举了一些在 Linux 平台下常用的命令工具，用于排查系统上的可疑进程和文件，以确保一些后门的恶意程序已被清除干净；否则单独补个漏洞，删除个 Webshell，并不能完全防止二次入侵。</p><p>同时自己应注意做好数据备份，防止被恶意删除文件后无法恢复，造成严重的业务经济损失。在用备份恢复数据时，注意提前入侵排查，建议提供备份好相关的恶意文件，以留后续分析，防止有遗落的恶意行为和文件未被发现，同时为制作相应的防御方案提供参考。</p><hr><p><a href="https://wj.qq.com/s2/8059116/3881/" target="_blank" rel="noreferrer">课程评价入口，挑选 5 名小伙伴赠送小礼品～</a></p>`,94),e=[o];function t(r,c,y,E,i,F){return a(),n("div",null,e)}const b=s(p,[["render",t]]);export{h as __pageData,b as default};
