import{_ as s,o as a,g as n,Q as p}from"./chunks/framework.4e7d56ce.js";const C=JSON.parse('{"title":"09资源隔离：为什么构建容器需要Namepace？","description":"","frontmatter":{},"headers":[],"relativePath":"posts/backEnd/045_由浅入深吃透 Docker/(4580) 09  资源隔离：为什么构建容器需要 Namepace ？.md","filePath":"posts/backEnd/045_由浅入深吃透 Docker/(4580) 09  资源隔离：为什么构建容器需要 Namepace ？.md","lastUpdated":1696338709000}'),l={name:"posts/backEnd/045_由浅入深吃透 Docker/(4580) 09  资源隔离：为什么构建容器需要 Namepace ？.md"},o=p(`<h1 id="_09资源隔离-为什么构建容器需要namepace" tabindex="-1">09资源隔离：为什么构建容器需要Namepace？ <a class="header-anchor" href="#_09资源隔离-为什么构建容器需要namepace" aria-label="Permalink to &quot;09资源隔离：为什么构建容器需要Namepace？&quot;">​</a></h1><p>我们知道， Docker 是使用 Linux 的 Namespace 技术实现各种资源隔离的。那么究竟什么是 Namespace，各种 Namespace 都有什么作用，为什么 Docker 需要 Namespace呢？下面我带你一一揭秘。</p><p>首先我们来了解一下什么是 Namespace。</p><h3 id="什么是-namespace" tabindex="-1">什么是 Namespace？ <a class="header-anchor" href="#什么是-namespace" aria-label="Permalink to &quot;什么是 Namespace？&quot;">​</a></h3><p>下面是 Namespace 的维基百科定义：</p><blockquote><p>Namespace 是 Linux 内核的一项功能，该功能对内核资源进行分区，以使一组进程看到一组资源，而另一组进程看到另一组资源。Namespace 的工作方式通过为一组资源和进程设置相同的 Namespace 而起作用，但是这些 Namespace 引用了不同的资源。资源可能存在于多个 Namespace 中。这些资源可以是进程 ID、主机名、用户 ID、文件名、与网络访问相关的名称和进程间通信。</p></blockquote><p>简单来说，Namespace 是 Linux 内核的一个特性，该特性可以实现在同一主机系统中，对进程 ID、主机名、用户 ID、文件名、网络和进程间通信等资源的隔离。Docker 利用 Linux 内核的 Namespace 特性，实现了每个容器的资源相互隔离，从而保证容器内部只能访问到自己 Namespace 的资源。</p><p>最新的 Linux 5.6 内核中提供了 8 种类型的 Namespace：</p><table><thead><tr><th>Namespace 名称</th><th>作用</th><th>内核版本</th></tr></thead><tbody><tr><td>Mount（mnt）</td><td>隔离挂载点</td><td>2.4.19</td></tr><tr><td>Process ID (pid)</td><td>隔离进程 ID</td><td>2.6.24</td></tr><tr><td>Network (net)</td><td>隔离网络设备，端口号等</td><td>2.6.29</td></tr><tr><td>Interprocess Communication (ipc)</td><td>隔离 System V IPC 和 POSIX message queues</td><td>2.6.19</td></tr><tr><td>UTS Namespace(uts)</td><td>隔离主机名和域名</td><td>2.6.19</td></tr><tr><td>User Namespace (user)</td><td>隔离用户和用户组</td><td>3.8</td></tr><tr><td>Control group (cgroup) Namespace</td><td>隔离 Cgroups 根目录</td><td>4.6</td></tr><tr><td>Time Namespace</td><td>隔离系统时间</td><td>5.6</td></tr></tbody></table><p>虽然 Linux 内核提供了8种 Namespace，但是最新版本的 Docker 只使用了其中的前6 种，分别为Mount Namespace、PID Namespace、Net Namespace、IPC Namespace、UTS Namespace、User Namespace。</p><p>下面，我们详细了解下 Docker 使用的 6 种 Namespace的作用分别是什么。</p><h3 id="各种-namespace-的作用" tabindex="-1">各种 Namespace 的作用？ <a class="header-anchor" href="#各种-namespace-的作用" aria-label="Permalink to &quot;各种 Namespace 的作用？&quot;">​</a></h3><h4 id="_1-mount-namespace" tabindex="-1">（1）Mount Namespace <a class="header-anchor" href="#_1-mount-namespace" aria-label="Permalink to &quot;（1）Mount Namespace&quot;">​</a></h4><p>Mount Namespace 是 Linux 内核实现的第一个 Namespace，从内核的 2.4.19 版本开始加入。它可以用来隔离不同的进程或进程组看到的挂载点。通俗地说，就是可以实现在不同的进程中看到不同的挂载目录。使用 Mount Namespace 可以实现容器内只能看到自己的挂载信息，在容器内的挂载操作不会影响主机的挂载目录。</p><p>下面我们通过一个实例来演示下 Mount Namespace。在演示之前，我们先来认识一个命令行工具 unshare。unshare 是 util-linux 工具包中的一个工具，CentOS 7 系统默认已经集成了该工具，<strong>使用 unshare 命令可以实现创建并访问不同类型的 Namespace</strong>。</p><p>首先我们使用以下命令创建一个 bash 进程并且新建一个 Mount Namespace：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">unshare</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--mount</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--fork</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/bin/bash</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@centos7 centos]#</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">unshare</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--mount</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--fork</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/bin/bash</span></span>
<span class="line"><span style="color:#24292E;">[root@centos7 centos]#</span></span></code></pre></div><p>执行完上述命令后，这时我们已经在主机上创建了一个新的 Mount Namespace，并且当前命令行窗口加入了新创建的 Mount Namespace。下面我通过一个例子来验证下，在独立的 Mount Namespace 内创建挂载目录是不影响主机的挂载目录的。</p><p>首先在 /tmp 目录下创建一个目录。</p><div class="language-dart vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">dart</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root</span><span style="color:#F97583;">@centos</span><span style="color:#E1E4E8;">7 centos]# mkdir </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">tmp</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">tmpfs</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root</span><span style="color:#D73A49;">@centos</span><span style="color:#24292E;">7 centos]# mkdir </span><span style="color:#D73A49;">/</span><span style="color:#24292E;">tmp</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">tmpfs</span></span></code></pre></div><p>创建好目录后使用 mount 命令挂载一个 tmpfs 类型的目录。命令如下：</p><div class="language-dart vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">dart</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root</span><span style="color:#F97583;">@centos</span><span style="color:#E1E4E8;">7 centos]# mount </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">t tmpfs </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">o size</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">20m tmpfs </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">tmp</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">tmpfs</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root</span><span style="color:#D73A49;">@centos</span><span style="color:#24292E;">7 centos]# mount </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">t tmpfs </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">o size</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">20m tmpfs </span><span style="color:#D73A49;">/</span><span style="color:#24292E;">tmp</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">tmpfs</span></span></code></pre></div><p>然后使用 df 命令查看一下已经挂载的目录信息：</p><div class="language-dart vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">dart</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root</span><span style="color:#F97583;">@centos</span><span style="color:#E1E4E8;">7 centos]# df </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">h</span></span>
<span class="line"><span style="color:#79B8FF;">Filesystem</span><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">Size</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">Used</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Avail</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Use</span><span style="color:#F97583;">%</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Mounted</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">on</span></span>
<span class="line"><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">dev</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">vda1       500G  </span><span style="color:#79B8FF;">1.</span><span style="color:#E1E4E8;">4G  499G   </span><span style="color:#79B8FF;">1</span><span style="color:#F97583;">%</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">/</span></span>
<span class="line"><span style="color:#E1E4E8;">devtmpfs         16G     </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">   16G   </span><span style="color:#79B8FF;">0</span><span style="color:#F97583;">%</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">dev</span></span>
<span class="line"><span style="color:#E1E4E8;">tmpfs            16G     </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">   16G   </span><span style="color:#79B8FF;">0</span><span style="color:#F97583;">%</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">dev</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">shm</span></span>
<span class="line"><span style="color:#E1E4E8;">tmpfs            16G     </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">   16G   </span><span style="color:#79B8FF;">0</span><span style="color:#F97583;">%</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">sys</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">fs</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">cgroup</span></span>
<span class="line"><span style="color:#E1E4E8;">tmpfs            16G   57M   16G   </span><span style="color:#79B8FF;">1</span><span style="color:#F97583;">%</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">run</span></span>
<span class="line"><span style="color:#E1E4E8;">tmpfs           </span><span style="color:#79B8FF;">3.</span><span style="color:#E1E4E8;">2G     </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">3.</span><span style="color:#E1E4E8;">2G   </span><span style="color:#79B8FF;">0</span><span style="color:#F97583;">%</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">run</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">user</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">1000</span></span>
<span class="line"><span style="color:#E1E4E8;">tmpfs            20M     </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">   20M   </span><span style="color:#79B8FF;">0</span><span style="color:#F97583;">%</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">tmp</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">tmpfs</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root</span><span style="color:#D73A49;">@centos</span><span style="color:#24292E;">7 centos]# df </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">h</span></span>
<span class="line"><span style="color:#005CC5;">Filesystem</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">Size</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">Used</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Avail</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Use</span><span style="color:#D73A49;">%</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Mounted</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">on</span></span>
<span class="line"><span style="color:#D73A49;">/</span><span style="color:#24292E;">dev</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">vda1       500G  </span><span style="color:#005CC5;">1.</span><span style="color:#24292E;">4G  499G   </span><span style="color:#005CC5;">1</span><span style="color:#D73A49;">%</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">/</span></span>
<span class="line"><span style="color:#24292E;">devtmpfs         16G     </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">   16G   </span><span style="color:#005CC5;">0</span><span style="color:#D73A49;">%</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">/</span><span style="color:#24292E;">dev</span></span>
<span class="line"><span style="color:#24292E;">tmpfs            16G     </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">   16G   </span><span style="color:#005CC5;">0</span><span style="color:#D73A49;">%</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">/</span><span style="color:#24292E;">dev</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">shm</span></span>
<span class="line"><span style="color:#24292E;">tmpfs            16G     </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">   16G   </span><span style="color:#005CC5;">0</span><span style="color:#D73A49;">%</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">/</span><span style="color:#24292E;">sys</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">fs</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">cgroup</span></span>
<span class="line"><span style="color:#24292E;">tmpfs            16G   57M   16G   </span><span style="color:#005CC5;">1</span><span style="color:#D73A49;">%</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">/</span><span style="color:#24292E;">run</span></span>
<span class="line"><span style="color:#24292E;">tmpfs           </span><span style="color:#005CC5;">3.</span><span style="color:#24292E;">2G     </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">3.</span><span style="color:#24292E;">2G   </span><span style="color:#005CC5;">0</span><span style="color:#D73A49;">%</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">/</span><span style="color:#24292E;">run</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">user</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">1000</span></span>
<span class="line"><span style="color:#24292E;">tmpfs            20M     </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">   20M   </span><span style="color:#005CC5;">0</span><span style="color:#D73A49;">%</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">/</span><span style="color:#24292E;">tmp</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">tmpfs</span></span></code></pre></div><p>可以看到 /tmp/tmpfs 目录已经被正确挂载。为了验证主机上并没有挂载此目录，我们新打开一个命令行窗口，同样执行 df 命令查看主机的挂载信息：</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[centos@</span><span style="color:#F97583;">centos7</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]$ df </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">h</span></span>
<span class="line"><span style="color:#E1E4E8;">Filesystem      Size  Used Avail Use</span><span style="color:#F97583;">%</span><span style="color:#E1E4E8;"> Mounted on</span></span>
<span class="line"><span style="color:#E1E4E8;">devtmpfs         16G     </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">   16G   </span><span style="color:#79B8FF;">0</span><span style="color:#F97583;">%</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">dev</span></span>
<span class="line"><span style="color:#E1E4E8;">tmpfs            16G     </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">   16G   </span><span style="color:#79B8FF;">0</span><span style="color:#F97583;">%</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">dev</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">shm</span></span>
<span class="line"><span style="color:#E1E4E8;">tmpfs            16G   57M   16G   </span><span style="color:#79B8FF;">1</span><span style="color:#F97583;">%</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">run</span></span>
<span class="line"><span style="color:#E1E4E8;">tmpfs            16G     </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">   16G   </span><span style="color:#79B8FF;">0</span><span style="color:#F97583;">%</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">sys</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">fs</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">cgroup</span></span>
<span class="line"><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">dev</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">vda1       500G  1.</span><span style="color:#FDAEB7;font-style:italic;">4G</span><span style="color:#E1E4E8;">  499G   </span><span style="color:#79B8FF;">1</span><span style="color:#F97583;">%</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">/</span></span>
<span class="line"><span style="color:#E1E4E8;">tmpfs           3.</span><span style="color:#FDAEB7;font-style:italic;">2G</span><span style="color:#E1E4E8;">     </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">  3.</span><span style="color:#FDAEB7;font-style:italic;">2G</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#F97583;">%</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">run</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">user</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">1000</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[centos@</span><span style="color:#D73A49;">centos7</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]$ df </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">h</span></span>
<span class="line"><span style="color:#24292E;">Filesystem      Size  Used Avail Use</span><span style="color:#D73A49;">%</span><span style="color:#24292E;"> Mounted on</span></span>
<span class="line"><span style="color:#24292E;">devtmpfs         16G     </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">   16G   </span><span style="color:#005CC5;">0</span><span style="color:#D73A49;">%</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">/</span><span style="color:#24292E;">dev</span></span>
<span class="line"><span style="color:#24292E;">tmpfs            16G     </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">   16G   </span><span style="color:#005CC5;">0</span><span style="color:#D73A49;">%</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">/</span><span style="color:#24292E;">dev</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">shm</span></span>
<span class="line"><span style="color:#24292E;">tmpfs            16G   57M   16G   </span><span style="color:#005CC5;">1</span><span style="color:#D73A49;">%</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">/</span><span style="color:#24292E;">run</span></span>
<span class="line"><span style="color:#24292E;">tmpfs            16G     </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">   16G   </span><span style="color:#005CC5;">0</span><span style="color:#D73A49;">%</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">/</span><span style="color:#24292E;">sys</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">fs</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">cgroup</span></span>
<span class="line"><span style="color:#D73A49;">/</span><span style="color:#24292E;">dev</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">vda1       500G  1.</span><span style="color:#B31D28;font-style:italic;">4G</span><span style="color:#24292E;">  499G   </span><span style="color:#005CC5;">1</span><span style="color:#D73A49;">%</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">/</span></span>
<span class="line"><span style="color:#24292E;">tmpfs           3.</span><span style="color:#B31D28;font-style:italic;">2G</span><span style="color:#24292E;">     </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">  3.</span><span style="color:#B31D28;font-style:italic;">2G</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#D73A49;">%</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">/</span><span style="color:#24292E;">run</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">user</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">1000</span></span></code></pre></div><p>通过上面输出可以看到主机上并没有挂载 /tmp/tmpfs，可见我们独立的 Mount Namespace 中执行 mount 操作并不会影响主机。</p><p>为了进一步验证我们的想法，我们继续在当前命令行窗口查看一下当前进程的 Namespace 信息，命令如下：</p><div class="language-dart vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">dart</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root</span><span style="color:#F97583;">@centos</span><span style="color:#E1E4E8;">7 centos]# ls </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">l </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">proc</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">self</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">ns</span><span style="color:#F97583;">/</span></span>
<span class="line"><span style="color:#E1E4E8;">total </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#E1E4E8;">lrwxrwxrwx. </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> root root </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Sep</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">08</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">20</span><span style="color:#E1E4E8;"> ipc </span><span style="color:#F97583;">-&gt;</span><span style="color:#E1E4E8;"> ipc</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;">[</span><span style="color:#79B8FF;">4026531839</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">lrwxrwxrwx. </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> root root </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Sep</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">08</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">20</span><span style="color:#E1E4E8;"> mnt </span><span style="color:#F97583;">-&gt;</span><span style="color:#E1E4E8;"> mnt</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;">[</span><span style="color:#79B8FF;">4026532239</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">lrwxrwxrwx. </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> root root </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Sep</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">08</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">20</span><span style="color:#E1E4E8;"> net </span><span style="color:#F97583;">-&gt;</span><span style="color:#E1E4E8;"> net</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;">[</span><span style="color:#79B8FF;">4026531956</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">lrwxrwxrwx. </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> root root </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Sep</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">08</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">20</span><span style="color:#E1E4E8;"> pid </span><span style="color:#F97583;">-&gt;</span><span style="color:#E1E4E8;"> pid</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;">[</span><span style="color:#79B8FF;">4026531836</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">lrwxrwxrwx. </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> root root </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Sep</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">08</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">20</span><span style="color:#E1E4E8;"> user </span><span style="color:#F97583;">-&gt;</span><span style="color:#E1E4E8;"> user</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;">[</span><span style="color:#79B8FF;">4026531837</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">lrwxrwxrwx. </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> root root </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Sep</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">08</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">20</span><span style="color:#E1E4E8;"> uts </span><span style="color:#F97583;">-&gt;</span><span style="color:#E1E4E8;"> uts</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;">[</span><span style="color:#79B8FF;">4026531838</span><span style="color:#E1E4E8;">]</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root</span><span style="color:#D73A49;">@centos</span><span style="color:#24292E;">7 centos]# ls </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">l </span><span style="color:#D73A49;">/</span><span style="color:#24292E;">proc</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">self</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">ns</span><span style="color:#D73A49;">/</span></span>
<span class="line"><span style="color:#24292E;">total </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#24292E;">lrwxrwxrwx. </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> root root </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Sep</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">4</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">08</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">20</span><span style="color:#24292E;"> ipc </span><span style="color:#D73A49;">-&gt;</span><span style="color:#24292E;"> ipc</span><span style="color:#D73A49;">:</span><span style="color:#24292E;">[</span><span style="color:#005CC5;">4026531839</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">lrwxrwxrwx. </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> root root </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Sep</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">4</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">08</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">20</span><span style="color:#24292E;"> mnt </span><span style="color:#D73A49;">-&gt;</span><span style="color:#24292E;"> mnt</span><span style="color:#D73A49;">:</span><span style="color:#24292E;">[</span><span style="color:#005CC5;">4026532239</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">lrwxrwxrwx. </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> root root </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Sep</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">4</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">08</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">20</span><span style="color:#24292E;"> net </span><span style="color:#D73A49;">-&gt;</span><span style="color:#24292E;"> net</span><span style="color:#D73A49;">:</span><span style="color:#24292E;">[</span><span style="color:#005CC5;">4026531956</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">lrwxrwxrwx. </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> root root </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Sep</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">4</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">08</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">20</span><span style="color:#24292E;"> pid </span><span style="color:#D73A49;">-&gt;</span><span style="color:#24292E;"> pid</span><span style="color:#D73A49;">:</span><span style="color:#24292E;">[</span><span style="color:#005CC5;">4026531836</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">lrwxrwxrwx. </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> root root </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Sep</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">4</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">08</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">20</span><span style="color:#24292E;"> user </span><span style="color:#D73A49;">-&gt;</span><span style="color:#24292E;"> user</span><span style="color:#D73A49;">:</span><span style="color:#24292E;">[</span><span style="color:#005CC5;">4026531837</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">lrwxrwxrwx. </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> root root </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Sep</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">4</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">08</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">20</span><span style="color:#24292E;"> uts </span><span style="color:#D73A49;">-&gt;</span><span style="color:#24292E;"> uts</span><span style="color:#D73A49;">:</span><span style="color:#24292E;">[</span><span style="color:#005CC5;">4026531838</span><span style="color:#24292E;">]</span></span></code></pre></div><p>然后新打开一个命令行窗口，使用相同的命令查看一下主机上的 Namespace 信息：</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[centos@</span><span style="color:#F97583;">centos7</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]$ ls </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">l </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">proc</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">self</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">ns</span><span style="color:#F97583;">/</span></span>
<span class="line"><span style="color:#E1E4E8;">total </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#E1E4E8;">lrwxrwxrwx. </span><span style="color:#FDAEB7;font-style:italic;">1</span><span style="color:#E1E4E8;"> centos centos </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> Sep  </span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;"> 08</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">20</span><span style="color:#E1E4E8;"> ipc </span><span style="color:#F97583;">-&gt;</span><span style="color:#E1E4E8;"> ipc</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;">[</span><span style="color:#79B8FF;">4026531839</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">lrwxrwxrwx. </span><span style="color:#FDAEB7;font-style:italic;">1</span><span style="color:#E1E4E8;"> centos centos </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> Sep  </span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;"> 08</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">20</span><span style="color:#E1E4E8;"> mnt </span><span style="color:#F97583;">-&gt;</span><span style="color:#E1E4E8;"> mnt</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;">[</span><span style="color:#79B8FF;">4026531840</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">lrwxrwxrwx. </span><span style="color:#FDAEB7;font-style:italic;">1</span><span style="color:#E1E4E8;"> centos centos </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> Sep  </span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;"> 08</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">20</span><span style="color:#E1E4E8;"> net </span><span style="color:#F97583;">-&gt;</span><span style="color:#E1E4E8;"> net</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;">[</span><span style="color:#79B8FF;">4026531956</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">lrwxrwxrwx. </span><span style="color:#FDAEB7;font-style:italic;">1</span><span style="color:#E1E4E8;"> centos centos </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> Sep  </span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;"> 08</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">20</span><span style="color:#E1E4E8;"> pid </span><span style="color:#F97583;">-&gt;</span><span style="color:#E1E4E8;"> pid</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;">[</span><span style="color:#79B8FF;">4026531836</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">lrwxrwxrwx. </span><span style="color:#FDAEB7;font-style:italic;">1</span><span style="color:#E1E4E8;"> centos centos </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> Sep  </span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;"> 08</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">20</span><span style="color:#E1E4E8;"> user </span><span style="color:#F97583;">-&gt;</span><span style="color:#E1E4E8;"> user</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;">[</span><span style="color:#79B8FF;">4026531837</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">lrwxrwxrwx. </span><span style="color:#FDAEB7;font-style:italic;">1</span><span style="color:#E1E4E8;"> centos centos </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> Sep  </span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;"> 08</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">20</span><span style="color:#E1E4E8;"> uts </span><span style="color:#F97583;">-&gt;</span><span style="color:#E1E4E8;"> uts</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;">[</span><span style="color:#79B8FF;">4026531838</span><span style="color:#E1E4E8;">]</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[centos@</span><span style="color:#D73A49;">centos7</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]$ ls </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">l </span><span style="color:#D73A49;">/</span><span style="color:#24292E;">proc</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">self</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">ns</span><span style="color:#D73A49;">/</span></span>
<span class="line"><span style="color:#24292E;">total </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#24292E;">lrwxrwxrwx. </span><span style="color:#B31D28;font-style:italic;">1</span><span style="color:#24292E;"> centos centos </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> Sep  </span><span style="color:#005CC5;">4</span><span style="color:#24292E;"> 08</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">20</span><span style="color:#24292E;"> ipc </span><span style="color:#D73A49;">-&gt;</span><span style="color:#24292E;"> ipc</span><span style="color:#D73A49;">:</span><span style="color:#24292E;">[</span><span style="color:#005CC5;">4026531839</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">lrwxrwxrwx. </span><span style="color:#B31D28;font-style:italic;">1</span><span style="color:#24292E;"> centos centos </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> Sep  </span><span style="color:#005CC5;">4</span><span style="color:#24292E;"> 08</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">20</span><span style="color:#24292E;"> mnt </span><span style="color:#D73A49;">-&gt;</span><span style="color:#24292E;"> mnt</span><span style="color:#D73A49;">:</span><span style="color:#24292E;">[</span><span style="color:#005CC5;">4026531840</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">lrwxrwxrwx. </span><span style="color:#B31D28;font-style:italic;">1</span><span style="color:#24292E;"> centos centos </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> Sep  </span><span style="color:#005CC5;">4</span><span style="color:#24292E;"> 08</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">20</span><span style="color:#24292E;"> net </span><span style="color:#D73A49;">-&gt;</span><span style="color:#24292E;"> net</span><span style="color:#D73A49;">:</span><span style="color:#24292E;">[</span><span style="color:#005CC5;">4026531956</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">lrwxrwxrwx. </span><span style="color:#B31D28;font-style:italic;">1</span><span style="color:#24292E;"> centos centos </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> Sep  </span><span style="color:#005CC5;">4</span><span style="color:#24292E;"> 08</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">20</span><span style="color:#24292E;"> pid </span><span style="color:#D73A49;">-&gt;</span><span style="color:#24292E;"> pid</span><span style="color:#D73A49;">:</span><span style="color:#24292E;">[</span><span style="color:#005CC5;">4026531836</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">lrwxrwxrwx. </span><span style="color:#B31D28;font-style:italic;">1</span><span style="color:#24292E;"> centos centos </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> Sep  </span><span style="color:#005CC5;">4</span><span style="color:#24292E;"> 08</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">20</span><span style="color:#24292E;"> user </span><span style="color:#D73A49;">-&gt;</span><span style="color:#24292E;"> user</span><span style="color:#D73A49;">:</span><span style="color:#24292E;">[</span><span style="color:#005CC5;">4026531837</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">lrwxrwxrwx. </span><span style="color:#B31D28;font-style:italic;">1</span><span style="color:#24292E;"> centos centos </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> Sep  </span><span style="color:#005CC5;">4</span><span style="color:#24292E;"> 08</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">20</span><span style="color:#24292E;"> uts </span><span style="color:#D73A49;">-&gt;</span><span style="color:#24292E;"> uts</span><span style="color:#D73A49;">:</span><span style="color:#24292E;">[</span><span style="color:#005CC5;">4026531838</span><span style="color:#24292E;">]</span></span></code></pre></div><p>通过对比两次命令的输出结果，我们可以看到，除了 Mount Namespace 的 ID 值不一样外，其他Namespace 的 ID 值均一致。</p><p>通过以上结果我们可以得出结论，<strong>使用 unshare 命令可以新建 Mount Namespace，并且在新建的 Mount Namespace 内 mount 是和外部完全隔离的。</strong></p><h4 id="_2-pid-namespace" tabindex="-1">（2）PID Namespace <a class="header-anchor" href="#_2-pid-namespace" aria-label="Permalink to &quot;（2）PID Namespace&quot;">​</a></h4><p>PID Namespace 的作用是用来隔离进程。在不同的 PID Namespace 中，进程可以拥有相同的 PID 号，利用 PID Namespace 可以实现每个容器的主进程为 1 号进程，而容器内的进程在主机上却拥有不同的PID。例如一个进程在主机上 PID 为 122，使用 PID Namespace 可以实现该进程在容器内看到的 PID 为 1。</p><p>下面我们通过一个实例来演示下 PID Namespace的作用。首先我们使用以下命令创建一个 bash 进程，并且新建一个 PID Namespace：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">unshare</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--pid</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--fork</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--mount-proc</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/bin/bash</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@centos7 centos]#</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">unshare</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--pid</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--fork</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--mount-proc</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/bin/bash</span></span>
<span class="line"><span style="color:#24292E;">[root@centos7 centos]#</span></span></code></pre></div><p>执行完上述命令后，我们在主机上创建了一个新的 PID Namespace，并且当前命令行窗口加入了新创建的 PID Namespace。在当前的命令行窗口使用 ps aux 命令查看一下进程信息：</p><div class="language-dart vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">dart</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root</span><span style="color:#F97583;">@centos</span><span style="color:#E1E4E8;">7 centos]# ps aux</span></span>
<span class="line"><span style="color:#79B8FF;">USER</span><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">PID</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">%</span><span style="color:#79B8FF;">CPU</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">%</span><span style="color:#79B8FF;">MEM</span><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">VSZ</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">RSS</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">TTY</span><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">STAT</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">START</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">TIME</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">COMMAND</span></span>
<span class="line"><span style="color:#E1E4E8;">root         </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">0.0</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">0.0</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">115544</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">2004</span><span style="color:#E1E4E8;"> pts</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">S</span><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">10</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">57</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">00</span><span style="color:#E1E4E8;"> bash</span></span>
<span class="line"><span style="color:#E1E4E8;">root        </span><span style="color:#79B8FF;">10</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">0.0</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">0.0</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">155444</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">1764</span><span style="color:#E1E4E8;"> pts</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">R</span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">10</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">59</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">00</span><span style="color:#E1E4E8;"> ps aux</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root</span><span style="color:#D73A49;">@centos</span><span style="color:#24292E;">7 centos]# ps aux</span></span>
<span class="line"><span style="color:#005CC5;">USER</span><span style="color:#24292E;">       </span><span style="color:#005CC5;">PID</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">%</span><span style="color:#005CC5;">CPU</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">%</span><span style="color:#005CC5;">MEM</span><span style="color:#24292E;">    </span><span style="color:#005CC5;">VSZ</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">RSS</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">TTY</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">STAT</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">START</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">TIME</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">COMMAND</span></span>
<span class="line"><span style="color:#24292E;">root         </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">0.0</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">0.0</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">115544</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">2004</span><span style="color:#24292E;"> pts</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">    </span><span style="color:#005CC5;">S</span><span style="color:#24292E;">    </span><span style="color:#005CC5;">10</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">57</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">00</span><span style="color:#24292E;"> bash</span></span>
<span class="line"><span style="color:#24292E;">root        </span><span style="color:#005CC5;">10</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">0.0</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">0.0</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">155444</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">1764</span><span style="color:#24292E;"> pts</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">    </span><span style="color:#005CC5;">R</span><span style="color:#D73A49;">+</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">10</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">59</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">00</span><span style="color:#24292E;"> ps aux</span></span></code></pre></div><p>通过上述命令输出结果可以看到当前 Namespace 下 bash 为 1 号进程，而且我们也看不到主机上的其他进程信息。</p><h4 id="_3-uts-namespace" tabindex="-1">（3）UTS Namespace <a class="header-anchor" href="#_3-uts-namespace" aria-label="Permalink to &quot;（3）UTS Namespace&quot;">​</a></h4><p>UTS Namespace 主要是用来隔离主机名的，它允许每个 UTS Namespace 拥有一个独立的主机名。例如我们的主机名称为 docker，使用 UTS Namespace 可以实现在容器内的主机名称为 lagoudocker 或者其他任意自定义主机名。</p><p>同样我们通过一个实例来验证下 UTS Namespace 的作用，首先我们使用 unshare 命令来创建一个 UTS Namespace：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">unshare</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--uts</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--fork</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/bin/bash</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@centos7 centos]#</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">unshare</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--uts</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--fork</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/bin/bash</span></span>
<span class="line"><span style="color:#24292E;">[root@centos7 centos]#</span></span></code></pre></div><p>创建好 UTS Namespace 后，当前命令行窗口已经处于一个独立的 UTS Namespace 中，下面我们使用 hostname 命令（hostname 可以用来查看主机名称）设置一下主机名：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">root@centos7</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">centos]#</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">hostname</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-b</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">lagoudocker</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">root@centos7</span><span style="color:#24292E;"> </span><span style="color:#032F62;">centos]#</span><span style="color:#24292E;"> </span><span style="color:#032F62;">hostname</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-b</span><span style="color:#24292E;"> </span><span style="color:#032F62;">lagoudocker</span></span></code></pre></div><p>然后再查看一下主机名：</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@</span><span style="color:#F97583;">centos7</span><span style="color:#E1E4E8;"> centos]# hostname</span></span>
<span class="line"><span style="color:#E1E4E8;">lagoudocker</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@</span><span style="color:#D73A49;">centos7</span><span style="color:#24292E;"> centos]# hostname</span></span>
<span class="line"><span style="color:#24292E;">lagoudocker</span></span></code></pre></div><p>通过上面命令的输出，我们可以看到当前UTS Namespace 内的主机名已经被修改为 lagoudocker。然后我们新打开一个命令行窗口，使用相同的命令查看一下主机的 hostname：</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[centos@</span><span style="color:#F97583;">centos7</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]$ hostname</span></span>
<span class="line"><span style="color:#E1E4E8;">centos7</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[centos@</span><span style="color:#D73A49;">centos7</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]$ hostname</span></span>
<span class="line"><span style="color:#24292E;">centos7</span></span></code></pre></div><p>可以看到主机的名称仍然为 centos7，并没有被修改。由此，可以验证 UTS Namespace 可以用来隔离主机名。</p><h4 id="_4-ipc-namespace" tabindex="-1">（4）IPC Namespace <a class="header-anchor" href="#_4-ipc-namespace" aria-label="Permalink to &quot;（4）IPC Namespace&quot;">​</a></h4><p>IPC Namespace 主要是用来隔离进程间通信的。例如 PID Namespace 和 IPC Namespace 一起使用可以实现同一 IPC Namespace 内的进程彼此可以通信，不同 IPC Namespace 的进程却不能通信。</p><p>同样我们通过一个实例来验证下IPC Namespace的作用，首先我们使用 unshare 命令来创建一个 IPC Namespace：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">unshare</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--ipc</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--fork</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/bin/bash</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@centos7 centos]#</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">unshare</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--ipc</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--fork</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/bin/bash</span></span>
<span class="line"><span style="color:#24292E;">[root@centos7 centos]#</span></span></code></pre></div><p>下面我们需要借助两个命令来实现对 IPC Namespace 的验证。</p><ul><li><p>ipcs -q 命令：用来查看系统间通信队列列表。</p></li><li><p>ipcmk -Q 命令：用来创建系统间通信队列。</p></li></ul><p>我们首先使用 ipcs -q 命令查看一下当前 IPC Namespace 下的系统通信队列列表：</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[centos@</span><span style="color:#F97583;">centos7</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]$ ipcs </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">q</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">------</span><span style="color:#E1E4E8;"> Message Queues </span><span style="color:#F97583;">--------</span></span>
<span class="line"><span style="color:#E1E4E8;">key        msqid      owner      perms      used</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">bytes   messages</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[centos@</span><span style="color:#D73A49;">centos7</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]$ ipcs </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">q</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">------</span><span style="color:#24292E;"> Message Queues </span><span style="color:#D73A49;">--------</span></span>
<span class="line"><span style="color:#24292E;">key        msqid      owner      perms      used</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">bytes   messages</span></span></code></pre></div><p>由上可以看到当前无任何系统通信队列，然后我们使用 ipcmk -Q 命令创建一个系统通信队列：</p><div class="language-dart vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">dart</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root</span><span style="color:#F97583;">@centos</span><span style="color:#E1E4E8;">7 centos]# ipcmk </span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">Q</span></span>
<span class="line"><span style="color:#79B8FF;">Message</span><span style="color:#E1E4E8;"> queue id</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root</span><span style="color:#D73A49;">@centos</span><span style="color:#24292E;">7 centos]# ipcmk </span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">Q</span></span>
<span class="line"><span style="color:#005CC5;">Message</span><span style="color:#24292E;"> queue id</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span></span></code></pre></div><p>再次使用 ipcs -q 命令查看当前 IPC Namespace 下的系统通信队列列表：</p><div class="language-dart vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">dart</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root</span><span style="color:#F97583;">@centos</span><span style="color:#E1E4E8;">7 centos]# ipcs </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">q</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">------</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Message</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Queues</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">--------</span></span>
<span class="line"><span style="color:#E1E4E8;">key        msqid      owner      perms      used</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">bytes   messages</span></span>
<span class="line"><span style="color:#79B8FF;">0x73682a32</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          root       </span><span style="color:#79B8FF;">644</span><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">            </span><span style="color:#79B8FF;">0</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root</span><span style="color:#D73A49;">@centos</span><span style="color:#24292E;">7 centos]# ipcs </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">q</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">------</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Message</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Queues</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">--------</span></span>
<span class="line"><span style="color:#24292E;">key        msqid      owner      perms      used</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">bytes   messages</span></span>
<span class="line"><span style="color:#005CC5;">0x73682a32</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          root       </span><span style="color:#005CC5;">644</span><span style="color:#24292E;">        </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">            </span><span style="color:#005CC5;">0</span></span></code></pre></div><p>可以看到我们已经成功创建了一个系统通信队列。然后我们新打开一个命令行窗口，使用ipcs -q 命令查看一下主机的系统通信队列：</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[centos@</span><span style="color:#F97583;">centos7</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]$ ipcs </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">q</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">------</span><span style="color:#E1E4E8;"> Message Queues </span><span style="color:#F97583;">--------</span></span>
<span class="line"><span style="color:#E1E4E8;">key        msqid      owner      perms      used</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">bytes   messages</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[centos@</span><span style="color:#D73A49;">centos7</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]$ ipcs </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">q</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">------</span><span style="color:#24292E;"> Message Queues </span><span style="color:#D73A49;">--------</span></span>
<span class="line"><span style="color:#24292E;">key        msqid      owner      perms      used</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">bytes   messages</span></span></code></pre></div><p>通过上面的实验，可以发现，在单独的 IPC Namespace 内创建的系统通信队列在主机上无法看到。即 IPC Namespace 实现了系统通信队列的隔离。</p><h4 id="_5-user-namespace" tabindex="-1">（5）User Namespace <a class="header-anchor" href="#_5-user-namespace" aria-label="Permalink to &quot;（5）User Namespace&quot;">​</a></h4><p>User Namespace 主要是用来隔离用户和用户组的。一个比较典型的应用场景就是在主机上以非 root 用户运行的进程可以在一个单独的 User Namespace 中映射成 root 用户。使用 User Namespace 可以实现进程在容器内拥有 root 权限，而在主机上却只是普通用户。</p><p>User Namesapce 的创建是可以不使用 root 权限的。下面我们以普通用户的身份创建一个 User Namespace，命令如下：</p><div class="language-dart vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">dart</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[centos</span><span style="color:#F97583;">@centos</span><span style="color:#E1E4E8;">7 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]$ unshare </span><span style="color:#F97583;">--</span><span style="color:#E1E4E8;">user </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">r </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">bin</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">bash</span></span>
<span class="line"><span style="color:#E1E4E8;">[root</span><span style="color:#F97583;">@centos</span><span style="color:#E1E4E8;">7 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]#</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[centos</span><span style="color:#D73A49;">@centos</span><span style="color:#24292E;">7 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]$ unshare </span><span style="color:#D73A49;">--</span><span style="color:#24292E;">user </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">r </span><span style="color:#D73A49;">/</span><span style="color:#24292E;">bin</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">bash</span></span>
<span class="line"><span style="color:#24292E;">[root</span><span style="color:#D73A49;">@centos</span><span style="color:#24292E;">7 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]#</span></span></code></pre></div><blockquote><p>CentOS7 默认允许创建的 User Namespace 为 0，如果执行上述命令失败（ unshare 命令返回的错误为 unshare: unshare failed: Invalid argument ），需要使用以下命令修改系统允许创建的 User Namespace 数量，命令为：echo 65535 &gt; /proc/sys/user/max_user_namespaces，然后再次尝试创建 User Namespace。</p></blockquote><p>然后执行 id 命令查看一下当前的用户信息：</p><div class="language-dart vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">dart</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root</span><span style="color:#F97583;">@centos</span><span style="color:#E1E4E8;">7 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# id</span></span>
<span class="line"><span style="color:#E1E4E8;">uid</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">(root) gid</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">(root) groups</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">(root),</span><span style="color:#79B8FF;">65534</span><span style="color:#E1E4E8;">(nfsnobody) context</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">unconfined_u</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;">unconfined_r</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;">unconfined_t</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;">s0</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">s0</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;">c0.c1023</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root</span><span style="color:#D73A49;">@centos</span><span style="color:#24292E;">7 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# id</span></span>
<span class="line"><span style="color:#24292E;">uid</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">(root) gid</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">(root) groups</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">(root),</span><span style="color:#005CC5;">65534</span><span style="color:#24292E;">(nfsnobody) context</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">unconfined_u</span><span style="color:#D73A49;">:</span><span style="color:#24292E;">unconfined_r</span><span style="color:#D73A49;">:</span><span style="color:#24292E;">unconfined_t</span><span style="color:#D73A49;">:</span><span style="color:#24292E;">s0</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">s0</span><span style="color:#D73A49;">:</span><span style="color:#24292E;">c0.c1023</span></span></code></pre></div><p>通过上面的输出可以看到我们在新的 User Namespace 内已经是 root 用户了。下面我们使用只有主机 root 用户才可以执行的 reboot 命令来验证一下，在当前命令行窗口执行 reboot 命令：</p><div class="language-dart vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">dart</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root</span><span style="color:#F97583;">@centos</span><span style="color:#E1E4E8;">7 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# reboot</span></span>
<span class="line"><span style="color:#79B8FF;">Failed</span><span style="color:#E1E4E8;"> to open </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">dev</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">initctl</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Permission</span><span style="color:#E1E4E8;"> denied</span></span>
<span class="line"><span style="color:#79B8FF;">Failed</span><span style="color:#E1E4E8;"> to talk to init daemon.</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root</span><span style="color:#D73A49;">@centos</span><span style="color:#24292E;">7 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# reboot</span></span>
<span class="line"><span style="color:#005CC5;">Failed</span><span style="color:#24292E;"> to open </span><span style="color:#D73A49;">/</span><span style="color:#24292E;">dev</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">initctl</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Permission</span><span style="color:#24292E;"> denied</span></span>
<span class="line"><span style="color:#005CC5;">Failed</span><span style="color:#24292E;"> to talk to init daemon.</span></span></code></pre></div><p>可以看到，我们在新创建的 User Namespace 内虽然是 root 用户，但是并没有权限执行 reboot 命令。这说明在隔离的 User Namespace 中，并不能获取到主机的 root 权限，也就是说 User Namespace 实现了用户和用户组的隔离。</p><h4 id="_6-net-namespace" tabindex="-1">（6）Net Namespace <a class="header-anchor" href="#_6-net-namespace" aria-label="Permalink to &quot;（6）Net Namespace&quot;">​</a></h4><p>Net Namespace 是用来隔离网络设备、IP 地址和端口等信息的。Net Namespace 可以让每个进程拥有自己独立的 IP 地址，端口和网卡信息。例如主机 IP 地址为 172.16.4.1 ，容器内可以设置独立的 IP 地址为 192.168.1.1。</p><p>同样用实例验证，我们首先使用 ip a 命令查看一下主机上的网络信息：</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">$ ip a</span></span>
<span class="line"><span style="color:#79B8FF;">1</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> lo</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">LOOPBACK,UP,LOWER_UP</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> mtu </span><span style="color:#79B8FF;">65536</span><span style="color:#E1E4E8;"> qdisc noqueue state UNKNOWN group </span><span style="color:#F97583;">default</span><span style="color:#E1E4E8;"> qlen </span><span style="color:#79B8FF;">1000</span></span>
<span class="line"><span style="color:#E1E4E8;">    link</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">loopback </span><span style="color:#79B8FF;">00</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">00</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">00</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">00</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">00</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">00</span><span style="color:#E1E4E8;"> brd </span><span style="color:#79B8FF;">00</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">00</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">00</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">00</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">00</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">00</span></span>
<span class="line"><span style="color:#E1E4E8;">    inet </span><span style="color:#79B8FF;">127.0</span><span style="color:#E1E4E8;">.</span><span style="color:#FDAEB7;font-style:italic;">0</span><span style="color:#E1E4E8;">.</span><span style="color:#FDAEB7;font-style:italic;">1</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">8</span><span style="color:#E1E4E8;"> scope host lo</span></span>
<span class="line"><span style="color:#E1E4E8;">       valid_lft forever preferred_lft forever</span></span>
<span class="line"><span style="color:#E1E4E8;">    inet6 </span><span style="color:#F97583;">::</span><span style="color:#79B8FF;">1</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">128</span><span style="color:#E1E4E8;"> scope host</span></span>
<span class="line"><span style="color:#E1E4E8;">       valid_lft forever preferred_lft forever</span></span>
<span class="line"><span style="color:#79B8FF;">2</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> eth0</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">BROADCAST,MULTICAST,UP,LOWER_UP</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> mtu </span><span style="color:#79B8FF;">1500</span><span style="color:#E1E4E8;"> qdisc pfifo_fast state UP group </span><span style="color:#F97583;">default</span><span style="color:#E1E4E8;"> qlen </span><span style="color:#79B8FF;">1000</span></span>
<span class="line"><span style="color:#E1E4E8;">    link</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">ether </span><span style="color:#79B8FF;">02</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">11</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;">b0</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">14</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">01</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;">0c brd ff</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;">ff</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;">ff</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;">ff</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;">ff</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;">ff</span></span>
<span class="line"><span style="color:#E1E4E8;">    inet </span><span style="color:#79B8FF;">172.20</span><span style="color:#E1E4E8;">.</span><span style="color:#FDAEB7;font-style:italic;">1</span><span style="color:#E1E4E8;">.</span><span style="color:#FDAEB7;font-style:italic;">11</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">24</span><span style="color:#E1E4E8;"> brd </span><span style="color:#79B8FF;">172.20</span><span style="color:#E1E4E8;">.</span><span style="color:#FDAEB7;font-style:italic;">1</span><span style="color:#E1E4E8;">.</span><span style="color:#FDAEB7;font-style:italic;">255</span><span style="color:#E1E4E8;"> scope global dynamic eth0</span></span>
<span class="line"><span style="color:#E1E4E8;">       valid_lft 86063337sec preferred_lft 86063337sec</span></span>
<span class="line"><span style="color:#E1E4E8;">    inet6 fe80</span><span style="color:#F97583;">::</span><span style="color:#79B8FF;">11</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;">b0ff</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;">fe14</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;">10c</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">64</span><span style="color:#E1E4E8;"> scope link</span></span>
<span class="line"><span style="color:#E1E4E8;">       valid_lft forever preferred_lft forever</span></span>
<span class="line"><span style="color:#79B8FF;">3</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> docker0</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">NO</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">CARRIER,BROADCAST,MULTICAST,UP</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> mtu </span><span style="color:#79B8FF;">1500</span><span style="color:#E1E4E8;"> qdisc noqueue state DOWN group </span><span style="color:#F97583;">default</span></span>
<span class="line"><span style="color:#E1E4E8;">    link</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">ether </span><span style="color:#79B8FF;">02</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">42</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">82</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">8d</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;">a0</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;">df brd ff</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;">ff</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;">ff</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;">ff</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;">ff</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;">ff</span></span>
<span class="line"><span style="color:#E1E4E8;">    inet </span><span style="color:#79B8FF;">172.17</span><span style="color:#E1E4E8;">.</span><span style="color:#FDAEB7;font-style:italic;">0</span><span style="color:#E1E4E8;">.</span><span style="color:#FDAEB7;font-style:italic;">1</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">16</span><span style="color:#E1E4E8;"> scope global docker0</span></span>
<span class="line"><span style="color:#E1E4E8;">       valid_lft forever preferred_lft forever</span></span>
<span class="line"><span style="color:#E1E4E8;">    inet6 fe80</span><span style="color:#F97583;">::</span><span style="color:#79B8FF;">42</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;">82ff</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;">fe8d</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;">a0df</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">64</span><span style="color:#E1E4E8;"> scope link</span></span>
<span class="line"><span style="color:#E1E4E8;">       valid_lft forever preferred_lft forever</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">$ ip a</span></span>
<span class="line"><span style="color:#005CC5;">1</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> lo</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">LOOPBACK,UP,LOWER_UP</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> mtu </span><span style="color:#005CC5;">65536</span><span style="color:#24292E;"> qdisc noqueue state UNKNOWN group </span><span style="color:#D73A49;">default</span><span style="color:#24292E;"> qlen </span><span style="color:#005CC5;">1000</span></span>
<span class="line"><span style="color:#24292E;">    link</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">loopback </span><span style="color:#005CC5;">00</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">00</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">00</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">00</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">00</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">00</span><span style="color:#24292E;"> brd </span><span style="color:#005CC5;">00</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">00</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">00</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">00</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">00</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">00</span></span>
<span class="line"><span style="color:#24292E;">    inet </span><span style="color:#005CC5;">127.0</span><span style="color:#24292E;">.</span><span style="color:#B31D28;font-style:italic;">0</span><span style="color:#24292E;">.</span><span style="color:#B31D28;font-style:italic;">1</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">8</span><span style="color:#24292E;"> scope host lo</span></span>
<span class="line"><span style="color:#24292E;">       valid_lft forever preferred_lft forever</span></span>
<span class="line"><span style="color:#24292E;">    inet6 </span><span style="color:#D73A49;">::</span><span style="color:#005CC5;">1</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">128</span><span style="color:#24292E;"> scope host</span></span>
<span class="line"><span style="color:#24292E;">       valid_lft forever preferred_lft forever</span></span>
<span class="line"><span style="color:#005CC5;">2</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> eth0</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">BROADCAST,MULTICAST,UP,LOWER_UP</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> mtu </span><span style="color:#005CC5;">1500</span><span style="color:#24292E;"> qdisc pfifo_fast state UP group </span><span style="color:#D73A49;">default</span><span style="color:#24292E;"> qlen </span><span style="color:#005CC5;">1000</span></span>
<span class="line"><span style="color:#24292E;">    link</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">ether </span><span style="color:#005CC5;">02</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">11</span><span style="color:#D73A49;">:</span><span style="color:#24292E;">b0</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">14</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">01</span><span style="color:#D73A49;">:</span><span style="color:#24292E;">0c brd ff</span><span style="color:#D73A49;">:</span><span style="color:#24292E;">ff</span><span style="color:#D73A49;">:</span><span style="color:#24292E;">ff</span><span style="color:#D73A49;">:</span><span style="color:#24292E;">ff</span><span style="color:#D73A49;">:</span><span style="color:#24292E;">ff</span><span style="color:#D73A49;">:</span><span style="color:#24292E;">ff</span></span>
<span class="line"><span style="color:#24292E;">    inet </span><span style="color:#005CC5;">172.20</span><span style="color:#24292E;">.</span><span style="color:#B31D28;font-style:italic;">1</span><span style="color:#24292E;">.</span><span style="color:#B31D28;font-style:italic;">11</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">24</span><span style="color:#24292E;"> brd </span><span style="color:#005CC5;">172.20</span><span style="color:#24292E;">.</span><span style="color:#B31D28;font-style:italic;">1</span><span style="color:#24292E;">.</span><span style="color:#B31D28;font-style:italic;">255</span><span style="color:#24292E;"> scope global dynamic eth0</span></span>
<span class="line"><span style="color:#24292E;">       valid_lft 86063337sec preferred_lft 86063337sec</span></span>
<span class="line"><span style="color:#24292E;">    inet6 fe80</span><span style="color:#D73A49;">::</span><span style="color:#005CC5;">11</span><span style="color:#D73A49;">:</span><span style="color:#24292E;">b0ff</span><span style="color:#D73A49;">:</span><span style="color:#24292E;">fe14</span><span style="color:#D73A49;">:</span><span style="color:#24292E;">10c</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">64</span><span style="color:#24292E;"> scope link</span></span>
<span class="line"><span style="color:#24292E;">       valid_lft forever preferred_lft forever</span></span>
<span class="line"><span style="color:#005CC5;">3</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> docker0</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">NO</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">CARRIER,BROADCAST,MULTICAST,UP</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> mtu </span><span style="color:#005CC5;">1500</span><span style="color:#24292E;"> qdisc noqueue state DOWN group </span><span style="color:#D73A49;">default</span></span>
<span class="line"><span style="color:#24292E;">    link</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">ether </span><span style="color:#005CC5;">02</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">42</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">82</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">8d</span><span style="color:#D73A49;">:</span><span style="color:#24292E;">a0</span><span style="color:#D73A49;">:</span><span style="color:#24292E;">df brd ff</span><span style="color:#D73A49;">:</span><span style="color:#24292E;">ff</span><span style="color:#D73A49;">:</span><span style="color:#24292E;">ff</span><span style="color:#D73A49;">:</span><span style="color:#24292E;">ff</span><span style="color:#D73A49;">:</span><span style="color:#24292E;">ff</span><span style="color:#D73A49;">:</span><span style="color:#24292E;">ff</span></span>
<span class="line"><span style="color:#24292E;">    inet </span><span style="color:#005CC5;">172.17</span><span style="color:#24292E;">.</span><span style="color:#B31D28;font-style:italic;">0</span><span style="color:#24292E;">.</span><span style="color:#B31D28;font-style:italic;">1</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">16</span><span style="color:#24292E;"> scope global docker0</span></span>
<span class="line"><span style="color:#24292E;">       valid_lft forever preferred_lft forever</span></span>
<span class="line"><span style="color:#24292E;">    inet6 fe80</span><span style="color:#D73A49;">::</span><span style="color:#005CC5;">42</span><span style="color:#D73A49;">:</span><span style="color:#24292E;">82ff</span><span style="color:#D73A49;">:</span><span style="color:#24292E;">fe8d</span><span style="color:#D73A49;">:</span><span style="color:#24292E;">a0df</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">64</span><span style="color:#24292E;"> scope link</span></span>
<span class="line"><span style="color:#24292E;">       valid_lft forever preferred_lft forever</span></span></code></pre></div><p>然后我们使用以下命令创建一个 Net Namespace：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">unshare</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--net</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--fork</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/bin/bash</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@centos7 centos]#</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">unshare</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--net</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--fork</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/bin/bash</span></span>
<span class="line"><span style="color:#24292E;">[root@centos7 centos]#</span></span></code></pre></div><p>同样的我们使用 ip a 命令查看一下网络信息：</p><div class="language-dart vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">dart</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root</span><span style="color:#F97583;">@centos</span><span style="color:#E1E4E8;">7 centos]# ip a</span></span>
<span class="line"><span style="color:#79B8FF;">1</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> lo</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#79B8FF;">LOOPBACK</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> mtu </span><span style="color:#79B8FF;">65536</span><span style="color:#E1E4E8;"> qdisc noop state </span><span style="color:#79B8FF;">DOWN</span><span style="color:#E1E4E8;"> group </span><span style="color:#F97583;">default</span><span style="color:#E1E4E8;"> qlen </span><span style="color:#79B8FF;">1000</span></span>
<span class="line"><span style="color:#E1E4E8;">    link</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">loopback </span><span style="color:#79B8FF;">00</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">00</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">00</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">00</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">00</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">00</span><span style="color:#E1E4E8;"> brd </span><span style="color:#79B8FF;">00</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">00</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">00</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">00</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">00</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">00</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root</span><span style="color:#D73A49;">@centos</span><span style="color:#24292E;">7 centos]# ip a</span></span>
<span class="line"><span style="color:#005CC5;">1</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> lo</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#005CC5;">LOOPBACK</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> mtu </span><span style="color:#005CC5;">65536</span><span style="color:#24292E;"> qdisc noop state </span><span style="color:#005CC5;">DOWN</span><span style="color:#24292E;"> group </span><span style="color:#D73A49;">default</span><span style="color:#24292E;"> qlen </span><span style="color:#005CC5;">1000</span></span>
<span class="line"><span style="color:#24292E;">    link</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">loopback </span><span style="color:#005CC5;">00</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">00</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">00</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">00</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">00</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">00</span><span style="color:#24292E;"> brd </span><span style="color:#005CC5;">00</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">00</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">00</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">00</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">00</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">00</span></span></code></pre></div><p>可以看到，宿主机上有 lo、eth0、docker0 等网络设备，而我们新建的 Net Namespace 内则与主机上的网络设备不同。</p><h3 id="为什么-docker-需要-namespace" tabindex="-1">为什么 Docker 需要 Namespace？ <a class="header-anchor" href="#为什么-docker-需要-namespace" aria-label="Permalink to &quot;为什么 Docker 需要 Namespace？&quot;">​</a></h3><p>Linux 内核从 2002 年 2.4.19 版本开始加入了 Mount Namespace，而直到内核 3.8 版本加入了 User Namespace 才为容器提供了足够的支持功能。</p><p>当 Docker 新建一个容器时， 它会创建这六种 Namespace，然后将容器中的进程加入这些 Namespace 之中，使得 Docker 容器中的进程只能看到当前 Namespace 中的系统资源。</p><p>正是由于 Docker 使用了 Linux 的这些 Namespace 技术，才实现了 Docker 容器的隔离，可以说没有 Namespace，就没有 Docker 容器。</p><h3 id="小结" tabindex="-1">小结 <a class="header-anchor" href="#小结" aria-label="Permalink to &quot;小结&quot;">​</a></h3><p>到此，相信你已经了解了什么是 Namespace。Namespace 是 Linux 内核的一个特性，该特性可以实现在同一主机系统中对进程 ID、主机名、用户 ID、文件名、网络和进程间通信等资源的隔离。Docker 正是结合了这六种 Namespace 的功能，才诞生了 Docker 容器。</p><p>最后，试想下，当我们使用 docker run --net=host 命令启动容器时，容器是否和主机共享同一个 Net Namespace？思考后，可以把你的想法写在留言区。</p>`,92),e=[o];function t(c,r,y,E,i,F){return a(),n("div",null,e)}const u=s(l,[["render",t]]);export{C as __pageData,u as default};
