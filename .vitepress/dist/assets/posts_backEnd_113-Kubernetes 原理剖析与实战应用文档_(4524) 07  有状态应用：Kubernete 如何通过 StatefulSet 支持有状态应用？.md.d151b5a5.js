import{_ as s,o as n,h as a,Q as l}from"./chunks/framework.d3daa342.js";const C=JSON.parse('{"title":"07有状态应用：Kubernete如何通过StatefulSet支持有状态应用？","description":"","frontmatter":{},"headers":[],"relativePath":"posts/backEnd/113-Kubernetes 原理剖析与实战应用文档/(4524) 07  有状态应用：Kubernete 如何通过 StatefulSet 支持有状态应用？.md","filePath":"posts/backEnd/113-Kubernetes 原理剖析与实战应用文档/(4524) 07  有状态应用：Kubernete 如何通过 StatefulSet 支持有状态应用？.md","lastUpdated":1696682708000}'),p={name:"posts/backEnd/113-Kubernetes 原理剖析与实战应用文档/(4524) 07  有状态应用：Kubernete 如何通过 StatefulSet 支持有状态应用？.md"},o=l(`<h1 id="_07有状态应用-kubernete如何通过statefulset支持有状态应用" tabindex="-1">07有状态应用：Kubernete如何通过StatefulSet支持有状态应用？ <a class="header-anchor" href="#_07有状态应用-kubernete如何通过statefulset支持有状态应用" aria-label="Permalink to &quot;07有状态应用：Kubernete如何通过StatefulSet支持有状态应用？&quot;">​</a></h1><p>在上一节课中，我们学习了 Kubernetes 中的无状态工作负载，并上手实践了 Deployment 对象，相信现在你已经慢慢喜欢上 Kubernetes 了。</p><p>那么本节课，我们来一起看看Kubernetes 中的另外一种工作负载 StatefulSet。从名字就可以看出，这个工作负载主要用于有状态的服务发布。关于有状态服务和无状态服务，你可以参考上一节课的内容。</p><p>这节课，我们从一个具体的例子来逐渐了解、认识 StatefulSet。在 kubectl 命令行中，我们一般将 StatefulSet 简写为 sts。在部署一个 StatefulSet 的时候，有个前置依赖对象，即 Service（服务）。这个对象在 StatefulSet 中的作用，我们在下文中会一一道来。另外，关于这个对象的详细介绍和其他作用，我们会在后面的课程中单独讲解。在此，你可以先暂时略过对 Service 的感知。我们先看如下一个 Service：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">cat</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nginx-svc.yaml</span></span>
<span class="line"><span style="color:#B392F0;">apiVersion:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#B392F0;">kind:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Service</span></span>
<span class="line"><span style="color:#B392F0;">metadata:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">name:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nginx-demo</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">namespace:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">demo</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">labels:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">app:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nginx</span></span>
<span class="line"><span style="color:#B392F0;">spec:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">clusterIP:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">None</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">ports:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">port:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">80</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">name:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">web</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">selector:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">app:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nginx</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">cat</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nginx-svc.yaml</span></span>
<span class="line"><span style="color:#6F42C1;">apiVersion:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#6F42C1;">kind:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Service</span></span>
<span class="line"><span style="color:#6F42C1;">metadata:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">name:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nginx-demo</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">namespace:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">demo</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">labels:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">app:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nginx</span></span>
<span class="line"><span style="color:#6F42C1;">spec:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">clusterIP:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">None</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">ports:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">-</span><span style="color:#24292E;"> </span><span style="color:#032F62;">port:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">80</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">name:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">web</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">selector:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">app:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nginx</span></span></code></pre></div><p>上面这段 yaml 的意思是，在 demo 这个命名空间中，创建一个名为 nginx-demo 的服务，这个服务暴露了 80 端口，可以访问带有<code>app=nginx</code>这个 label 的 Pod。</p><p>我们现在利用上面这段 yaml 在集群中创建出一个 Service：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">create</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ns</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">demo</span></span>
<span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">create</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-f</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nginx-svc.yaml</span></span>
<span class="line"><span style="color:#B392F0;">service/nginx-demo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">created</span></span>
<span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">get</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">svc</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-n</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">demo</span></span>
<span class="line"><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">         </span><span style="color:#9ECBFF;">TYPE</span><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">CLUSTER-IP</span><span style="color:#E1E4E8;">       </span><span style="color:#9ECBFF;">EXTERNAL-IP</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">PORT</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">S</span><span style="color:#E1E4E8;">)   </span><span style="color:#9ECBFF;">AGE</span></span>
<span class="line"><span style="color:#B392F0;">nginx-demo</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">ClusterIP</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">None</span><span style="color:#E1E4E8;">             </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">80</span><span style="color:#9ECBFF;">/TCP</span><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">5</span><span style="color:#9ECBFF;">s</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">create</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ns</span><span style="color:#24292E;"> </span><span style="color:#032F62;">demo</span></span>
<span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">create</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-f</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nginx-svc.yaml</span></span>
<span class="line"><span style="color:#6F42C1;">service/nginx-demo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span>
<span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">get</span><span style="color:#24292E;"> </span><span style="color:#032F62;">svc</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-n</span><span style="color:#24292E;"> </span><span style="color:#032F62;">demo</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">         </span><span style="color:#032F62;">TYPE</span><span style="color:#24292E;">        </span><span style="color:#032F62;">CLUSTER-IP</span><span style="color:#24292E;">       </span><span style="color:#032F62;">EXTERNAL-IP</span><span style="color:#24292E;">   </span><span style="color:#032F62;">PORT</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">S</span><span style="color:#24292E;">)   </span><span style="color:#032F62;">AGE</span></span>
<span class="line"><span style="color:#6F42C1;">nginx-demo</span><span style="color:#24292E;">   </span><span style="color:#032F62;">ClusterIP</span><span style="color:#24292E;">   </span><span style="color:#032F62;">None</span><span style="color:#24292E;">             </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">        </span><span style="color:#005CC5;">80</span><span style="color:#032F62;">/TCP</span><span style="color:#24292E;">    </span><span style="color:#005CC5;">5</span><span style="color:#032F62;">s</span></span></code></pre></div><p>创建好了这个前置依赖的 Service，下面我们就可以开始创建真正的 StatefulSet 对象，可参照如下的 yaml 文件：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">cat</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">web-sts.yaml</span></span>
<span class="line"><span style="color:#B392F0;">apiVersion:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">apps/v1</span></span>
<span class="line"><span style="color:#B392F0;">kind:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">StatefulSet</span></span>
<span class="line"><span style="color:#B392F0;">metadata:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">name:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">web-demo</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">namespace:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">demo</span></span>
<span class="line"><span style="color:#B392F0;">spec:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">serviceName:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;nginx-demo&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">replicas:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">selector:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">matchLabels:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">app:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nginx</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">template:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">metadata:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">labels:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">app:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nginx</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">spec:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">containers:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">name:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nginx</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">image:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nginx:1.19.2-alpine</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">ports:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">containerPort:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">80</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#B392F0;">name:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">web</span></span>
<span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">create</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-f</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">web-sts.yaml</span></span>
<span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">get</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">sts</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-n</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">demo</span></span>
<span class="line"><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">       </span><span style="color:#9ECBFF;">READY</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">AGE</span></span>
<span class="line"><span style="color:#B392F0;">web-demo</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#9ECBFF;">/2</span><span style="color:#E1E4E8;">     </span><span style="color:#79B8FF;">9</span><span style="color:#9ECBFF;">s</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">cat</span><span style="color:#24292E;"> </span><span style="color:#032F62;">web-sts.yaml</span></span>
<span class="line"><span style="color:#6F42C1;">apiVersion:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">apps/v1</span></span>
<span class="line"><span style="color:#6F42C1;">kind:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">StatefulSet</span></span>
<span class="line"><span style="color:#6F42C1;">metadata:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">name:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">web-demo</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">namespace:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">demo</span></span>
<span class="line"><span style="color:#6F42C1;">spec:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">serviceName:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;nginx-demo&quot;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">replicas:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">selector:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">matchLabels:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6F42C1;">app:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nginx</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">template:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">metadata:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6F42C1;">labels:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">app:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nginx</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">spec:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6F42C1;">containers:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6F42C1;">-</span><span style="color:#24292E;"> </span><span style="color:#032F62;">name:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nginx</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">image:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nginx:1.19.2-alpine</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">ports:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">-</span><span style="color:#24292E;"> </span><span style="color:#032F62;">containerPort:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">80</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#6F42C1;">name:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">web</span></span>
<span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">create</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-f</span><span style="color:#24292E;"> </span><span style="color:#032F62;">web-sts.yaml</span></span>
<span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">get</span><span style="color:#24292E;"> </span><span style="color:#032F62;">sts</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-n</span><span style="color:#24292E;"> </span><span style="color:#032F62;">demo</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">       </span><span style="color:#032F62;">READY</span><span style="color:#24292E;">   </span><span style="color:#032F62;">AGE</span></span>
<span class="line"><span style="color:#6F42C1;">web-demo</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#032F62;">/2</span><span style="color:#24292E;">     </span><span style="color:#005CC5;">9</span><span style="color:#032F62;">s</span></span></code></pre></div><p>可以看到，到这里我已经将名为web-demo的StatefulSet部署完成了。</p><p>下面我们来一点点探索 StatefulSet 的秘密，看看它有哪些特性，为何可以保障服务有状态的运行。</p><h3 id="statefulset-的特性" tabindex="-1">StatefulSet 的特性 <a class="header-anchor" href="#statefulset-的特性" aria-label="Permalink to &quot;StatefulSet 的特性&quot;">​</a></h3><p>通过 kubectl 的<strong>watch</strong> 功能（命令行加参数<code>-w</code>），我们可以观察到 Pod 状态的一步步变化。</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">get</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pod</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-n</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">demo</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-w</span></span>
<span class="line"><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">         </span><span style="color:#9ECBFF;">READY</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">STATUS</span><span style="color:#E1E4E8;">              </span><span style="color:#9ECBFF;">RESTARTS</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">AGE</span></span>
<span class="line"><span style="color:#B392F0;">web-demo-0</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">ContainerCreating</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">18</span><span style="color:#9ECBFF;">s</span></span>
<span class="line"><span style="color:#B392F0;">web-demo-0</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;">             </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">20</span><span style="color:#9ECBFF;">s</span></span>
<span class="line"><span style="color:#B392F0;">web-demo-1</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Pending</span><span style="color:#E1E4E8;">             </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">0</span><span style="color:#9ECBFF;">s</span></span>
<span class="line"><span style="color:#B392F0;">web-demo-1</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Pending</span><span style="color:#E1E4E8;">             </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">0</span><span style="color:#9ECBFF;">s</span></span>
<span class="line"><span style="color:#B392F0;">web-demo-1</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">ContainerCreating</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">0</span><span style="color:#9ECBFF;">s</span></span>
<span class="line"><span style="color:#B392F0;">web-demo-1</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;">             </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">2</span><span style="color:#9ECBFF;">s</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">get</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pod</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-n</span><span style="color:#24292E;"> </span><span style="color:#032F62;">demo</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-w</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">         </span><span style="color:#032F62;">READY</span><span style="color:#24292E;">   </span><span style="color:#032F62;">STATUS</span><span style="color:#24292E;">              </span><span style="color:#032F62;">RESTARTS</span><span style="color:#24292E;">   </span><span style="color:#032F62;">AGE</span></span>
<span class="line"><span style="color:#6F42C1;">web-demo-0</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">ContainerCreating</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">18</span><span style="color:#032F62;">s</span></span>
<span class="line"><span style="color:#6F42C1;">web-demo-0</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">             </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">20</span><span style="color:#032F62;">s</span></span>
<span class="line"><span style="color:#6F42C1;">web-demo-1</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Pending</span><span style="color:#24292E;">             </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">0</span><span style="color:#032F62;">s</span></span>
<span class="line"><span style="color:#6F42C1;">web-demo-1</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Pending</span><span style="color:#24292E;">             </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">0</span><span style="color:#032F62;">s</span></span>
<span class="line"><span style="color:#6F42C1;">web-demo-1</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">ContainerCreating</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">0</span><span style="color:#032F62;">s</span></span>
<span class="line"><span style="color:#6F42C1;">web-demo-1</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">             </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">2</span><span style="color:#032F62;">s</span></span></code></pre></div><p><strong>通过 StatefulSet 创建出来的 Pod 名字有一定的规律</strong> ，即<code>$(statefulset名称)-$(序号)</code>，比如这个例子中的web-demo-0、web-demo-1。</p><p>这里面还有个有意思的点，web-demo-0 这个 Pod 比 web-demo-1 优先创建，而且在 web-demo-0 变为 Running 状态以后，才被创建出来。为了证实这个猜想，我们在一个终端窗口观察 StatefulSet 的 Pod：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">get</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pod</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-n</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">demo</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-w</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-l</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">app=nginx</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">get</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pod</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-n</span><span style="color:#24292E;"> </span><span style="color:#032F62;">demo</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-w</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-l</span><span style="color:#24292E;"> </span><span style="color:#032F62;">app=nginx</span></span></code></pre></div><p>我们再开一个终端端口来 watch 这个 namespace 中的 event：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">get</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">event</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-n</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">demo</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-w</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">get</span><span style="color:#24292E;"> </span><span style="color:#032F62;">event</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-n</span><span style="color:#24292E;"> </span><span style="color:#032F62;">demo</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-w</span></span></code></pre></div><p>现在我们试着改变这个 StatefulSet 的副本数，将它改成 5：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">scale</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">sts</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">web-demo</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-n</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">demo</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--replicas=5</span></span>
<span class="line"><span style="color:#B392F0;">statefulset.apps/web-demo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">scaled</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">scale</span><span style="color:#24292E;"> </span><span style="color:#032F62;">sts</span><span style="color:#24292E;"> </span><span style="color:#032F62;">web-demo</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-n</span><span style="color:#24292E;"> </span><span style="color:#032F62;">demo</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--replicas=5</span></span>
<span class="line"><span style="color:#6F42C1;">statefulset.apps/web-demo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">scaled</span></span></code></pre></div><p>此时我们观察到另外两个终端端口的输出：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">get</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pod</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-n</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">demo</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-w</span></span>
<span class="line"><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">         </span><span style="color:#9ECBFF;">READY</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">STATUS</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">RESTARTS</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">AGE</span></span>
<span class="line"><span style="color:#B392F0;">web-demo-0</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">20</span><span style="color:#9ECBFF;">m</span></span>
<span class="line"><span style="color:#B392F0;">web-demo-1</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">20</span><span style="color:#9ECBFF;">m</span></span>
<span class="line"><span style="color:#B392F0;">web-demo-2</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Pending</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">0</span><span style="color:#9ECBFF;">s</span></span>
<span class="line"><span style="color:#B392F0;">web-demo-2</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Pending</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">0</span><span style="color:#9ECBFF;">s</span></span>
<span class="line"><span style="color:#B392F0;">web-demo-2</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">ContainerCreating</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">0</span><span style="color:#9ECBFF;">s</span></span>
<span class="line"><span style="color:#B392F0;">web-demo-2</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;">             </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">2</span><span style="color:#9ECBFF;">s</span></span>
<span class="line"><span style="color:#B392F0;">web-demo-3</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Pending</span><span style="color:#E1E4E8;">             </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">0</span><span style="color:#9ECBFF;">s</span></span>
<span class="line"><span style="color:#B392F0;">web-demo-3</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Pending</span><span style="color:#E1E4E8;">             </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">0</span><span style="color:#9ECBFF;">s</span></span>
<span class="line"><span style="color:#B392F0;">web-demo-3</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">ContainerCreating</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">0</span><span style="color:#9ECBFF;">s</span></span>
<span class="line"><span style="color:#B392F0;">web-demo-3</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;">             </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">3</span><span style="color:#9ECBFF;">s</span></span>
<span class="line"><span style="color:#B392F0;">web-demo-4</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Pending</span><span style="color:#E1E4E8;">             </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">0</span><span style="color:#9ECBFF;">s</span></span>
<span class="line"><span style="color:#B392F0;">web-demo-4</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Pending</span><span style="color:#E1E4E8;">             </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">0</span><span style="color:#9ECBFF;">s</span></span>
<span class="line"><span style="color:#B392F0;">web-demo-4</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">ContainerCreating</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">0</span><span style="color:#9ECBFF;">s</span></span>
<span class="line"><span style="color:#B392F0;">web-demo-4</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;">             </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">3</span><span style="color:#9ECBFF;">s</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">get</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pod</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-n</span><span style="color:#24292E;"> </span><span style="color:#032F62;">demo</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-w</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">         </span><span style="color:#032F62;">READY</span><span style="color:#24292E;">   </span><span style="color:#032F62;">STATUS</span><span style="color:#24292E;">    </span><span style="color:#032F62;">RESTARTS</span><span style="color:#24292E;">   </span><span style="color:#032F62;">AGE</span></span>
<span class="line"><span style="color:#6F42C1;">web-demo-0</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">20</span><span style="color:#032F62;">m</span></span>
<span class="line"><span style="color:#6F42C1;">web-demo-1</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">20</span><span style="color:#032F62;">m</span></span>
<span class="line"><span style="color:#6F42C1;">web-demo-2</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Pending</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">0</span><span style="color:#032F62;">s</span></span>
<span class="line"><span style="color:#6F42C1;">web-demo-2</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Pending</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">0</span><span style="color:#032F62;">s</span></span>
<span class="line"><span style="color:#6F42C1;">web-demo-2</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">ContainerCreating</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">0</span><span style="color:#032F62;">s</span></span>
<span class="line"><span style="color:#6F42C1;">web-demo-2</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">             </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">2</span><span style="color:#032F62;">s</span></span>
<span class="line"><span style="color:#6F42C1;">web-demo-3</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Pending</span><span style="color:#24292E;">             </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">0</span><span style="color:#032F62;">s</span></span>
<span class="line"><span style="color:#6F42C1;">web-demo-3</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Pending</span><span style="color:#24292E;">             </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">0</span><span style="color:#032F62;">s</span></span>
<span class="line"><span style="color:#6F42C1;">web-demo-3</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">ContainerCreating</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">0</span><span style="color:#032F62;">s</span></span>
<span class="line"><span style="color:#6F42C1;">web-demo-3</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">             </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">3</span><span style="color:#032F62;">s</span></span>
<span class="line"><span style="color:#6F42C1;">web-demo-4</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Pending</span><span style="color:#24292E;">             </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">0</span><span style="color:#032F62;">s</span></span>
<span class="line"><span style="color:#6F42C1;">web-demo-4</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Pending</span><span style="color:#24292E;">             </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">0</span><span style="color:#032F62;">s</span></span>
<span class="line"><span style="color:#6F42C1;">web-demo-4</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">ContainerCreating</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">0</span><span style="color:#032F62;">s</span></span>
<span class="line"><span style="color:#6F42C1;">web-demo-4</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">             </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">3</span><span style="color:#032F62;">s</span></span></code></pre></div><p>我们再一次看到了 StatefulSet 管理的 Pod 按照 2、3、4 的顺序依次创建，名称有规律，跟上一节通过 Deployment 创建的随机 Pod 名有很大的区别。</p><p>通过观察对应的 event 信息，也可以再次证实我们的猜想。</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">$ kubectl get event </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">n demo </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">w</span></span>
<span class="line"><span style="color:#79B8FF;">LAST</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">SEEN</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">TYPE</span><span style="color:#E1E4E8;">     </span><span style="color:#79B8FF;">REASON</span><span style="color:#E1E4E8;">             </span><span style="color:#79B8FF;">OBJECT</span><span style="color:#E1E4E8;">                 </span><span style="color:#79B8FF;">MESSAGE</span></span>
<span class="line"><span style="color:#E1E4E8;">20m         Normal   Scheduled          pod</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">web</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">demo</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">         Successfully assigned demo</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">web</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">demo</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> to kraken</span></span>
<span class="line"><span style="color:#E1E4E8;">20m         Normal   Pulling            pod</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">web</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">demo</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">         Pulling image </span><span style="color:#9ECBFF;">&quot;nginx:1.19.2-alpine&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">20m         Normal   Pulled             pod</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">web</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">demo</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">         Successfully pulled image </span><span style="color:#9ECBFF;">&quot;nginx:1.19.2-alpine&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">20m         Normal   Created            pod</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">web</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">demo</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">         Created container nginx</span></span>
<span class="line"><span style="color:#E1E4E8;">20m         Normal   Started            pod</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">web</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">demo</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">         Started container nginx</span></span>
<span class="line"><span style="color:#E1E4E8;">20m         Normal   Scheduled          pod</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">web</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">demo</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">         Successfully assigned demo</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">web</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">demo</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> to kraken</span></span>
<span class="line"><span style="color:#E1E4E8;">20m         Normal   Pulled             pod</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">web</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">demo</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">         Container image </span><span style="color:#9ECBFF;">&quot;nginx:1.19.2-alpine&quot;</span><span style="color:#E1E4E8;"> already present on machine</span></span>
<span class="line"><span style="color:#E1E4E8;">20m         Normal   Created            pod</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">web</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">demo</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">         Created container nginx</span></span>
<span class="line"><span style="color:#E1E4E8;">20m         Normal   Started            pod</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">web</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">demo</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">         Started container nginx</span></span>
<span class="line"><span style="color:#E1E4E8;">20m         Normal   SuccessfulCreate   statefulset</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">web</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">demo   create Pod web</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">demo</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> StatefulSet web</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">demo successful</span></span>
<span class="line"><span style="color:#E1E4E8;">20m         Normal   SuccessfulCreate   statefulset</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">web</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">demo   create Pod web</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">demo</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> StatefulSet web</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">demo successful</span></span>
<span class="line"><span style="color:#E1E4E8;">0s          Normal   SuccessfulCreate   statefulset</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">web</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">demo   create Pod web</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">demo</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> StatefulSet web</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">demo successful</span></span>
<span class="line"><span style="color:#E1E4E8;">0s          Normal   Scheduled          pod</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">web</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">demo</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">         Successfully assigned demo</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">web</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">demo</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;"> to kraken</span></span>
<span class="line"><span style="color:#E1E4E8;">0s          Normal   Pulled             pod</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">web</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">demo</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">         Container image </span><span style="color:#9ECBFF;">&quot;nginx:1.19.2-alpine&quot;</span><span style="color:#E1E4E8;"> already present on machine</span></span>
<span class="line"><span style="color:#E1E4E8;">0s          Normal   Created            pod</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">web</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">demo</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">         Created container nginx</span></span>
<span class="line"><span style="color:#E1E4E8;">0s          Normal   Started            pod</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">web</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">demo</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">         Started container nginx</span></span>
<span class="line"><span style="color:#E1E4E8;">0s          Normal   SuccessfulCreate   statefulset</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">web</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">demo   create Pod web</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">demo</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> StatefulSet web</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">demo successful</span></span>
<span class="line"><span style="color:#E1E4E8;">0s          Normal   Scheduled          pod</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">web</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">demo</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;">         Successfully assigned demo</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">web</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">demo</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;"> to kraken</span></span>
<span class="line"><span style="color:#E1E4E8;">0s          Normal   Pulled             pod</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">web</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">demo</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;">         Container image </span><span style="color:#9ECBFF;">&quot;nginx:1.19.2-alpine&quot;</span><span style="color:#E1E4E8;"> already present on machine</span></span>
<span class="line"><span style="color:#E1E4E8;">0s          Normal   Created            pod</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">web</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">demo</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;">         Created container nginx</span></span>
<span class="line"><span style="color:#E1E4E8;">0s          Normal   Started            pod</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">web</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">demo</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;">         Started container nginx</span></span>
<span class="line"><span style="color:#E1E4E8;">0s          Normal   SuccessfulCreate   statefulset</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">web</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">demo   create Pod web</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">demo</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> StatefulSet web</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">demo successful</span></span>
<span class="line"><span style="color:#E1E4E8;">0s          Normal   Scheduled          pod</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">web</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">demo</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;">         Successfully assigned demo</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">web</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">demo</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;"> to kraken</span></span>
<span class="line"><span style="color:#E1E4E8;">0s          Normal   Pulled             pod</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">web</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">demo</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;">         Container image </span><span style="color:#9ECBFF;">&quot;nginx:1.19.2-alpine&quot;</span><span style="color:#E1E4E8;"> already present on machine</span></span>
<span class="line"><span style="color:#E1E4E8;">0s          Normal   Created            pod</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">web</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">demo</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;">         Created container nginx</span></span>
<span class="line"><span style="color:#E1E4E8;">0s          Normal   Started            pod</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">web</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">demo</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;">         Started container nginx</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">$ kubectl get event </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">n demo </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">w</span></span>
<span class="line"><span style="color:#005CC5;">LAST</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">SEEN</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">TYPE</span><span style="color:#24292E;">     </span><span style="color:#005CC5;">REASON</span><span style="color:#24292E;">             </span><span style="color:#005CC5;">OBJECT</span><span style="color:#24292E;">                 </span><span style="color:#005CC5;">MESSAGE</span></span>
<span class="line"><span style="color:#24292E;">20m         Normal   Scheduled          pod</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">web</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">demo</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">         Successfully assigned demo</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">web</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">demo</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> to kraken</span></span>
<span class="line"><span style="color:#24292E;">20m         Normal   Pulling            pod</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">web</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">demo</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">         Pulling image </span><span style="color:#032F62;">&quot;nginx:1.19.2-alpine&quot;</span></span>
<span class="line"><span style="color:#24292E;">20m         Normal   Pulled             pod</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">web</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">demo</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">         Successfully pulled image </span><span style="color:#032F62;">&quot;nginx:1.19.2-alpine&quot;</span></span>
<span class="line"><span style="color:#24292E;">20m         Normal   Created            pod</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">web</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">demo</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">         Created container nginx</span></span>
<span class="line"><span style="color:#24292E;">20m         Normal   Started            pod</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">web</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">demo</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">         Started container nginx</span></span>
<span class="line"><span style="color:#24292E;">20m         Normal   Scheduled          pod</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">web</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">demo</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">         Successfully assigned demo</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">web</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">demo</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> to kraken</span></span>
<span class="line"><span style="color:#24292E;">20m         Normal   Pulled             pod</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">web</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">demo</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">         Container image </span><span style="color:#032F62;">&quot;nginx:1.19.2-alpine&quot;</span><span style="color:#24292E;"> already present on machine</span></span>
<span class="line"><span style="color:#24292E;">20m         Normal   Created            pod</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">web</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">demo</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">         Created container nginx</span></span>
<span class="line"><span style="color:#24292E;">20m         Normal   Started            pod</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">web</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">demo</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">         Started container nginx</span></span>
<span class="line"><span style="color:#24292E;">20m         Normal   SuccessfulCreate   statefulset</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">web</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">demo   create Pod web</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">demo</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> StatefulSet web</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">demo successful</span></span>
<span class="line"><span style="color:#24292E;">20m         Normal   SuccessfulCreate   statefulset</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">web</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">demo   create Pod web</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">demo</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> StatefulSet web</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">demo successful</span></span>
<span class="line"><span style="color:#24292E;">0s          Normal   SuccessfulCreate   statefulset</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">web</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">demo   create Pod web</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">demo</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">2</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> StatefulSet web</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">demo successful</span></span>
<span class="line"><span style="color:#24292E;">0s          Normal   Scheduled          pod</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">web</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">demo</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">2</span><span style="color:#24292E;">         Successfully assigned demo</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">web</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">demo</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">2</span><span style="color:#24292E;"> to kraken</span></span>
<span class="line"><span style="color:#24292E;">0s          Normal   Pulled             pod</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">web</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">demo</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">2</span><span style="color:#24292E;">         Container image </span><span style="color:#032F62;">&quot;nginx:1.19.2-alpine&quot;</span><span style="color:#24292E;"> already present on machine</span></span>
<span class="line"><span style="color:#24292E;">0s          Normal   Created            pod</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">web</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">demo</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">2</span><span style="color:#24292E;">         Created container nginx</span></span>
<span class="line"><span style="color:#24292E;">0s          Normal   Started            pod</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">web</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">demo</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">2</span><span style="color:#24292E;">         Started container nginx</span></span>
<span class="line"><span style="color:#24292E;">0s          Normal   SuccessfulCreate   statefulset</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">web</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">demo   create Pod web</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">demo</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">3</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> StatefulSet web</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">demo successful</span></span>
<span class="line"><span style="color:#24292E;">0s          Normal   Scheduled          pod</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">web</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">demo</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">3</span><span style="color:#24292E;">         Successfully assigned demo</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">web</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">demo</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">3</span><span style="color:#24292E;"> to kraken</span></span>
<span class="line"><span style="color:#24292E;">0s          Normal   Pulled             pod</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">web</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">demo</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">3</span><span style="color:#24292E;">         Container image </span><span style="color:#032F62;">&quot;nginx:1.19.2-alpine&quot;</span><span style="color:#24292E;"> already present on machine</span></span>
<span class="line"><span style="color:#24292E;">0s          Normal   Created            pod</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">web</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">demo</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">3</span><span style="color:#24292E;">         Created container nginx</span></span>
<span class="line"><span style="color:#24292E;">0s          Normal   Started            pod</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">web</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">demo</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">3</span><span style="color:#24292E;">         Started container nginx</span></span>
<span class="line"><span style="color:#24292E;">0s          Normal   SuccessfulCreate   statefulset</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">web</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">demo   create Pod web</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">demo</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">4</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> StatefulSet web</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">demo successful</span></span>
<span class="line"><span style="color:#24292E;">0s          Normal   Scheduled          pod</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">web</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">demo</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">4</span><span style="color:#24292E;">         Successfully assigned demo</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">web</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">demo</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">4</span><span style="color:#24292E;"> to kraken</span></span>
<span class="line"><span style="color:#24292E;">0s          Normal   Pulled             pod</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">web</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">demo</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">4</span><span style="color:#24292E;">         Container image </span><span style="color:#032F62;">&quot;nginx:1.19.2-alpine&quot;</span><span style="color:#24292E;"> already present on machine</span></span>
<span class="line"><span style="color:#24292E;">0s          Normal   Created            pod</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">web</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">demo</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">4</span><span style="color:#24292E;">         Created container nginx</span></span>
<span class="line"><span style="color:#24292E;">0s          Normal   Started            pod</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">web</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">demo</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">4</span><span style="color:#24292E;">         Started container nginx</span></span></code></pre></div><p>现在我们试着进行一次缩容：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">scale</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">sts</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">web-demo</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-n</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">demo</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--replicas=2</span></span>
<span class="line"><span style="color:#B392F0;">statefulset.apps/web-demo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">scaled</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">scale</span><span style="color:#24292E;"> </span><span style="color:#032F62;">sts</span><span style="color:#24292E;"> </span><span style="color:#032F62;">web-demo</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-n</span><span style="color:#24292E;"> </span><span style="color:#032F62;">demo</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--replicas=2</span></span>
<span class="line"><span style="color:#6F42C1;">statefulset.apps/web-demo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">scaled</span></span></code></pre></div><p>此时观察另外两个终端窗口，分别如下：</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">web</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">demo</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">     Terminating   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          11m</span></span>
<span class="line"><span style="color:#E1E4E8;">web</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">demo</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">     Terminating   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          11m</span></span>
<span class="line"><span style="color:#E1E4E8;">web</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">demo</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">     Terminating   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          11m</span></span>
<span class="line"><span style="color:#E1E4E8;">web</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">demo</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">     Terminating   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          11m</span></span>
<span class="line"><span style="color:#E1E4E8;">web</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">demo</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">     Terminating   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          12m</span></span>
<span class="line"><span style="color:#E1E4E8;">web</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">demo</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">     Terminating   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          12m</span></span>
<span class="line"><span style="color:#E1E4E8;">web</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">demo</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">     Terminating   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          12m</span></span>
<span class="line"><span style="color:#E1E4E8;">web</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">demo</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">     Terminating   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          12m</span></span>
<span class="line"><span style="color:#E1E4E8;">web</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">demo</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">     Terminating   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          12m</span></span>
<span class="line"><span style="color:#E1E4E8;">web</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">demo</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">     Terminating   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          12m</span></span>
<span class="line"><span style="color:#E1E4E8;">web</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">demo</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">     Terminating   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          12m</span></span>
<span class="line"><span style="color:#E1E4E8;">web</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">demo</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">     Terminating   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          12m</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">web</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">demo</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">4</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">     Terminating   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          11m</span></span>
<span class="line"><span style="color:#24292E;">web</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">demo</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">4</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">     Terminating   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          11m</span></span>
<span class="line"><span style="color:#24292E;">web</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">demo</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">4</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">     Terminating   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          11m</span></span>
<span class="line"><span style="color:#24292E;">web</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">demo</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">4</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">     Terminating   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          11m</span></span>
<span class="line"><span style="color:#24292E;">web</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">demo</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">3</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">     Terminating   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          12m</span></span>
<span class="line"><span style="color:#24292E;">web</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">demo</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">3</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">     Terminating   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          12m</span></span>
<span class="line"><span style="color:#24292E;">web</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">demo</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">3</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">     Terminating   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          12m</span></span>
<span class="line"><span style="color:#24292E;">web</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">demo</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">3</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">     Terminating   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          12m</span></span>
<span class="line"><span style="color:#24292E;">web</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">demo</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">2</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">     Terminating   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          12m</span></span>
<span class="line"><span style="color:#24292E;">web</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">demo</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">2</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">     Terminating   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          12m</span></span>
<span class="line"><span style="color:#24292E;">web</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">demo</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">2</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">     Terminating   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          12m</span></span>
<span class="line"><span style="color:#24292E;">web</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">demo</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">2</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">     Terminating   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          12m</span></span></code></pre></div><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">0s          Normal   SuccessfulDelete   statefulset</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">web</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">demo   </span><span style="color:#F97583;">delete</span><span style="color:#E1E4E8;"> Pod web</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">demo</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> StatefulSet web</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">demo successful</span></span>
<span class="line"><span style="color:#E1E4E8;">0s          Normal   Killing            pod</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">web</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">demo</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;">         Stopping container nginx</span></span>
<span class="line"><span style="color:#E1E4E8;">0s          Normal   Killing            pod</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">web</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">demo</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;">         Stopping container nginx</span></span>
<span class="line"><span style="color:#E1E4E8;">0s          Normal   SuccessfulDelete   statefulset</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">web</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">demo   </span><span style="color:#F97583;">delete</span><span style="color:#E1E4E8;"> Pod web</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">demo</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> StatefulSet web</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">demo successful</span></span>
<span class="line"><span style="color:#E1E4E8;">0s          Normal   SuccessfulDelete   statefulset</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">web</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">demo   </span><span style="color:#F97583;">delete</span><span style="color:#E1E4E8;"> Pod web</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">demo</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> StatefulSet web</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">demo successful</span></span>
<span class="line"><span style="color:#E1E4E8;">0s          Normal   Killing            pod</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">web</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">demo</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">         Stopping container nginx</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">0s          Normal   SuccessfulDelete   statefulset</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">web</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">demo   </span><span style="color:#D73A49;">delete</span><span style="color:#24292E;"> Pod web</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">demo</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">4</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> StatefulSet web</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">demo successful</span></span>
<span class="line"><span style="color:#24292E;">0s          Normal   Killing            pod</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">web</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">demo</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">4</span><span style="color:#24292E;">         Stopping container nginx</span></span>
<span class="line"><span style="color:#24292E;">0s          Normal   Killing            pod</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">web</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">demo</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">3</span><span style="color:#24292E;">         Stopping container nginx</span></span>
<span class="line"><span style="color:#24292E;">0s          Normal   SuccessfulDelete   statefulset</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">web</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">demo   </span><span style="color:#D73A49;">delete</span><span style="color:#24292E;"> Pod web</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">demo</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">3</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> StatefulSet web</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">demo successful</span></span>
<span class="line"><span style="color:#24292E;">0s          Normal   SuccessfulDelete   statefulset</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">web</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">demo   </span><span style="color:#D73A49;">delete</span><span style="color:#24292E;"> Pod web</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">demo</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">2</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> StatefulSet web</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">demo successful</span></span>
<span class="line"><span style="color:#24292E;">0s          Normal   Killing            pod</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">web</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">demo</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">2</span><span style="color:#24292E;">         Stopping container nginx</span></span></code></pre></div><p>可以看到，在缩容的时候，StatefulSet 关联的 Pod 按着 4、3、2 的顺序依次删除。</p><p>可见，<strong>对于一个拥有 N 个副本的 StatefulSet 来说</strong> ，<strong>Pod 在部署时按照 {0 ...... N-1} 的序号顺序创建的</strong> ，<strong>而删除的时候按照逆序逐个删除</strong>，这便是我想说的第一个特性。</p><p>接着我们来看，<strong>StatefulSet 创建出来的 Pod 都具有固定的、且确切的主机名</strong>，比如：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">for</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">i</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">in</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">; </span><span style="color:#F97583;">do</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">exec</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">web-demo-</span><span style="color:#E1E4E8;">$i </span><span style="color:#79B8FF;">-n</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">demo</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">sh</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-c</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;hostname&#39;</span><span style="color:#E1E4E8;">; </span><span style="color:#F97583;">done</span></span>
<span class="line"><span style="color:#B392F0;">web-demo-0</span></span>
<span class="line"><span style="color:#B392F0;">web-demo-1</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">for</span><span style="color:#24292E;"> </span><span style="color:#032F62;">i</span><span style="color:#24292E;"> </span><span style="color:#032F62;">in</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">; </span><span style="color:#D73A49;">do</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">exec</span><span style="color:#24292E;"> </span><span style="color:#032F62;">web-demo-</span><span style="color:#24292E;">$i </span><span style="color:#005CC5;">-n</span><span style="color:#24292E;"> </span><span style="color:#032F62;">demo</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--</span><span style="color:#24292E;"> </span><span style="color:#032F62;">sh</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-c</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;hostname&#39;</span><span style="color:#24292E;">; </span><span style="color:#D73A49;">done</span></span>
<span class="line"><span style="color:#6F42C1;">web-demo-0</span></span>
<span class="line"><span style="color:#6F42C1;">web-demo-1</span></span></code></pre></div><p>我们再看看上面 StatefulSet 的 API 对象定义，有没有发现跟我们上一节中 Deployment 的定义极其相似，主要的差异在于<code>spec.serviceName</code>这个字段。它很重要，StatefulSet 根据这个字段，为每个 Pod 创建一个 DNS 域名，这个<strong>域名的格式</strong> 为<code>$(podname).(headless service name)</code>，下面我们通过例子来看一下。</p><p>当前 Pod 和 IP 之间的对应关系如下：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">get</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pod</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-n</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">demo</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-l</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">app=nginx</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-o</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">wide</span></span>
<span class="line"><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">         </span><span style="color:#9ECBFF;">READY</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">STATUS</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">RESTARTS</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">AGE</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">IP</span><span style="color:#E1E4E8;">            </span><span style="color:#9ECBFF;">NODE</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">NOMINATED</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">NODE</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">READINESS</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">GATES</span></span>
<span class="line"><span style="color:#B392F0;">web-demo-0</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">3</span><span style="color:#9ECBFF;">h17m</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">10.244</span><span style="color:#9ECBFF;">.0.39</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">kraken</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">           </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#B392F0;">web-demo-1</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">3</span><span style="color:#9ECBFF;">h17m</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">10.244</span><span style="color:#9ECBFF;">.0.40</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">kraken</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">           </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">get</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pod</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-n</span><span style="color:#24292E;"> </span><span style="color:#032F62;">demo</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-l</span><span style="color:#24292E;"> </span><span style="color:#032F62;">app=nginx</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-o</span><span style="color:#24292E;"> </span><span style="color:#032F62;">wide</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">         </span><span style="color:#032F62;">READY</span><span style="color:#24292E;">   </span><span style="color:#032F62;">STATUS</span><span style="color:#24292E;">    </span><span style="color:#032F62;">RESTARTS</span><span style="color:#24292E;">   </span><span style="color:#032F62;">AGE</span><span style="color:#24292E;">     </span><span style="color:#032F62;">IP</span><span style="color:#24292E;">            </span><span style="color:#032F62;">NODE</span><span style="color:#24292E;">     </span><span style="color:#032F62;">NOMINATED</span><span style="color:#24292E;"> </span><span style="color:#032F62;">NODE</span><span style="color:#24292E;">   </span><span style="color:#032F62;">READINESS</span><span style="color:#24292E;"> </span><span style="color:#032F62;">GATES</span></span>
<span class="line"><span style="color:#6F42C1;">web-demo-0</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">3</span><span style="color:#032F62;">h17m</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">10.244</span><span style="color:#032F62;">.0.39</span><span style="color:#24292E;">   </span><span style="color:#032F62;">kraken</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">           </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#6F42C1;">web-demo-1</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">3</span><span style="color:#032F62;">h17m</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">10.244</span><span style="color:#032F62;">.0.40</span><span style="color:#24292E;">   </span><span style="color:#032F62;">kraken</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">           </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span></span></code></pre></div><p>Podweb-demo-0 的IP 地址是 10.244.0.39，web-demo-1的 IP 地址是 10.244.0.40。这里我们通过<code>kubectl run</code>在同一个命名空间<code>demo</code>中创建一个名为 dns-test 的 Pod，同时 attach 到容器中，类似于<code>docker run -it --rm</code>这个命令。</p><p>我么在容器中运行 nslookup 来查询它们在集群内部的 DNS 地址，如下所示：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">run</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-it</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--rm</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--image</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">busybox:1.28</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">dns-test</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-n</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">demo</span></span>
<span class="line"><span style="color:#B392F0;">If</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">you</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">don&#39;t see a command prompt, try pressing enter.</span></span>
<span class="line"><span style="color:#9ECBFF;">/ # nslookup web-demo-0.nginx-demo</span></span>
<span class="line"><span style="color:#9ECBFF;">Server:    10.96.0.10</span></span>
<span class="line"><span style="color:#9ECBFF;">Address 1: 10.96.0.10 kube-dns.kube-system.svc.cluster.local</span></span>
<span class="line"><span style="color:#9ECBFF;">Name:      web-demo-0.nginx-demo</span></span>
<span class="line"><span style="color:#9ECBFF;">Address 1: 10.244.0.39 web-demo-0.nginx-demo.demo.svc.cluster.local</span></span>
<span class="line"><span style="color:#9ECBFF;">/ # nslookup web-demo-1.nginx-demo</span></span>
<span class="line"><span style="color:#9ECBFF;">Server:    10.96.0.10</span></span>
<span class="line"><span style="color:#9ECBFF;">Address 1: 10.96.0.10 kube-dns.kube-system.svc.cluster.local</span></span>
<span class="line"><span style="color:#9ECBFF;">Name:      web-demo-1.nginx-demo</span></span>
<span class="line"><span style="color:#9ECBFF;">Address 1: 10.244.0.40 web-demo-1.nginx-demo.demo.svc.cluster.local</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">run</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-it</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--rm</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--image</span><span style="color:#24292E;"> </span><span style="color:#032F62;">busybox:1.28</span><span style="color:#24292E;"> </span><span style="color:#032F62;">dns-test</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-n</span><span style="color:#24292E;"> </span><span style="color:#032F62;">demo</span></span>
<span class="line"><span style="color:#6F42C1;">If</span><span style="color:#24292E;"> </span><span style="color:#032F62;">you</span><span style="color:#24292E;"> </span><span style="color:#032F62;">don&#39;t see a command prompt, try pressing enter.</span></span>
<span class="line"><span style="color:#032F62;">/ # nslookup web-demo-0.nginx-demo</span></span>
<span class="line"><span style="color:#032F62;">Server:    10.96.0.10</span></span>
<span class="line"><span style="color:#032F62;">Address 1: 10.96.0.10 kube-dns.kube-system.svc.cluster.local</span></span>
<span class="line"><span style="color:#032F62;">Name:      web-demo-0.nginx-demo</span></span>
<span class="line"><span style="color:#032F62;">Address 1: 10.244.0.39 web-demo-0.nginx-demo.demo.svc.cluster.local</span></span>
<span class="line"><span style="color:#032F62;">/ # nslookup web-demo-1.nginx-demo</span></span>
<span class="line"><span style="color:#032F62;">Server:    10.96.0.10</span></span>
<span class="line"><span style="color:#032F62;">Address 1: 10.96.0.10 kube-dns.kube-system.svc.cluster.local</span></span>
<span class="line"><span style="color:#032F62;">Name:      web-demo-1.nginx-demo</span></span>
<span class="line"><span style="color:#032F62;">Address 1: 10.244.0.40 web-demo-1.nginx-demo.demo.svc.cluster.local</span></span></code></pre></div><p>可以看到，每个 Pod 都有一个对应的 <a href="https://baike.baidu.com/item/A%E8%AE%B0%E5%BD%95/1188077?fr=aladdin" target="_blank" rel="noreferrer">A 记录</a>。</p><p>我们现在删除一下这些 Pod，看看会有什么变化：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">delete</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pod</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-l</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">app=nginx</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-n</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">demo</span></span>
<span class="line"><span style="color:#B392F0;">pod</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;web-demo-0&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">deleted</span></span>
<span class="line"><span style="color:#B392F0;">pod</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;web-demo-1&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">deleted</span></span>
<span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">get</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pod</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-l</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">app=nginx</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-n</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">demo</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-o</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">wide</span></span>
<span class="line"><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">         </span><span style="color:#9ECBFF;">READY</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">STATUS</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">RESTARTS</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">AGE</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">IP</span><span style="color:#E1E4E8;">            </span><span style="color:#9ECBFF;">NODE</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">NOMINATED</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">NODE</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">READINESS</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">GATES</span></span>
<span class="line"><span style="color:#B392F0;">web-demo-0</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">s</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">10.244</span><span style="color:#9ECBFF;">.0.50</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">kraken</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">           </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#B392F0;">web-demo-1</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">13</span><span style="color:#9ECBFF;">s</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">10.244</span><span style="color:#9ECBFF;">.0.51</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">kraken</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">           </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">delete</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pod</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-l</span><span style="color:#24292E;"> </span><span style="color:#032F62;">app=nginx</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-n</span><span style="color:#24292E;"> </span><span style="color:#032F62;">demo</span></span>
<span class="line"><span style="color:#6F42C1;">pod</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;web-demo-0&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deleted</span></span>
<span class="line"><span style="color:#6F42C1;">pod</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;web-demo-1&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deleted</span></span>
<span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">get</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pod</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-l</span><span style="color:#24292E;"> </span><span style="color:#032F62;">app=nginx</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-n</span><span style="color:#24292E;"> </span><span style="color:#032F62;">demo</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-o</span><span style="color:#24292E;"> </span><span style="color:#032F62;">wide</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">         </span><span style="color:#032F62;">READY</span><span style="color:#24292E;">   </span><span style="color:#032F62;">STATUS</span><span style="color:#24292E;">    </span><span style="color:#032F62;">RESTARTS</span><span style="color:#24292E;">   </span><span style="color:#032F62;">AGE</span><span style="color:#24292E;">   </span><span style="color:#032F62;">IP</span><span style="color:#24292E;">            </span><span style="color:#032F62;">NODE</span><span style="color:#24292E;">     </span><span style="color:#032F62;">NOMINATED</span><span style="color:#24292E;"> </span><span style="color:#032F62;">NODE</span><span style="color:#24292E;">   </span><span style="color:#032F62;">READINESS</span><span style="color:#24292E;"> </span><span style="color:#032F62;">GATES</span></span>
<span class="line"><span style="color:#6F42C1;">web-demo-0</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">s</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">10.244</span><span style="color:#032F62;">.0.50</span><span style="color:#24292E;">   </span><span style="color:#032F62;">kraken</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">           </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#6F42C1;">web-demo-1</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">13</span><span style="color:#032F62;">s</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">10.244</span><span style="color:#032F62;">.0.51</span><span style="color:#24292E;">   </span><span style="color:#032F62;">kraken</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">           </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span></span></code></pre></div><p>删除成功后，可以发现 StatefulSet 立即生成了新的 Pod，但是 Pod 名称维持不变。唯一变化的就是 IP 发生了改变。</p><p>我们再来看看 DNS 记录：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">run</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-it</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--rm</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--image</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">busybox:1.28</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">dns-test</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-n</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">demo</span></span>
<span class="line"><span style="color:#B392F0;">If</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">you</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">don&#39;t see a command prompt, try pressing enter.</span></span>
<span class="line"><span style="color:#9ECBFF;">/ # nslookup web-demo-0.nginx-demo</span></span>
<span class="line"><span style="color:#9ECBFF;">Server:    10.96.0.10</span></span>
<span class="line"><span style="color:#9ECBFF;">Address 1: 10.96.0.10 kube-dns.kube-system.svc.cluster.local</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9ECBFF;">Name:      web-demo-0.nginx-demo</span></span>
<span class="line"><span style="color:#9ECBFF;">Address 1: 10.244.0.50 web-demo-0.nginx-demo.demo.svc.cluster.local</span></span>
<span class="line"><span style="color:#9ECBFF;">/ # nslookup web-demo-1.nginx-demo</span></span>
<span class="line"><span style="color:#9ECBFF;">Server:    10.96.0.10</span></span>
<span class="line"><span style="color:#9ECBFF;">Address 1: 10.96.0.10 kube-dns.kube-system.svc.cluster.local</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9ECBFF;">Name:      web-demo-1.nginx-demo</span></span>
<span class="line"><span style="color:#9ECBFF;">Address 1: 10.244.0.51 web-demo-1.nginx-demo.demo.svc.cluster.local</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">run</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-it</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--rm</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--image</span><span style="color:#24292E;"> </span><span style="color:#032F62;">busybox:1.28</span><span style="color:#24292E;"> </span><span style="color:#032F62;">dns-test</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-n</span><span style="color:#24292E;"> </span><span style="color:#032F62;">demo</span></span>
<span class="line"><span style="color:#6F42C1;">If</span><span style="color:#24292E;"> </span><span style="color:#032F62;">you</span><span style="color:#24292E;"> </span><span style="color:#032F62;">don&#39;t see a command prompt, try pressing enter.</span></span>
<span class="line"><span style="color:#032F62;">/ # nslookup web-demo-0.nginx-demo</span></span>
<span class="line"><span style="color:#032F62;">Server:    10.96.0.10</span></span>
<span class="line"><span style="color:#032F62;">Address 1: 10.96.0.10 kube-dns.kube-system.svc.cluster.local</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032F62;">Name:      web-demo-0.nginx-demo</span></span>
<span class="line"><span style="color:#032F62;">Address 1: 10.244.0.50 web-demo-0.nginx-demo.demo.svc.cluster.local</span></span>
<span class="line"><span style="color:#032F62;">/ # nslookup web-demo-1.nginx-demo</span></span>
<span class="line"><span style="color:#032F62;">Server:    10.96.0.10</span></span>
<span class="line"><span style="color:#032F62;">Address 1: 10.96.0.10 kube-dns.kube-system.svc.cluster.local</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032F62;">Name:      web-demo-1.nginx-demo</span></span>
<span class="line"><span style="color:#032F62;">Address 1: 10.244.0.51 web-demo-1.nginx-demo.demo.svc.cluster.local</span></span></code></pre></div><p>可以看出，<strong>DNS 记录中 Pod 的域名没有发生变化</strong> ，<strong>仅仅 IP 地址发生了更换</strong> 。因此当 Pod 所在的节点发生故障导致 Pod 飘移到其他节点上，或者 Pod 因故障被删除重建，Pod 的 IP 都会发生变化，但是 Pod 的域名不会有任何变化，这也就意味着<strong>服务间可以通过不变的 Pod 域名来保障通信稳定</strong> ，<strong>而不必依赖 Pod IP</strong>。</p><p>有了<code>spec.serviceName</code>这个字段，保证了 StatefulSet 关联的 Pod 可以有稳定的网络身份标识，即 Pod 的序号、主机名、DNS 记录名称等。</p><p>最后一个我想说的是，对于有状态的服务来说，每个副本都会用到持久化存储，且各自使用的数据是不一样的。</p><p>StatefulSet 通过 PersistentVolumeClaim（PVC）可以保证 Pod 的存储卷之间一一对应的绑定关系。同时，删除 StatefulSet 关联的 Pod 时，不会删除其关联的 PVC。</p><p>我们会在后续网络存储的章节中来专门介绍，再次先略过。</p><h3 id="如何更新升级-statefulset" tabindex="-1">如何更新升级 StatefulSet <a class="header-anchor" href="#如何更新升级-statefulset" aria-label="Permalink to &quot;如何更新升级 StatefulSet&quot;">​</a></h3><p>那么，如果想对一个 StatefulSet 进行升级，该怎么办呢？</p><p>在 StatefulSet 中，支持两种更新升级策略，即 RollingUpdate 和 OnDelete。</p><p>RollingUpdate策略是<strong>默认的更新策略</strong> 。可以实现 Pod 的滚动升级，跟我们上一节课中 Deployment 介绍的RollingUpdate策略一样。比如我们这个时候做了镜像更新操作，那么整个的升级过程大致如下，先逆序删除所有的 Pod，然后依次用新镜像创建新的 Pod 出来。这里你可以通过<code>kubectl get pod -n demo -w -l app=nginx</code>来动手观察下。</p><p>同时使用 RollingUpdate 更新策略还支持通过 partition 参数来分段更新一个 StatefulSet。所有序号大于或者等于 partition 的Pod 都将被更新。你这里也可以手动更新 StatefulSet 的配置来实验下。</p><p>当你把更新策略设置为 OnDelete 时，我们就必须手动先删除 Pod，才能触发新的 Pod 更新。</p><h3 id="写在最后" tabindex="-1">写在最后 <a class="header-anchor" href="#写在最后" aria-label="Permalink to &quot;写在最后&quot;">​</a></h3><p>现在我们就总结下 StatefulSet 的特点：</p><ul><li><p>具备固定的网络标记，比如主机名，域名等；</p></li><li><p>支持持久化存储，而且最好能够跟实例一一绑定；</p></li><li><p>可以按照顺序来部署和扩展；</p></li><li><p>可以按照顺序进行终止和删除操作；</p></li><li><p>在进行滚动升级的时候，也会按照一定顺序。</p></li></ul><p>借助 StatefulSet 的这些能力，我们就可以去部署一些有状态服务，比如 MySQL、ZooKeeper、MongoDB 等。你可以跟着这个<a href="https://kubernetes.io/zh/docs/tutorials/stateful-application/zookeeper/" target="_blank" rel="noreferrer">教程</a>在 Kubernetes 中搭建一个 ZooKeeper 集群。</p><p>到这里这节课就结束了，下节课我们就来学习配置管理。如果你对本节课有什么想法或者疑问，欢迎你在留言区留言，我们一起讨论。</p>`,64),e=[o];function t(c,r,y,E,F,i){return n(),a("div",null,e)}const m=s(p,[["render",t]]);export{C as __pageData,m as default};
